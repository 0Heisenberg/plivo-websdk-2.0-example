/* Name: JsSIP Maintainer: José Luis Millán <jmillan@aliax.net> Copyright (c) 2012-2016 José Luis Millán <jmillan@aliax.net> License: The MIT License Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.*/
/*Copyright (c) 2013-2016, callstats.io All rights reserved.THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.*/
var Plivo=function(){var e=1,t=function n(e,t,r){function i(s,a){if(!t[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=t[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,n,e,t,r)}return t[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){var t=new i(e);Object.defineProperties(this,{client:{enumerable:!0,value:t}})}var i=e("./client");t.exports=r},{"./client":2}],2:[function(e,t,n){"use strict";function r(t){if("object"==typeof window._PlivoInstance)return Plivo.log.info("window.Plivo object and its instance already exist"),window._PlivoInstance;if(!(this instanceof r))return new r(t);var n=this,o={codecs:a.DEFAULT_CODECS,enableTracking:!0,debug:"INFO",permOnClick:!1,enableIPV6:!1,audioConstraints:!0,dscp:!0,appId:null,appSecret:null,registrationDomainSocket:null,clientRegion:null,preDetectOwa:!1,disableRtpTimeOut:!1};if(this.permOnClick=!1,this.ringToneFlag=!0,this.ringToneBackFlag=!0,this.connectToneFlag=!0,this.isLoggedIn=!1,this.localStorage="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,this.log=new c({enableDate:!0,loggingName:"PlivoSDK",logMethod:"DEBUG"}),Plivo.log=n.log,"undefined"!=typeof t)for(var l in t)switch(l){case"enableTracking":p.isBoolean(l,t[l])&&(o.enableTracking=t[l]);break;case"debug":t[l]=t[l].toUpperCase(),p.debug(t[l],a.DEBUG_MODES)?(o.debug=t[l],"ALL-PLAIN"==t[l]&&(t[l]="ALL"),n.log.setLevel(t[l])):n.log.setLevel("INFO");break;case"permOnClick":p.isBoolean(l,t[l])&&(n.permOnClick=t[l],o.permOnClick=t[l]);break;case"audioConstraints":t[l]&&(o.audioConstraints=t[l]);break;case"dscp":p.isBoolean(l,t[l])&&(o.dscp=t[l]);break;case"codecs":p.codecs(t[l],a.DEFAULT_CODECS)&&(o.codecs=t[l]);break;case"appSecret":o.appSecret=t[l];break;case"appId":o.appId=t[l];break;case"registrationDomainSocket":o.registrationDomainSocket=t[l];break;case"enableIPV6":break;case"clientRegion":p.region(t[l],a.REGION)&&(o.clientRegion=t[l]);break;case"preDetectOwa":p.isBoolean(l,t[l])&&(o.preDetectOwa=t[l]);break;case"disableRtpTimeOut":p.isBoolean(l,t[l])&&(o.disableRtpTimeOut=t[l]);break;default:Plivo.log.warn("Ignoring invalid option key "+l)}["ALL","ALL-PLAIN"].indexOf(o.debug)!=-1?(this.localStorage.debug="PlivoSIP:*",window._PlivoUseColorLog=!0,"ALL-PLAIN"==o.debug&&(window._PlivoUseColorLog=!1)):this.localStorage.debug="",s.call(this),i=e("../sipLib/JsSIP"),this.phone=null,this.callSession=null,this.callUUID=null,this.lastCallUUID=null,this.callDirection=null,this.callStats=null,this.userName=null,this.options=o,this.audio={availableDevices:d.availableDevices,ringtoneDevices:d.ringtoneDevices,microphoneDevices:d.inputDevices,speakerDevices:d.outputDevices,revealAudioDevices:d.revealAudioDevices},this.audioConstraints=this.options.audioConstraints,this.browserDetails=i.adapter.browserDetails,this.owaLastDetect={time:0,isOneWay:!0},this.owaDetectTime=36e5,this.connStage=[],this.str=function(e){return JSON.stringify(e)},Plivo.audioConstraints=this.audioConstraints,Plivo.AppError=function(e,t){if(n.userName&&n.callStats){var r;r=n.callUUID?n.callUUID:n.userName,"[object Object]"==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),t&&Plivo.log.debug("Call summary "+r+"\n",e),n.callStats.reportError(null,r,n.callStats.webRTCFunctions.applicationLog,e)}return!0},f.setup(n.options,function(e){if(window.RTCPeerConnection||(Plivo.log.error("No webRTC support"),document.onreadystatechange=function(){"complete"==document.readyState&&n.emit("onWebrtcNotSupported")}),n.emit("onMediaPermission",e),"failure"==e.status&&n.userName&&n.callStats){var r=new DOMError("getUserMedia Error",e.error);n.callStats.reportError(null,n.userName,n.callStats.webRTCFunctions.getUserMedia,r)}"success"==e.status&&e.stream&&d.audioDevDictionary.call(n,!0).then(function(){Plivo.log.debug("audioDevDictionary is updated onMediaPermission: "+e.status)}),n.remoteView=document.getElementById(a.REMOTE_VIEW_ID),n.ringToneView=document.getElementById(a.RINGTONE_ELEMENT_ID),n.ringBackToneView=document.getElementById(a.RINGBACK_ELEMENT_ID),n.connectToneView=document.getElementById(a.CONNECT_TONE_ELEMENT_ID),Plivo.log.info("PlivoWebSdk initialized in "+n.log.level()+" mode, version: 2.0.19"),Plivo.log.debug("PlivoWebSdk initialized with ",n.str(t)),Plivo.log.info(n.str(n.browserDetails))}),navigator.mediaDevices.ondevicechange=function(e){d.checkAudioDevChange.call(n)},"chrome"==i.adapter.browserDetails.browser&&i.adapter.browserDetails.version<57&&setInterval(function(){d.checkAudioDevChange.call(n)},5e3),n.audioDevDic=null,d.audioDevDictionary.call(this,!0),window._PlivoInstance=this}var i,o=e("util").inherits,s=e("events").EventEmitter,a=e("./util/constants"),l=e("./util/codecPreference"),u=e("./util/callAnalytics"),c=e("./util/logger"),d=e("./media/audioDevice"),f=e("./media/document"),h=e("./util/headers"),p=e("./util/validateOptions");o(r,s),r.prototype.login=function(e,t){if("undefined"==typeof e||"undefined"==typeof t||null===e||null===t&&(e.length<=0||t.length<=0))return Plivo.log.error("username & password cant be null"),this.emit("onLoginFailed","Username and password must be filled out"),!1;this.phone&&(this.phone.stop(),delete this.phone,Plivo.log.debug("deleting the existing phone instance")),this.options.registrationDomainSocket&&(a.WS_SERVERS=this.options.registrationDomainSocket);var n=new i.WebSocketInterface(a.WS_SERVERS),r={sockets:[n],register_expires:a.REGISTER_EXPIRES_SECONDS,uri:e+"@"+a.DOMAIN,password:t,googIPv6:this.enableIPV6||!1,connection_recovery_max_interval:a.WS_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:a.WS_RECOVERY_MIN_INTERVAL,session_timers:!1};try{this.phone=new i.UA(r)}catch(o){return Plivo.log.debug("Failed to create user agent"+o),!1}Plivo.log.info("Ready to login");var s=this,c=!1;return this.phone.on("connected",function(e){if(Plivo.log.info("websocket connection established",e),!c){c=!0;var t={state:"connected"};s.emit("onConnectionChange",t)}}),this.phone.on("disconnected",function(e){if(Plivo.log.info("websocket connection closed",e),c&&e&&e.code>1e3){var t={state:"disconnected",eventCode:e.code,eventReason:e.reason};s.emit("onConnectionChange",t)}c=!1}),this.phone.on("registered",function(){if(s.userName=e,s.isLoggedIn===!1&&(s.isLoggedIn=!0,s.emit("onLogin"),Plivo.log.debug("logged in"),s.options.enableTracking&&!s.callStats)){s.options.appId?null:s.options.appId="380077084",window.csioChromeLegacyGetStats=!0,s.callStats=new callstats;var t={disableBeforeUnloadHandler:!1,applicationVersion:"2.0.19"},n=function(e,t){Plivo.log.debug("Stats Initializing Status: err= "+e+" msg= "+t)},r=function(e){var t=e.streams;u.call(s,g,t),window._PlivoDevLogging&&console.log(t)};if("chrome"!=i.adapter.browserDetails.browser&&(r=null),s.callStats){var o=s.options.appSecret||S(s);s.callStats.initialize(s.options.appId,o,e,n,r,t)}Plivo.log.debug("enableTracking initialized")}}),this.phone.on("unregistered",function(){Plivo.log.debug("Plivo client logged out"),s.isLoggedIn=!1,s.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),s.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID),s.userName=null,s.emit("onLogout")}),this.phone.on("registrationFailed",function(e){s.isLoggedIn=!1,Plivo.log.debug("Login failed : ",e.cause),s.userName=null,s.emit("onLoginFailed",e.cause)}),this.phone.on("newRTCSession",function(e){if(Plivo.log.debug("new rtc session"),s.callSession&&"closed"==s.callSession.connection.signalingState&&(Plivo.log.warn("Previous call doesn't end properly"),s.callSession=null),s.callSession){Plivo.log.debug("Already on call, sending busy signal.");var t={status_code:486,reason_phrase:"Busy Here"};return void e.session.terminate(t)}if(s.callSession=e.session,"remote"===e.originator){s.callDirection="incoming",Plivo.log.info("<----- INCOMING ----->"),s.connStage=[],s.connStage.push("I-invite@"+y()),s.callUUID=e.request.getHeader("X-Calluuid")||null;var n=e.request.getHeader("From");s.caller=n.match(/:(.*)@/i)[1];try{e.request.body=l(s.options.codecs,e.request.body)}catch(r){Plivo.log.debug("checkCodecPreference err - ",r)}s.callSession.on("progress",function(e){Plivo.log.debug("Incoming call progress"),s.connStage.push("progress-180@"+y());var t=s.callSession.remote_identity.uri.toString();s.ringToneFlag!==!1&&(Plivo.log.debug("ringtone enabled : ",s.ringToneFlag),f.playAudio(a.RINGTONE_ELEMENT_ID)),s.emit("onIncomingCall",t.substring(4,t.indexOf("@"))+"@"+a.DOMAIN,c),Plivo.log.debug("Incoming Call Extra Headers : ",c)}),s.callSession.on("sdp",function(e){Plivo.log.debug("Incoming call SDP processing done")}),s.callSession.on("accepted",function(e){Plivo.log.info("Incoming call accepted"),_(s);var t=s.callSession.connection||null;t.oniceconnectionstatechange=function(e){var n=t.iceConnectionState;if(Plivo.log.debug("oniceconnectionstatechange:: "+n),s.connStage.push("iceConnectionState-"+n+"@"+y()),T.call(s,n),s.callStats&&s.callUUID&&t&&("failed"==n||"disconnected"==n)){var r=new DOMError(n,n);s.callStats.reportError(t,s.callUUID,s.callStats.webRTCFunctions.iceConnectionFailure,r)}}}),s.callSession.on("confirmed",function(e){Plivo.log.debug("Incoming call confirmed - "+s.callUUID),s.connStage.push("confirmed@"+y()),s.options.disableRtpTimeOut&&(s.callSession.connection.disableRtpTimeOut=!0);var t=this.connection.getRemoteStreams()[0];t||Plivo.log.error("Incoming call remoteStream does not exists"),s.remoteView.srcObject=t;var n=function(e){Plivo.log.debug("Stats new fabric message: "+e)};s.callStats&&this.connection&&s.callStats.addNewFabric(this.connection,s.caller,s.callStats.fabricUsage.audio,s.callUUID,n),s.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),s.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID),s.emit("onCallAnswered"),Plivo.log.debug("Plivo Event: Post-Answer detecting OWA"),setTimeout(v,3e3,this.connection,s)}),s.callSession.on("icetimeout",function(e){Plivo.log.debug("iceGathering timed out"),g(s,"network","warning","ice_timeout",e,!0,"Possible NAT/Firewall issue")}),s.callSession.on("failed",function(e){if(Plivo.log.error("Call failed: "+e.cause),s.connStage.push("failed@"+y()),s.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),e.cause==i.C.causes.CANCELED&&"incoming"==s.callDirection?s.emit("onIncomingCallCanceled"):s.emit("onCallFailed",e.cause),s.callStats&&s.callUUID&&this.connection&&!e.cause.match("edia")){var t,n;e.message&&(t=e.cause,n=t,e.message.status_code&&(n=String(e.message.status_code)));var r=new DOMError(t,n);Plivo.log.debug(r),s.callStats.reportError(this.connection,s.callUUID,s.callStats.webRTCFunctions.signalingError,r)}k(s)}),s.callSession.on("ended",function(e){Plivo.log.debug("Incoming call ended - "+s.callUUID),Plivo.log.info("Incoming call ended"),s.connStage.push("ended@"+y()),s.callStats&&s.callStats.sendFabricEvent(this.connection,s.callStats.fabricEvent.fabricTerminated,s.callUUID),s.emit("onCallTerminated",{originator:e.originator,reason:e.cause}),k(s)}),s.callSession.on("getusermediafailed",function(e){Plivo.log.error("getusermediafailed: "+e),s.userName&&s.callStats&&(e.message="getusermediafailed",s.callStats.reportError(null,s.userName,s.callStats.webRTCFunctions.getUserMedia,e))}),s.callSession.on("peerconnection:createofferfailed",function(e){Plivo.log.error("peerconnection:createofferfailed: ",e),s.userName&&s.callStats&&(e.message="peerconnection:createofferfailed",s.callStats.reportError(null,s.userName,s.callStats.webRTCFunctions.createOffer,e))}),s.callSession.on("peerconnection:createanswerfailed",function(e){Plivo.log.error("peerconnection:createanswerfailed: ",e),s.userName&&s.callStats&&(e.message="peerconnection:createanswerfailed",s.callStats.reportError(null,s.userName,s.callStats.webRTCFunctions.createAnswer,e))}),s.callSession.on("peerconnection:setlocaldescriptionfailed",function(e){Plivo.log.error("peerconnection:setlocaldescriptionfailed: ",e),s.userName&&s.callStats&&(e.message="peerconnection:setlocaldescriptionfailed",s.callStats.reportError(null,s.userName,s.callStats.webRTCFunctions.setLocalDescription,e))}),s.callSession.on("peerconnection:setremotedescriptionfailed",function(e){Plivo.log.error("peerconnection:setremotedescriptionfailed: ",e),e.message&&"pranswer not yet implemented"==!e.message&&s.userName&&s.callStats&&s.callStats.reportError(null,s.userName,s.callStats.webRTCFunctions.setRemoteDescription,e)});var o=e.request,u=o.headers,c=h.receiveExtraHeader(o,u);Plivo.log.debug("callSession - "+s.callUUID)}else s.callDirection="outgoing",Plivo.log.debug("new RTCSession outgoing"),s.emit("onCalling")}),this.phone.start(),!0},r.prototype.logout=function(){return Plivo.log.debug("logout() triggered!"),this.callSession&&(Plivo.log.debug("Terminating an active call"),this.callSession.terminate()),this.connStage.push("logout()@"+y()),this.phone&&this.phone.stop(),this.emit("onLogout"),!0},r.prototype.call=function(e,t){function n(e){return i.emit("onCallFailed",e),!0}function r(){return i.owaLastDetect.isOneWay=!1,m(i,t,e)}var i=this;return Plivo.log.info("<----- OUTGOING ----->"),i.connStage=[],Plivo.log.info("Outgoing call initialized to : "+e),this.isLoggedIn?(i.connStage.push("call()@"+y()),void(i.options.preDetectOwa&&"chrome"==i.browserDetails.browser&&(new Date-i.owaLastDetect.time>i.owaDetectTime||i.owaLastDetect.isOneWay)?C(function(e,t){return i.owaLastDetect.time=new Date,t?(Plivo.log.error("Error in detecting microphone status ",t),i.emit("onMediaPermission",{status:"failure",error:t.name}),n("media - "+t.name),!1):(Plivo.log.debug("getUserMedia precheck ",e),0==Number(e.bytesSent)&&0==Number(e.audioInputLevel)?(g(i,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser"),i.owaLastDetect.isOneWay=!0,n("no_microphone_access"),!1):(0==Number(e.audioInputLevel)&&g(i,"audio","warning","no_microphone_access",0,!0,"microphone is muted"),void r()))}):r())):(Plivo.log.warn("Must be logged in before make a call"),!1)},r.prototype.answer=function(){function e(e){return n.reject(),!0}function t(){if(n.owaLastDetect.isOneWay=!1,r.pcConfig={iceServers:[{urls:a.STUN_SERVERS}]},n.permOnClick){var e=n.options.audioConstraints||!0;r.mediaConstraints={audio:e,video:!1}}else!!window.localStream||Plivo.log.warn("no localStream attached for this call");r.mediaStream=window.localStream||null,r.rtcConstraints=n.options.dscp?{optional:[{googDscp:!0}]}:null,r.sessionTimersExpires=a.SESSION_TIMERS_EXPIRES;try{n.callSession&&n.callSession.answer(r)}catch(t){Plivo.log.error("error in answering : ",t),n.emit("onIncomingCallCanceled",t)}return n.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),!0}Plivo.log.debug("answer - "+this.callUUID);var n=this,r={};return this.callSession?(n.connStage.push("answer()@"+y()),n.options.preDetectOwa&&"chrome"==n.browserDetails.browser&&(new Date-n.owaLastDetect.time>n.owaDetectTime||n.owaLastDetect.isOneWay)?C(function(r,i){return n.owaLastDetect.time=new Date,i?(Plivo.log.error("Error in detecting microphone status ",i),n.emit("onMediaPermission",{status:"failure",error:i.name}),e("media - "+i.name),!1):(Plivo.log.debug("getUserMedia precheck ",n.str(r)),0==Number(r.bytesSent)&&0==Number(r.audioInputLevel)?(g(n,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser"),n.owaLastDetect.isOneWay=!0,e("no_microphone_access"),!1):(0==Number(r.audioInputLevel)&&g(n,"audio","warning","no_microphone_access",0,!0,"microphone is muted"),void t()))}):t(),!0):(Plivo.log.error("Incoming call answer() failed : no incoming call"),!1)},r.prototype.hangup=function(){if(Plivo.log.debug("hangup - "+this.callUUID),!this.callSession)return Plivo.log.warn("No call session exists to hangup"),!1;"outgoing"==this.callSession.direction||E(this.callSession)||Plivo.log.warn("use of hangup() on unanswered call is deprecated. use reject() instead");try{Plivo.log.info("hangup initialized"),Plivo.AppError({name:"hangup",message:"hangup initialized",method:"hangup()"}),this.callSession.terminate(),this.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID)}catch(e){Plivo.log.error("Could not hangup reason : ",e),Plivo.AppError({name:e.name,message:e.message,method:"hangup()"})}return!0},r.prototype.reject=function(){if(Plivo.log.debug("reject - "+this.callUUID),!this.callSession)return Plivo.log.warn("No call session exists to reject()"),!1;if(E(this.callSession))return Plivo.log.warn("call already answerd, please use hangup() method"),!1;if(this.callSession){var e={status_code:486,reason_phrase:"Busy Here"};Plivo.log.info("rejecting call"),Plivo.AppError({name:"reject",message:"reject initialized",method:"reject()"});try{this.callSession.terminate(e)}catch(t){Plivo.log.error("error in rejecting call : ",t),Plivo.AppError({name:t.name,message:t.message,method:"reject()"})}return this.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),!0}},r.prototype.sendDtmf=function(e){if(Plivo.log.debug("sendDtmf - "+this.callUUID),"undefined"==typeof e||null==e)return Plivo.log.warn("DTMF digit can not be null");if("undefined"==typeof a.DTMF_TONE_FLAG[e])return Plivo.log.warn(e+" is not a valid DTMF digit");if(this.callSession)try{return Plivo.log.debug("sending dtmf digit "+e),this.callSession.sendDTMF(e),"*"===e?f.playAudio("dtmfstar"):"#"===e?f.playAudio("dtmfpound"):f.playAudio("dtmf"+e)}catch(t){Plivo.log.error("Call has not been confirmed cannot send DTMF"),Plivo.AppError({name:t.name,message:t.message,method:"sendDtmf()"})}else Plivo.log.warn("No call session exists to sendDtmf")},r.prototype.mute=function(){if(!this.callSession)return Plivo.log.warn("No call session exists to mute"),!1;Plivo.log.debug("mute called");try{this.callSession.mute(),this.callStats&&this.callStats.sendFabricEvent(this.callSession.connection,this.callStats.fabricEvent.audioMute,this.callUUID)}catch(e){Plivo.log.error("error in mute :",e),Plivo.AppError({name:e.name,message:e.message,method:"mute()"})}return!0},r.prototype.unmute=function(){if(!this.callSession)return Plivo.log.warn("No call session exists to unmute"),!1;Plivo.log.debug("unmute called");try{this.callSession.unmute(),this.callStats&&this.callStats.sendFabricEvent(this.callSession.connection,this.callStats.fabricEvent.audioUnmute,this.callUUID)}catch(e){Plivo.log.error("error in unmute : ",e),Plivo.AppError({name:e.name,message:e.message,method:"unmute()"})}return!0},r.prototype.setRingTone=function(e){return e===!1||null===e?this.ringToneFlag=!1:"string"==typeof e?(this.ringToneFlag="user",Plivo.log.debug("setRingTone() url : "+e),this.ringToneView.src=e):this.ringToneFlag=!0,!0},r.prototype.setRingToneBack=function(e){return e===!1||null===e?this.ringToneBackFlag=!1:"string"==typeof e?(this.ringToneBackFlag="user",Plivo.log.debug("setRingToneBack() url : "+e),this.ringBackToneView.src=e):this.ringToneBackFlag=!0,!0},r.prototype.setConnectTone=function(e){return e?this.connectToneFlag=!0:this.connectToneFlag=!1,!0},r.prototype.setDtmfTone=function(e,t){if(t===!1||null===t)a.DTMF_TONE_FLAG[e]=!1;else if("string"==typeof t){Plivo.log.debug("set dtmf tone"),a.DTMF_TONE_FLAG[e]="user";var n="dtmf"+e,r=document.getElementById(n);r.src=t}else a.DTMF_TONE_FLAG[e]=!0;return!0},r.prototype.getCallUUID=function(){return this.callUUID},r.prototype.getLastCallUUID=function(){return this.lastCallUUID},r.prototype.setDebug=function(e){e&&["INFO","DEBUG","WARN","ERROR","ALL","OFF"].indexOf(e)!=-1&&Plivo.log.setLevel(e)},r.prototype.getPeerConnection=function(){return this.callSession&&E(this.callSession)?{status:"success",pc:this.callSession.connection}:{status:"called in wrong state",pc:null}},r.prototype.version="2.0.19",r.prototype.webRTC=function(){return!!window.RTCPeerConnection},r.prototype.supportedBrowsers=function(){return"Chrome, Firefox"},r.prototype.sendQualityFeedback=function(e,t,n){var t=Number(t);if(!this.callStats)return void Plivo.log.warn("Stats integration not configured, ignoring feedback");if(!this.userName)return void Plivo.log.error("sendQualityFeedback() userName is null, isLoggedIn : "+this.isLoggedIn);if(!e)return void Plivo.log.error("sendQualityFeedback() callUUID is mandatory");if(n&&n.toString().length>200)return void Plivo.log.error("sendQualityFeedback() comment max length is 200 character");if(n||Plivo.log.error("sendQualityFeedback() comment is mandatory"),t>0&&t<=5){var r={userID:this.userName,overall:t,comment:n},i=function(e){Plivo.log.debug("Stats sendFeedback status: "+e)};Plivo.log.debug("Feedback sent for callUUID : "+e),this.callStats.sendUserFeedback(e,r,i)}else Plivo.log.error("sendQualityFeedback() score: "+t+" , score should be from 1-5 range")};var v=function(e,t){if(e&&"closed"!=e.signalingState&&"chrome"==i.adapter.browserDetails.browser){var n=e;n.getStats(function(e){e.result().forEach(function(e){var n=e;n.stat("bytesSent")&&Plivo.log.debug("Bytes sent by WebSDK client: "+n.stat("bytesSent")+" audioInputLevel: "+n.stat("audioInputLevel")),t.storage.audioCodec=n.stat("googCodecName"),"ssrc"===n.type&&"audio"===n.stat("mediaType")&&0===parseInt(n.stat("bytesSent"),10)&&0===n.stat("audioInputLevel")&&(Plivo.log.debug("One way audio detected"),g(t,"audio","warning","no_microphone_access",0,!0,"no access to your microphone"))})},n.getLocalStreams()[0].getAudioTracks()[0],function(e){console.log(e)})}},g=function(e,t,n,r,i,o,s){var a={group:t,level:n,type:r,value:i,active:o,desc:s||""};e.emit("mediaMetrics",a)},m=function(e,t,n){var r,i={};if(n&&(n=String(n)),"undefined"==typeof n||null===n||n.length<=0)return Plivo.log.warn("Destination address cant be null and its length must be > 0"),!1;if(e.callSession)return Plivo.log.warn("Can't make another call while in call"),!1;t=t||{};var o=[];for(var s in t){var u=t[s];h.checkExtraHeaderKey(s)&&h.checkExtraHeaderVal(u)?(o.push(s+": "+u),Plivo.log.debug("valid hdr = "+s+" -> "+u)):Plivo.log.debug("invalid hdr = "+s+" -> "+u)}e.options.clientRegion&&o.push("X-ClientRegion: "+e.options.clientRegion),r="sip:"!=n.substring(0,4)?"sip:"+n:n,i.sessionTimersExpires=a.SESSION_TIMERS_EXPIRES,i.pcConfig={iceServers:[{urls:a.STUN_SERVERS}]};var c=e.options.audioConstraints||!0;i.mediaConstraints={audio:c,video:!1},i.rtcConstraints=e.options.dscp?{optional:[{googDscp:!0}]}:null,i.extraHeaders=o,i.mediaStream=window.localStream||null,i.eventHandlers={sending:function(t){Plivo.log.debug("Outgoing call sending"),e.connStage.push("O-invite@"+y());var n=this.connection||null;e.connectToneFlag!==!1&&f.playAudio(a.CONNECT_TONE_ELEMENT_ID),n.ontrack=function(t){Plivo.log.debug("Outgoing call received addStream"),e.connStage.push("addStream-success@"+y()),t.streams[0]?(setTimeout(function(){e.remoteView.srcObject=t.streams[0]},100),e.ringToneBackFlag&&!E(e.callSession)?setTimeout(function(){E(e.callSession)||e.remoteView.pause()},100):e.ringToneBackFlag||E(e.callSession)||Plivo.log.debug("playAudio - MediaServer")):(Plivo.log.error("Outgoing call addStream failure"),e.connStage.push("addStream-failure@"+y()))},n.oniceconnectionstatechange=function(){var t=n.iceConnectionState;if(Plivo.log.debug("oniceconnectionstatechange:: "+t),e.connStage.push("iceConnectionState-"+t+"@"+y()),T.call(e,t),e.callStats&&e.callUUID&&n&&("failed"==t||"disconnected"==t)){Plivo.log.debug("iceState :: "+t);var r=new DOMError(t,t);e.callStats.reportError(n,e.callUUID,e.callStats.webRTCFunctions.iceConnectionFailure,r)}}},sdp:function(t){try{t.sdp=l(e.options.codecs,t.sdp)}catch(n){Plivo.log.debug("checkCodecPreference err - ",n)}},progress:function(t){if(e.callSession=this,e.callUUID=t.response.getHeader("X-Calluuid"),e.emit("onCallRemoteRinging"),e.callStats&&this.connection){var n=function(e){Plivo.log.debug("Stats new fabric message: "+e)},r=this.request.headers.To.toString().match(/:(.*)@/i)[1];e.callStats.addNewFabric(this.connection,r,e.callStats.fabricUsage.audio,e.callUUID,n)}if(e.connStage.push("progress-"+t.response.status_code+"@"+y()),Plivo.log.debug("Outgoing call progress",t.response.status_code),Plivo.log.debug("ringback tone enabled : "+e.ringToneBackFlag),e.connectToneView.paused?null:f.stopAudio(a.CONNECT_TONE_ELEMENT_ID),e.ringToneBackFlag&&f.playAudio(a.RINGBACK_ELEMENT_ID),183==t.response.status_code&&t.response.body&&(Plivo.log.debug("callSession - "+e.callUUID),!e.ringToneBackFlag))return void(e.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID))},accepted:function(t){var n=t.response.getHeader("To").match(/:(.*)@/i)[1];e.callUUID=t.response.getHeader("X-Calluuid"),Plivo.log.info("Outgoing call accepted");var r=function(e){Plivo.log.debug("Stats new fabric message: "+e)};_(e),e.callStats&&this.connection&&e.callStats.addNewFabric(this.connection,n,e.callStats.fabricUsage.audio,e.callUUID,r)},confirmed:function(t){Plivo.log.debug("Outgoing call confirmed - "+e.callUUID),e.connStage.push("confirmed@"+y()),e.remoteView.paused&&e.remoteView.play(),e.options.disableRtpTimeOut&&(e.callSession.connection.disableRtpTimeOut=!0),e.ringToneView.paused?null:f.stopAudio(a.RINGTONE_ELEMENT_ID),e.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID),e.connectToneView.paused?null:f.stopAudio(a.CONNECT_TONE_ELEMENT_ID),e.emit("onCallAnswered"),setTimeout(v,3e3,this.connection,e)},icetimeout:function(t){Plivo.log.debug("iceGathering timed out"),g(e,"network","warning","ice_timeout",t,!0,"Possible NAT/Firewall issue")},failed:function(t){if(Plivo.log.error("Outgoing call failed: "+t.cause),e.connStage.push("failed@"+y()),e.ringBackToneView.paused?null:f.stopAudio(a.RINGBACK_ELEMENT_ID),e.connectToneView.paused?null:f.stopAudio(a.CONNECT_TONE_ELEMENT_ID),t.message&&(e.callUUID=t.message.getHeader("X-CallUUID")||null),e.callStats&&e.callUUID&&!t.cause.match("edia")){var n=t.cause,r=n;t.message&&t.message.status_code&&(r=String(t.message.status_code));var i=new DOMError(n,r);Plivo.log.debug(i),e.callStats.reportError(null,e.callUUID,e.callStats.webRTCFunctions.signalingError,i)}e.emit("onCallFailed",t.cause),k(e)},ended:function(t){Plivo.log.debug("Outgoing call ended - "+e.callUUID),Plivo.log.info("Outgoing call ended"),e.connStage.push("ended@"+y()),e.callStats&&e.callStats.sendFabricEvent(this.connection,e.callStats.fabricEvent.fabricTerminated,e.callUUID),e.emit("onCallTerminated",{originator:t.originator,reason:t.cause}),Plivo.AppError({name:"onCallTerminated",originator:t.originator,reason:t.cause}),k(e)},getusermediafailed:function(t){Plivo.log.error("getusermediafailed: "+t),e.userName&&e.callStats&&(t.message="getusermediafailed",e.callStats.reportError(null,e.userName,e.callStats.webRTCFunctions.getUserMedia,t))},"peerconnection:createofferfailed":function(t){Plivo.log.error("peerconnection:createofferfailed: ",t),e.userName&&e.callStats&&(t.message="peerconnection:createofferfailed",e.callStats.reportError(null,e.userName,e.callStats.webRTCFunctions.createOffer,t))},"peerconnection:createanswerfailed":function(t){Plivo.log.error("peerconnection:createanswerfailed: ",t),e.userName&&e.callStats&&(t.message="peerconnection:createanswerfailed",e.callStats.reportError(null,e.userName,e.callStats.webRTCFunctions.createAnswer,t))},"peerconnection:setlocaldescriptionfailed":function(t){Plivo.log.error("peerconnection:setlocaldescriptionfailed: ",t),e.userName&&e.callStats&&(t.message="peerconnection:setlocaldescriptionfailed",e.callStats.reportError(null,e.userName,e.callStats.webRTCFunctions.setLocalDescription,t))},"peerconnection:setremotedescriptionfailed":function(t){t.message&&!/pranswer/.test(t.message)&&(Plivo.log.error("peerconnection:setremotedescriptionfailed: ",t),e.userName&&e.callStats&&(t.message="peerconnection:setremotedescriptionfailed",e.callStats.reportError(null,e.userName,e.callStats.webRTCFunctions.setRemoteDescription,t)))}};try{e.phone.call(r,i),Plivo.log.debug("Outgoing call options : ",JSON.stringify(i.mediaConstraints))}catch(d){return Plivo.log.error("Failed to execute plivo.onCalling event handler",d),Plivo.AppError({name:d.name,message:d.message,method:"call()"}),!1}return!0},y=function(){var e=new Date,t=e.toISOString().substring(0,10)+" "+e.toString().split(" ")[4]+"."+e.getMilliseconds();return t},b=function(e){var t=e.storage;return t.local_audio=[],t.remote_audio=[],t.mosLocalMeasures=[],t.mosRemoteMeasures=[],t.jitterLocalMeasures=[],t.jitterRemoteMeasures=[],t.packetLossRemoteMeasures=[],t.packetLossLocalMeasures=[],t.rtt=[],t.audioCodec=null,t.warning={audioLocalMeasures:!1,audioRemoteMeasures:!1,mosLocalMeasures:!1,mosRemoteMeasures:!1,jitterLocalMeasures:!1,jitterRemoteMeasures:!1,packetLossRemoteMeasures:!1,packetLossLocalMeasures:!1,rtt:!1,ice_connection:!1},t.startAnalysis=!1,setTimeout(function(){t.startAnalysis=!0,Plivo.log.debug("Stats startAnalysis started")},5e3),!0},_=function(e){return e.storage={},b(e)},S=function(e){return function(t,n){Plivo.log.info("Stats token req...");var r={eventHandlers:{succeeded:function(e){Plivo.log.info("Stats token success!");var t=JSON.parse(e.response.getHeader("x-token"));return t&&"0"!==t?n(null,t.token):(Plivo.log.error("Stats token failed with 0"),n("token failed 0"))},failed:function(e){return e.response&&e.response.status_code?(Plivo.log.error("Stats token failed!",e.response.status_code),n(e.response.status_code)):(Plivo.log.error("Stats token failed!"),n("failed"))}},extraHeaders:["X-appID: "+e.options.appId,"X-userID: "+e.userName]};e.phone.sendMessage("admin","-- Plivo web client --",r)}},T=function(e){["disconnected","failed"].indexOf(e)!=-1&&(g(this,"network","warning","ice_connection",e,!0,"network drop"),this.storage&&(this.storage.warning.ice_connection=!0)),"connected"==e&&this.storage&&this.storage.warning.ice_connection===!0&&(g(this,"network","warning","ice_connection",e,!1),this.storage.warning.ice_connection=!1)},C=function(e){function t(e,t){t.candidate&&e.addIceCandidate(t.candidate).then()["catch"](n)}function n(t){e&&e(null,t)}function r(e){e.addStream(a),e.createOffer().then(function(t){e.setLocalDescription(t).then(function(){i(u,t)})["catch"](n)})["catch"](n)}function i(e,t){e.setRemoteDescription(t).then(function(){"offer"==t.type&&e.createAnswer().then(function(t){e.setLocalDescription(t).then(function(){})["catch"](n),i(l,t)})["catch"](n)})["catch"](n)}function o(){a&&a.getTracks().forEach(function(e){e.stop(),a.removeTrack(e),a=null}),"stable"==l.signalingState&&l.close(),"stable"==u.signalingState&&u.close()}function s(){function t(){l.getLocalStreams()[0]&&l.getStats(function(n){n.result().forEach(function(n){var i=n;if("ssrc"===i.type&&"audio"===i.stat("mediaType")){var s={bytesSent:i.stat("bytesSent"),audioInputLevel:i.stat("audioInputLevel")};Number(s.audioInputLevel)<=0&&2!=r?(r++,setTimeout(t,1e3),Plivo.log.debug("getUM precheck re-attempt: "+r)):(e&&e(s,null),setTimeout(o,3e3))}})},l.getLocalStreams()[0].getAudioTracks()[0],n)}Plivo.log.debug("getUM precheck icestate : "+l.iceConnectionState);var r=0;t()}var a,l,u,c=null;l=new RTCPeerConnection(c),u=new RTCPeerConnection(c),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){a=e,r(l)})["catch"](n),l.onicecandidate=function(e){t(u,e)},u.onicecandidate=function(e){t(l,e)},setTimeout(s,500)},w=function(e){for(var t,n=[],r=0;e.length>r;r++){var i=e[r].split("@");if(0==r)t=i[1],n.push(i[0]+" = "+i[1]+"#");else{var o=new Date(i[1])-new Date(t);o>1e3?(o/=1e3,o=String(o)+"s#"):o=String(o)+"ms#",n.push(i[0]+" = "+i[1]+" +"+o)}}return n=JSON.stringify(n),n=n.replace(/[[",\]]/g,""),n=n.replace(/#/g,"\n")},E=function(e){return e?e.is_confirmed:(Plivo.log.debug("session not available"),!1)},k=function(e){if(e.remoteView.pause(),Plivo.AppError(w(e.connStage),"log"),e.callSession=null,delete e.storage,e.lastCallUUID=e.callUUID,e.callUUID=null,e.callDirection=null,window.localStream&&("chrome"==i.adapter.browserDetails.browser||e.permOnClick))try{window.localStream.getTracks().forEach(function(e){
e.stop(),window.localStream.removeTrack(e)}),window.localStream=null}catch(t){Plivo.log.debug("error on stop track in localStream : "+t.message)}};t.exports=r},{"../sipLib/JsSIP":41,"./media/audioDevice":3,"./media/document":4,"./util/callAnalytics":5,"./util/codecPreference":6,"./util/constants":7,"./util/headers":8,"./util/logger":9,"./util/validateOptions":10,events:11,util:23}],3:[function(e,t,n){var r=e("../util/constants"),i=function(e){return new Promise(function(t,n){navigator.mediaDevices.enumerateDevices().then(function(n){var r=[];n.filter(function(t){"input"==e?"audioinput"==t.kind&&r.push(t):"output"==e?"audiooutput"==t.kind&&r.push(t):/video/i.test(t.kind)||r.push(t)}),t(r)})["catch"](function(e){n(e)})})},o=function(e){return new Promise(function(t,n){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){"returnStream"==e?t(n):(n.getTracks().forEach(function(e){e.stop()}),t("success"))})["catch"](function(e){Plivo.log.error("failed to get user media :: "+e.name),n(e.name)}):n("no getUserMedia support")})},s=function(){return{set:function(e){if("string"==typeof e&&"optional"in Plivo.audioConstraints)return Plivo.audioConstraints.optional.push({sourceId:e}),!0},get:function(){if(Plivo.audioConstraints.optional){var e=Plivo.audioConstraints.optional.filter(function(e){return e.sourceId});return e.length>0?e[0].sourceId:""}return""},reset:function(){return Plivo.audioConstraints.optional&&(Plivo.audioConstraints.optional=Plivo.audioConstraints.optional.filter(function(e){return!e.sourceId})),!0}}}(),a=function(){return{set:function(e){var t=document.querySelectorAll('[data-devicetype="speakerDevice"]');return t.forEach(function(t){t.setSinkId&&t.setSinkId(e)}),!0},get:function(){var e=document.querySelector('[data-devicetype="speakerDevice"]');if(e.sinkId)return e.sinkId},reset:function(){var e=document.querySelectorAll('[data-devicetype="speakerDevice"]');return e.forEach(function(e){e.setSinkId&&e.setSinkId("")}),!0},media:function(e){var t={dtmf:"dtmfstar",ringback:r.RINGBACK_ELEMENT_ID};return e&&e in t?document.getElementById(t[e]):document.getElementById(r.RINGBACK_ELEMENT_ID)}}}(),l=function(){return{set:function(e){var t=document.getElementById(r.RINGTONE_ELEMENT_ID);return t.setSinkId&&t.setSinkId(e),!0},get:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);if(e.sinkId)return e.sinkId},reset:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);return e.setSinkId&&e.setSinkId(""),!0},media:function(){return document.getElementById(r.RINGTONE_ELEMENT_ID)}}}(),u=function(e){var t=this;return new Promise(function(n,r){i().then(function(r){var i=[];r.forEach(function(e){if(e.label){var t=JSON.stringify(e);i.push(t)}else i=null}),e?(t.audioDevDic=i,n(!0)):n(i)})["catch"](function(e){Plivo.log.error("Error availableDevices() ",e),r(e)})})},c=function(){var e,t,n=this;u().then(function(r){n.audioDevDic&&r&&(r.forEach(function(t){n.audioDevDic.indexOf(t)==-1&&(e=JSON.parse(t),/default/i.test(e.deviceId)||n.emit("audioDeviceChange",{change:"added",device:e}))}),n.audioDevDic.forEach(function(e){r.indexOf(e)==-1&&(t=JSON.parse(e),/default/i.test(t.deviceId)||n.emit("audioDeviceChange",{change:"removed",device:t}))})),n.audioDevDic||n.emit("audioDeviceChange",{change:"",device:""}),r&&(n.audioDevDic=r)})["catch"](function(e){Plivo.log.error("Error checkAudioDevChange() ",e)})};t.exports.inputDevices=s,t.exports.outputDevices=a,t.exports.ringtoneDevices=l,t.exports.revealAudioDevices=o,t.exports.availableDevices=i,t.exports.audioDevDictionary=u,t.exports.checkAudioDevChange=c},{"../util/constants":7}],4:[function(e,t,n){"use strict";var r=e("../util/constants"),i=function(e,t){var n=document.createElement("audio");n.id=r.REMOTE_VIEW_ID,n.hidden=!0,n.autoplay=!0,n.width=0,n.height=0,n.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(n);var i=document.createElement("audio");i.id=r.CONNECT_TONE_ELEMENT_ID,i.loop="loop",i.src=r.CONNECT_TONE_URL,i.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(i);var s=document.createElement("audio");s.id=r.RINGBACK_ELEMENT_ID,s.loop="loop",s.src=r.RINGTONE_URL,s.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(s);var a=document.createElement("audio");a.id=r.RINGTONE_ELEMENT_ID,a.loop="loop",a.src=r.RINGTONE_URL,a.setAttribute("data-devicetype","ringtoneDevice"),document.body.appendChild(a);for(var l="mp3",u="https://cdn.plivo.com/sdk/browser/audio/dtmf-",c=function(e,t,n){var r="dtmf"+t,i=e+t+"."+n,o=document.createElement("audio");o.id=r,o.src=i,o.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(o)},d=0;d<=9;d++)c(u,d,l);c(u,"star",l),c(u,"pound",l),e.permOnClick?(window.localStream=null,t({status:"success",stream:!1})):o(e.audioConstraints,function(e){t(e)})},o=function(e,t){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:e,video:!1}).then(function(e){window.localStream=e,Plivo.log.debug("getUserMedia success"),t({status:"success",stream:!0})})["catch"](function(e){Plivo.log.error("failed to get user media :: "+e.name),t({status:"failure",error:e.name})}):(Plivo.log.error("getUserMedia not available"),t({status:"failure",error:"getUserMedia not supported"}))},s=function(e){try{document.getElementById(e).play(),Plivo.log.debug("playAudio - "+e)}catch(t){Plivo.log.debug("failed to play audio for elementId "+e+" Cause: "+t)}},a=function(e){try{document.getElementById(e).pause(),Plivo.log.debug("stopAudio - "+e)}catch(t){Plivo.log.debug("failed to stop audio for elementId "+e+" Cause: "+t)}},l=function(){var e=document.createElement("div");e.id="plivo_mask",document.body.insertBefore(e,document.body.firstChild),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="#000",e.style.opacity="0.8",e.style.filter="alpha(opacity=80)",e.style.zindex="50"};t.exports.setup=i,t.exports.getLocalMedia=o,t.exports.playAudio=s,t.exports.stopAudio=a,t.exports.maskPage=l},{"../util/constants":7}],5:[function(e,t,n){var r=function(e,t){function n(t,n){var r=a.storage[t];if(2==r.length){r.push(Number(n));var i={},o=null;r.forEach(function(e){i[e]=i[e]+1||1});for(var s in i)i[s]>=2&&(o=Number(s));"number"==typeof o?(a.storage.warning[t]=!0,o>1?Plivo.log.debug("Same audioLevel detected for "+t+" : ",a.str(r)):Plivo.log.debug("Audio mute detected for "+t+" : ",a.str(r)),e(a,"audio","warning","no_audio_received",o,!0,t)):a.storage.warning[t]?(a.storage.warning[t]=!1,e(a,"audio","warning","no_audio_received",0,!1,t)):null}else r.push(Number(n));3==r.length&&r.splice(0,2)}function r(t,n){var n=Number(n),r=a.storage[t];if(2==r.length){r.push(n);var i=r.filter(function(e,t){return e>400});if(i.length>=2){var o=i.reduce(function(e,t){return e+t}),s=(o/i.length).toFixed(2);a.storage.warning[t]=!0,Plivo.log.debug(t+" : getting high rtt  : ",a.str(i)),e(a,"network","warning","high_rtt",s,!0,"high latency")}else a.storage.warning[t]?(a.storage.warning[t]=!1,e(a,"network","warning","high_rtt",0,!1)):null}else r.push(n);3==r.length&&r.splice(0,2)}function i(t,n){var n=Number(n),r=a.storage[t];if(2==r.length){r.push(n);var i=r.filter(function(e,t){return e>30});if(i.length>=2){var o=i.reduce(function(e,t){return e+t}),s=o/i.length;a.storage.warning[t]=!0,Plivo.log.debug(t+" : getting high jitter rate : ",a.str(i)),e(a,"network","warning","high_jitter",s,!0,t)}else a.storage.warning[t]?(a.storage.warning[t]=!1,e(a,"network","warning","high_jitter",0,!1,t)):null}else r.push(n);3==r.length&&r.splice(0,2)}function o(t,n){var r=a.storage[t];if(2==r.length){r.push(n);var i=r.filter(function(e,t){return"opus"==a.storage.audioCodec?"bad"==e:"excellent"!=e});i.length>=2?(a.storage.warning[t]=!0,Plivo.log.debug(t+" : getting low mos : ",a.str(r)),e(a,"network","warning","low_mos",i[0],!0,t)):a.storage.warning[t]?(a.storage.warning[t]=!1,e(a,"network","warning","low_mos",0,!1,t)):null}else r.push(n);3==r.length&&r.splice(0,2)}function s(t,n){var n=Number(n),r=a.storage[t];if(2==r.length){r.push(n);var i=r.filter(function(e,t){return"opus"==a.storage.audioCodec?e>=.1:e>=.02});if(i.length>=2){var o=i.reduce(function(e,t){return e+t}),s=o/i.length;s=s.toFixed(3),a.storage.warning[t]=!0,Plivo.log.debug(t+" : ploss score value is high :",a.str(i)),e(a,"network","warning","high_packetloss",s,!0,t)}else a.storage.warning[t]?(a.storage.warning[t]=!1,e(a,"network","warning","high_packetloss",0,!1,t)):null}else r.push(n);3==r.length&&r.splice(0,2)}var a=this;if(a.storage&&a.storage.startAnalysis)for(var l in t)if("audioInputLevel"in t[l]){var u=t[l],c=u.fractionLoss?u.fractionLoss.toFixed(2):0,d=(u.bitrate?u.bitrate.toFixed(2):0,u.quality||null),f=u.rtt||0,h=u.jitter||0,p=u.audioInputLevel||0;n("local_audio",p),r("rtt",f),i("jitterLocalMeasures",h),s("packetLossLocalMeasures",c)}else if("audioOutputLevel"in t[l]){var u=t[l],c=u.fractionLoss?u.fractionLoss.toFixed(2):0,d=(u.bitrate?u.bitrate.toFixed(2):0,u.quality||null),h=u.jitter||0,v=u.audioOutputLevel||0;n("remote_audio",v),i("jitterRemoteMeasures",h),o("mosRemoteMeasures",d),s("packetLossRemoteMeasures",c)}};t.exports=r},{}],6:[function(e,t,n){var r=function(e,t){function n(e,t){var n=new RegExp("a=rtpmap:.* "+e+"(.*)","ig");return!!t.match(n)&&t.match(n)[0].split(" ")[0].match(/\d+/)}function r(e,t){var r;return e.forEach(function(e){var i=n(e,t);r=new RegExp("\na=rtpmap:.*"+e+"/.*","ig"),t=t.replace(r,""),r=new RegExp("\na=fmtp:"+i+" (.*)","ig"),t=t.replace(r,""),r=new RegExp("\na=rtcp-fb:"+i+" (.*)","ig"),t=t.replace(r,"")}),t}if(e.length>0){var i=["OPUS","G722","PCMA","PCMU","ISAC","CN"],o=e,s="";o.forEach(function(e){var r=i.indexOf(e);r>-1&&i.splice(r,1);var o=n(e,t);o&&(s+=o+" ")}),s=s.slice(0,-1),t=t.replace(t.match(/m=audio .*[a-z] (.*)/i)[1],s),t=r(i,t)}return t};t.exports=r},{}],7:[function(e,t,n){"use strict";t.exports.DEFAULT_LOG_LEVEL="INFO",t.exports.DOMAIN="phone.plivo.com",t.exports.WS_SERVERS="wss://phone.plivo.com:5063",t.exports.REGISTER_EXPIRES_SECONDS=120,t.exports.SESSION_TIMERS_EXPIRES=300,t.exports.WS_RECOVERY_MAX_INTERVAL=20,t.exports.WS_RECOVERY_MIN_INTERVAL=2,t.exports.DEFAULT_CODECS=["OPUS","PCMU"],t.exports.STUN_SERVERS=["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"],t.exports.LIB_NAME="plivojs",t.exports.DEBUG_MODES=["INFO","DEBUG","WARN","ERROR","ALL","ALL-PLAIN","OFF"],t.exports.REGION=["usa_west","usa_east","australia","europe","asia","south_america"],t.exports.RINGTONE_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3",t.exports.CONNECT_TONE_URL="https://cdn.plivo.com/sdk/browser/audio/connect-tone.mp3",t.exports.SELF_VIEW_ID="plivo_webrtc_selfview",t.exports.REMOTE_VIEW_ID="plivo_webrtc_remoteview",t.exports.RINGBACK_ELEMENT_ID="plivo_ringbacktone",t.exports.RINGTONE_ELEMENT_ID="plivo_ringtone",t.exports.CONNECT_TONE_ELEMENT_ID="plivo_connect_tone",t.exports.DTMF_TONE_FLAG={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"#":!0,"*":!0},t.exports.DEFAULT_COMMENTS=["bad-audio","call-dropped","wrong-callerid","post-dial-delay","dtmf-not-captured","audio-latency","unsolicited-call","one-way-audio","no-audio","never-connected"];var r={};"undefined"!=typeof navigator&&navigator.mozGetUserMedia?r={offerToReceiveAudio:!0}:r.mandatory={OfferToReceiveAudio:!0},t.exports.DEFAULT_OFFER_OPTIONS=r},{}],8:[function(e,t,n){"use strict";var r=function(e){if("X-Ph-"!=e.substr(0,5)&&"X-PH-"!=e.substr(0,5))return!1;var t=/^([a-z0-9A-Z]){1,19}$/;return t.test(e.substr(5))!==!1},i=function(e){var t=/^([a-z0-9A-Z_\-\+\(\)%]){1,120}$/;return t.test(e)!==!1},o=function(e,t){var n={};for(var o in t){var s=e.getHeader(o);r(o)&&i(s)&&(n[o]=s)}return n};t.exports.checkExtraHeaderKey=r,t.exports.checkExtraHeaderVal=i,t.exports.receiveExtraHeader=o},{}],9:[function(e,t,n){var r=function(e){e?e:e={};var t=["INFO","DEBUG","WARN","ERROR","ALL","OFF"],n=e.logMethod||"INFO",r=e.enableDate||!1,i=e.loggingName||"",o="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,s=function(){function e(){if(r){var e=new Date,n=e.toISOString().substring(0,10)+" "+e.toString().split(" ")[4]+"."+e.getMilliseconds();console.log("["+n+"] ["+t+"] "+i+" :: ",s,a)}else console.log("["+t+"] "+i+" :: ",s,a)}var t=arguments[0].toUpperCase(),o=arguments[1],s=o[0]||"",a=o[1]||"";if("DEBUG"==n||"ALL"==n)e();else{if(n!=t)return;e()}};return{info:function(){s("info",arguments)},debug:function(){s("debug",arguments)},warn:function(){s("warn",arguments)},error:function(){s("error",arguments)},setLevel:function(e){return e=e.toUpperCase(),t.indexOf(e)!=-1?(n=e,["DEBUG","ALL"].indexOf(e)==-1&&(o.debug=""),"logLevel is now : "+n):"only : "+t.toString()+" are allowed in run time!"},level:function(){return n}}};t.exports=r},{}],10:[function(e,t,n){var r=function(e,t){if("[object Array]"==Object.prototype.toString.call(e)){var n=!0;return e.forEach(function(e){t.indexOf(e)==-1&&(n=!1,Plivo.log.warn("Ignoring invalid codec - ",e),Plivo.log.debug("Allowed list: ",t))}),!!n}return Plivo.log.error("Please send codecs in Array. Eg:",t),!1},i=function(e,t){return"boolean"==typeof t||(Plivo.log.error(e+" has to be boolean. "+t+" is not accepted"),!1)},o=function(e,t){return t.indexOf(e)!=-1||(Plivo.log.error("debug method "+e+" is not allowed"),Plivo.log.debug("Allowed list for debug: ",t),!1)},s=function(e,t){return t.indexOf(e)!=-1||(Plivo.log.error("region name "+e+" is not allowed"),Plivo.log.debug("Allowed list for regions: ",t),!1)};t.exports={codecs:r,isBoolean:i,debug:o,region:s}},{}],11:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),l=1;l<r;l++)o[l-1]=arguments[l];n.apply(this,o)}else if(s(n)){for(r=arguments.length,o=new Array(r-1),l=1;l<r;l++)o[l-1]=arguments[l];for(u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,o)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],12:[function(e,t,n){(function(r){function i(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var t=window._PlivoUseColorLog;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),t){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(t){}}function l(){var e;try{e=n.storage.debug}catch(t){}return!e&&"undefined"!=typeof r&&"env"in r&&(e=r.env.DEBUG),e}function u(){try{return window.localStorage}catch(e){}}n=t.exports=e("./debug"),n.log=s,n.formatArgs=o,n.save=a,n.load=l,n.useColors=i,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},n.enable(l())}).call(this,e("_process"))},{"./debug":13,_process:16}],13:[function(e,t,n){function r(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]}function i(e){function t(){if(t.enabled){var e=t,r=+new Date,i=r-(u||r);e.diff=i,e.prev=u,e.curr=r,u=r;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=n.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(t,r){if("%%"===t)return t;a++;var i=n.formatters[r];if("function"==typeof i){var s=o[a];t=i.call(e,s),o.splice(a,1),a--}return t}),n.formatArgs.call(e,o);var l=t.log||n.log||console.log.bind(console);l.apply(e,o)}}return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=r(e),"function"==typeof n.init&&n.init(t),t}function o(e){n.save(e),n.names=[],n.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&(e=t[i].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function s(){n.enable("")}function a(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=i.debug=i["default"]=i,n.coerce=l,n.disable=s,n.enable=o,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var u},{ms:15}],14:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],15:[function(e,t,n){function r(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*l;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function i(e){return e>=c?Math.round(e/c)+"d":e>=u?Math.round(e/u)+"h":e>=l?Math.round(e/l)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function o(e){return s(e,c,"day")||s(e,u,"hour")||s(e,l,"minute")||s(e,a,"second")||e+" ms"}function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,l=60*a,u=60*l,c=24*u,d=365.25*c;t.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return r(e);if("number"===n&&isNaN(e)===!1)return t["long"]?o(e):i(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],16:[function(e,t,n){function r(){if(!a){a=!0;for(var e,t=s.length;t;){e=s,s=[];for(var n=-1;++n<t;)e[n]();t=s.length}a=!1}}function i(){}var o=t.exports={},s=[],a=!1;o.nextTick=function(e){s.push(e),a||setTimeout(r,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=i,o.addListener=i,o.once=i,o.off=i,o.removeListener=i,o.removeAllListeners=i,o.emit=i,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],17:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],18:[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parseParams=r.parseParams,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates,n.parseImageAttributes=r.parseImageAttributes,n.parseSimulcastStreamList=r.parseSimulcastStreamList},{"./parser":19,"./writer":20}],19:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))},o=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},s=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var l=s[t][a];if(l.reg.test(i))return o(l,r,i)}}),t.media=n,t};var l=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};n.parseParams=function(e){return e.split(/\;\s?/).reduce(l,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},n.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(l,{})})},n.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},{"./grammar":17}],20:[function(e,t,n){var r=e("./grammar"),i=/%[sdv%]/g,o=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},s=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?i.push(n[t.name][a]):i.push(n[t.names[s]])}else i.push(n[t.name]);return o.apply(null,i)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,i=t.innerOrder||l,o=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(s(t,n,e))})})}),e.media.forEach(function(e){o.push(s("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(s(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},{"./grammar":17}],21:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:n[t[r]]=t[r+1]}return n;
},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){var n=r.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:n.map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i={usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return i},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var l=r.parseRtpMap(a),u=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(l.parameters=u.length?r.parseFmtp(u[0]):{},l.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(l.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=a.length>0&&a[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===l&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&l&&n.push({ssrc:l});var c=r.matchPrefix(e,"b=");return c.length&&(0===c[0].indexOf("b=TIAS:")?c=parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")&&(c=parseInt(c[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=c})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",o+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){var t=r.splitLines(e),n=t[0].split(" ");return n[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.exports=r},{}],22:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],23:[function(e,t,n){(function(t,r){function i(e,t){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&n._extend(r,t),S(r.showHidden)&&(r.showHidden=!1),S(r.depth)&&(r.depth=2),S(r.colors)&&(r.colors=!1),S(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),l(r,e,r.depth)}function o(e,t){var n=i.styles[t];return n?"\x1b["+i.colors[n][0]+"m"+e+"\x1b["+i.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,r){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return b(i)||(i=l(e,i,r)),i}var o=u(e,t);if(o)return o;var s=Object.keys(t),v=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),E(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(t);if(0===s.length){if(k(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(T(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(E(t))return c(t)}var m="",y=!1,_=["{","}"];if(p(t)&&(y=!0,_=["[","]"]),k(t)){var S=t.name?": "+t.name:"";m=" [Function"+S+"]"}if(T(t)&&(m=" "+RegExp.prototype.toString.call(t)),w(t)&&(m=" "+Date.prototype.toUTCString.call(t)),E(t)&&(m=" "+c(t)),0===s.length&&(!y||0==t.length))return _[0]+m+_[1];if(r<0)return T(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var C;return C=y?d(e,t,r,v,s):s.map(function(n){return f(e,t,r,v,n,y)}),e.seen.pop(),h(C,m,_)}function u(e,t){if(S(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)O(t,String(s))?o.push(f(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(e,t,n,r,i,!0))}),o}function f(e,t,n,r,i,o){var s,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),O(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=g(n)?l(e,u.value,null):l(e,u.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),S(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return null==e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function S(e){return void 0===e}function T(e){return C(e)&&"[object RegExp]"===I(e)}function C(e){return"object"==typeof e&&null!==e}function w(e){return C(e)&&"[object Date]"===I(e)}function E(e){return C(e)&&("[object Error]"===I(e)||e instanceof Error)}function k(e){return"function"==typeof e}function R(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function I(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}function A(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),N[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var M=/%[sdj%]/g;n.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(M,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])s+=g(a)||!C(a)?" "+a:" "+i(a);return s},n.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(S(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var D,x={};n.debuglog=function(e){if(S(D)&&(D=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!x[e])if(new RegExp("\\b"+e+"\\b","i").test(D)){var r=t.pid;x[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else x[e]=function(){};return x[e]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=v,n.isNull=g,n.isNullOrUndefined=m,n.isNumber=y,n.isString=b,n.isSymbol=_,n.isUndefined=S,n.isRegExp=T,n.isObject=C,n.isDate=w,n.isError=E,n.isFunction=k,n.isPrimitive=R,n.isBuffer=e("./support/isBuffer");var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",A(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!C(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":22,_process:16,inherits:14}],24:[function(e,t,n){"use strict";!function(){var n=e("./utils"),r=n.log,i=n.browserDetails;t.exports.browserDetails=i,t.exports.extractVersion=n.extractVersion,t.exports.disableLog=n.disableLog;var o=e("./chrome/chrome_shim")||null,s=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,l=e("./safari/safari_shim")||null;switch(i.browser){case"chrome":if(!o||!o.shimPeerConnection)return void r("Chrome shim is not included in this adapter release.");r("adapter.js shimming chrome."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimMediaStream(),n.shimCreateObjectURL(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack(),o.shimGetSendersWithDtmf();break;case"firefox":if(!a||!a.shimPeerConnection)return void r("Firefox shim is not included in this adapter release.");r("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),n.shimCreateObjectURL(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!s||!s.shimPeerConnection)return void r("MS edge shim is not included in this adapter release.");r("adapter.js shimming edge."),t.exports.browserShim=s,s.shimGetUserMedia(),n.shimCreateObjectURL(),s.shimPeerConnection(),s.shimReplaceTrack();break;case"safari":if(!l)return void r("Safari shim is not included in this adapter release.");r("adapter.js shimming safari."),t.exports.browserShim=l,l.shimCallbacksAPI(),l.shimAddStream(),l.shimOnAddStream(),l.shimGetUserMedia();break;default:r("Unsupported browser!")}}()},{"./chrome/chrome_shim":25,"./edge/edge_shim":27,"./firefox/firefox_shim":30,"./safari/safari_shim":32,"./utils":33}],25:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r;r=RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track.id===n.track.id}):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=r,i.streams=[e.stream],t.dispatchEvent(i)}),e.stream.getTracks().forEach(function(n){var r;r=RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track.id===n.id}):{track:n};var i=new Event("track");i.track=n,i.receiver=r,i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var e=RTCPeerConnection.prototype.addStream,t=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addTrack||(RTCPeerConnection.prototype.addTrack=function(e,t){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(t){return t===e}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");n._senders=n._senders||[];var i=n._senders.find(function(t){return t.track===e});if(i)throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{};var o=n._streams[t.id];if(o)o.addTrack(e),n.removeStream(o),n.addStream(o);else{var s=new MediaStream([e]);n._streams[t.id]=s,n.addStream(s)}var a={track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=n.createDTMFSender(e):this._dtmf=null),this._dtmf}};return n._senders.push(a),a}),RTCPeerConnection.prototype.addStream=function(t){var n=this;n._senders=n._senders||[],e.apply(n,[t]),t.getTracks().forEach(function(e){n._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=n.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(e){var n=this;n._senders=n._senders||[],t.apply(n,[e]),e.getTracks().forEach(function(e){var t=n._senders.find(function(t){return t.track===e});t&&n._senders.splice(n._senders.indexOf(t),1)})}}},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){if(window.RTCPeerConnection){var e=RTCPeerConnection;window.RTCPeerConnection=function(t,n){if(t&&t.iceServers){for(var r=[],i=0;i<t.iceServers.length;i++){var o=t.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,r.push(o)):r.push(t.iceServers[i])}t.iceServers=r}return new e(t,n)},window.RTCPeerConnection.prototype=e.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return e.generateCertificate}})}else window.RTCPeerConnection=function(e,t){return r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new webkitRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});var t=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,n,r){var i=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var s=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var l=function(e){o[1](a(s(e)))};return t.apply(this,[l,arguments[0]])}return new Promise(function(e,n){t.apply(i,[function(t){e(a(s(t)))},n])}).then(n,r)},i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),i.version<52&&["createOffer","createAnswer"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var n=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":33,"./getusermedia":26}],26:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var o=t.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var s=i.version<61;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||s)){delete t.video.facingMode;var a;if("environment"===o.exact||"environment"===o.ideal?a=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(a=["front"]),a)return navigator.mediaDevices.enumerateDevices().then(function(i){i=i.filter(function(e){return"videoinput"===e.kind});var s=i.find(function(e){return a.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!s&&i.length&&a.indexOf("back")!==-1&&(s=i[i.length-1]),s&&(t.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)})}t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{ConstraintNotSatisfiedError:"OverconstrainedError",PermissionDeniedError:"NotAllowedError",TrackStartError:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};navigator.getUserMedia=o;var s=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:s,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return s(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":33}],27:[function(e,t,n){"use strict";var r=e("../utils").browserDetails,i=e("./rtcpeerconnection_shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),r.version<15025)){var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var n=new Event("enabled");n.enabled=t,this.dispatchEvent(n)}})}window.RTCPeerConnection=i(r.version)},shimReplaceTrack:function(){!window.RTCRtpSender||"replaceTrack"in RTCRtpSender.prototype||(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},{"../utils":33,"./getusermedia":28,"./rtcpeerconnection_shim":29}],28:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n)["catch"](function(t){return Promise.reject(e(t))})}}},{}],29:[function(e,t,n){"use strict";function r(e){var t=e.filter(function(e){return"audio"===e.kind}),n=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||n.length;)t.length&&e.push(t.shift()),n.length&&e.push(n.shift());return e}function i(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){var r=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;return r?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393}),delete e.url,e.urls=i?r[0]:r,!!r.length}return!1})}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),s=r(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&s.parameters.apt&&!i(r,s,e.codecs,t.codecs))continue;s=JSON.parse(JSON.stringify(s)),s.numChannels=Math.min(r.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function s(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}var a=e("sdp");t.exports=function(e){var t=function(t){var n=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=r[e].bind(r)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy}this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers&&(this.iceOptions.iceServers=i(t.iceServers,e)),this._config=t||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return t.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},t.prototype._emitBufferedCandidates=function(){var e=this,t=a.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){var r=!n.candidate||0===Object.keys(n.candidate).length;if(r)for(var i=1;i<t.length;i++)t[i].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[i]+="a=end-of-candidates\r\n");else t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n";if(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState){var o=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});o&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},t.prototype.getConfiguration=function(){return this._config;
},t.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},t.prototype.addTrack=function(e,t){for(var n,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==e.kind||(n=this.transceivers[r]);return n||(n=this._createTransceiver(e.kind)),n.track=e,n.stream=t,n.rtpSender=new RTCRtpSender(e,n.dtlsTransport),this._maybeFireNegotiationNeeded(),n.rtpSender},t.prototype.addStream=function(t){var n=this;if(e>=15025)this.localStreams.push(t),t.getTracks().forEach(function(e){n.addTrack(e,t)});else{var r=t.clone();t.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)}),this.localStreams.push(r)}this._maybeFireNegotiationNeeded()},t.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},t.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},t.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},t.prototype._createIceGatherer=function(e,t){var n=this,r=new RTCIceGatherer(n.iceOptions);return r.onlocalcandidate=function(i){var o=new Event("icecandidate");o.candidate={sdpMid:e,sdpMLineIndex:t};var s=i.candidate,l=!s||0===Object.keys(s).length;l?void 0===r.state&&(r.state="completed"):(s.component=1,o.candidate.candidate=a.writeCandidate(s));var u=a.splitSections(n.localDescription.sdp);l?u[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":u[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n",n.localDescription.sdp=u.join("");var c=n._pendingOffer?n._pendingOffer:n.transceivers,d=c.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":l||n._localIceCandidatesBuffer.push(o),l&&d&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),l||(n.dispatchEvent(o),null!==n.onicecandidate&&n.onicecandidate(o)),d&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange());break;case"complete":}},r},t.prototype._createIceAndDtlsTransports=function(){var e=this,t=new RTCIceTransport(null);t.onicestatechange=function(){e._updateConnectionState()};var n=new RTCDtlsTransport(t);return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},t.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlssttatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},t.prototype._transceive=function(t,n,r){var i=o(t.localCapabilities,t.remoteCapabilities);n&&t.rtpSender&&(i.encodings=t.sendEncodingParameters,i.rtcp={cname:a.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(i.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(i)),r&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&e<15019&&t.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=t.recvEncodingParameters,i.rtcp={cname:t.rtcpParameters.cname,compound:t.rtcpParameters.compound},t.sendEncodingParameters.length&&(i.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(i))},t.prototype.setLocalDescription=function(e){var t=this;if(!s("setLocalDescription",e.type,this.signalingState)){var n=new Error("Can not set local "+e.type+" in state "+this.signalingState);return n.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,n),Promise.reject(n)}var r,i;if("offer"===e.type)this._pendingOffer&&(r=a.splitSections(e.sdp),i=r.shift(),r.forEach(function(e,n){var r=a.parseRtpParameters(e);t._pendingOffer[n].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){r=a.splitSections(t.remoteDescription.sdp),i=r.shift();var l=a.matchPrefix(i,"a=ice-lite").length>0;r.forEach(function(e,n){var r=t.transceivers[n],s=r.iceGatherer,u=r.iceTransport,c=r.dtlsTransport,d=r.localCapabilities,f=r.remoteCapabilities,h=a.isRejected(e);if(!h&&!r.isDatachannel){var p=a.getIceParameters(e,i),v=a.getDtlsParameters(e,i);l&&(v.role="server"),t.usingBundle&&0!==n||(u.start(s,p,l?"controlling":"controlled"),c.start(v));var g=o(d,f);t._transceive(r,g.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var u=arguments.length>1&&"function"==typeof arguments[1];if(u){var c=arguments[1];window.setTimeout(function(){c(),"new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),t._emitBufferedCandidates()},0)}var d=Promise.resolve();return d.then(function(){u||("new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),window.setTimeout(t._emitBufferedCandidates.bind(t),500))}),d},t.prototype.setRemoteDescription=function(t){var n=this;if(!s("setRemoteDescription",t.type,this.signalingState)){var r=new Error("Can not set remote "+t.type+" in state "+this.signalingState);return r.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,r),Promise.reject(r)}var i={},o=[],l=a.splitSections(t.sdp),u=l.shift(),c=a.matchPrefix(u,"a=ice-lite").length>0,d=a.matchPrefix(u,"a=group:BUNDLE ").length>0;this.usingBundle=d;var f=a.matchPrefix(u,"a=ice-options:")[0];switch(f?this.canTrickleIceCandidates=f.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,l.forEach(function(r,s){var l=a.splitLines(r),f=a.getKind(r),h=a.isRejected(r),p=l[0].substr(2).split(" ")[2],v=a.getDirection(r,u),g=a.parseMsid(r),m=a.getMid(r)||a.generateIdentifier();if("application"===f&&"DTLS/SCTP"===p)return void(n.transceivers[s]={mid:m,isDatachannel:!0});var y,b,_,S,T,C,w,E,k,R,I,P=a.parseRtpParameters(r);h||(R=a.getIceParameters(r,u),I=a.getDtlsParameters(r,u),I.role="client"),w=a.parseRtpEncodingParameters(r);var A=a.parseRtcpParameters(r),O=a.matchPrefix(r,"a=end-of-candidates",u).length>0,M=a.matchPrefix(r,"a=candidate:").map(function(e){return a.parseCandidate(e)}).filter(function(e){return"1"===e.component||1===e.component});"offer"!==t.type||h?"answer"!==t.type||h||(d&&s>0&&(n._disposeIceAndDtlsTransports(s),n.transceivers[s].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[s].iceTransport=n.transceivers[0].iceTransport,n.transceivers[s].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[s].rtpSender&&n.transceivers[s].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[s].rtpReceiver&&n.transceivers[s].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),y=n.transceivers[s],b=y.iceGatherer,_=y.iceTransport,S=y.dtlsTransport,T=y.rtpReceiver,C=y.sendEncodingParameters,E=y.localCapabilities,n.transceivers[s].recvEncodingParameters=w,n.transceivers[s].remoteCapabilities=P,n.transceivers[s].rtcpParameters=A,(c||O)&&M.length&&_.setRemoteCandidates(M),d&&0!==s||(_.start(b,R,"controlling"),S.start(I)),n._transceive(y,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!T||"sendrecv"!==v&&"sendonly"!==v?delete y.rtpReceiver:(k=T.track,g?(i[g.stream]||(i[g.stream]=new MediaStream),i[g.stream].addTrack(k),o.push([k,T,i[g.stream]])):(i["default"]||(i["default"]=new MediaStream),i["default"].addTrack(k),o.push([k,T,i["default"]])))):(y=n.transceivers[s]||n._createTransceiver(f),y.mid=m,y.iceGatherer||(y.iceGatherer=d&&s>0?n.transceivers[0].iceGatherer:n._createIceGatherer(m,s)),!O||d&&0!==s||y.iceTransport.setRemoteCandidates(M),E=RTCRtpReceiver.getCapabilities(f),e<15019&&(E.codecs=E.codecs.filter(function(e){return"rtx"!==e.name})),C=[{ssrc:1001*(2*s+2)}],"sendrecv"!==v&&"sendonly"!==v||(T=new RTCRtpReceiver(y.dtlsTransport,f),k=T.track,g?(i[g.stream]||(i[g.stream]=new MediaStream,Object.defineProperty(i[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(k,"id",{get:function(){return g.track}}),i[g.stream].addTrack(k),o.push([k,T,i[g.stream]])):(i["default"]||(i["default"]=new MediaStream),i["default"].addTrack(k),o.push([k,T,i["default"]]))),y.localCapabilities=E,y.remoteCapabilities=P,y.rtpReceiver=T,y.rtcpParameters=A,y.sendEncodingParameters=C,y.recvEncodingParameters=w,n._transceive(n.transceivers[s],!1,"sendrecv"===v||"sendonly"===v))}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return Object.keys(i).forEach(function(e){var t=i[e];if(t.getTracks().length){n.remoteStreams.push(t);var r=new Event("addstream");r.stream=t,n.dispatchEvent(r),null!==n.onaddstream&&window.setTimeout(function(){n.onaddstream(r)},0),o.forEach(function(e){var r=e[0],i=e[1];if(t.id===e[2].id){var o=new Event("track");o.track=r,o.receiver=i,o.streams=[t],n.dispatchEvent(o),null!==n.ontrack&&window.setTimeout(function(){n.ontrack(o)},0)}})}}),window.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},t.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},t.prototype._maybeFireNegotiationNeeded=function(){var e=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,window.setTimeout(function(){if(e.needNegotiation!==!1){e.needNegotiation=!1;var t=new Event("negotiationneeded");e.dispatchEvent(t),null!==e.onnegotiationneeded&&e.onnegotiationneeded(t)}},0))},t.prototype._updateConnectionState=function(){var e,t=this,n={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n["new"]>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},t.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var n;1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var i=this.transceivers.filter(function(e){return"audio"===e.kind}).length,o=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(i=n.offerToReceiveAudio===!0?1:n.offerToReceiveAudio===!1?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(o=n.offerToReceiveVideo===!0?1:n.offerToReceiveVideo===!1?0:n.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?(i--,i<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});i>0||o>0;)i>0&&(this._createTransceiver("audio"),i--),o>0&&(this._createTransceiver("video"),o--);var s=r(this.transceivers),l=a.writeSessionBoilerplate();s.forEach(function(n,r){var i=n.track,o=n.kind,l=a.generateIdentifier();n.mid=l,n.iceGatherer||(n.iceGatherer=t.usingBundle&&r>0?s[0].iceGatherer:t._createIceGatherer(l,r));var u=RTCRtpSender.getCapabilities(o);e<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var c=[{ssrc:1001*(2*r+1)}];i&&e>=15019&&"video"===o&&(c[0].rtx={ssrc:1001*(2*r+1)+1}),n.wantReceive&&(n.rtpReceiver=new RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=u,n.sendEncodingParameters=c}),"max-compat"!==this._config.bundlePolicy&&(l+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",s.forEach(function(e,t){l+=a.writeMediaSection(e,e.localCapabilities,"offer",e.stream),l+="a=rtcp-rsize\r\n"}),this._pendingOffer=s;var u=new RTCSessionDescription({type:"offer",sdp:l});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,u),Promise.resolve(u)},t.prototype.createAnswer=function(){var t=a.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n,r){if(n.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n");if(n.stream){var i;"audio"===n.kind?i=n.stream.getAudioTracks()[0]:"video"===n.kind&&(i=n.stream.getVideoTracks()[0]),i&&e>=15019&&"video"===n.kind&&(n.sendEncodingParameters[0].rtx={ssrc:1001*(2*r+2)+1})}var s=o(n.localCapabilities,n.remoteCapabilities),l=s.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!l&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx,t+=a.writeMediaSection(n,s,"answer",n.stream),n.rtcpParameters&&n.rtcpParameters.reducedSize&&(t+="a=rtcp-rsize\r\n")});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},t.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var r=this.transceivers[t];if(r){var i=Object.keys(e.candidate).length>0?a.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return Promise.resolve();if(i.component&&"1"!==i.component&&1!==i.component)return Promise.resolve();r.iceTransport.addRemoteCandidate(i);var o=a.splitSections(this.remoteDescription.sdp);o[t+1]+=(i.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}else for(var s=0;s<this.transceivers.length;s++)if(this.transceivers[s].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},t.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]),i.set(t,e[t])})}),t&&window.setTimeout(t,0,i),r(i)})})},t}},{sdp:21}],30:[function(e,t,n){"use strict";var r=e("../utils").browserDetails,i={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var s=0;s<o.urls.length;s++){var a={url:o.urls[s]};0===o.urls[s].indexOf("turn")&&(a.username=o.username,a.credential=o.credential),n.push(a)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,o,s){return i.apply(this,[e||null]).then(function(e){if(r.version<48&&(e=t(e)),r.version<53&&!o)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(i){if("TypeError"!==i.name)throw i;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(o,s)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":33,"./getusermedia":31}],31:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=s(t.audio)),t.video&&(t.video=s(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})},n=function(e){return new Promise(function(n,r){t(e,n,r)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},i.version<41){var o=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return o().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return s(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){return i.version<44?t(e,n,r):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(e).then(n,r))}}},{"../utils":33}],32:[function(e,t,n){"use strict";var r={shimAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"addStream"in window.RTCPeerConnection.prototype||(RTCPeerConnection.prototype.addStream=function(e){var t=this;e.getTracks().forEach(function(n){t.addTrack(n,e)})})},shimOnAddStream:function(){"object"!=typeof window||!window.RTCPeerConnection||"onaddstream"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._streams||(this._streams=[]),!(this._streams.indexOf(t)>=0)){this._streams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}})},shimCallbacksAPI:function(){if("object"==typeof window&&window.RTCPeerConnection){var e=RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(e,n){var r=arguments.length>=2?arguments[2]:arguments[0],i=t.apply(this,[r]);return n?(i.then(e,n),Promise.resolve()):i},e.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};e.setLocalDescription=s,s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.setRemoteDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.addIceCandidate=s}},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t,n)}.bind(navigator)))}};t.exports={shimCallbacksAPI:r.shimCallbacksAPI,shimAddStream:r.shimAddStream,shimOnAddStream:r.shimOnAddStream,shimGetUserMedia:r.shimGetUserMedia}},{}],33:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},shimCreateObjectURL:function(){return}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},{}],34:[function(e,t,n){t.exports={name:"plivowebsdk",title:"plivowebsdk",version:"2.0.19",description:"Plivo WebRTC sdk for use in chrome/firefox ",main:"./lib/index.js",directories:{example:"example"},scripts:{build:"node_modules/gulp/bin/gulp.js build"},repository:{type:"git",url:"git+https://github.com/gigster-eng/PlivoWebSDK.git"},author:"",license:"ISC",bugs:{url:"https://github.com/gigster-eng/PlivoWebSDK/issues"},homepage:"https://github.com/gigster-eng/PlivoWebSDK#readme",dependencies:{debug:"^2.6.3","sdp-transform":"^2.3.0",uuid:"^2.0.3","webrtc-adapter":"^3.2.0"},devDependencies:{browserify:"^9.0.3",cheerio:"^0.22.0",del:"^2.0.2",disc:"^1.3.2",eslint:"^2.12.0",gulp:"^3.9.0","gulp-copy":"0.0.2","gulp-express":"^0.3.5","gulp-footer":"^1.0.5","gulp-header":"^2.0.5","gulp-insert":"^0.5.0","gulp-istanbul":"^0.10.3","gulp-newer":"^1.0.0","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-uglify":"^1.4.2","gulp-util":"^3.0.7",jsdoc:"https://github.com/jsdoc3/jsdoc.git#e2fd9e75de9617aadfc3120331f020b2d66cff86",jshint:"^2.6.3","jshint-stylish":"^1.0.0",mkdirp:"^0.5.1",opener:"^1.4.2",promptly:"^0.2.0","release-tool":"^0.2.2","run-sequence":"^1.2.2",sinon:"^1.15.3","stream-from-promise":"^0.1.0",through2:"^2.0.0","vinyl-source-stream":"^1.1.0"}}},{}],35:[function(e,t,n){var r=e("../package.json"),i={USER_AGENT:r.title+" "+r.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60};t.exports=i},{"../package.json":34}],36:[function(e,t,n){function r(e,t,n,r){var a;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,t.hasHeader("contact")?(r=t instanceof s.IncomingResponse?t.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:r||i.STATUS_CONFIRMED,a=t.parseHeader("contact"),"UAS"===n?(this.id={call_id:t.call_id,local_tag:t.to_tag,remote_tag:t.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=t.cseq,this.local_uri=t.parseHeader("to").uri,this.remote_uri=t.parseHeader("from").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route")):"UAC"===n&&(this.id={call_id:t.call_id,local_tag:t.from_tag,remote_tag:t.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag;
}},this.state=r,this.local_seqnum=t.cseq,this.local_uri=t.parseHeader("from").uri,this.remote_uri=t.parseHeader("to").uri,this.remote_target=a.uri,this.route_set=t.getHeaders("record-route").reverse()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,void o("new "+n+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}t.exports=r;var i={STATUS_EARLY:1,STATUS_CONFIRMED:2};r.C=i;var o=e("debug")("PlivoSIP:Dialog"),s=e("./SIPMessage"),a=e("./Constants"),l=e("./Transactions"),u=e("./Dialog/RequestSender");r.prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,o("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){o("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,t,n){var r,i;return t=t&&t.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=e===a.CANCEL||e===a.ACK?this.local_seqnum:this.local_seqnum+=1,i=new s.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},t,n),i.dialog=this,i},checkInDialogRequest:function(e){var t=this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==a.ACK&&e.reply(500),!1;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;if(e.method===a.INVITE||e.method===a.UPDATE&&e.body){if(this.uac_pending_reply===!0)e.reply(491);else{if(this.uas_pending_reply===!0){var n=(10*Math.random()|0)+1;return e.reply(500,null,["Retry-After:"+n]),!1}this.uas_pending_reply=!0,e.server_transaction.on("stateChanged",function r(){this.state!==l.C.STATUS_ACCEPTED&&this.state!==l.C.STATUS_COMPLETED&&this.state!==l.C.STATUS_TERMINATED||(e.server_transaction.removeListener("stateChanged",r),t.uas_pending_reply=!1)})}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===l.C.STATUS_ACCEPTED&&(t.remote_target=e.parseHeader("contact").uri)})}else e.method===a.NOTIFY&&e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===l.C.STATUS_COMPLETED&&(t.remote_target=e.parseHeader("contact").uri)});return!0},sendRequest:function(e,t,n){n=n||{};var r=n.extraHeaders&&n.extraHeaders.slice()||[],i=n.body||null,o=this.createRequest(t,r,i),s=new u(this,e,o);return s.send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}}},{"./Constants":35,"./Dialog/RequestSender":37,"./SIPMessage":52,"./Transactions":55,debug:12}],37:[function(e,t,n){function r(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}t.exports=r;var i=e("../Constants"),o=e("../Transactions"),s=e("../RTCSession"),a=e("../RequestSender");r.prototype={send:function(){var e=this,t=new a(this,this.dialog.owner.ua);t.send(),(this.request.method===i.INVITE||this.request.method===i.UPDATE&&this.request.body)&&t.clientTransaction.state!==o.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,t.clientTransaction.on("stateChanged",function n(){this.state!==o.C.STATUS_ACCEPTED&&this.state!==o.C.STATUS_COMPLETED&&this.state!==o.C.STATUS_TERMINATED||(t.clientTransaction.removeListener("stateChanged",n),e.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t=this;408===e.status_code||481===e.status_code?this.applicant.onDialogError(e):e.method===i.INVITE&&491===e.status_code?this.reattempt?this.applicant.receiveResponse(e):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){t.applicant.owner.status!==s.C.STATUS_TERMINATED&&(t.reattempt=!0,t.request_sender.send())},1e3)):this.applicant.receiveResponse(e)}}},{"../Constants":35,"../RTCSession":45,"../RequestSender":51,"../Transactions":55}],38:[function(e,t,n){function r(e){this.credentials=e,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.algorithm=null,this.realm=null,this.nonce=null,this.opaque=null,this.stale=null,this.qop=null,this.method=null,this.uri=null,this.ha1=null,this.response=null}t.exports=r;var i=e("debug")("PlivoSIP:DigestAuthentication"),o=e("debug")("PlivoSIP:ERROR:DigestAuthentication");o.log=console.warn.bind(console);var s=e("./Utils");r.prototype.get=function(e){switch(e){case"realm":return this.realm;case"ha1":return this.ha1;default:return void o('get() | cannot get "%s" parameter',e)}},r.prototype.authenticate=function(e,t){var n,r;if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return o('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.nonce)return o("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this.realm)return o("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this.credentials.password){if(!this.credentials.ha1)return o("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this.credentials.realm!==this.realm)return o('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this.credentials.realm,this.realm),!1}if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return o('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=e.method,this.uri=e.ruri,this.cnonce=s.createRandomToken(12),this.nc+=1,r=Number(this.nc).toString(16),this.ncHex="00000000".substr(0,8-r.length)+r,4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.credentials.password?this.ha1=s.calculateMD5(this.credentials.username+":"+this.realm+":"+this.credentials.password):this.ha1=this.credentials.ha1,"auth"===this.qop?(n=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=s.calculateMD5(this.method+":"+this.uri+":"+s.calculateMD5(this.body?this.body:"")),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=s.calculateMD5(this.method+":"+this.uri),this.response=s.calculateMD5(this.ha1+":"+this.nonce+":"+n)),i("authenticate() | response generated"),!0},r.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.credentials.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")}},{"./Utils":59,debug:12}],39:[function(e,t,n){var r={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),NotReadyError:function(){var e=function(e){this.code=4,this.name="NOT_READY_ERROR",this.message=e};return e.prototype=new Error,e}()};t.exports=r},{}],40:[function(e,t,n){t.exports=function(){function t(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,r){function i(e){yr<_r||(yr>_r&&(_r=yr,Sr=[]),Sr.push(e))}function o(){var e;return"\r\n"===n.substr(yr,2)?(e="\r\n",yr+=2):(e=null,0===br&&i('"\\r\\n"')),e}function s(){var e;return/^[0-9]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[0-9]")),e}function a(){var e;return/^[a-zA-Z]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[a-zA-Z]")),e}function l(){var e;return/^[0-9a-fA-F]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[0-9a-fA-F]")),e}function u(){var e;return e=f(),null===e&&(e=h()),e}function c(){var e;return/^[\0-\xFF]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[\\0-\\xFF]")),e}function d(){var e;return/^["]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i('["]')),e}function f(){var e;return 32===n.charCodeAt(yr)?(e=" ",yr++):(e=null,0===br&&i('" "')),e}function h(){var e;return 9===n.charCodeAt(yr)?(e="\t",yr++):(e=null,0===br&&i('"\\t"')),e}function p(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[a-zA-Z0-9]")),e}function v(){var e;return 59===n.charCodeAt(yr)?(e=";",yr++):(e=null,0===br&&i('";"')),null===e&&(47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"')),null===e&&(63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(64===n.charCodeAt(yr)?(e="@",yr++):(e=null,0===br&&i('"@"')),null===e&&(38===n.charCodeAt(yr)?(e="&",yr++):(e=null,0===br&&i('"&"')),null===e&&(61===n.charCodeAt(yr)?(e="=",yr++):(e=null,0===br&&i('"="')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')),null===e&&(44===n.charCodeAt(yr)?(e=",",yr++):(e=null,0===br&&i('","'))))))))))),e}function g(){var e;return e=p(),null===e&&(e=m()),e}function m(){var e;return 45===n.charCodeAt(yr)?(e="-",yr++):(e=null,0===br&&i('"-"')),null===e&&(95===n.charCodeAt(yr)?(e="_",yr++):(e=null,0===br&&i('"_"')),null===e&&(46===n.charCodeAt(yr)?(e=".",yr++):(e=null,0===br&&i('"."')),null===e&&(33===n.charCodeAt(yr)?(e="!",yr++):(e=null,0===br&&i('"!"')),null===e&&(126===n.charCodeAt(yr)?(e="~",yr++):(e=null,0===br&&i('"~"')),null===e&&(42===n.charCodeAt(yr)?(e="*",yr++):(e=null,0===br&&i('"*"')),null===e&&(39===n.charCodeAt(yr)?(e="'",yr++):(e=null,0===br&&i('"\'"')),null===e&&(40===n.charCodeAt(yr)?(e="(",yr++):(e=null,0===br&&i('"("')),null===e&&(41===n.charCodeAt(yr)?(e=")",yr++):(e=null,0===br&&i('")"')))))))))),e}function y(){var e,t,r,o,s;return o=yr,s=yr,37===n.charCodeAt(yr)?(e="%",yr++):(e=null,0===br&&i('"%"')),null!==e?(t=l(),null!==t?(r=l(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){return t.join("")}(o,e)),null===e&&(yr=o),e}function b(){var e,t,n,r,i,s;for(r=yr,i=yr,s=yr,e=[],t=u();null!==t;)e.push(t),t=u();if(null!==e?(t=o(),null!==t?e=[e,t]:(e=null,yr=s)):(e=null,yr=s),e=null!==e?e:"",null!==e){if(n=u(),null!==n)for(t=[];null!==n;)t.push(n),n=u();else t=null;null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return null!==e&&(e=function(e){return" "}(r)),null===e&&(yr=r),e}function _(){var e;return e=b(),e=null!==e?e:""}function S(){var e,t,r,o,s;for(o=yr,s=yr,e=[],t=f(),null===t&&(t=h());null!==t;)e.push(t),t=f(),null===t&&(t=h());return null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return":"}(o)),null===e&&(yr=o),e}function T(){var e,t,r,i,o,s,a;if(o=yr,s=yr,t=C(),null!==t)for(e=[];null!==t;)e.push(t),t=C();else e=null;if(null!==e){for(t=[],a=yr,r=[],i=b();null!==i;)r.push(i),i=b();for(null!==r?(i=C(),null!==i?r=[r,i]:(r=null,yr=a)):(r=null,yr=a);null!==r;){for(t.push(r),a=yr,r=[],i=b();null!==i;)r.push(i),i=b();null!==r?(i=C(),null!==i?r=[r,i]:(r=null,yr=a)):(r=null,yr=a)}null!==t?e=[e,t]:(e=null,yr=s)}else e=null,yr=s;return null!==e&&(e=function(e){return n.substring(yr,e)}(o)),null===e&&(yr=o),e}function C(){var e;return/^[!-~]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[!-~]")),null===e&&(e=w()),e}function w(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[\\x80-\\uFFFF]")),e}function E(){var e;return/^[\x80-\xBF]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[\\x80-\\xBF]")),e}function k(){var e;return e=s(),null===e&&(/^[a-f]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[a-f]"))),e}function R(){var e,t,r;if(r=yr,t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(yr,e)}(r)),null===e&&(yr=r),e}function I(){var e,t,r;if(r=yr,t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(yr,e)}(r)),null===e&&(yr=r),e}function P(){var e;return 40===n.charCodeAt(yr)?(e="(",yr++):(e=null,0===br&&i('"("')),null===e&&(41===n.charCodeAt(yr)?(e=")",yr++):(e=null,0===br&&i('")"')),null===e&&(60===n.charCodeAt(yr)?(e="<",yr++):(e=null,0===br&&i('"<"')),null===e&&(62===n.charCodeAt(yr)?(e=">",yr++):(e=null,0===br&&i('">"')),null===e&&(64===n.charCodeAt(yr)?(e="@",yr++):(e=null,0===br&&i('"@"')),null===e&&(44===n.charCodeAt(yr)?(e=",",yr++):(e=null,0===br&&i('","')),null===e&&(59===n.charCodeAt(yr)?(e=";",yr++):(e=null,0===br&&i('";"')),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(92===n.charCodeAt(yr)?(e="\\",yr++):(e=null,0===br&&i('"\\\\"')),null===e&&(e=d(),null===e&&(47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"')),null===e&&(91===n.charCodeAt(yr)?(e="[",yr++):(e=null,0===br&&i('"["')),null===e&&(93===n.charCodeAt(yr)?(e="]",yr++):(e=null,0===br&&i('"]"')),null===e&&(63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null===e&&(61===n.charCodeAt(yr)?(e="=",yr++):(e=null,0===br&&i('"="')),null===e&&(123===n.charCodeAt(yr)?(e="{",yr++):(e=null,0===br&&i('"{"')),null===e&&(125===n.charCodeAt(yr)?(e="}",yr++):(e=null,0===br&&i('"}"')),null===e&&(e=f(),null===e&&(e=h())))))))))))))))))),e}function A(){var e,t,r;if(r=yr,t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"')),null===t&&(40===n.charCodeAt(yr)?(t="(",yr++):(t=null,0===br&&i('"("')),null===t&&(41===n.charCodeAt(yr)?(t=")",yr++):(t=null,0===br&&i('")"')),null===t&&(60===n.charCodeAt(yr)?(t="<",yr++):(t=null,0===br&&i('"<"')),null===t&&(62===n.charCodeAt(yr)?(t=">",yr++):(t=null,0===br&&i('">"')),null===t&&(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null===t&&(92===n.charCodeAt(yr)?(t="\\",yr++):(t=null,0===br&&i('"\\\\"')),null===t&&(t=d(),null===t&&(47===n.charCodeAt(yr)?(t="/",yr++):(t=null,0===br&&i('"/"')),null===t&&(91===n.charCodeAt(yr)?(t="[",yr++):(t=null,0===br&&i('"["')),null===t&&(93===n.charCodeAt(yr)?(t="]",yr++):(t=null,0===br&&i('"]"')),null===t&&(63===n.charCodeAt(yr)?(t="?",yr++):(t=null,0===br&&i('"?"')),null===t&&(123===n.charCodeAt(yr)?(t="{",yr++):(t=null,0===br&&i('"{"')),null===t&&(125===n.charCodeAt(yr)?(t="}",yr++):(t=null,0===br&&i('"}"'))))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=p(),null===t&&(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null===t&&(46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null===t&&(33===n.charCodeAt(yr)?(t="!",yr++):(t=null,0===br&&i('"!"')),null===t&&(37===n.charCodeAt(yr)?(t="%",yr++):(t=null,0===br&&i('"%"')),null===t&&(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null===t&&(95===n.charCodeAt(yr)?(t="_",yr++):(t=null,0===br&&i('"_"')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(96===n.charCodeAt(yr)?(t="`",yr++):(t=null,0===br&&i('"`"')),null===t&&(39===n.charCodeAt(yr)?(t="'",yr++):(t=null,0===br&&i('"\'"')),null===t&&(126===n.charCodeAt(yr)?(t="~",yr++):(t=null,0===br&&i('"~"')),null===t&&(40===n.charCodeAt(yr)?(t="(",yr++):(t=null,0===br&&i('"("')),null===t&&(41===n.charCodeAt(yr)?(t=")",yr++):(t=null,0===br&&i('")"')),null===t&&(60===n.charCodeAt(yr)?(t="<",yr++):(t=null,0===br&&i('"<"')),null===t&&(62===n.charCodeAt(yr)?(t=">",yr++):(t=null,0===br&&i('">"')),null===t&&(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null===t&&(92===n.charCodeAt(yr)?(t="\\",yr++):(t=null,0===br&&i('"\\\\"')),null===t&&(t=d(),null===t&&(47===n.charCodeAt(yr)?(t="/",yr++):(t=null,0===br&&i('"/"')),null===t&&(91===n.charCodeAt(yr)?(t="[",yr++):(t=null,0===br&&i('"["')),null===t&&(93===n.charCodeAt(yr)?(t="]",yr++):(t=null,0===br&&i('"]"')),null===t&&(63===n.charCodeAt(yr)?(t="?",yr++):(t=null,0===br&&i('"?"')),null===t&&(123===n.charCodeAt(yr)?(t="{",yr++):(t=null,0===br&&i('"{"')),null===t&&(125===n.charCodeAt(yr)?(t="}",yr++):(t=null,0===br&&i('"}"')))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(yr,e)}(r)),null===e&&(yr=r),e}function O(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(42===n.charCodeAt(yr)?(t="*",yr++):(t=null,0===br&&i('"*"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return"*"}(o)),null===e&&(yr=o),e}function M(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(47===n.charCodeAt(yr)?(t="/",yr++):(t=null,0===br&&i('"/"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return"/"}(o)),null===e&&(yr=o),e}function D(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return"="}(o)),null===e&&(yr=o),e}function x(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(40===n.charCodeAt(yr)?(t="(",yr++):(t=null,0===br&&i('"("')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return"("}(o)),null===e&&(yr=o),e}function N(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(41===n.charCodeAt(yr)?(t=")",yr++):(t=null,0===br&&i('")"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return")"}(o)),null===e&&(yr=o),e}function F(){var e,t,r,o;return r=yr,o=yr,62===n.charCodeAt(yr)?(e=">",yr++):(e=null,0===br&&i('">"')),null!==e?(t=_(),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e){return">"}(r)),null===e&&(yr=r),e}function U(){var e,t,r,o;return r=yr,o=yr,e=_(),null!==e?(60===n.charCodeAt(yr)?(t="<",yr++):(t=null,0===br&&i('"<"')),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e){return"<"}(r)),null===e&&(yr=r),e}function j(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(44===n.charCodeAt(yr)?(t=",",yr++):(t=null,0===br&&i('","')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return","}(o)),null===e&&(yr=o),e}function L(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(59===n.charCodeAt(yr)?(t=";",yr++):(t=null,0===br&&i('";"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return";"}(o)),null===e&&(yr=o),e}function H(){var e,t,r,o,s;return o=yr,s=yr,e=_(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=_(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return":"}(o)),null===e&&(yr=o),e}function B(){var e,t,n,r;return n=yr,r=yr,e=_(),null!==e?(t=d(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),null!==e&&(e=function(e){return'"'}(n)),null===e&&(yr=n),e}function q(){var e,t,n,r;return n=yr,r=yr,e=d(),null!==e?(t=_(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),null!==e&&(e=function(e){return'"'}(n)),null===e&&(yr=n),e}function G(){var e,t,n,r;if(r=yr,e=x(),null!==e){for(t=[],n=W(),null===n&&(n=J(),null===n&&(n=G()));null!==n;)t.push(n),n=W(),null===n&&(n=J(),null===n&&(n=G()));null!==t?(n=N(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)}else e=null,yr=r;return e}function W(){var e;return/^[!-']/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[!-']")),null===e&&(/^[*-[]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[*-[]")),null===e&&(/^[\]-~]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[\\]-~]")),null===e&&(e=w(),null===e&&(e=b())))),e}function V(){var e,t,r,i,o,s;if(o=yr,s=yr,e=_(),null!==e)if(t=d(),null!==t){for(r=[],i=K(),null===i&&(i=J());null!==i;)r.push(i),i=K(),null===i&&(i=J());null!==r?(i=d(),null!==i?e=[e,t,r,i]:(e=null,yr=s)):(e=null,yr=s)}else e=null,yr=s;else e=null,yr=s;return null!==e&&(e=function(e){return n.substring(yr,e)}(o)),null===e&&(yr=o),e}function z(){var e,t,r,i,o,s;if(o=yr,s=yr,e=_(),null!==e)if(t=d(),null!==t){for(r=[],i=K(),null===i&&(i=J());null!==i;)r.push(i),i=K(),null===i&&(i=J());null!==r?(i=d(),null!==i?e=[e,t,r,i]:(e=null,yr=s)):(e=null,yr=s)}else e=null,yr=s;else e=null,yr=s;return null!==e&&(e=function(e){return n.substring(yr-1,e+1)}(o)),null===e&&(yr=o),e}function K(){var e;return e=b(),null===e&&(33===n.charCodeAt(yr)?(e="!",yr++):(e=null,0===br&&i('"!"')),null===e&&(/^[#-[]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[#-[]")),null===e&&(/^[\]-~]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[\\]-~]")),null===e&&(e=w())))),e}function J(){var e,t,r;return r=yr,92===n.charCodeAt(yr)?(e="\\",yr++):(e=null,0===br&&i('"\\\\"')),null!==e?(/^[\0-\t]/.test(n.charAt(yr))?(t=n.charAt(yr),yr++):(t=null,0===br&&i("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(n.charAt(yr))?(t=n.charAt(yr),yr++):(t=null,0===br&&i("[\\x0B-\\f]")),null===t&&(/^[\x0E-\x7f]/.test(n.charAt(yr))?(t=n.charAt(yr),yr++):(t=null,0===br&&i("[\\x0E-\x7f]")))),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e}function Q(){var e,t,r,o,s,a;return s=yr,a=yr,e=$(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=ee(),r=null!==r?r:"",null!==r?(o=ie(),null!==o?e=[e,t,r,o]:(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a),null!==e&&(e=function(e){try{wr.uri=new Tr(wr.scheme,wr.user,wr.host,wr.port),delete wr.scheme,delete wr.user,delete wr.host,delete wr.host_type,delete wr.port}catch(t){wr=-1}}(s)),null===e&&(yr=s),e}function X(){var e,t,o,s,a,l,u,c;return u=yr,c=yr,e=$(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(o=ee(),o=null!==o?o:"",null!==o?(s=ie(),null!==s?(a=ge(),null!==a?(l=Pe(),l=null!==l?l:"",null!==l?e=[e,t,o,s,a,l]:(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c),null!==e&&(e=function(e){try{wr.uri=new Tr(wr.scheme,wr.user,wr.host,wr.port,wr.uri_params,wr.uri_headers),delete wr.scheme,delete wr.user,delete wr.host,delete wr.host_type,delete wr.port,delete wr.uri_params,"SIP_URI"===r&&(wr=wr.uri)}catch(t){wr=-1}}(u)),null===e&&(yr=u),e}function $(){var e;return e=Y(),null===e&&(e=Z()),e}function Y(){var e,t;return t=yr,"sips"===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"sips"')),null!==e&&(e=function(e,t){wr.scheme=t.toLowerCase()}(t,e)),null===e&&(yr=t),e}function Z(){var e,t;return t=yr,"sip"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"sip"')),null!==e&&(e=function(e,t){wr.scheme=t.toLowerCase()}(t,e)),null===e&&(yr=t),e}function ee(){var e,t,r,o,s,a;return o=yr,s=yr,e=te(),null!==e?(a=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=re(),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a),t=null!==t?t:"",null!==t?(64===n.charCodeAt(yr)?(r="@",yr++):(r=null,0===br&&i('"@"')),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){wr.user=decodeURIComponent(n.substring(yr-1,e))}(o)),null===e&&(yr=o),e}function te(){var e,t;if(t=g(),null===t&&(t=y(),null===t&&(t=ne())),null!==t)for(e=[];null!==t;)e.push(t),t=g(),null===t&&(t=y(),null===t&&(t=ne()));else e=null;return e}function ne(){var e;return 38===n.charCodeAt(yr)?(e="&",yr++):(e=null,0===br&&i('"&"')),null===e&&(61===n.charCodeAt(yr)?(e="=",yr++):(e=null,0===br&&i('"="')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')),null===e&&(44===n.charCodeAt(yr)?(e=",",yr++):(e=null,0===br&&i('","')),null===e&&(59===n.charCodeAt(yr)?(e=";",yr++):(e=null,0===br&&i('";"')),null===e&&(63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null===e&&(47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"'))))))))),e}function re(){var e,t,r;for(r=yr,e=[],t=g(),null===t&&(t=y(),null===t&&(38===n.charCodeAt(yr)?(t="&",yr++):(t=null,0===br&&i('"&"')),null===t&&(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(36===n.charCodeAt(yr)?(t="$",yr++):(t=null,0===br&&i('"$"')),null===t&&(44===n.charCodeAt(yr)?(t=",",yr++):(t=null,0===br&&i('","'))))))));null!==t;)e.push(t),t=g(),null===t&&(t=y(),null===t&&(38===n.charCodeAt(yr)?(t="&",yr++):(t=null,0===br&&i('"&"')),null===t&&(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')),null===t&&(36===n.charCodeAt(yr)?(t="$",yr++):(t=null,0===br&&i('"$"')),null===t&&(44===n.charCodeAt(yr)?(t=",",yr++):(t=null,0===br&&i('","'))))))));return null!==e&&(e=function(e){wr.password=n.substring(yr,e)}(r)),null===e&&(yr=r),e}function ie(){var e,t,r,o,s;return o=yr,e=oe(),null!==e?(s=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=ve(),null!==r?t=[t,r]:(t=null,yr=s)):(t=null,yr=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),e}function oe(){var e,t;return t=yr,e=se(),null===e&&(e=he(),null===e&&(e=ue())),null!==e&&(e=function(e){return wr.host=n.substring(yr,e).toLowerCase(),wr.host}(t)),null===e&&(yr=t),e}function se(){var e,t,r,o,s,a;for(o=yr,s=yr,e=[],a=yr,t=ae(),null!==t?(46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."')),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a);null!==t;)e.push(t),a=yr,t=ae(),null!==t?(46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."')),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a);return null!==e?(t=le(),null!==t?(46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."')),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return wr.host_type="domain",n.substring(yr,e)}(o)),null===e&&(yr=o),e}function ae(){var e,t,r,o;if(o=yr,e=p(),null!==e){for(t=[],r=p(),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(95===n.charCodeAt(yr)?(r="_",yr++):(r=null,0===br&&i('"_"'))));null!==r;)t.push(r),r=p(),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(95===n.charCodeAt(yr)?(r="_",yr++):(r=null,0===br&&i('"_"'))));null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return e}function le(){var e,t,r,o;if(o=yr,e=a(),null!==e){for(t=[],r=p(),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(95===n.charCodeAt(yr)?(r="_",yr++):(r=null,0===br&&i('"_"'))));null!==r;)t.push(r),r=p(),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(95===n.charCodeAt(yr)?(r="_",yr++):(r=null,0===br&&i('"_"'))));null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return e}function ue(){var e,t,r,o,s;return o=yr,s=yr,91===n.charCodeAt(yr)?(e="[",yr++):(e=null,0===br&&i('"["')),null!==e?(t=ce(),null!==t?(93===n.charCodeAt(yr)?(r="]",yr++):(r=null,0===br&&i('"]"')),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){return wr.host_type="IPv6",n.substring(yr,e)}(o)),null===e&&(yr=o),e}function ce(){var e,t,r,o,s,a,l,u,c,d,f,h,p,v,g,m;return v=yr,g=yr,e=de(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?(58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(yr)?(a=":",yr++):(a=null,0===br&&i('":"')),null!==a?(l=de(),null!==l?(58===n.charCodeAt(yr)?(u=":",yr++):(u=null,0===br&&i('":"')),null!==u?(c=de(),null!==c?(58===n.charCodeAt(yr)?(d=":",
yr++):(d=null,0===br&&i('":"')),null!==d?(f=de(),null!==f?(58===n.charCodeAt(yr)?(h=":",yr++):(h=null,0===br&&i('":"')),null!==h?(p=fe(),null!==p?e=[e,t,r,o,s,a,l,u,c,d,f,h,p]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=de(),null!==u?(58===n.charCodeAt(yr)?(c=":",yr++):(c=null,0===br&&i('":"')),null!==c?(d=de(),null!==d?(58===n.charCodeAt(yr)?(f=":",yr++):(f=null,0===br&&i('":"')),null!==f?(h=fe(),null!==h?e=[e,t,r,o,s,a,l,u,c,d,f,h]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=de(),null!==u?(58===n.charCodeAt(yr)?(c=":",yr++):(c=null,0===br&&i('":"')),null!==c?(d=fe(),null!==d?e=[e,t,r,o,s,a,l,u,c,d]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=fe(),null!==u?e=[e,t,r,o,s,a,l,u]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=fe(),null!==a?e=[e,t,r,o,s,a]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?(58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=fe(),null!==o?e=[e,t,r,o]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=fe(),null!==t?e=[e,t]:(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,"::"===n.substr(yr,2)?(e="::",yr+=2):(e=null,0===br&&i('"::"')),null!==e?(t=de(),null!==t?e=[e,t]:(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?("::"===n.substr(yr,2)?(t="::",yr+=2):(t=null,0===br&&i('"::"')),null!==t?(r=de(),null!==r?(58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(yr)?(a=":",yr++):(a=null,0===br&&i('":"')),null!==a?(l=de(),null!==l?(58===n.charCodeAt(yr)?(u=":",yr++):(u=null,0===br&&i('":"')),null!==u?(c=de(),null!==c?(58===n.charCodeAt(yr)?(d=":",yr++):(d=null,0===br&&i('":"')),null!==d?(f=fe(),null!==f?e=[e,t,r,o,s,a,l,u,c,d,f]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?("::"===n.substr(yr,2)?(r="::",yr+=2):(r=null,0===br&&i('"::"')),null!==r?(o=de(),null!==o?(58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=de(),null!==u?(58===n.charCodeAt(yr)?(c=":",yr++):(c=null,0===br&&i('":"')),null!==c?(d=fe(),null!==d?e=[e,t,r,o,s,a,l,u,c,d]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?(m=yr,58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,yr=m)):(r=null,yr=m),r=null!==r?r:"",null!==r?("::"===n.substr(yr,2)?(o="::",yr+=2):(o=null,0===br&&i('"::"')),null!==o?(s=de(),null!==s?(58===n.charCodeAt(yr)?(a=":",yr++):(a=null,0===br&&i('":"')),null!==a?(l=de(),null!==l?(58===n.charCodeAt(yr)?(u=":",yr++):(u=null,0===br&&i('":"')),null!==u?(c=fe(),null!==c?e=[e,t,r,o,s,a,l,u,c]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?(m=yr,58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,yr=m)):(r=null,yr=m),r=null!==r?r:"",null!==r?(m=yr,58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,yr=m)):(o=null,yr=m),o=null!==o?o:"",null!==o?("::"===n.substr(yr,2)?(s="::",yr+=2):(s=null,0===br&&i('"::"')),null!==s?(a=de(),null!==a?(58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=fe(),null!==u?e=[e,t,r,o,s,a,l,u]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?(m=yr,58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,yr=m)):(r=null,yr=m),r=null!==r?r:"",null!==r?(m=yr,58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,yr=m)):(o=null,yr=m),o=null!==o?o:"",null!==o?(m=yr,58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,yr=m)):(s=null,yr=m),s=null!==s?s:"",null!==s?("::"===n.substr(yr,2)?(a="::",yr+=2):(a=null,0===br&&i('"::"')),null!==a?(l=fe(),null!==l?e=[e,t,r,o,s,a,l]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?(m=yr,58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,yr=m)):(r=null,yr=m),r=null!==r?r:"",null!==r?(m=yr,58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,yr=m)):(o=null,yr=m),o=null!==o?o:"",null!==o?(m=yr,58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,yr=m)):(s=null,yr=m),s=null!==s?s:"",null!==s?(m=yr,58===n.charCodeAt(yr)?(a=":",yr++):(a=null,0===br&&i('":"')),null!==a?(l=de(),null!==l?a=[a,l]:(a=null,yr=m)):(a=null,yr=m),a=null!==a?a:"",null!==a?("::"===n.substr(yr,2)?(l="::",yr+=2):(l=null,0===br&&i('"::"')),null!==l?(u=de(),null!==u?e=[e,t,r,o,s,a,l,u]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g),null===e&&(g=yr,e=de(),null!==e?(m=yr,58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,yr=m)):(t=null,yr=m),t=null!==t?t:"",null!==t?(m=yr,58===n.charCodeAt(yr)?(r=":",yr++):(r=null,0===br&&i('":"')),null!==r?(o=de(),null!==o?r=[r,o]:(r=null,yr=m)):(r=null,yr=m),r=null!==r?r:"",null!==r?(m=yr,58===n.charCodeAt(yr)?(o=":",yr++):(o=null,0===br&&i('":"')),null!==o?(s=de(),null!==s?o=[o,s]:(o=null,yr=m)):(o=null,yr=m),o=null!==o?o:"",null!==o?(m=yr,58===n.charCodeAt(yr)?(s=":",yr++):(s=null,0===br&&i('":"')),null!==s?(a=de(),null!==a?s=[s,a]:(s=null,yr=m)):(s=null,yr=m),s=null!==s?s:"",null!==s?(m=yr,58===n.charCodeAt(yr)?(a=":",yr++):(a=null,0===br&&i('":"')),null!==a?(l=de(),null!==l?a=[a,l]:(a=null,yr=m)):(a=null,yr=m),a=null!==a?a:"",null!==a?(m=yr,58===n.charCodeAt(yr)?(l=":",yr++):(l=null,0===br&&i('":"')),null!==l?(u=de(),null!==u?l=[l,u]:(l=null,yr=m)):(l=null,yr=m),l=null!==l?l:"",null!==l?("::"===n.substr(yr,2)?(u="::",yr+=2):(u=null,0===br&&i('"::"')),null!==u?e=[e,t,r,o,s,a,l,u]:(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g)):(e=null,yr=g))))))))))))))),null!==e&&(e=function(e){return wr.host_type="IPv6",n.substring(yr,e)}(v)),null===e&&(yr=v),e}function de(){var e,t,n,r,i;return i=yr,e=l(),null!==e?(t=l(),t=null!==t?t:"",null!==t?(n=l(),n=null!==n?n:"",null!==n?(r=l(),r=null!==r?r:"",null!==r?e=[e,t,n,r]:(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i),e}function fe(){var e,t,r,o;return o=yr,e=de(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=de(),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),null===e&&(e=he()),e}function he(){var e,t,r,o,s,a,l,u,c;return u=yr,c=yr,e=pe(),null!==e?(46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null!==t?(r=pe(),null!==r?(46===n.charCodeAt(yr)?(o=".",yr++):(o=null,0===br&&i('"."')),null!==o?(s=pe(),null!==s?(46===n.charCodeAt(yr)?(a=".",yr++):(a=null,0===br&&i('"."')),null!==a?(l=pe(),null!==l?e=[e,t,r,o,s,a,l]:(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c)):(e=null,yr=c),null!==e&&(e=function(e){return wr.host_type="IPv4",n.substring(yr,e)}(u)),null===e&&(yr=u),e}function pe(){var e,t,r,o;return o=yr,"25"===n.substr(yr,2)?(e="25",yr+=2):(e=null,0===br&&i('"25"')),null!==e?(/^[0-5]/.test(n.charAt(yr))?(t=n.charAt(yr),yr++):(t=null,0===br&&i("[0-5]")),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null===e&&(o=yr,50===n.charCodeAt(yr)?(e="2",yr++):(e=null,0===br&&i('"2"')),null!==e?(/^[0-4]/.test(n.charAt(yr))?(t=n.charAt(yr),yr++):(t=null,0===br&&i("[0-4]")),null!==t?(r=s(),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),null===e&&(o=yr,49===n.charCodeAt(yr)?(e="1",yr++):(e=null,0===br&&i('"1"')),null!==e?(t=s(),null!==t?(r=s(),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),null===e&&(o=yr,/^[1-9]/.test(n.charAt(yr))?(e=n.charAt(yr),yr++):(e=null,0===br&&i("[1-9]")),null!==e?(t=s(),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null===e&&(e=s())))),e}function ve(){var e,t,n,r,i,o,a;return o=yr,a=yr,e=s(),e=null!==e?e:"",null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?(r=s(),r=null!==r?r:"",null!==r?(i=s(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a),null!==e&&(e=function(e,t){return t=parseInt(t.join("")),wr.port=t,t}(o,e)),null===e&&(yr=o),e}function ge(){var e,t,r,o;for(e=[],o=yr,59===n.charCodeAt(yr)?(t=";",yr++):(t=null,0===br&&i('";"')),null!==t?(r=me(),null!==r?t=[t,r]:(t=null,yr=o)):(t=null,yr=o);null!==t;)e.push(t),o=yr,59===n.charCodeAt(yr)?(t=";",yr++):(t=null,0===br&&i('";"')),null!==t?(r=me(),null!==r?t=[t,r]:(t=null,yr=o)):(t=null,yr=o);return e}function me(){var e;return e=ye(),null===e&&(e=be(),null===e&&(e=_e(),null===e&&(e=Se(),null===e&&(e=Te(),null===e&&(e=Ce(),null===e&&(e=we())))))),e}function ye(){var e,t,r,o;return r=yr,o=yr,"transport="===n.substr(yr,10).toLowerCase()?(e=n.substr(yr,10),yr+=10):(e=null,0===br&&i('"transport="')),null!==e?("udp"===n.substr(yr,3).toLowerCase()?(t=n.substr(yr,3),yr+=3):(t=null,0===br&&i('"udp"')),null===t&&("tcp"===n.substr(yr,3).toLowerCase()?(t=n.substr(yr,3),yr+=3):(t=null,0===br&&i('"tcp"')),null===t&&("sctp"===n.substr(yr,4).toLowerCase()?(t=n.substr(yr,4),yr+=4):(t=null,0===br&&i('"sctp"')),null===t&&("tls"===n.substr(yr,3).toLowerCase()?(t=n.substr(yr,3),yr+=3):(t=null,0===br&&i('"tls"')),null===t&&(t=R())))),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e,t){wr.uri_params||(wr.uri_params={}),wr.uri_params.transport=t.toLowerCase()}(r,e[1])),null===e&&(yr=r),e}function be(){var e,t,r,o;return r=yr,o=yr,"user="===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"user="')),null!==e?("phone"===n.substr(yr,5).toLowerCase()?(t=n.substr(yr,5),yr+=5):(t=null,0===br&&i('"phone"')),null===t&&("ip"===n.substr(yr,2).toLowerCase()?(t=n.substr(yr,2),yr+=2):(t=null,0===br&&i('"ip"')),null===t&&(t=R())),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e,t){wr.uri_params||(wr.uri_params={}),wr.uri_params.user=t.toLowerCase()}(r,e[1])),null===e&&(yr=r),e}function _e(){var e,t,r,o;return r=yr,o=yr,"method="===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"method="')),null!==e?(t=ut(),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e,t){wr.uri_params||(wr.uri_params={}),wr.uri_params.method=t}(r,e[1])),null===e&&(yr=r),e}function Se(){var e,t,r,o;return r=yr,o=yr,"ttl="===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"ttl="')),null!==e?(t=Jn(),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e,t){wr.params||(wr.params={}),wr.params.ttl=t}(r,e[1])),null===e&&(yr=r),e}function Te(){var e,t,r,o;return r=yr,o=yr,"maddr="===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"maddr="')),null!==e?(t=oe(),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),null!==e&&(e=function(e,t){wr.uri_params||(wr.uri_params={}),wr.uri_params.maddr=t}(r,e[1])),null===e&&(yr=r),e}function Ce(){var e,t,r,o,s,a;return o=yr,s=yr,"lr"===n.substr(yr,2).toLowerCase()?(e=n.substr(yr,2),yr+=2):(e=null,0===br&&i('"lr"')),null!==e?(a=yr,61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null!==t?(r=R(),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){wr.uri_params||(wr.uri_params={}),wr.uri_params.lr=void 0}(o)),null===e&&(yr=o),e}function we(){var e,t,r,o,s,a;return o=yr,s=yr,e=Ee(),null!==e?(a=yr,61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null!==t?(r=ke(),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t,n){wr.uri_params||(wr.uri_params={}),n="undefined"==typeof n?void 0:n[1],wr.uri_params[t.toLowerCase()]=n}(o,e[0],e[1])),null===e&&(yr=o),e}function Ee(){var e,t,n;if(n=yr,t=Re(),null!==t)for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(yr=n),e}function ke(){var e,t,n;if(n=yr,t=Re(),null!==t)for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=function(e,t){return t.join("")}(n,e)),null===e&&(yr=n),e}function Re(){var e;return e=Ie(),null===e&&(e=g(),null===e&&(e=y())),e}function Ie(){var e;return 91===n.charCodeAt(yr)?(e="[",yr++):(e=null,0===br&&i('"["')),null===e&&(93===n.charCodeAt(yr)?(e="]",yr++):(e=null,0===br&&i('"]"')),null===e&&(47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"')),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(38===n.charCodeAt(yr)?(e="&",yr++):(e=null,0===br&&i('"&"')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')))))))),e}function Pe(){var e,t,r,o,s,a,l;if(a=yr,63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null!==e)if(t=Ae(),null!==t){for(r=[],l=yr,38===n.charCodeAt(yr)?(o="&",yr++):(o=null,0===br&&i('"&"')),null!==o?(s=Ae(),null!==s?o=[o,s]:(o=null,yr=l)):(o=null,yr=l);null!==o;)r.push(o),l=yr,38===n.charCodeAt(yr)?(o="&",yr++):(o=null,0===br&&i('"&"')),null!==o?(s=Ae(),null!==s?o=[o,s]:(o=null,yr=l)):(o=null,yr=l);null!==r?e=[e,t,r]:(e=null,yr=a)}else e=null,yr=a;else e=null,yr=a;return e}function Ae(){var e,t,r,o,s;return o=yr,s=yr,e=Oe(),null!==e?(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null!==t?(r=Me(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t,n){t=t.join("").toLowerCase(),n=n.join(""),wr.uri_headers||(wr.uri_headers={}),wr.uri_headers[t]?wr.uri_headers[t].push(n):wr.uri_headers[t]=[n]}(o,e[0],e[2])),null===e&&(yr=o),e}function Oe(){var e,t;if(t=De(),null===t&&(t=g(),null===t&&(t=y())),null!==t)for(e=[];null!==t;)e.push(t),t=De(),null===t&&(t=g(),null===t&&(t=y()));else e=null;return e}function Me(){var e,t;for(e=[],t=De(),null===t&&(t=g(),null===t&&(t=y()));null!==t;)e.push(t),t=De(),null===t&&(t=g(),null===t&&(t=y()));return e}function De(){var e;return 91===n.charCodeAt(yr)?(e="[",yr++):(e=null,0===br&&i('"["')),null===e&&(93===n.charCodeAt(yr)?(e="]",yr++):(e=null,0===br&&i('"]"')),null===e&&(47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"')),null===e&&(63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')))))))),e}function xe(){var e;return e=ct(),null===e&&(e=Ne()),e}function Ne(){var e,t,n,r,i,o;return o=yr,e=ut(),null!==e?(t=f(),null!==t?(n=Fe(),null!==n?(r=f(),null!==r?(i=Ze(),null!==i?e=[e,t,n,r,i]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function Fe(){var e;return e=X(),null===e&&(e=Ue()),e}function Ue(){var e,t,r,o;return o=yr,e=Je(),null!==e?(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null!==t?(r=je(),null===r&&(r=Be()),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function je(){var e,t,r,o,s;return o=yr,e=Le(),null===e&&(e=He()),null!==e?(s=yr,63===n.charCodeAt(yr)?(t="?",yr++):(t=null,0===br&&i('"?"')),null!==t?(r=Ye(),null!==r?t=[t,r]:(t=null,yr=s)):(t=null,yr=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),e}function Le(){var e,t,r,o;return o=yr,"//"===n.substr(yr,2)?(e="//",yr+=2):(e=null,0===br&&i('"//"')),null!==e?(t=Qe(),null!==t?(r=He(),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function He(){var e,t,r;return r=yr,47===n.charCodeAt(yr)?(e="/",yr++):(e=null,0===br&&i('"/"')),null!==e?(t=We(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e}function Be(){var e,t,n,r;if(r=yr,e=Ge(),null!==e){for(t=[],n=qe();null!==n;)t.push(n),n=qe();null!==t?e=[e,t]:(e=null,yr=r)}else e=null,yr=r;return e}function qe(){var e;return e=v(),null===e&&(e=g(),null===e&&(e=y())),e}function Ge(){var e;return e=g(),null===e&&(e=y(),null===e&&(59===n.charCodeAt(yr)?(e=";",yr++):(e=null,0===br&&i('";"')),null===e&&(63===n.charCodeAt(yr)?(e="?",yr++):(e=null,0===br&&i('"?"')),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(64===n.charCodeAt(yr)?(e="@",yr++):(e=null,0===br&&i('"@"')),null===e&&(38===n.charCodeAt(yr)?(e="&",yr++):(e=null,0===br&&i('"&"')),null===e&&(61===n.charCodeAt(yr)?(e="=",yr++):(e=null,0===br&&i('"="')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')),null===e&&(44===n.charCodeAt(yr)?(e=",",yr++):(e=null,0===br&&i('","')))))))))))),e}function We(){var e,t,r,o,s,a;if(s=yr,e=Ve(),null!==e){for(t=[],a=yr,47===n.charCodeAt(yr)?(r="/",yr++):(r=null,0===br&&i('"/"')),null!==r?(o=Ve(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==r;)t.push(r),a=yr,47===n.charCodeAt(yr)?(r="/",yr++):(r=null,0===br&&i('"/"')),null!==r?(o=Ve(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==t?e=[e,t]:(e=null,yr=s)}else e=null,yr=s;return e}function Ve(){var e,t,r,o,s,a;for(s=yr,e=[],t=Ke();null!==t;)e.push(t),t=Ke();if(null!==e){for(t=[],a=yr,59===n.charCodeAt(yr)?(r=";",yr++):(r=null,0===br&&i('";"')),null!==r?(o=ze(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==r;)t.push(r),a=yr,59===n.charCodeAt(yr)?(r=";",yr++):(r=null,0===br&&i('";"')),null!==r?(o=ze(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==t?e=[e,t]:(e=null,yr=s)}else e=null,yr=s;return e}function ze(){var e,t;for(e=[],t=Ke();null!==t;)e.push(t),t=Ke();return e}function Ke(){var e;return e=g(),null===e&&(e=y(),null===e&&(58===n.charCodeAt(yr)?(e=":",yr++):(e=null,0===br&&i('":"')),null===e&&(64===n.charCodeAt(yr)?(e="@",yr++):(e=null,0===br&&i('"@"')),null===e&&(38===n.charCodeAt(yr)?(e="&",yr++):(e=null,0===br&&i('"&"')),null===e&&(61===n.charCodeAt(yr)?(e="=",yr++):(e=null,0===br&&i('"="')),null===e&&(43===n.charCodeAt(yr)?(e="+",yr++):(e=null,0===br&&i('"+"')),null===e&&(36===n.charCodeAt(yr)?(e="$",yr++):(e=null,0===br&&i('"$"')),null===e&&(44===n.charCodeAt(yr)?(e=",",yr++):(e=null,0===br&&i('","')))))))))),e}function Je(){var e,t,r,o,l;if(o=yr,l=yr,e=a(),null!==e){for(t=[],r=a(),null===r&&(r=s(),null===r&&(43===n.charCodeAt(yr)?(r="+",yr++):(r=null,0===br&&i('"+"')),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."'))))));null!==r;)t.push(r),r=a(),null===r&&(r=s(),null===r&&(43===n.charCodeAt(yr)?(r="+",yr++):(r=null,0===br&&i('"+"')),null===r&&(45===n.charCodeAt(yr)?(r="-",yr++):(r=null,0===br&&i('"-"')),null===r&&(46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."'))))));null!==t?e=[e,t]:(e=null,yr=l)}else e=null,yr=l;return null!==e&&(e=function(e){wr.scheme=n.substring(yr,e)}(o)),null===e&&(yr=o),e}function Qe(){var e;return e=Xe(),null===e&&(e=$e()),e}function Xe(){var e,t,r,o;return r=yr,o=yr,e=ee(),null!==e?(64===n.charCodeAt(yr)?(t="@",yr++):(t=null,0===br&&i('"@"')),null!==t?e=[e,t]:(e=null,yr=o)):(e=null,yr=o),e=null!==e?e:"",null!==e?(t=ie(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e=null!==e?e:""}function $e(){var e,t;if(t=g(),null===t&&(t=y(),null===t&&(36===n.charCodeAt(yr)?(t="$",yr++):(t=null,0===br&&i('"$"')),null===t&&(44===n.charCodeAt(yr)?(t=",",yr++):(t=null,0===br&&i('","')),null===t&&(59===n.charCodeAt(yr)?(t=";",yr++):(t=null,0===br&&i('";"')),null===t&&(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null===t&&(64===n.charCodeAt(yr)?(t="@",yr++):(t=null,0===br&&i('"@"')),null===t&&(38===n.charCodeAt(yr)?(t="&",yr++):(t=null,0===br&&i('"&"')),null===t&&(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=g(),null===t&&(t=y(),null===t&&(36===n.charCodeAt(yr)?(t="$",yr++):(t=null,0===br&&i('"$"')),null===t&&(44===n.charCodeAt(yr)?(t=",",yr++):(t=null,0===br&&i('","')),null===t&&(59===n.charCodeAt(yr)?(t=";",yr++):(t=null,0===br&&i('";"')),null===t&&(58===n.charCodeAt(yr)?(t=":",yr++):(t=null,0===br&&i('":"')),null===t&&(64===n.charCodeAt(yr)?(t="@",yr++):(t=null,0===br&&i('"@"')),null===t&&(38===n.charCodeAt(yr)?(t="&",yr++):(t=null,0===br&&i('"&"')),null===t&&(61===n.charCodeAt(yr)?(t="=",yr++):(t=null,0===br&&i('"="')),null===t&&(43===n.charCodeAt(yr)?(t="+",yr++):(t=null,0===br&&i('"+"')))))))))));else e=null;return e}function Ye(){var e,t;for(e=[],t=qe();null!==t;)e.push(t),t=qe();return e}function Ze(){var e,t,r,o,a,l,u,c;if(u=yr,c=yr,"sip"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"SIP"')),null!==e)if(47===n.charCodeAt(yr)?(t="/",yr++):(t=null,0===br&&i('"/"')),null!==t){if(o=s(),null!==o)for(r=[];null!==o;)r.push(o),o=s();else r=null;if(null!==r)if(46===n.charCodeAt(yr)?(o=".",yr++):(o=null,0===br&&i('"."')),null!==o){if(l=s(),null!==l)for(a=[];null!==l;)a.push(l),l=s();else a=null;null!==a?e=[e,t,r,o,a]:(e=null,yr=c)}else e=null,yr=c;else e=null,yr=c}else e=null,yr=c;else e=null,yr=c;return null!==e&&(e=function(e){wr.sip_version=n.substring(yr,e)}(u)),null===e&&(yr=u),e}function et(){var e;return"INVITE"===n.substr(yr,6)?(e="INVITE",yr+=6):(e=null,0===br&&i('"INVITE"')),e}function tt(){var e;return"ACK"===n.substr(yr,3)?(e="ACK",yr+=3):(e=null,0===br&&i('"ACK"')),e}function nt(){var e;return"OPTIONS"===n.substr(yr,7)?(e="OPTIONS",yr+=7):(e=null,0===br&&i('"OPTIONS"')),e}function rt(){var e;return"BYE"===n.substr(yr,3)?(e="BYE",yr+=3):(e=null,0===br&&i('"BYE"')),e}function it(){var e;return"CANCEL"===n.substr(yr,6)?(e="CANCEL",yr+=6):(e=null,0===br&&i('"CANCEL"')),e}function ot(){var e;return"REGISTER"===n.substr(yr,8)?(e="REGISTER",yr+=8):(e=null,0===br&&i('"REGISTER"')),e}function st(){var e;return"SUBSCRIBE"===n.substr(yr,9)?(e="SUBSCRIBE",yr+=9):(e=null,0===br&&i('"SUBSCRIBE"')),e}function at(){var e;return"NOTIFY"===n.substr(yr,6)?(e="NOTIFY",yr+=6):(e=null,0===br&&i('"NOTIFY"')),e}function lt(){var e;return"REFER"===n.substr(yr,5)?(e="REFER",yr+=5):(e=null,0===br&&i('"REFER"')),e}function ut(){var e,t;return t=yr,e=et(),null===e&&(e=tt(),null===e&&(e=nt(),null===e&&(e=rt(),null===e&&(e=it(),null===e&&(e=ot(),null===e&&(e=st(),null===e&&(e=at(),null===e&&(e=lt(),null===e&&(e=R()))))))))),null!==e&&(e=function(e){return wr.method=n.substring(yr,e),wr.method}(t)),null===e&&(yr=t),e}function ct(){var e,t,n,r,i,o;return o=yr,e=Ze(),null!==e?(t=f(),null!==t?(n=dt(),null!==n?(r=f(),null!==r?(i=ht(),null!==i?e=[e,t,n,r,i]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function dt(){var e,t;return t=yr,e=ft(),null!==e&&(e=function(e,t){wr.status_code=parseInt(t.join(""))}(t,e)),null===e&&(yr=t),e}function ft(){var e,t,n,r;return r=yr,e=s(),null!==e?(t=s(),null!==t?(n=s(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function ht(){var e,t,r;for(r=yr,e=[],t=v(),null===t&&(t=g(),null===t&&(t=y(),null===t&&(t=w(),null===t&&(t=E(),null===t&&(t=f(),null===t&&(t=h()))))));null!==t;)e.push(t),t=v(),null===t&&(t=g(),null===t&&(t=y(),null===t&&(t=w(),null===t&&(t=E(),null===t&&(t=f(),null===t&&(t=h()))))));return null!==e&&(e=function(e){wr.reason_phrase=n.substring(yr,e)}(r)),null===e&&(yr=r),e}function pt(){var e,t,n,r,i,o;if(i=yr,e=Kt(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=Kt(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=Kt(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function vt(){var e,t,r,o,s,a;return o=yr,s=yr,e=A(),null!==e?(a=yr,64===n.charCodeAt(yr)?(t="@",yr++):(t=null,0===br&&i('"@"')),null!==t?(r=A(),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){wr=n.substring(yr,e)}(o)),null===e&&(yr=o),e}function gt(){var e,t,n,r,i,o,s;if(i=yr,e=O(),null===e)if(o=yr,e=mt(),null!==e){for(t=[],s=yr,n=j(),null!==n?(r=mt(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=j(),null!==n?(r=mt(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t,n;for(n=wr.multi_header.length,t=0;t<n;t++)if(null===wr.multi_header[t].parsed){wr=null;break}wr=null!==wr?wr.multi_header:-1}(i)),null===e&&(yr=i),e}function mt(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=Q(),null===e&&(e=yt()),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=_t(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t;wr.multi_header||(wr.multi_header=[]);try{t=new Cr(wr.uri,wr.display_name,wr.params),delete wr.uri,delete wr.display_name,delete wr.params}catch(n){t=null}wr.multi_header.push({possition:yr,offset:e,parsed:t})}(i)),null===e&&(yr=i),e}function yt(){var e,t,n,r,i;return i=yr,e=bt(),e=null!==e?e:"",null!==e?(t=U(),null!==t?(n=X(),null!==n?(r=F(),null!==r?e=[e,t,n,r]:(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i),e}function bt(){var e,t,r,i,o,s,a;if(o=yr,s=yr,e=R(),null!==e){for(t=[],a=yr,r=b(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,yr=a)):(r=null,yr=a);null!==r;)t.push(r),a=yr,r=b(),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,yr=a)):(r=null,yr=a);null!==t?e=[e,t]:(e=null,yr=s)}else e=null,yr=s;return null===e&&(e=V()),null!==e&&(e=function(e,t){t=n.substring(yr,e).trim(),'"'===t[0]&&(t=t.substring(1,t.length-1)),wr.display_name=t}(o,e)),null===e&&(yr=o),e}function _t(){var e;return e=St(),null===e&&(e=Tt(),null===e&&(e=Et())),e}function St(){var e,t,r,o,s;return o=yr,s=yr,"q"===n.substr(yr,1).toLowerCase()?(e=n.substr(yr,1),yr++):(e=null,0===br&&i('"q"')),null!==e?(t=D(),null!==t?(r=wt(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.params||(wr.params={}),wr.params.q=t}(o,e[2])),null===e&&(yr=o),e}function Tt(){var e,t,r,o,s;return o=yr,s=yr,"expires"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"expires"')),null!==e?(t=D(),null!==t?(r=Ct(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.params||(wr.params={}),wr.params.expires=t}(o,e[2])),null===e&&(yr=o),e}function Ct(){var e,t,n;if(n=yr,t=s(),null!==t)for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){return parseInt(t.join(""))}(n,e)),null===e&&(yr=n),e}function wt(){var e,t,r,o,a,l,u,c;return l=yr,u=yr,48===n.charCodeAt(yr)?(e="0",yr++):(e=null,0===br&&i('"0"')),null!==e?(c=yr,46===n.charCodeAt(yr)?(t=".",yr++):(t=null,0===br&&i('"."')),null!==t?(r=s(),r=null!==r?r:"",null!==r?(o=s(),o=null!==o?o:"",null!==o?(a=s(),a=null!==a?a:"",null!==a?t=[t,r,o,a]:(t=null,yr=c)):(t=null,yr=c)):(t=null,yr=c)):(t=null,yr=c),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=u)):(e=null,yr=u),null!==e&&(e=function(e){return parseFloat(n.substring(yr,e))}(l)),null===e&&(yr=l),e}function Et(){var e,t,n,r,i,o;return r=yr,i=yr,e=R(),null!==e?(o=yr,t=D(),null!==t?(n=kt(),null!==n?t=[t,n]:(t=null,yr=o)):(t=null,yr=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=i)):(e=null,yr=i),null!==e&&(e=function(e,t,n){wr.params||(wr.params={}),n="undefined"==typeof n?void 0:n[1],wr.params[t.toLowerCase()]=n}(r,e[0],e[1])),null===e&&(yr=r),e}function kt(){var e;return e=R(),null===e&&(e=oe(),null===e&&(e=V())),e}function Rt(){var e,t,n,r,i,o;if(i=yr,e=It(),null!==e){for(t=[],o=yr,n=L(),null!==n?(r=Pt(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=L(),null!==n?(r=Pt(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function It(){var e;return"render"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"render"')),null===e&&("session"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"session"')),null===e&&("icon"===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"icon"')),null===e&&("alert"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"alert"')),null===e&&(e=R())))),e}function Pt(){var e;return e=At(),null===e&&(e=Et()),e}function At(){var e,t,r,o;return o=yr,"handling"===n.substr(yr,8).toLowerCase()?(e=n.substr(yr,8),yr+=8):(e=null,0===br&&i('"handling"')),null!==e?(t=D(),null!==t?("optional"===n.substr(yr,8).toLowerCase()?(r=n.substr(yr,8),yr+=8):(r=null,0===br&&i('"optional"')),null===r&&("required"===n.substr(yr,8).toLowerCase()?(r=n.substr(yr,8),yr+=8):(r=null,0===br&&i('"required"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function Ot(){var e,t,n,r,i,o;if(i=yr,e=R(),
null!==e){for(t=[],o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function Mt(){var e,t,n;if(n=yr,t=s(),null!==t)for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){wr=parseInt(t.join(""))}(n,e)),null===e&&(yr=n),e}function Dt(){var e,t;return t=yr,e=xt(),null!==e&&(e=function(e){wr=n.substring(yr,e)}(t)),null===e&&(yr=t),e}function xt(){var e,t,n,r,i,o,s,a;if(s=yr,e=Nt(),null!==e)if(t=M(),null!==t)if(n=Ht(),null!==n){for(r=[],a=yr,i=L(),null!==i?(o=Bt(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==i;)r.push(i),a=yr,i=L(),null!==i?(o=Bt(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==r?e=[e,t,n,r]:(e=null,yr=s)}else e=null,yr=s;else e=null,yr=s;else e=null,yr=s;return e}function Nt(){var e;return e=Ft(),null===e&&(e=Ut()),e}function Ft(){var e;return"text"===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"text"')),null===e&&("image"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"image"')),null===e&&("audio"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"audio"')),null===e&&("video"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"video"')),null===e&&("application"===n.substr(yr,11).toLowerCase()?(e=n.substr(yr,11),yr+=11):(e=null,0===br&&i('"application"')),null===e&&(e=jt()))))),e}function Ut(){var e;return"message"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"message"')),null===e&&("multipart"===n.substr(yr,9).toLowerCase()?(e=n.substr(yr,9),yr+=9):(e=null,0===br&&i('"multipart"')),null===e&&(e=jt())),e}function jt(){var e;return e=R(),null===e&&(e=Lt()),e}function Lt(){var e,t,r;return r=yr,"x-"===n.substr(yr,2).toLowerCase()?(e=n.substr(yr,2),yr+=2):(e=null,0===br&&i('"x-"')),null!==e?(t=R(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e}function Ht(){var e;return e=jt(),null===e&&(e=R()),e}function Bt(){var e,t,n,r;return r=yr,e=R(),null!==e?(t=D(),null!==t?(n=qt(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function qt(){var e;return e=R(),null===e&&(e=V()),e}function Gt(){var e,t,n,r;return r=yr,e=Wt(),null!==e?(t=b(),null!==t?(n=ut(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function Wt(){var e,t,n;if(n=yr,t=s(),null!==t)for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){wr.value=parseInt(t.join(""))}(n,e)),null===e&&(yr=n),e}function Vt(){var e,t;return t=yr,e=Ct(),null!==e&&(e=function(e,t){wr=t}(t,e)),null===e&&(yr=t),e}function zt(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=Kt(),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e,t){wr.event=t.join("").toLowerCase()}(i,e[0])),null===e&&(yr=i),e}function Kt(){var e,t,r,o,s,a;if(s=yr,e=I(),null!==e){for(t=[],a=yr,46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."')),null!==r?(o=I(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==r;)t.push(r),a=yr,46===n.charCodeAt(yr)?(r=".",yr++):(r=null,0===br&&i('"."')),null!==r?(o=I(),null!==o?r=[r,o]:(r=null,yr=a)):(r=null,yr=a);null!==t?e=[e,t]:(e=null,yr=s)}else e=null,yr=s;return e}function Jt(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=Q(),null===e&&(e=yt()),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=Qt(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=Qt(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t=wr.tag;try{wr=new Cr(wr.uri,wr.display_name,wr.params),t&&wr.setParam("tag",t)}catch(n){wr=-1}}(i)),null===e&&(yr=i),e}function Qt(){var e;return e=Xt(),null===e&&(e=Et()),e}function Xt(){var e,t,r,o,s;return o=yr,s=yr,"tag"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.tag=t}(o,e[2])),null===e&&(yr=o),e}function $t(){var e,t,n;if(n=yr,t=s(),null!==t)for(e=[];null!==t;)e.push(t),t=s();else e=null;return null!==e&&(e=function(e,t){wr=parseInt(t.join(""))}(n,e)),null===e&&(yr=n),e}function Yt(){var e,t;return t=yr,e=Ct(),null!==e&&(e=function(e,t){wr=t}(t,e)),null===e&&(yr=t),e}function Zt(){var e,t,n,r,i,o,s,a,l,u;for(a=yr,l=yr,e=[],t=bt();null!==t;)e.push(t),t=bt();if(null!==e)if(t=U(),null!==t)if(n=X(),null!==n)if(r=F(),null!==r){for(i=[],u=yr,o=L(),null!==o?(s=Et(),null!==s?o=[o,s]:(o=null,yr=u)):(o=null,yr=u);null!==o;)i.push(o),u=yr,o=L(),null!==o?(s=Et(),null!==s?o=[o,s]:(o=null,yr=u)):(o=null,yr=u);null!==i?e=[e,t,n,r,i]:(e=null,yr=l)}else e=null,yr=l;else e=null,yr=l;else e=null,yr=l;else e=null,yr=l;return null!==e&&(e=function(e){try{wr=new Cr(wr.uri,wr.display_name,wr.params)}catch(t){wr=-1}}(a)),null===e&&(yr=a),e}function en(){var e;return e=tn()}function tn(){var e,t,r,o,s,a,l,u;if(l=yr,"digest"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"Digest"')),null!==e)if(t=b(),null!==t)if(r=on(),null!==r){for(o=[],u=yr,s=j(),null!==s?(a=on(),null!==a?s=[s,a]:(s=null,yr=u)):(s=null,yr=u);null!==s;)o.push(s),u=yr,s=j(),null!==s?(a=on(),null!==a?s=[s,a]:(s=null,yr=u)):(s=null,yr=u);null!==o?e=[e,t,r,o]:(e=null,yr=l)}else e=null,yr=l;else e=null,yr=l;else e=null,yr=l;return null===e&&(e=nn()),e}function nn(){var e,t,n,r,i,o,s,a;if(s=yr,e=R(),null!==e)if(t=b(),null!==t)if(n=rn(),null!==n){for(r=[],a=yr,i=j(),null!==i?(o=rn(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==i;)r.push(i),a=yr,i=j(),null!==i?(o=rn(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==r?e=[e,t,n,r]:(e=null,yr=s)}else e=null,yr=s;else e=null,yr=s;else e=null,yr=s;return e}function rn(){var e,t,n,r;return r=yr,e=R(),null!==e?(t=D(),null!==t?(n=R(),null===n&&(n=V()),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function on(){var e;return e=sn(),null===e&&(e=ln(),null===e&&(e=cn(),null===e&&(e=fn(),null===e&&(e=hn(),null===e&&(e=pn(),null===e&&(e=vn(),null===e&&(e=rn()))))))),e}function sn(){var e,t,r,o;return o=yr,"realm"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"realm"')),null!==e?(t=D(),null!==t?(r=an(),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function an(){var e,t;return t=yr,e=z(),null!==e&&(e=function(e,t){wr.realm=t}(t,e)),null===e&&(yr=t),e}function ln(){var e,t,r,o,s,a,l,u,c;if(u=yr,"domain"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"domain"')),null!==e)if(t=D(),null!==t)if(r=B(),null!==r)if(o=un(),null!==o){if(s=[],c=yr,l=f(),null!==l)for(a=[];null!==l;)a.push(l),l=f();else a=null;for(null!==a?(l=un(),null!==l?a=[a,l]:(a=null,yr=c)):(a=null,yr=c);null!==a;){if(s.push(a),c=yr,l=f(),null!==l)for(a=[];null!==l;)a.push(l),l=f();else a=null;null!==a?(l=un(),null!==l?a=[a,l]:(a=null,yr=c)):(a=null,yr=c)}null!==s?(a=q(),null!==a?e=[e,t,r,o,s,a]:(e=null,yr=u)):(e=null,yr=u)}else e=null,yr=u;else e=null,yr=u;else e=null,yr=u;else e=null,yr=u;return e}function un(){var e;return e=Ue(),null===e&&(e=He()),e}function cn(){var e,t,r,o;return o=yr,"nonce"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"nonce"')),null!==e?(t=D(),null!==t?(r=dn(),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function dn(){var e,t;return t=yr,e=z(),null!==e&&(e=function(e,t){wr.nonce=t}(t,e)),null===e&&(yr=t),e}function fn(){var e,t,r,o,s;return o=yr,s=yr,"opaque"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"opaque"')),null!==e?(t=D(),null!==t?(r=z(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.opaque=t}(o,e[2])),null===e&&(yr=o),e}function hn(){var e,t,r,o,s;return o=yr,"stale"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"stale"')),null!==e?(t=D(),null!==t?(s=yr,"true"===n.substr(yr,4).toLowerCase()?(r=n.substr(yr,4),yr+=4):(r=null,0===br&&i('"true"')),null!==r&&(r=function(e){wr.stale=!0}(s)),null===r&&(yr=s),null===r&&(s=yr,"false"===n.substr(yr,5).toLowerCase()?(r=n.substr(yr,5),yr+=5):(r=null,0===br&&i('"false"')),null!==r&&(r=function(e){wr.stale=!1}(s)),null===r&&(yr=s)),null!==r?e=[e,t,r]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function pn(){var e,t,r,o,s;return o=yr,s=yr,"algorithm"===n.substr(yr,9).toLowerCase()?(e=n.substr(yr,9),yr+=9):(e=null,0===br&&i('"algorithm"')),null!==e?(t=D(),null!==t?("md5"===n.substr(yr,3).toLowerCase()?(r=n.substr(yr,3),yr+=3):(r=null,0===br&&i('"MD5"')),null===r&&("md5-sess"===n.substr(yr,8).toLowerCase()?(r=n.substr(yr,8),yr+=8):(r=null,0===br&&i('"MD5-sess"')),null===r&&(r=R())),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.algorithm=t.toUpperCase()}(o,e[2])),null===e&&(yr=o),e}function vn(){var e,t,r,o,s,a,l,u,c,d;if(u=yr,"qop"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"qop"')),null!==e)if(t=D(),null!==t)if(r=B(),null!==r){if(c=yr,o=gn(),null!==o){for(s=[],d=yr,44===n.charCodeAt(yr)?(a=",",yr++):(a=null,0===br&&i('","')),null!==a?(l=gn(),null!==l?a=[a,l]:(a=null,yr=d)):(a=null,yr=d);null!==a;)s.push(a),d=yr,44===n.charCodeAt(yr)?(a=",",yr++):(a=null,0===br&&i('","')),null!==a?(l=gn(),null!==l?a=[a,l]:(a=null,yr=d)):(a=null,yr=d);null!==s?o=[o,s]:(o=null,yr=c)}else o=null,yr=c;null!==o?(s=q(),null!==s?e=[e,t,r,o,s]:(e=null,yr=u)):(e=null,yr=u)}else e=null,yr=u;else e=null,yr=u;else e=null,yr=u;return e}function gn(){var e,t;return t=yr,"auth-int"===n.substr(yr,8).toLowerCase()?(e=n.substr(yr,8),yr+=8):(e=null,0===br&&i('"auth-int"')),null===e&&("auth"===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"auth"')),null===e&&(e=R())),null!==e&&(e=function(e,t){wr.qop||(wr.qop=[]),wr.qop.push(t.toLowerCase())}(t,e)),null===e&&(yr=t),e}function mn(){var e,t,n,r,i,o;if(i=yr,e=R(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function yn(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=bn(),null!==e){for(t=[],s=yr,n=j(),null!==n?(r=bn(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=j(),null!==n?(r=bn(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t,n;for(n=wr.multi_header.length,t=0;t<n;t++)if(null===wr.multi_header[t].parsed){wr=null;break}wr=null!==wr?wr.multi_header:-1}(i)),null===e&&(yr=i),e}function bn(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=yt(),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t;wr.multi_header||(wr.multi_header=[]);try{t=new Cr(wr.uri,wr.display_name,wr.params),delete wr.uri,delete wr.display_name,delete wr.params}catch(n){t=null}wr.multi_header.push({possition:yr,offset:e,parsed:t})}(i)),null===e&&(yr=i),e}function _n(){var e,t,r,o,s,a,l;if(s=yr,a=yr,"sip"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"SIP"')),null===e&&(e=R()),null!==e){for(t=[],l=yr,r=L(),null!==r?(o=Sn(),null!==o?r=[r,o]:(r=null,yr=l)):(r=null,yr=l);null!==r;)t.push(r),l=yr,r=L(),null!==r?(o=Sn(),null!==o?r=[r,o]:(r=null,yr=l)):(r=null,yr=l);null!==t?e=[e,t]:(e=null,yr=a)}else e=null,yr=a;return null!==e&&(e=function(e,t){if(wr.protocol=t.toLowerCase(),wr.params||(wr.params={}),wr.params.text&&'"'===wr.params.text[0]){var n=wr.params.text;wr.text=n.substring(1,n.length-1),delete wr.params.text}}(s,e[0])),null===e&&(yr=s),e}function Sn(){var e;return e=Tn(),null===e&&(e=Et()),e}function Tn(){var e,t,r,o,a,l;if(a=yr,l=yr,"cause"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"cause"')),null!==e)if(t=D(),null!==t){if(o=s(),null!==o)for(r=[];null!==o;)r.push(o),o=s();else r=null;null!==r?e=[e,t,r]:(e=null,yr=l)}else e=null,yr=l;else e=null,yr=l;return null!==e&&(e=function(e,t){wr.cause=parseInt(t.join(""))}(a,e[2])),null===e&&(yr=a),e}function Cn(){var e,t,n,r,i,o;if(i=yr,e=R(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function wn(){var e,t,n,r,i,o;if(i=yr,e=En(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=En(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=En(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function En(){var e,t,n,r,i,o;if(i=yr,e=yt(),null!==e){for(t=[],o=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function kn(){var e,t,n,r,i,o;if(i=yr,e=Rn(),null!==e){for(t=[],o=yr,n=L(),null!==n?(r=In(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=L(),null!==n?(r=In(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function Rn(){var e,t;return t=yr,"active"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"active"')),null===e&&("pending"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"pending"')),null===e&&("terminated"===n.substr(yr,10).toLowerCase()?(e=n.substr(yr,10),yr+=10):(e=null,0===br&&i('"terminated"')),null===e&&(e=R()))),null!==e&&(e=function(e){wr.state=n.substring(yr,e)}(t)),null===e&&(yr=t),e}function In(){var e,t,r,o,s;return o=yr,s=yr,"reason"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"reason"')),null!==e?(t=D(),null!==t?(r=Pn(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(wr.reason=t)}(o,e[2])),null===e&&(yr=o),null===e&&(o=yr,s=yr,"expires"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"expires"')),null!==e?(t=D(),null!==t?(r=Ct(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(wr.expires=t)}(o,e[2])),null===e&&(yr=o),null===e&&(o=yr,s=yr,"retry_after"===n.substr(yr,11).toLowerCase()?(e=n.substr(yr,11),yr+=11):(e=null,0===br&&i('"retry_after"')),null!==e?(t=D(),null!==t?(r=Ct(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){"undefined"!=typeof t&&(wr.retry_after=t)}(o,e[2])),null===e&&(yr=o),null===e&&(e=Et()))),e}function Pn(){var e;return"deactivated"===n.substr(yr,11).toLowerCase()?(e=n.substr(yr,11),yr+=11):(e=null,0===br&&i('"deactivated"')),null===e&&("probation"===n.substr(yr,9).toLowerCase()?(e=n.substr(yr,9),yr+=9):(e=null,0===br&&i('"probation"')),null===e&&("rejected"===n.substr(yr,8).toLowerCase()?(e=n.substr(yr,8),yr+=8):(e=null,0===br&&i('"rejected"')),null===e&&("timeout"===n.substr(yr,7).toLowerCase()?(e=n.substr(yr,7),yr+=7):(e=null,0===br&&i('"timeout"')),null===e&&("giveup"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"giveup"')),null===e&&("noresource"===n.substr(yr,10).toLowerCase()?(e=n.substr(yr,10),yr+=10):(e=null,0===br&&i('"noresource"')),null===e&&("invariant"===n.substr(yr,9).toLowerCase()?(e=n.substr(yr,9),yr+=9):(e=null,0===br&&i('"invariant"')),null===e&&(e=R()))))))),e}function An(){var e;return e=T(),e=null!==e?e:""}function On(){var e,t,n,r,i,o;if(i=yr,e=R(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e=null!==e?e:""}function Mn(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=Q(),null===e&&(e=yt()),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){var t=wr.tag;try{wr=new Cr(wr.uri,wr.display_name,wr.params),t&&wr.setParam("tag",t)}catch(n){wr=-1}}(i)),null===e&&(yr=i),e}function Dn(){var e;return e=Xt(),null===e&&(e=Et()),e}function xn(){var e,t,n,r,i,o;if(i=yr,e=Nn(),null!==e){for(t=[],o=yr,n=j(),null!==n?(r=Nn(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=j(),null!==n?(r=Nn(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function Nn(){var e,t,n,r,i,o,s,a;if(s=yr,e=qn(),null!==e)if(t=b(),null!==t)if(n=Vn(),null!==n){for(r=[],a=yr,i=L(),null!==i?(o=Fn(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==i;)r.push(i),a=yr,i=L(),null!==i?(o=Fn(),null!==o?i=[i,o]:(i=null,yr=a)):(i=null,yr=a);null!==r?e=[e,t,n,r]:(e=null,yr=s)}else e=null,yr=s;else e=null,yr=s;else e=null,yr=s;return e}function Fn(){var e;return e=Un(),null===e&&(e=jn(),null===e&&(e=Ln(),null===e&&(e=Hn(),null===e&&(e=Bn(),null===e&&(e=Et()))))),e}function Un(){var e,t,r,o,s;return o=yr,s=yr,"ttl"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"ttl"')),null!==e?(t=D(),null!==t?(r=Jn(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.ttl=t}(o,e[2])),null===e&&(yr=o),e}function jn(){var e,t,r,o,s;return o=yr,s=yr,"maddr"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"maddr"')),null!==e?(t=D(),null!==t?(r=oe(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.maddr=t}(o,e[2])),null===e&&(yr=o),e}function Ln(){var e,t,r,o,s;return o=yr,s=yr,"received"===n.substr(yr,8).toLowerCase()?(e=n.substr(yr,8),yr+=8):(e=null,0===br&&i('"received"')),null!==e?(t=D(),null!==t?(r=he(),null===r&&(r=ce()),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.received=t}(o,e[2])),null===e&&(yr=o),e}function Hn(){var e,t,r,o,s;return o=yr,s=yr,"branch"===n.substr(yr,6).toLowerCase()?(e=n.substr(yr,6),yr+=6):(e=null,0===br&&i('"branch"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.branch=t}(o,e[2])),null===e&&(yr=o),e}function Bn(){var e,t,r,o,a,l,u;if(a=yr,l=yr,"rport"===n.substr(yr,5).toLowerCase()?(e=n.substr(yr,5),yr+=5):(e=null,0===br&&i('"rport"')),null!==e){if(u=yr,t=D(),null!==t){for(r=[],o=s();null!==o;)r.push(o),o=s();null!==r?t=[t,r]:(t=null,yr=u)}else t=null,yr=u;t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=l)}else e=null,yr=l;return null!==e&&(e=function(e){"undefined"!=typeof response_port&&(wr.rport=response_port.join(""))}(a)),null===e&&(yr=a),e}function qn(){var e,t,n,r,i,o;return o=yr,e=Gn(),null!==e?(t=M(),null!==t?(n=R(),null!==n?(r=M(),null!==r?(i=Wn(),null!==i?e=[e,t,n,r,i]:(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o)):(e=null,yr=o),e}function Gn(){var e,t;return t=yr,"sip"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"SIP"')),null===e&&(e=R()),null!==e&&(e=function(e,t){wr.protocol=t}(t,e)),null===e&&(yr=t),e}function Wn(){var e,t;return t=yr,"udp"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"UDP"')),null===e&&("tcp"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"TCP"')),null===e&&("tls"===n.substr(yr,3).toLowerCase()?(e=n.substr(yr,3),yr+=3):(e=null,0===br&&i('"TLS"')),null===e&&("sctp"===n.substr(yr,4).toLowerCase()?(e=n.substr(yr,4),yr+=4):(e=null,0===br&&i('"SCTP"')),null===e&&(e=R())))),null!==e&&(e=function(e,t){wr.transport=t}(t,e)),null===e&&(yr=t),e}function Vn(){var e,t,n,r,i;return r=yr,e=zn(),null!==e?(i=yr,t=H(),null!==t?(n=Kn(),null!==n?t=[t,n]:(t=null,yr=i)):(t=null,yr=i),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e}function zn(){var e,t;return t=yr,e=he(),null===e&&(e=ue(),null===e&&(e=se())),null!==e&&(e=function(e){wr.host=n.substring(yr,e)}(t)),null===e&&(yr=t),e}function Kn(){var e,t,n,r,i,o,a;return o=yr,a=yr,e=s(),e=null!==e?e:"",null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?(r=s(),r=null!==r?r:"",null!==r?(i=s(),i=null!==i?i:"",null!==i?e=[e,t,n,r,i]:(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a)):(e=null,yr=a),null!==e&&(e=function(e,t){wr.port=parseInt(t.join(""))}(o,e)),null===e&&(yr=o),e}function Jn(){var e,t,n,r,i;return r=yr,i=yr,e=s(),null!==e?(t=s(),t=null!==t?t:"",null!==t?(n=s(),n=null!==n?n:"",null!==n?e=[e,t,n]:(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i),null!==e&&(e=function(e,t){return parseInt(t.join(""))}(r,e)),null===e&&(yr=r),e}function Qn(){var e;return e=tn()}function Xn(){var e,t,n,r,i,o;if(i=yr,e=$n(),null!==e){for(t=[],o=yr,n=L(),null!==n?(r=Yn(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=L(),null!==n?(r=Yn(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function $n(){var e,t;return t=yr,e=Ct(),null!==e&&(e=function(e,t){wr.expires=t}(t,e)),null===e&&(yr=t),e}function Yn(){var e;return e=Zn(),null===e&&(e=Et()),e}function Zn(){var e,t,r,o,s;return o=yr,s=yr,"refresher"===n.substr(yr,9).toLowerCase()?(e=n.substr(yr,9),yr+=9):(e=null,0===br&&i('"refresher"')),null!==e?(t=D(),null!==t?("uac"===n.substr(yr,3).toLowerCase()?(r=n.substr(yr,3),yr+=3):(r=null,0===br&&i('"uac"')),null===r&&("uas"===n.substr(yr,3).toLowerCase()?(r=n.substr(yr,3),yr+=3):(r=null,0===br&&i('"uas"'))),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.refresher=t.toLowerCase()}(o,e[2])),null===e&&(yr=o),e}function er(){var e,t,n,r;return r=yr,e=R(),null!==e?(t=S(),null!==t?(n=tr(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function tr(){var e,t;for(e=[],t=C(),null===t&&(t=E(),null===t&&(t=b()));null!==t;)e.push(t),t=C(),null===t&&(t=E(),null===t&&(t=b()));return e}function nr(){var e,t;for(e=[],t=c();null!==t;)e.push(t),t=c();return e}function rr(){var e,t,r;return r=yr,"uuid:"===n.substr(yr,5)?(e="uuid:",yr+=5):(e=null,0===br&&i('"uuid:"')),null!==e?(t=ir(),null!==t?e=[e,t]:(e=null,yr=r)):(e=null,yr=r),e}function ir(){var e,t,r,o,s,a,l,u,c,d,f;return d=yr,f=yr,e=sr(),null!==e?(45===n.charCodeAt(yr)?(t="-",yr++):(t=null,0===br&&i('"-"')),null!==t?(r=or(),null!==r?(45===n.charCodeAt(yr)?(o="-",yr++):(o=null,0===br&&i('"-"')),null!==o?(s=or(),null!==s?(45===n.charCodeAt(yr)?(a="-",yr++):(a=null,0===br&&i('"-"')),null!==a?(l=or(),null!==l?(45===n.charCodeAt(yr)?(u="-",yr++):(u=null,0===br&&i('"-"')),null!==u?(c=ar(),null!==c?e=[e,t,r,o,s,a,l,u,c]:(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f)):(e=null,yr=f),null!==e&&(e=function(e,t){wr=n.substring(yr+5,e)}(d,e[0])),null===e&&(yr=d),e}function or(){var e,t,n,r,i;return i=yr,e=l(),null!==e?(t=l(),null!==t?(n=l(),null!==n?(r=l(),null!==r?e=[e,t,n,r]:(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i)):(e=null,yr=i),e}function sr(){var e,t,n;return n=yr,e=or(),null!==e?(t=or(),null!==t?e=[e,t]:(e=null,yr=n)):(e=null,yr=n),e}function ar(){var e,t,n,r;return r=yr,e=or(),null!==e?(t=or(),null!==t?(n=or(),null!==n?e=[e,t,n]:(e=null,yr=r)):(e=null,yr=r)):(e=null,yr=r),e}function lr(){var e,t,n,r,i,o,s;if(i=yr,o=yr,e=Q(),null===e&&(e=yt()),null!==e){for(t=[],s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==n;)t.push(n),s=yr,n=L(),null!==n?(r=Et(),null!==r?n=[n,r]:(n=null,yr=s)):(n=null,yr=s);null!==t?e=[e,t]:(e=null,yr=o)}else e=null,yr=o;return null!==e&&(e=function(e){try{wr=new Cr(wr.uri,wr.display_name,wr.params)}catch(t){wr=-1}}(i)),null===e&&(yr=i),e}function ur(){var e,t,n,r,i,o;if(i=yr,e=cr(),null!==e){for(t=[],o=yr,n=L(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==n;)t.push(n),o=yr,n=L(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,yr=o)):(n=null,yr=o);null!==t?e=[e,t]:(e=null,yr=i)}else e=null,yr=i;return e}function cr(){var e,t,r,o,s,a;return o=yr,s=yr,e=A(),null!==e?(a=yr,64===n.charCodeAt(yr)?(t="@",yr++):(t=null,0===br&&i('"@"')),null!==t?(r=A(),null!==r?t=[t,r]:(t=null,yr=a)):(t=null,yr=a),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e){wr.call_id=n.substring(yr,e)}(o)),null===e&&(yr=o),e}function dr(){var e;return e=fr(),null===e&&(e=hr(),null===e&&(e=pr(),null===e&&(e=Et()))),e}function fr(){var e,t,r,o,s;return o=yr,s=yr,"to-tag"===n.substr(yr,6)?(e="to-tag",yr+=6):(e=null,0===br&&i('"to-tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.to_tag=t}(o,e[2])),null===e&&(yr=o),e}function hr(){var e,t,r,o,s;return o=yr,s=yr,"from-tag"===n.substr(yr,8)?(e="from-tag",yr+=8):(e=null,0===br&&i('"from-tag"')),null!==e?(t=D(),null!==t?(r=R(),null!==r?e=[e,t,r]:(e=null,yr=s)):(e=null,yr=s)):(e=null,yr=s),null!==e&&(e=function(e,t){wr.from_tag=t}(o,e[2])),null===e&&(yr=o),e}function pr(){var e,t;return t=yr,"early-only"===n.substr(yr,10)?(e="early-only",yr+=10):(e=null,0===br&&i('"early-only"')),null!==e&&(e=function(e){wr.early_only=!0}(t)),null===e&&(yr=t),e}function vr(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}function gr(){for(var e=1,t=1,r=!1,i=0;i<Math.max(yr,_r);i++){var o=n.charAt(i);"\n"===o?(r||e++,t=1,r=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(e++,t=1,r=!0):(t++,r=!1)}return{line:e,column:t}}var mr={CRLF:o,DIGIT:s,ALPHA:a,HEXDIG:l,WSP:u,OCTET:c,DQUOTE:d,SP:f,HTAB:h,alphanum:p,reserved:v,unreserved:g,mark:m,escaped:y,LWS:b,SWS:_,HCOLON:S,TEXT_UTF8_TRIM:T,TEXT_UTF8char:C,UTF8_NONASCII:w,UTF8_CONT:E,LHEX:k,token:R,token_nodot:I,separators:P,word:A,STAR:O,SLASH:M,EQUAL:D,LPAREN:x,RPAREN:N,RAQUOT:F,LAQUOT:U,COMMA:j,SEMI:L,COLON:H,LDQUOT:B,RDQUOT:q,comment:G,ctext:W,quoted_string:V,quoted_string_clean:z,qdtext:K,quoted_pair:J,SIP_URI_noparams:Q,SIP_URI:X,uri_scheme:$,uri_scheme_sips:Y,uri_scheme_sip:Z,userinfo:ee,user:te,user_unreserved:ne,password:re,hostport:ie,host:oe,hostname:se,domainlabel:ae,toplabel:le,IPv6reference:ue,IPv6address:ce,h16:de,ls32:fe,IPv4address:he,dec_octet:pe,port:ve,uri_parameters:ge,uri_parameter:me,transport_param:ye,user_param:be,method_param:_e,ttl_param:Se,maddr_param:Te,lr_param:Ce,other_param:we,pname:Ee,pvalue:ke,paramchar:Re,param_unreserved:Ie,headers:Pe,header:Ae,hname:Oe,hvalue:Me,hnv_unreserved:De,Request_Response:xe,Request_Line:Ne,Request_URI:Fe,absoluteURI:Ue,hier_part:je,net_path:Le,abs_path:He,opaque_part:Be,uric:qe,uric_no_slash:Ge,path_segments:We,segment:Ve,param:ze,pchar:Ke,scheme:Je,authority:Qe,srvr:Xe,reg_name:$e,query:Ye,SIP_Version:Ze,INVITEm:et,ACKm:tt,OPTIONSm:nt,BYEm:rt,CANCELm:it,REGISTERm:ot,SUBSCRIBEm:st,NOTIFYm:at,REFERm:lt,Method:ut,Status_Line:ct,Status_Code:dt,extension_code:ft,Reason_Phrase:ht,Allow_Events:pt,Call_ID:vt,Contact:gt,contact_param:mt,name_addr:yt,display_name:bt,contact_params:_t,c_p_q:St,c_p_expires:Tt,delta_seconds:Ct,qvalue:wt,generic_param:Et,gen_value:kt,Content_Disposition:Rt,disp_type:It,disp_param:Pt,handling_param:At,Content_Encoding:Ot,Content_Length:Mt,Content_Type:Dt,media_type:xt,m_type:Nt,discrete_type:Ft,composite_type:Ut,extension_token:jt,x_token:Lt,m_subtype:Ht,m_parameter:Bt,m_value:qt,CSeq:Gt,CSeq_value:Wt,Expires:Vt,Event:zt,event_type:Kt,From:Jt,from_param:Qt,tag_param:Xt,Max_Forwards:$t,Min_Expires:Yt,Name_Addr_Header:Zt,Proxy_Authenticate:en,challenge:tn,other_challenge:nn,auth_param:rn,digest_cln:on,realm:sn,realm_value:an,domain:ln,URI:un,nonce:cn,nonce_value:dn,opaque:fn,stale:hn,algorithm:pn,qop_options:vn,qop_value:gn,Proxy_Require:mn,Record_Route:yn,rec_route:bn,Reason:_n,reason_param:Sn,reason_cause:Tn,Require:Cn,Route:wn,route_param:En,Subscription_State:kn,substate_value:Rn,subexp_params:In,event_reason_value:Pn,Subject:An,Supported:On,To:Mn,to_param:Dn,Via:xn,via_param:Nn,via_params:Fn,via_ttl:Un,via_maddr:jn,via_received:Ln,via_branch:Hn,response_port:Bn,sent_protocol:qn,protocol_name:Gn,transport:Wn,sent_by:Vn,via_host:zn,via_port:Kn,ttl:Jn,WWW_Authenticate:Qn,Session_Expires:Xn,s_e_expires:$n,s_e_params:Yn,s_e_refresher:Zn,extension_header:er,header_value:tr,message_body:nr,uuid_URI:rr,uuid:ir,hex4:or,hex8:sr,hex12:ar,Refer_To:lr,Replaces:ur,call_id:cr,replaces_param:dr,to_tag:fr,from_tag:hr,early_flag:pr};if(void 0!==r){if(void 0===mr[r])throw new Error("Invalid rule name: "+t(r)+".")}else r="CRLF";var yr=0,br=0,_r=0,Sr=[],Tr=e("./URI"),Cr=e("./NameAddrHeader"),wr={},Er=mr[r]();if(null===Er||yr!==n.length){var kr=Math.max(yr,_r),Rr=kr<n.length?n.charAt(kr):null,Ir=gr();return new this.SyntaxError(vr(Sr),Rr,kr,Ir.line,Ir.column),-1}return wr},toSource:function(){return this._source}};return n.SyntaxError=function(e,n,r,i,o){function s(e,n){var r,i;switch(e.length){case 0:r="end of input";break;case 1:r=e[0];break;default:r=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}return i=n?t(n):"end of input","Expected "+r+" but "+i+" found."}this.name="SyntaxError",this.expected=e,this.found=n,this.message=s(e,n),this.offset=r,this.line=i,this.column=o},n.SyntaxError.prototype=Error.prototype,n}()},{"./NameAddrHeader":43,"./URI":58}],41:[function(e,t,n){var r=e("debug")("PlivoSIP"),i=e("webrtc-adapter"),o=e("../package.json");r("version %s",o.version);var s=e("./Constants"),a=e("./Exceptions"),l=e("./Utils"),u=e("./UA"),c=e("./URI"),d=e("./NameAddrHeader"),f=e("./Grammar"),h=e("./WebSocketInterface"),p=t.exports={C:s,Exceptions:a,Utils:l,UA:u,URI:c,NameAddrHeader:d,WebSocketInterface:h,Grammar:f,debug:e("debug"),adapter:i};Object.defineProperties(p,{name:{get:function(){return o.title}},version:{get:function(){return o.version}}})},{"../package.json":34,"./Constants":35,"./Exceptions":39,"./Grammar":40,"./NameAddrHeader":43,"./UA":57,"./URI":58,"./Utils":59,"./WebSocketInterface":60,debug:12,"webrtc-adapter":24}],42:[function(e,t,n){function r(e){this.ua=e,this.data={},o.EventEmitter.call(this)}t.exports=r;var i=e("util"),o=e("events"),s=e("./Constants"),a=e("./SIPMessage"),l=e("./Utils"),u=e("./RequestSender"),c=e("./Transactions"),d=e("./Exceptions");i.inherits(r,o.EventEmitter),r.prototype.send=function(e,t,n){var r,i,o,l,c,d=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+d);n=n||{},c=n.extraHeaders&&n.extraHeaders.slice()||[],l=n.eventHandlers||{},o=n.contentType||"text/plain",this.content_type=o;for(i in l)this.on(i,l[i]);this.closed=!1,this.ua.applicants[this]=this,c.push("Content-Type: "+o),this.request=new a.OutgoingRequest(s.MESSAGE,e,this.ua,null,c),t?(this.request.body=t,this.content=t):this.content=null,r=new u(this,this.ua),this.newMessage("local",this.request),r.send()},r.prototype.receiveResponse=function(e){var t;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:e});break;default:delete this.ua.applicants[this],t=l.sipErrorCause(e.status_code),this.emit("failed",{originator:"remote",response:e,cause:t})}},r.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:s.causes.REQUEST_TIMEOUT})},r.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:s.causes.CONNECTION_ERROR})},r.prototype.close=function(){this.closed=!0,
delete this.ua.applicants[this]},r.prototype.init_incoming=function(e){var t;this.request=e,this.content_type=e.getHeader("Content-Type"),e.body?this.content=e.body:this.content=null,this.newMessage("remote",e),t=this.ua.transactions.nist[e.via_branch],!t||t.state!==c.C.STATUS_TRYING&&t.state!==c.C.STATUS_PROCEEDING||e.reply(200)},r.prototype.accept=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,t,n)},r.prototype.reject=function(e){e=e||{};var t=e.status_code||480,n=e.reason_phrase,r=e.extraHeaders&&e.extraHeaders.slice()||[],i=e.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"reject" not supported for outgoing Message');if(t<300||t>=700)throw new TypeError("Invalid status_code: "+t);this.request.reply(t,n,r,i)},r.prototype.newMessage=function(e,t){"remote"===e?(this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from):"local"===e&&(this.direction="outgoing",this.local_identity=t.from,this.remote_identity=t.to),this.ua.newMessage({originator:e,message:this,request:t})}},{"./Constants":35,"./Exceptions":39,"./RequestSender":51,"./SIPMessage":52,"./Transactions":55,"./Utils":59,events:11,util:23}],43:[function(e,t,n){function r(e,t,n){var r;if(!(e&&e instanceof i))throw new TypeError('missing or invalid "uri" parameter');this.uri=e,this.parameters={};for(r in n)this.setParam(r,n[r]);Object.defineProperties(this,{display_name:{get:function(){return t},set:function(e){t=0===e?"0":e}}})}t.exports=r;var i=e("./URI"),o=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},clone:function(){return new r(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},r.parse=function(e){return e=o.parse(e,"Name_Addr_Header"),e!==-1?e:void 0}},{"./Grammar":40,"./URI":58}],44:[function(e,t,n){function r(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(i=e.indexOf("\r\n",n),i===-1)return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function i(e,t,n,r){var i,o,s,u,c=t.indexOf(":",n),d=t.substring(n,c).trim(),f=t.substring(c+1,r).trim();switch(d.toLowerCase()){case"via":case"v":e.addHeader("via",f),1===e.getHeaders("via").length?(u=e.parseHeader("Via"),u&&(e.via=u,e.via_branch=u.branch)):u=0;break;case"from":case"f":e.setHeader("from",f),u=e.parseHeader("from"),u&&(e.from=u,e.from_tag=u.getParam("tag"));break;case"to":case"t":e.setHeader("to",f),u=e.parseHeader("to"),u&&(e.to=u,e.to_tag=u.getParam("tag"));break;case"record-route":if(u=a.parse(f,"Record_Route"),u===-1)u=void 0;else for(s=u.length,o=0;o<s;o++)i=u[o],e.addHeader("record-route",f.substring(i.possition,i.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=i.parsed;break;case"call-id":case"i":e.setHeader("call-id",f),u=e.parseHeader("call-id"),u&&(e.call_id=f);break;case"contact":case"m":if(u=a.parse(f,"Contact"),u===-1)u=void 0;else for(s=u.length,o=0;o<s;o++)i=u[o],e.addHeader("contact",f.substring(i.possition,i.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=i.parsed;break;case"content-length":case"l":e.setHeader("content-length",f),u=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",f),u=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",f),u=e.parseHeader("cseq"),u&&(e.cseq=u.value),e instanceof l.IncomingResponse&&(e.method=u.method);break;case"max-forwards":e.setHeader("max-forwards",f),u=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",f),u=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",f),u=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",f),u=e.parseHeader("session-expires"),u&&(e.session_expires=u.expires,e.session_expires_refresher=u.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",f),u=e.parseHeader("refer-to"),u&&(e.refer_to=u);break;case"replaces":e.setHeader("replaces",f),u=e.parseHeader("replaces"),u&&(e.replaces=u);break;case"event":case"o":e.setHeader("event",f),u=e.parseHeader("event"),u&&(e.event=u);break;default:e.setHeader(d,f),u=0}return void 0!==u||{error:'error parsing header "'+d+'"'}}var o={};t.exports=o;var s=e("debug")("PlivoSIP:ERROR:Parser");s.log=console.warn.bind(console);var a=e("./Grammar"),l=e("./SIPMessage");o.parseMessage=function(e,t){var n,o,u,c,d,f=0,h=e.indexOf("\r\n");if(h===-1)return void s("parseMessage() | no CRLF found, not a SIP message");if(o=e.substring(0,h),d=a.parse(o,"Request_Response"),d===-1)return void s('parseMessage() | error parsing first line of SIP message: "'+o+'"');for(d.status_code?(n=new l.IncomingResponse,n.status_code=d.status_code,n.reason_phrase=d.reason_phrase):(n=new l.IncomingRequest(t),n.method=d.method,n.ruri=d.uri),n.data=e,f=h+2;;){if(h=r(e,f),h===-2){c=f+2;break}if(h===-1)return void s("parseMessage() | malformed message");if(d=i(n,e,f,h),d!==!0)return void s("parseMessage() |",d.error);f=h+2}return n.hasHeader("content-length")?(u=n.getHeader("content-length"),n.body=e.substr(c,u)):n.body=e.substring(c),n}},{"./Grammar":40,"./SIPMessage":52,debug:12}],45:[function(e,t,n){function r(e){q("new"),this.ua=e,this.status=L.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:V.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.referSubscribers={},this.data={},this.causes=V.causes,B.EventEmitter.call(this)}function i(e,t){var n=this,r=Q.T1;this.timers.invite2xxTimer=setTimeout(function i(){n.status===L.STATUS_WAITING_FOR_ACK&&(e.reply(200,null,["Contact: "+n.contact],t),r<Q.T2&&(r=2*r,r>Q.T2&&(r=Q.T2)),n.timers.invite2xxTimer=setTimeout(i,r))},r)}function o(){var e=this;this.timers.ackTimer=setTimeout(function(){e.status===L.STATUS_WAITING_FOR_ACK&&(q("no ACK received, terminating the session"),clearTimeout(e.timers.invite2xxTimer),b.call(e,V.BYE),M.call(e,"remote",null,V.causes.NO_ACK))},Q.TIMER_H)}function s(e,t){var n=this;this.connection=new RTCPeerConnection(e,t),this.connection.addEventListener("iceconnectionstatechange",function(){var e=n.connection.iceConnectionState;"failed"!==e||this.disableRtpTimeOut||n.terminate({cause:V.causes.RTP_TIMEOUT,status_code:200,reason_phrase:V.causes.RTP_TIMEOUT})})}function a(e,t,n,r){function i(r){var i,a=!1;s.addEventListener("icecandidate",i=function(n){var r=n.candidate;if(r&&r.candidate.search("srflx")!=-1&&(a=!0),!r||a){if(s.removeEventListener("icecandidate",i),o.rtcReady=!0,t){var l={originator:"local",type:e,sdp:s.localDescription.sdp};o.emit("sdp",l),t(l.sdp),q("iceGathering completed")}t=null}}),s.setLocalDescription(r).then(function(){"complete"!=s.iceGatheringState&&setTimeout(function(){if("complete"===s.iceGatheringState)return void q("iceGathering already completed");if(o.rtcReady=!0,t){var n={originator:"local",type:e,sdp:s.localDescription.sdp};o.emit("sdp",n),t(n.sdp),t=null,q("iceGathering taking more than 2sec "+s.iceGatheringState),j.call(o,2e3)}},2e3),q("iceGatheringState after setLocalDescription success: "+s.iceGatheringState)})["catch"](function(e){o.rtcReady=!0,n&&n(e),o.emit("peerconnection:setlocaldescriptionfailed",e)})}q("createLocalDescription()");var o=this,s=this.connection;if(this.rtcReady=!1,"offer"===e)s.createOffer(r).then(i)["catch"](function(e){o.rtcReady=!0,n&&n(e),o.emit("peerconnection:createofferfailed",e)});else{if("answer"!==e)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+e+'" was given');s.createAnswer(r).then(i)["catch"](function(e){o.rtcReady=!0,n&&n(e),o.emit("peerconnection:createanswerfailed",e)})}}function l(e,t,n){var r,i,o="UAS"===t?e.to_tag:e.from_tag,s="UAS"===t?e.from_tag:e.to_tag,a=e.call_id+o+s;return i=this.earlyDialogs[a],n?!!i||(i=new $(this,e,t,$.C.STATUS_EARLY),i.error?(q(i.error),D.call(this,"remote",e,V.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[a]=i,!0)):(this.from_tag=e.from_tag,this.to_tag=e.to_tag,i?(i.update(e,t),this.dialog=i,delete this.earlyDialogs[a],!0):(r=new $(this,e,t),r.error?(q(r.error),D.call(this,"remote",e,V.causes.INTERNAL_ERROR),!1):(this.dialog=r,!0)))}function u(e){function t(t){t=t||{},p=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==L.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}function n(){r(function(t){var n=["Contact: "+d.contact];T.call(d,e,n),d.late_sdp&&(t=_.call(d,t)),e.reply(200,null,n,t,function(){d.status=L.STATUS_WAITING_FOR_ACK,i.call(d,e,t),o.call(d)}),"function"==typeof v.callback&&v.callback()},function(){e.reply(500)})}function r(e,t){d.late_sdp?a.call(d,"offer",e,t,d.rtcOfferConstraints):(d.remoteHold===!0&&h===!1?(d.remoteHold=!1,N.call(d,"remote")):d.remoteHold===!1&&h===!0&&(d.remoteHold=!0,x.call(d,"remote")),a.call(d,"answer",e,t,d.rtcAnswerConstraints))}q("receiveReinvite()");var s,l,u,c,d=this,f=e.getHeader("Content-Type"),h=!1,p=!1,v={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("reinvite",v),!p)if(e.body){if(this.late_sdp=!1,"application/sdp"!==f)return q("invalid Content-Type"),void e.reply(415);for(s=e.parseSDP(),l=0;l<s.media.length;l++)if(c=s.media[l],re.indexOf(c.type)!==-1){if(u=c.direction||s.direction||"sendrecv","sendonly"!==u&&"inactive"!==u){h=!1;break}h=!0}var g={originator:"remote",type:"offer",sdp:e.body},m=new RTCSessionDescription({type:"offer",sdp:g.sdp});this.emit("sdp",g),this.connection.setRemoteDescription(m).then(n)["catch"](function(t){e.reply(488),d.emit("peerconnection:setremotedescriptionfailed",t)})}else this.late_sdp=!0,n()}function c(e){function t(t){t=t||{},u=!0;var n=t.status_code||403,r=t.reason_phrase||"",i=t.extraHeaders&&t.extraHeaders.slice()||[];if(this.status!==L.STATUS_CONFIRMED)return!1;if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);e.reply(n,r,i)}q("receiveUpdate()");var n,r,i,o,s=this,l=e.getHeader("Content-Type"),u=!1,c=!1,d={request:e,callback:void 0,reject:t.bind(this)};if(this.emit("update",d),!u){if(!e.body){var f=[];return T.call(this,e,f),void e.reply(200,null,f)}if("application/sdp"!==l)return q("invalid Content-Type"),void e.reply(415);for(n=e.parseSDP(),r=0;r<n.media.length;r++)if(o=n.media[r],re.indexOf(o.type)!==-1){if(i=o.direction||n.direction||"sendrecv","sendonly"!==i&&"inactive"!==i){c=!1;break}c=!0}var h={originator:"remote",type:"offer",sdp:e.body},p=new RTCSessionDescription({type:"offer",sdp:h.sdp});this.emit("sdp",h),this.connection.setRemoteDescription(p).then(function(){s.remoteHold===!0&&c===!1?(s.remoteHold=!1,N.call(s,"remote")):s.remoteHold===!1&&c===!0&&(s.remoteHold=!0,x.call(s,"remote")),a.call(s,"answer",function(t){var n=["Contact: "+s.contact];T.call(s,e,n),e.reply(200,null,n,t),"function"==typeof d.callback&&d.callback()},function(){e.reply(500)})})["catch"](function(t){e.reply(488),s.emit("peerconnection:setremotedescriptionfailed",t)})}}function d(e){function t(t,n){var o,s;return n=n||{},t="function"==typeof t?t:null,(this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_CONFIRMED)&&(o=new r(this.ua),o.on("progress",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),o.on("accepted",function(e){i.notify(e.response.status_code,e.response.reason_phrase)}),o.on("failed",function(e){e.message?i.notify(e.message.status_code,e.message.reason_phrase):i.notify(487,e.cause)}),e.refer_to.uri.hasHeader("replaces")&&(s=decodeURIComponent(e.refer_to.uri.getHeader("replaces")),n.extraHeaders=n.extraHeaders||[],n.extraHeaders.push("Replaces: "+s)),void o.connect(e.refer_to.uri.toAor(),n,t))}function n(){i.notify(603)}q("receiveRefer()");var i,o=this;return void 0===typeof e.refer_to?(q("no Refer-To header field present in REFER"),void e.reply(400)):e.refer_to.uri.scheme!==V.SIP?(q("Refer-To header field points to a non-SIP URI scheme"),void e.reply(416)):(e.reply(202),i=new te(this,e.cseq),void this.emit("refer",{request:e,accept:function(e,n){t.call(o,e,n)},reject:function(){n.call(o)}}))}function f(e){switch(q("receiveNotify()"),void 0===typeof e.event&&e.reply(400),e.event.event){case"refer":var t=e.event.params.id,n=this.referSubscribers[t];if(!n)return void e.reply(481,"Subscription does not exist");n.receiveNotify(e),e.reply(200);break;default:e.reply(489)}}function h(e){function t(t){var n;return(this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_CONFIRMED)&&(n=new r(this.ua),n.on("confirmed",function(){i.terminate()}),void n.init_incoming(e,t))}function n(){q("Replaced INVITE rejected by the user"),e.reply(486)}q("receiveReplaces()");var i=this;this.emit("replaces",{request:e,accept:function(e){t.call(i,e)},reject:function(){n.call(i)}})}function p(e,t,n){function r(e){l.status!==L.STATUS_TERMINATED&&(l.localMediaStream=e,e&&l.connection.addStream(e),l.emit("peerconnection",{peerconnection:l.connection}),I.call(l,l.request),a.call(l,"offer",o,s,t))}function i(){l.status!==L.STATUS_TERMINATED&&D.call(l,"local",null,V.causes.USER_DENIED_MEDIA_ACCESS)}function o(e){l.isCanceled||l.status===L.STATUS_TERMINATED||(l.request.body=e,l.status=L.STATUS_INVITE_SENT,l.emit("sending",{request:l.request}),u.send())}function s(){l.status!==L.STATUS_TERMINATED&&D.call(l,"system",null,V.causes.WEBRTC_ERROR)}var l=this,u=new Y(l,this.ua);this.receiveResponse=function(e){v.call(l,e)},n?setTimeout(function(){r(n)}):e.audio||e.video?(this.localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).then(r)["catch"](function(e){i(e),l.emit("getusermediafailed",e)})):r(null)}function v(e){q("receiveInviteResponse()");var t,n,r,i=this;if(this.dialog&&e.status_code>=200&&e.status_code<=299)return this.dialog.id.call_id===e.call_id&&this.dialog.id.local_tag===e.from_tag&&this.dialog.id.remote_tag===e.to_tag?void b.call(this,V.ACK):(n=new $(this,e,"UAC"),void 0!==n.error?void q(n.error):(n.sendRequest({owner:{status:L.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},V.ACK),void n.sendRequest({owner:{status:L.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},V.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(e.status_code>=100&&e.status_code<200?this.request.cancel(this.cancelReason):e.status_code>=200&&e.status_code<299&&y.call(this,e));if(this.status===L.STATUS_INVITE_SENT||this.status===L.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(e.status_code):this.status=L.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){q("1xx response received without to tag");break}if(e.hasHeader("contact")&&!l.call(this,e,"UAC",!0))break;if(this.status=L.STATUS_1XX_RECEIVED,P.call(this,"remote",e),!e.body)break;r={originator:"remote",type:"pranswer",sdp:e.body},this.emit("sdp",r);var o=new RTCSessionDescription({type:"pranswer",sdp:r.sdp});this.connection.setRemoteDescription(o)["catch"](function(e){i.emit("peerconnection:setremotedescriptionfailed",e)});break;case/^2[0-9]{2}$/.test(e.status_code):if(this.status=L.STATUS_CONFIRMED,!e.body){y.call(this,e,400,V.causes.MISSING_SDP),D.call(this,"remote",e,V.causes.BAD_MEDIA_DESCRIPTION);break}if(!l.call(this,e,"UAC"))break;r={originator:"remote",type:"answer",sdp:e.body},this.emit("sdp",r);var s=new RTCSessionDescription({type:"answer",sdp:r.sdp});this.connection.setRemoteDescription(s).then(function(){C.call(i,e),A.call(i,"remote",e),b.call(i,V.ACK),O.call(i,"local",null)})["catch"](function(t){y.call(i,e,488,"Not Acceptable Here"),D.call(i,"remote",e,V.causes.BAD_MEDIA_DESCRIPTION),i.emit("peerconnection:setremotedescriptionfailed",t)});break;default:t=J.sipErrorCause(e.status_code),D.call(this,"remote",e,t)}}function g(e){function t(e){if(r.status!==L.STATUS_TERMINATED&&(b.call(r,V.ACK),!l)){if(C.call(r,e),!e.body)return void n();if("application/sdp"!==e.getHeader("Content-Type"))return void n();var t={originator:"remote",type:"answer",sdp:e.body},i=new RTCSessionDescription({type:"answer",sdp:t.sdp});r.emit("sdp",t),r.connection.setRemoteDescription(i).then(function(){o.succeeded&&o.succeeded(e)})["catch"](function(e){n(),r.emit("peerconnection:setremotedescriptionfailed",e)})}}function n(e){o.failed&&o.failed(e)}q("sendReinvite()"),e=e||{};var r=this,i=e.extraHeaders||[],o=e.eventHandlers||{},s=e.rtcOfferConstraints||this.rtcOfferConstraints||null,l=!1;i.push("Contact: "+this.contact),i.push("Content-Type: application/sdp"),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),a.call(this,"offer",function(e){e=_.call(r,e);var o=new Z(r,V.INVITE);o.send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),l=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},s)}function m(e){function t(e){if(r.status!==L.STATUS_TERMINATED&&!u)if(C.call(r,e),l){if(!e.body)return void n();if("application/sdp"!==e.getHeader("Content-Type"))return void n();var t={originator:"remote",type:"answer",sdp:e.body},i=new RTCSessionDescription({type:"answer",sdp:t.sdp});r.emit("sdp",t),r.connection.setRemoteDescription(i).then(function(){o.succeeded&&o.succeeded(e)})["catch"](function(e){n(),r.emit("peerconnection:setremotedescriptionfailed",e)})}else o.succeeded&&o.succeeded(e)}function n(e){o.failed&&o.failed(e)}q("sendUpdate()"),e=e||{};var r=this,i=e.extraHeaders||[],o=e.eventHandlers||{},s=e.rtcOfferConstraints||this.rtcOfferConstraints||null,l=e.sdpOffer||!1,u=!1;if(i.push("Contact: "+this.contact),this.sessionTimers.running&&i.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),l)i.push("Content-Type: application/sdp"),a.call(this,"offer",function(e){e=_.call(r,e);var o=new Z(r,V.UPDATE);o.send({extraHeaders:i,body:e,eventHandlers:{onSuccessResponse:function(e){t(e),u=!0},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},s);else{var c=new Z(r,V.UPDATE);c.send({extraHeaders:i,eventHandlers:{onSuccessResponse:function(e){t(e)},onErrorResponse:function(e){n(e)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})}}function y(e,t,n){q("acceptAndTerminate()");var r=[];t&&(n=n||V.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause="+t+'; text="'+n+'"')),(this.dialog||l.call(this,e,"UAC"))&&(b.call(this,V.ACK),b.call(this,V.BYE,{extraHeaders:r})),this.status=L.STATUS_TERMINATED}function b(e,t){q("sendRequest()");var n=new Z(this,e);n.send(t)}function _(e){var t,n,r;if(!this.localHold&&!this.remoteHold)return e;if(e=W.parse(e),this.localHold&&!this.remoteHold)for(q("mangleOffer() | me on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction?"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="sendonly");else if(this.localHold&&this.remoteHold)for(q("mangleOffer() | both on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction="inactive");else if(this.remoteHold)for(q("mangleOffer() | remote on hold, mangling offer"),n=e.media.length,t=0;t<n;t++)r=e.media[t],re.indexOf(r.type)!==-1&&(r.direction?"sendrecv"===r.direction?r.direction="recvonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="recvonly");return W.write(e)}function S(){var e=!0,t=!0;(this.localHold||this.remoteHold)&&(e=!1,t=!1),this.audioMuted&&(e=!1),this.videoMuted&&(t=!1),E.call(this,!e),k.call(this,!t)}function T(e,t){if(this.sessionTimers.enabled){var n;e.session_expires&&e.session_expires>=V.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,n="uas"),t.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+n),this.sessionTimers.refresher="uas"===n,w.call(this)}}function C(e){if(this.sessionTimers.enabled){var t;e.session_expires&&e.session_expires>=V.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,t="uac"),this.sessionTimers.refresher="uac"===t,w.call(this)}}function w(){var e=this,t=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){e.status!==L.STATUS_TERMINATED&&(q("runSessionTimer() | sending session refresh request"),m.call(e,{eventHandlers:{succeeded:function(t){C.call(e,t)}}}))},500*t):this.sessionTimers.timer=setTimeout(function(){e.status!==L.STATUS_TERMINATED&&(G("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:V.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*t)}function E(e){var t,n,r,i,o,s=this.connection.getLocalStreams();for(r=s.length,t=0;t<r;t++)for(o=s[t].getAudioTracks(),i=o.length,n=0;n<i;n++)o[n].enabled=!e}function k(e){var t,n,r,i,o,s=this.connection.getLocalStreams();for(r=s.length,t=0;t<r;t++)for(o=s[t].getVideoTracks(),i=o.length,n=0;n<i;n++)o[n].enabled=!e}function R(e,t){q("newRTCSession"),this.ua.newRTCSession({originator:e,session:this,request:t})}function I(e){q("session connecting"),this.emit("connecting",{request:e})}function P(e,t){q("session progress"),this.emit("progress",{originator:e,response:t||null})}function A(e,t){q("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:e,response:t||null})}function O(e,t){q("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:e,ack:t||null})}function M(e,t,n){q("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:e,message:t||null,cause:n})}function D(e,t,n){q("session failed"),this.close(),this.emit("failed",{originator:e,message:t||null,cause:n})}function x(e){q("session onhold"),S.call(this),this.emit("hold",{originator:e})}function N(e){q("session onunhold"),S.call(this),this.emit("unhold",{originator:e})}function F(e){q("session onmute"),S.call(this),this.emit("muted",{audio:e.audio,video:e.video})}function U(e){q("session onunmute"),S.call(this),this.emit("unmuted",{audio:e.audio,video:e.video})}function j(e){q("iceTimeOut() after "+e),this.emit("icetimeout",e)}t.exports=r;var L={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};r.C=L;var H=e("util"),B=e("events"),q=e("debug")("PlivoSIP:RTCSession"),G=e("debug")("PlivoSIP:ERROR:RTCSession");G.log=console.warn.bind(console);var W=e("sdp-transform"),V=e("./Constants"),z=e("./Exceptions"),K=e("./Transactions"),J=e("./Utils"),Q=e("./Timers"),X=e("./SIPMessage"),$=e("./Dialog"),Y=e("./RequestSender"),Z=e("./RTCSession/Request"),ee=e("./RTCSession/DTMF"),te=e("./RTCSession/ReferNotifier"),ne=e("./RTCSession/ReferSubscriber"),re=["audio","video"];H.inherits(r,B.EventEmitter),r.prototype.isInProgress=function(){switch(this.status){case L.STATUS_NULL:case L.STATUS_INVITE_SENT:case L.STATUS_1XX_RECEIVED:case L.STATUS_INVITE_RECEIVED:case L.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},r.prototype.isEstablished=function(){switch(this.status){case L.STATUS_ANSWERED:case L.STATUS_WAITING_FOR_ACK:case L.STATUS_CONFIRMED:return!0;default:return!1}},r.prototype.isEnded=function(){switch(this.status){case L.STATUS_CANCELED:case L.STATUS_TERMINATED:return!0;default:return!1}},r.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},r.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},r.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply!==!0&&this.dialog.uas_pending_reply!==!0||(q("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(q("isReadyToReOffer() | session not established yet"),!1):(q("isReadyToReOffer() | internal WebRTC status not ready"),!1)},r.prototype.connect=function(e,t,n){q("connect()"),t=t||{};var r,i,o=e,a=t.eventHandlers||{},l=t.extraHeaders&&t.extraHeaders.slice()||[],u=t.mediaConstraints||{audio:!0,video:!0},c=t.mediaStream||null,d=t.pcConfig||{iceServers:[]},f=t.rtcConstraints||null,h=t.rtcOfferConstraints||null;if(this.rtcOfferConstraints=h,this.rtcAnswerConstraints=t.rtcAnswerConstraints||null,this.sessionTimers.enabled&&J.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=V.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=t.sessionTimersExpires:this.sessionTimers.defaultExpires=V.SESSION_EXPIRES),this.data=t.data||this.data,void 0===e)throw new TypeError("Not enough arguments");if(!window.RTCPeerConnection)throw new z.NotSupportedError("WebRTC not supported");if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+o);if(this.status!==L.STATUS_NULL)throw new z.InvalidStateError(this.status);for(r in a)this.on(r,a[r]);this.from_tag=J.newTag(),this.anonymous=t.anonymous||!1,this.isCanceled=!1,i={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",l.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),l.push("Privacy: id")),l.push("Contact: "+this.contact),l.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&l.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new X.OutgoingRequest(V.INVITE,e,this.ua,i,l),this.id=this.request.call_id+this.from_tag,s.call(this,d,f),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,n?n(this):R.call(this,"local",this.request),p.call(this,u,h,c)},r.prototype.init_incoming=function(e,t){q("init_incoming()");var n,r=this,i=e.getHeader("Content-Type");return e.body&&"application/sdp"!==i?void e.reply(415):(this.status=L.STATUS_INVITE_RECEIVED,this.from_tag=e.from_tag,this.id=e.call_id+this.from_tag,this.request=e,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,e.hasHeader("expires")&&(n=1e3*e.getHeader("expires")),e.to_tag=J.newTag(),l.call(this,e,"UAS",!0)?(e.body?this.late_sdp=!1:this.late_sdp=!0,this.status=L.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){e.reply(408),D.call(r,"local",null,V.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),n&&(this.timers.expiresTimer=setTimeout(function(){r.status===L.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),D.call(r,"system",null,V.causes.EXPIRES))},n)),this.direction="incoming",this.local_identity=e.to,this.remote_identity=e.from,t?t(this):R.call(this,"remote",e),void(this.status!==L.STATUS_TERMINATED&&(e.reply(180,null,["Contact: "+r.contact]),P.call(r,"local",null)))):void e.reply(500,"Missing Contact header field"))},r.prototype.answer=function(e){function t(e){if(b.status!==L.STATUS_TERMINATED)if(b.localMediaStream=e,e&&b.connection.addStream(e),b.request.body||b.emit("peerconnection",{peerconnection:b.connection}),b.late_sdp)r();else{var t={originator:"remote",type:"offer",sdp:_.body},n=new RTCSessionDescription({type:"offer",sdp:t.sdp});b.emit("sdp",t),b.connection.setRemoteDescription(n).then(r)["catch"](function(e){_.reply(488),D.call(b,"system",null,V.causes.WEBRTC_ERROR),b.emit("peerconnection:setremotedescriptionfailed",e)})}}function n(){b.status!==L.STATUS_TERMINATED&&(_.reply(480),D.call(b,"local",null,V.causes.USER_DENIED_MEDIA_ACCESS))}function r(){I.call(b,_),b.late_sdp?a.call(b,"offer",u,c,b.rtcOfferConstraints):a.call(b,"answer",u,c,R)}function u(e){function t(){b.status=L.STATUS_WAITING_FOR_ACK,i.call(b,_,e),o.call(b),A.call(b,"local")}function n(){D.call(b,"system",null,V.causes.CONNECTION_ERROR)}b.status!==L.STATUS_TERMINATED&&(T.call(b,_,S),_.reply(200,null,S,e,t,n))}function c(){b.status!==L.STATUS_TERMINATED&&(_.reply(500),D.call(b,"system",null,V.causes.WEBRTC_ERROR))}q("answer()"),e=e||{};var d,f,h,p,v=!1,g=!1,m=!1,y=!1,b=this,_=this.request,S=e.extraHeaders&&e.extraHeaders.slice()||[],C=e.mediaConstraints||{},w=e.mediaStream||null,E=e.pcConfig||{iceServers:[]},k=e.rtcConstraints||null,R=e.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=R,this.rtcOfferConstraints=e.rtcOfferConstraints||null,this.sessionTimers.enabled&&J.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=V.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=e.sessionTimersExpires:this.sessionTimers.defaultExpires=V.SESSION_EXPIRES),this.data=e.data||this.data,"incoming"!==this.direction)throw new z.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==L.STATUS_WAITING_FOR_ANSWER)throw new z.InvalidStateError(this.status);if(this.status=L.STATUS_ANSWERED,!l.call(this,_,"UAS"))return void _.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),S.unshift("Contact: "+b.contact),h=_.parseSDP(),Array.isArray(h.media)||(h.media=[h.media]),d=h.media.length;d--;){var P=h.media[d];"audio"===P.type&&(v=!0,P.direction&&"sendrecv"!==P.direction||(m=!0)),"video"===P.type&&(g=!0,P.direction&&"sendrecv"!==P.direction||(y=!0))}if(w&&C.audio===!1)for(p=w.getAudioTracks(),f=p.length,d=0;d<f;d++)w.removeTrack(p[d]);if(w&&C.video===!1)for(p=w.getVideoTracks(),f=p.length,d=0;d<f;d++)w.removeTrack(p[d]);w||void 0!==C.audio||(C.audio=m),w||void 0!==C.video||(C.video=y),w||v||(C.audio=!1),w||g||(C.video=!1),s.call(this,E,k),w?t(w):C.audio||C.video?(b.localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(C).then(t)["catch"](function(e){n(e),b.emit("getusermediafailed",e)})):t(null)},r.prototype.terminate=function(e){q("terminate()"),e=e||{};var t,n,r=e.cause||V.causes.BYE,i=e.status_code,o=e.reason_phrase,s=e.extraHeaders&&e.extraHeaders.slice()||[],a=e.body,l=this;if(this.status===L.STATUS_TERMINATED)throw new z.InvalidStateError(this.status);switch(this.status){case L.STATUS_NULL:case L.STATUS_INVITE_SENT:case L.STATUS_1XX_RECEIVED:if(q("canceling session"),i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&(o=o||V.REASON_PHRASE[i]||"",
t="SIP ;cause="+i+' ;text="'+o+'"'),this.status===L.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=t):this.status===L.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=t):this.status===L.STATUS_1XX_RECEIVED&&this.request.cancel(t),this.status=L.STATUS_CANCELED,D.call(this,"local",null,V.causes.CANCELED);break;case L.STATUS_WAITING_FOR_ANSWER:case L.STATUS_ANSWERED:if(q("rejecting session"),i=i||480,i<300||i>=700)throw new TypeError("Invalid status_code: "+i);this.request.reply(i,o,s,a),D.call(this,"local",null,V.causes.REJECTED);break;case L.STATUS_WAITING_FOR_ACK:case L.STATUS_CONFIRMED:if(q("terminating session"),o=e.reason_phrase||V.REASON_PHRASE[i]||"",i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&s.push("Reason: SIP ;cause="+i+'; text="'+o+'"'),this.status===L.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==K.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(e){e.method===V.ACK&&(b.call(this,V.BYE,{extraHeaders:s,body:a}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===K.C.STATUS_TERMINATED&&(b.call(l,V.BYE,{extraHeaders:s,body:a}),n.terminate())}),M.call(this,"local",null,r),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):(b.call(this,V.BYE,{extraHeaders:s,body:a}),M.call(this,"local",null,r))}},r.prototype.close=function(){q("close()");var e;if(this.status!==L.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(t){G("close() | error closing the RTCPeerConnection: %o",t)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(q("close() | closing local MediaStream"),J.closeMediaStream(this.localMediaStream));for(e in this.timers)clearTimeout(this.timers[e]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(e in this.earlyDialogs)this.earlyDialogs[e].terminate(),delete this.earlyDialogs[e];this.status=L.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},r.prototype.sendDTMF=function(e,t){function n(){var e,a;if(s.status===L.STATUS_TERMINATED||!s.tones||o>=s.tones.length)return void(s.tones=null);if(e=s.tones[o],o+=1,","===e)a=2e3;else{var l=new ee(s);t.eventHandlers={failed:function(){s.tones=null}},l.send(e,t),a=r+i}setTimeout(n,a)}q("sendDTMF() | tones: %s",e);var r,i,o=0,s=this;if(t=t||{},r=t.duration||null,i=t.interToneGap||null,void 0===e)throw new TypeError("Not enough arguments");if(this.status!==L.STATUS_CONFIRMED&&this.status!==L.STATUS_WAITING_FOR_ACK)throw new z.InvalidStateError(this.status);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);if(r&&!J.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<ee.C.MIN_DURATION?(q('"duration" value is lower than the minimum allowed, setting it to '+ee.C.MIN_DURATION+" milliseconds"),r=ee.C.MIN_DURATION):r>ee.C.MAX_DURATION?(q('"duration" value is greater than the maximum allowed, setting it to '+ee.C.MAX_DURATION+" milliseconds"),r=ee.C.MAX_DURATION):r=Math.abs(r):r=ee.C.DEFAULT_DURATION,t.duration=r,i&&!J.isDecimal(i))throw new TypeError("Invalid interToneGap: "+i);return i?i<ee.C.MIN_INTER_TONE_GAP?(q('"interToneGap" value is lower than the minimum allowed, setting it to '+ee.C.MIN_INTER_TONE_GAP+" milliseconds"),i=ee.C.MIN_INTER_TONE_GAP):i=Math.abs(i):i=ee.C.DEFAULT_INTER_TONE_GAP,this.tones?void(this.tones+=e):(this.tones=e,void n())},r.prototype.mute=function(e){q("mute()"),e=e||{audio:!0,video:!1};var t=!1,n=!1;this.audioMuted===!1&&e.audio&&(t=!0,this.audioMuted=!0,E.call(this,!0)),this.videoMuted===!1&&e.video&&(n=!0,this.videoMuted=!0,k.call(this,!0)),t!==!0&&n!==!0||F.call(this,{audio:t,video:n})},r.prototype.unmute=function(e){q("unmute()"),e=e||{audio:!0,video:!0};var t=!1,n=!1;this.audioMuted===!0&&e.audio&&(t=!0,this.audioMuted=!1,this.localHold===!1&&E.call(this,!1)),this.videoMuted===!0&&e.video&&(n=!0,this.videoMuted=!1,this.localHold===!1&&k.call(this,!1)),t!==!0&&n!==!0||U.call(this,{audio:t,video:n})},r.prototype.hold=function(e,t){q("hold()"),e=e||{};var n,r=this;return(this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_CONFIRMED)&&(this.localHold!==!0&&(!!this.isReadyToReOffer()&&(this.localHold=!0,x.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},e.useUpdate?m.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):g.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.unhold=function(e,t){q("unhold()"),e=e||{};var n,r=this;return(this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_CONFIRMED)&&(this.localHold!==!1&&(!!this.isReadyToReOffer()&&(this.localHold=!1,N.call(this,"local"),n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},e.useUpdate?m.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:e.extraHeaders}):g.call(this,{eventHandlers:n,extraHeaders:e.extraHeaders}),!0)))},r.prototype.renegotiate=function(e,t){q("renegotiate()"),e=e||{};var n,r=this,i=e.rtcOfferConstraints||null;return(this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(n={succeeded:function(){t&&t()},failed:function(){r.terminate({cause:V.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},S.call(this),e.useUpdate?m.call(this,{sdpOffer:!0,eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}):g.call(this,{eventHandlers:n,rtcOfferConstraints:i,extraHeaders:e.extraHeaders}),!0))},r.prototype.refer=function(e,t){q("refer()");var n,r,i=this,o=e;if(this.status!==L.STATUS_WAITING_FOR_ACK&&this.status!==L.STATUS_CONFIRMED)return!1;if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+o);return n=new ne(this),n.sendRefer(e,t),r=n.outgoingRequest.cseq,this.referSubscribers[r]=n,n.on("requestFailed",function(){delete i.referSubscribers[r]}),n.on("accepted",function(){delete i.referSubscribers[r]}),n.on("failed",function(){delete i.referSubscribers[r]}),n},r.prototype.receiveRequest=function(e){q("receiveRequest()");var t,n=this;if(e.method===V.CANCEL)this.status!==L.STATUS_WAITING_FOR_ANSWER&&this.status!==L.STATUS_ANSWERED||(this.status=L.STATUS_CANCELED,this.request.reply(487),D.call(this,"remote",e,V.causes.CANCELED));else switch(e.method){case V.ACK:if(this.status!==L.STATUS_WAITING_FOR_ACK)return;if(this.status=L.STATUS_CONFIRMED,clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!e.body){this.terminate({cause:V.causes.MISSING_SDP,status_code:400});break}var r={originator:"remote",type:"answer",sdp:e.body},i=new RTCSessionDescription({type:"answer",sdp:r.sdp});this.emit("sdp",r),this.connection.setRemoteDescription(i).then(function(){n.is_confirmed||O.call(n,"remote",e)})["catch"](function(e){n.terminate({cause:V.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),n.emit("peerconnection:setremotedescriptionfailed",e)})}else this.is_confirmed||O.call(this,"remote",e);break;case V.BYE:this.status===L.STATUS_CONFIRMED?(e.reply(200),M.call(this,"remote",e,V.causes.BYE)):this.status===L.STATUS_INVITE_RECEIVED?(e.reply(200),this.request.reply(487,"BYE Received"),M.call(this,"remote",e,V.causes.BYE)):e.reply(403,"Wrong Status");break;case V.INVITE:this.status===L.STATUS_CONFIRMED?e.hasHeader("replaces")?h.call(this,e):u.call(this,e):e.reply(403,"Wrong Status");break;case V.INFO:this.status===L.STATUS_CONFIRMED||this.status===L.STATUS_WAITING_FOR_ACK||this.status===L.STATUS_INVITE_RECEIVED?(t=e.getHeader("content-type"),t&&t.match(/^application\/dtmf-relay/i)?new ee(this).init_incoming(e):e.reply(415)):e.reply(403,"Wrong Status");break;case V.UPDATE:this.status===L.STATUS_CONFIRMED?c.call(this,e):e.reply(403,"Wrong Status");break;case V.REFER:this.status===L.STATUS_CONFIRMED?d.call(this,e):e.reply(403,"Wrong Status");break;case V.NOTIFY:this.status===L.STATUS_CONFIRMED?f.call(this,e):e.reply(403,"Wrong Status");break;default:e.reply(501)}},r.prototype.onTransportError=function(){G("onTransportError()"),this.status!==L.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:V.causes.CONNECTION_ERROR,cause:V.causes.CONNECTION_ERROR})},r.prototype.onRequestTimeout=function(){q("onRequestTimeout"),this.status!==L.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:V.causes.REQUEST_TIMEOUT,cause:V.causes.REQUEST_TIMEOUT})},r.prototype.onDialogError=function(){G("onDialogError()"),this.status!==L.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:V.causes.DIALOG_ERROR,cause:V.causes.DIALOG_ERROR})},r.prototype.newDTMF=function(e){q("newDTMF()"),this.emit("newDTMF",e)},r.prototype.resetLocalMedia=function(){q("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,S.call(this)}},{"./Constants":35,"./Dialog":36,"./Exceptions":39,"./RTCSession/DTMF":46,"./RTCSession/ReferNotifier":47,"./RTCSession/ReferSubscriber":48,"./RTCSession/Request":49,"./RequestSender":51,"./SIPMessage":52,"./Timers":54,"./Transactions":55,"./Utils":59,debug:12,events:11,"sdp-transform":18,util:23}],46:[function(e,t,n){function r(e){this.owner=e,this.direction=null,this.tone=null,this.duration=null}t.exports=r;var i={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};r.C=i;var o=e("debug")("PlivoSIP:RTCSession:DTMF"),s=e("debug")("PlivoSIP:ERROR:RTCSession:DTMF");s.log=console.warn.bind(console);var a=e("../Constants"),l=e("../Exceptions"),u=e("../RTCSession");r.prototype.send=function(e,t){var n,r;if(void 0===e)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==u.C.STATUS_CONFIRMED&&this.owner.status!==u.C.STATUS_WAITING_FOR_ACK)throw new l.InvalidStateError(this.owner.status);if(t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],this.eventHandlers=t.eventHandlers||{},"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: "+e);e=e.toString()}if(!e.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+e);this.tone=e,this.duration=t.duration,n.push("Content-Type: application/dtmf-relay"),r="Signal="+this.tone+"\r\n",r+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,a.INFO,{extraHeaders:n,body:r})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):o("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){s("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){s("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){s("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},r.prototype.init_incoming=function(e){var t,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=e,e.reply(200),e.body&&(t=e.body.split("\n"),t.length>=1&&n.test(t[0])&&(this.tone=t[0].replace(n,"$2")),t.length>=2&&r.test(t[1])&&(this.duration=parseInt(t[1].replace(r,"$2"),10))),this.duration||(this.duration=i.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:e}):o("invalid INFO DTMF received, discarded")}},{"../Constants":35,"../Exceptions":39,"../RTCSession":45,debug:12}],47:[function(e,t,n){function r(e,t,n){this.session=e,this.id=t,this.expires=n||i.expires,this.active=!0,this.notify(100)}t.exports=r;var i={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},o=e("debug")("PlivoSIP:RTCSession:ReferNotifier"),s=e("../Constants"),a=e("./Request");r.prototype.notify=function(e,t){o("notify()");var n,r=this;if(this.active!==!1){t=t||s.REASON_PHRASE[e]||"",n=e>=200?"terminated;reason=noresource":"active;expires="+this.expires;var l=new a(this.session,s.NOTIFY);l.send({extraHeaders:["Event: "+i.event_type+";id="+r.id,"Subscription-State: "+n,"Content-Type: "+i.body_type],body:"SIP/2.0 "+e+" "+t,eventHandlers:{onErrorResponse:function(){r.active=!1}}})}}},{"../Constants":35,"./Request":49,debug:12}],48:[function(e,t,n){function r(e){this.session=e,this.timer=null,this.outgoingRequest=null,a.EventEmitter.call(this)}function i(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}t.exports=r;var o={expires:120},s=e("util"),a=e("events"),l=e("debug")("PlivoSIP:RTCSession:ReferSubscriber"),u=e("../Constants"),c=e("../Grammar"),d=e("./Request");s.inherits(r,a.EventEmitter),r.prototype.sendRefer=function(e,t){l("sendRefer()");var n,r,s,a=null,c=this;t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],r=t.eventHandlers||{};for(var f in r)this.on(f,r[f]);t.replaces&&(a=t.replaces.request.call_id,a+=";to-tag="+t.replaces.to_tag,a+=";from-tag="+t.replaces.from_tag,a=encodeURIComponent(a)),s="Refer-To: <"+e+(a?"?Replaces="+a:"")+">",n.push(s);var h=new d(this.session,u.REFER);this.timer=setTimeout(function(){i.call(c)},1e3*o.expires),h.send({extraHeaders:n,eventHandlers:{onSuccessResponse:function(e){c.emit("requestSucceeded",{response:e})},onErrorResponse:function(e){c.emit("requestFailed",{response:e,cause:u.causes.REJECTED})},onTransportError:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.CONNECTION_ERROR})},onRequestTimeout:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.REQUEST_TIMEOUT})},onDialogError:function(){i.call(c),c.emit("requestFailed",{response:null,cause:u.causes.DIALOG_ERROR})}}}),this.outgoingRequest=h.outgoingRequest},r.prototype.receiveNotify=function(e){l("receiveNotify()");var t;if(e.body){if(t=c.parse(e.body,"Status_Line"),t===-1)return void l('receiveNotify() | error parsing NOTIFY body: "'+e.body+'"');switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):i.call(this),this.emit("accepted",{request:e,status_line:t});break;default:i.call(this),this.emit("failed",{request:e,status_line:t})}}}},{"../Constants":35,"../Grammar":40,"./Request":49,debug:12,events:11,util:23}],49:[function(e,t,n){function r(e,t){if(i("new | %s",t),this.session=e,this.method=t,this.outgoingRequest=null,this.session.status!==l.C.STATUS_1XX_RECEIVED&&this.session.status!==l.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==l.C.STATUS_WAITING_FOR_ACK&&this.session.status!==l.C.STATUS_CONFIRMED&&this.session.status!==l.C.STATUS_TERMINATED)throw new a.InvalidStateError(this.session.status);if(this.session.status===l.C.STATUS_TERMINATED&&t!==s.BYE)throw new a.InvalidStateError(this.session.status)}t.exports=r;var i=e("debug")("PlivoSIP:RTCSession:Request"),o=e("debug")("PlivoSIP:ERROR:RTCSession:Request");o.log=console.warn.bind(console);var s=e("../Constants"),a=e("../Exceptions"),l=e("../RTCSession");r.prototype.send=function(e){e=e||{};var t=e.extraHeaders&&e.extraHeaders.slice()||[],n=e.body||null;this.eventHandlers=e.eventHandlers||{},this.outgoingRequest=this.session.dialog.sendRequest(this,this.method,{extraHeaders:t,body:n})},r.prototype.receiveResponse=function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):i("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(e);break;case/^2[0-9]{2}$/.test(e.status_code):i("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(e);break;default:i("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(e)}},r.prototype.onRequestTimeout=function(){o("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){o("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){o("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":35,"../Exceptions":39,"../RTCSession":45,debug:12}],50:[function(e,t,n){function r(e,t){var n=1;this.ua=e,this.transport=t,this.registrar=e.configuration.registrar_server,this.expires=e.configuration.register_expires,this.call_id=o.createRandomToken(22),this.cseq=0,this.to_uri=e.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",n&&(this.contact+=";reg-id="+n,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}t.exports=r;var i=e("debug")("PlivoSIP:Registrator"),o=e("./Utils"),s=e("./Constants"),a=e("./SIPMessage"),l=e("./RequestSender");r.prototype={setExtraHeaders:function(e){Array.isArray(e)||(e=[]),this.extraHeaders=e.slice()},setExtraContactParams:function(e){e instanceof Object||(e={}),this.extraContactParams="";for(var t in e){var n=e[t];this.extraContactParams+=";"+t,n&&(this.extraContactParams+="="+n)}},register:function(){var e,t,n,r=this;n=this.extraHeaders.slice(),n.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),n.push("Expires: "+this.expires),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},n),e=new l(this,this.ua),this.receiveResponse=function(e){var n,a,l=e.getHeaders("contact").length;if(e.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(e.hasHeader("expires")&&(a=e.getHeader("expires")),!l){i("no Contact header in response to REGISTER, response ignored");break}for(;l--;){if(n=e.parseHeader("contact",l),n.uri.user===this.ua.contact.uri.user){a=n.getParam("expires");break}n=null}if(!n){i("no Contact header pointing to us, response ignored");break}a||(a=this.expires),this.registrationTimer=setTimeout(function(){r.registrationTimer=null,r.register()},1e3*a-3e3),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:e}));break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(this.expires=e.getHeader("min-expires"),this.register()):(i("423 response received for REGISTER without Min-Expires"),this.registrationFailure(e,s.causes.SIP_FAILURE_CODE));break;default:t=o.sipErrorCause(e.status_code),this.registrationFailure(e,t)}},this.onRequestTimeout=function(){this.registrationFailure(null,s.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,s.causes.CONNECTION_ERROR)},e.send()},unregister:function(e){var t;if(!this.registered)return void i("already unregistered");e=e||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),t=this.extraHeaders.slice(),e.all?(t.push("Contact: *"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t)):(t.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),t.push("Expires: 0"),this.request=new a.OutgoingRequest(s.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},t));var n=new l(this,this.ua);this.receiveResponse=function(e){var t;switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this.unregistered(e);break;default:t=o.sipErrorCause(e.status_code),this.unregistered(e,t)}},this.onRequestTimeout=function(){this.unregistered(null,s.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,s.causes.CONNECTION_ERROR)},n.send()},registrationFailure:function(e,t){this.ua.registrationFailed({response:e||null,cause:t}),this.registered&&(this.registered=!1,this.ua.unregistered({response:e||null,cause:t}))},unregistered:function(e,t){this.registered=!1,this.ua.unregistered({response:e||null,cause:t||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":35,"./RequestSender":51,"./SIPMessage":52,"./Utils":59,debug:12}],51:[function(e,t,n){function r(e,t){this.ua=t,this.applicant=e,this.method=e.request.method,this.request=e.request,this.auth=null,this.challenged=!1,this.staled=!1,t.status!==s.C.STATUS_USER_CLOSED||this.method===o.BYE&&this.method===o.ACK||this.onTransportError()}t.exports=r;var i=e("debug")("PlivoSIP:RequestSender"),o=e("./Constants"),s=e("./UA"),a=e("./DigestAuthentication"),l=e("./Transactions");r.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new l.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new l.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new l.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(e){var t,n,r,s=e.status_code;if(401!==s&&407!==s||null===this.ua.configuration.password&&null===this.ua.configuration.ha1)this.applicant.receiveResponse(e);else{if(401===e.status_code?(n=e.parseHeader("www-authenticate"),r="authorization"):(n=e.parseHeader("proxy-authenticate"),r="proxy-authorization"),!n)return i(e.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(e);if(!this.challenged||!this.staled&&n.stale===!0){if(this.auth||(this.auth=new a({username:this.ua.configuration.authorization_user,password:this.ua.configuration.password,realm:this.ua.configuration.realm,ha1:this.ua.configuration.ha1})),!this.auth.authenticate(this.request,n))return void this.applicant.receiveResponse(e);this.challenged=!0,this.ua.set("realm",this.auth.get("realm")),this.ua.set("ha1",this.auth.get("ha1")),n.stale&&(this.staled=!0),t=e.method===o.REGISTER?this.applicant.cseq+=1:this.request.dialog?this.request.dialog.local_seqnum+=1:this.request.cseq+1,this.request=this.applicant.request=this.request.clone(),this.request.cseq=t,this.request.setHeader("cseq",t+" "+this.method),this.request.setHeader(r,this.auth.toString()),this.send()}else this.applicant.receiveResponse(e)}}}},{"./Constants":35,"./DigestAuthentication":38,"./Transactions":55,"./UA":57,debug:12}],52:[function(e,t,n){function r(e,t,n,r,i,o){var s,a,l,f;return r=r||{},e&&t&&n?(this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=o,this.extraHeaders=i&&i.slice()||[],r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<"+n.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",u.MAX_FORWARDS),s=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"",s+="<"+(r.to_uri||t)+">",s+=r.to_tag?";tag="+r.to_tag:"",this.to=new d.parse(s),this.setHeader("to",s),a=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':n.configuration.display_name?'"'+n.configuration.display_name+'" ':"",a+="<"+(r.from_uri||n.configuration.uri)+">;tag=",a+=r.from_tag||c.newTag(),this.from=new d.parse(a),this.setHeader("from",a),l=r.call_id||n.configuration.plivosip_id+c.createRandomToken(15),this.call_id=l,this.setHeader("call-id",l),f=r.cseq||Math.floor(1e4*Math.random()),this.cseq=f,void this.setHeader("cseq",f+" "+e)):null}function i(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function o(e){this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function s(){this.headers={},this.status_code=null,this.reason_phrase=null}t.exports={OutgoingRequest:r,IncomingRequest:o,IncomingResponse:s};var a=e("debug")("PlivoSIP:SIPMessage"),l=e("sdp-transform"),u=e("./Constants"),c=e("./Utils"),d=e("./NameAddrHeader"),f=e("./Grammar");r.prototype={setHeader:function(e,t){var n,r;for(n=new RegExp("^\\s*"+e+"\\s*:","i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[c.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){var t,n,r=this.extraHeaders.length,i=this.headers[c.headerize(e)];if(i){if(i[0])return i[0]}else for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(i=this.extraHeaders[n],t.test(i))return i.substring(i.indexOf(":")+1).trim()},getHeaders:function(e){var t,n,r,i=this.headers[c.headerize(e)],o=[];if(i){for(n=i.length,t=0;t<n;t++)o.push(i[t]);return o}for(n=this.extraHeaders.length,r=new RegExp("^\\s*"+e+"\\s*:","i"),t=0;t<n;t++)i=this.extraHeaders[t],r.test(i)&&o.push(i.substring(i.indexOf(":")+1).trim());return o},hasHeader:function(e){var t,n,r=this.extraHeaders.length;if(this.headers[c.headerize(e)])return!0;for(t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0;n<r;n++)if(t.test(this.extraHeaders[n]))return!0;return!1},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=l.parse(this.body||""),this.sdp)},toString:function(){var e,t,n,r="",i=[];r+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(e in this.headers)for(t=this.headers[e].length,n=0;n<t;n++)r+=e+": "+this.headers[e][n]+"\r\n";for(t=this.extraHeaders.length,n=0;n<t;n++)r+=this.extraHeaders[n].trim()+"\r\n";switch(this.method){case u.REGISTER:i.push("path","gruu");break;case u.INVITE:this.ua.configuration.session_timers&&i.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&i.push("gruu"),i.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&i.push("timer"),i.push("ice")}return i.push("outbound"),r+="Allow: "+u.ALLOWED_METHODS+"\r\n",r+="Supported: "+i+"\r\n",r+="User-Agent: PlivowebSDK 2.0.19\r\n",this.body?(t=c.str_utf8_length(this.body),r+="Content-Length: "+t+"\r\n\r\n",r+=this.body):r+="Content-Length: 0\r\n\r\n",r},clone:function(){var e=new r(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(t){e.headers[t]=this.headers[t].slice()},this),e.body=this.body,e.extraHeaders=this.extraHeaders&&this.extraHeaders.slice()||[],e.to=this.to,e.from=this.from,e.call_id=this.call_id,e.cseq=this.cseq,e}},i.prototype={addHeader:function(e,t){var n={raw:t};e=c.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]},getHeader:function(e){var t=this.headers[c.headerize(e)];if(t)return t[0]?t[0].raw:void 0},getHeaders:function(e){var t,n,r=this.headers[c.headerize(e)],i=[];if(!r)return[];for(n=r.length,t=0;t<n;t++)i.push(r[t].raw);return i},hasHeader:function(e){return!!this.headers[c.headerize(e)]},parseHeader:function(e,t){var n,r,i;return e=c.headerize(e),t=t||0,this.headers[e]?t>=this.headers[e].length?void a('not so many "'+e+'" headers present'):(n=this.headers[e][t],r=n.raw,n.parsed?n.parsed:(i=f.parse(r,e.replace(/-/g,"_")),i===-1?(this.headers[e].splice(t,1),void a('error parsing "'+e+'" header field with value "'+r+'"')):(n.parsed=i,i))):void a('header "'+e+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(e,t){var n={raw:t};this.headers[c.headerize(e)]=[n]},parseSDP:function(e){return!e&&this.sdp?this.sdp:(this.sdp=l.parse(this.body||""),this.sdp)},toString:function(){return this.data}},o.prototype=new i,o.prototype.reply=function(e,t,n,r,i,o){var s,a,l,d,f,h=[],p=this.getHeader("To"),v=0,g=0;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);if(t=t||u.REASON_PHRASE[e]||"",n=n&&n.slice()||[],f="SIP/2.0 "+e+" "+t+"\r\n",this.method===u.INVITE&&e>100&&e<=200)for(s=this.getHeaders("record-route"),l=s.length,v;v<l;v++)f+="Record-Route: "+s[v]+"\r\n";for(a=this.getHeaders("via"),l=a.length,g;g<l;g++)f+="Via: "+a[g]+"\r\n";for(!this.to_tag&&e>100?p+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),f+="To: "+p+"\r\n",f+="From: "+this.getHeader("From")+"\r\n",f+="Call-ID: "+this.call_id+"\r\n",f+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=n.length,d=0;d<l;d++)f+=n[d].trim()+"\r\n";switch(this.method){case u.INVITE:this.ua.configuration.session_timers&&h.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&h.push("gruu"),h.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&h.push("timer"),r&&h.push("ice"),h.push("replaces")}h.push("outbound"),this.method===u.OPTIONS?(f+="Allow: "+u.ALLOWED_METHODS+"\r\n",f+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"):405===e?f+="Allow: "+u.ALLOWED_METHODS+"\r\n":415===e&&(f+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"),f+="Supported: "+h+"\r\n",r?(l=c.str_utf8_length(r),f+="Content-Type: application/sdp\r\n",f+="Content-Length: "+l+"\r\n\r\n",f+=r):f+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(e,f,i,o)},o.prototype.reply_sl=function(e,t){var n,r,i=0,o=this.getHeaders("via"),s=o.length;if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);for(t=t||u.REASON_PHRASE[e]||"",r="SIP/2.0 "+e+" "+t+"\r\n",i;i<s;i++)r+="Via: "+o[i]+"\r\n";n=this.getHeader("To"),!this.to_tag&&e>100?n+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(n+=";tag="+this.to_tag),r+="To: "+n+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},s.prototype=new i},{"./Constants":35,"./Grammar":40,"./NameAddrHeader":43,"./Utils":59,debug:12,"sdp-transform":18}],53:[function(e,t,n){function r(){}t.exports=r;var i=e("./Utils"),o=e("./Grammar"),s=e("debug")("PlivoSIP:ERROR:Socket");s.log=console.warn.bind(console),r.isSocket=function(e){if(Array.isArray(e))return!1;if("undefined"==typeof e)return s("undefined JsSIP.Socket instance"),!1;try{if(!i.isString(e.url))throw s("missing or invalid JsSIP.Socket url property"),new Error;if(!i.isString(e.via_transport))throw s("missing or invalid JsSIP.Socket via_transport property"),new Error;if(o.parse(e.sip_uri,"SIP_URI")===-1)throw s("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(t){return!1}try{["connect","disconnect","send"].forEach(function(t){if(!i.isFunction(e[t]))throw s("missing or invalid JsSIP.Socket method: "+t),new Error})}catch(t){return!1}return!0}},{"./Grammar":40,"./Utils":59,debug:12}],54:[function(e,t,n){var r=500,i=4e3,o=5e3,s={T1:r,T2:i,T4:o,TIMER_B:64*r,TIMER_D:0*r,TIMER_F:64*r,TIMER_H:64*r,TIMER_I:0*r,TIMER_J:0*r,TIMER_K:0*o,TIMER_L:64*r,TIMER_M:64*r,PROVISIONAL_RESPONSE_INTERVAL:6e4};t.exports=s},{}],55:[function(e,t,n){function r(e,t,n){var r;this.type=u.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),d.EventEmitter.call(this)}function i(e,t,n){var r,i=this;
this.type=u.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e){i.cancel_request(i,e)},d.EventEmitter.call(this)}function o(e,t,n){var r;this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,r="SIP/2.0/"+n.via_transport,r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),d.EventEmitter.call(this)}function s(e,t){this.type=u.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=u.STATUS_TRYING,t.newTransaction(this),d.EventEmitter.call(this)}function a(e,t){this.type=u.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.state=u.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100),d.EventEmitter.call(this)}function l(e,t){var n;switch(t.method){case m.INVITE:if(n=e.transactions.ist[t.via_branch]){switch(n.state){case u.STATUS_PROCEEDING:n.transport.send(n.last_response);break;case u.STATUS_ACCEPTED:}return!0}break;case m.ACK:if(n=e.transactions.ist[t.via_branch],!n)return!1;if(n.state===u.STATUS_ACCEPTED)return!1;if(n.state===u.STATUS_COMPLETED)return n.state=u.STATUS_CONFIRMED,n.I=setTimeout(function(){n.timer_I()},y.TIMER_I),!0;break;case m.CANCEL:return n=e.transactions.ist[t.via_branch],n?(t.reply_sl(200),n.state!==u.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(n=e.transactions.nist[t.via_branch]){switch(n.state){case u.STATUS_TRYING:break;case u.STATUS_PROCEEDING:case u.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}t.exports={C:null,NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:o,NonInviteServerTransaction:s,InviteServerTransaction:a,checkTransaction:l};var u={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};t.exports.C=u;var c=e("util"),d=e("events"),f=e("debug")("PlivoSIP:NonInviteClientTransaction"),h=e("debug")("PlivoSIP:InviteClientTransaction"),p=e("debug")("PlivoSIP:AckClientTransaction"),v=e("debug")("PlivoSIP:NonInviteServerTransaction"),g=e("debug")("PlivoSIP:InviteServerTransaction"),m=e("./Constants"),y=e("./Timers");c.inherits(r,d.EventEmitter),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var e=this;this.stateChanged(u.STATUS_TRYING),this.F=setTimeout(function(){e.timer_F()},y.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){f("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){f("Timer F expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n<200)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(e)}else switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(e),this.K=setTimeout(function(){t.timer_K()},y.TIMER_K);break;case u.STATUS_COMPLETED:}},c.inherits(i,d.EventEmitter),i.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){var e=this;this.stateChanged(u.STATUS_CALLING),this.B=setTimeout(function(){e.timer_B()},y.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==u.STATUS_ACCEPTED&&(h("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.timer_M=function(){h("Timer M expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){h("Timer B expired for transaction "+this.id),this.state===u.STATUS_CALLING&&(this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){h("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(e){var t=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+e.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){t.timer_D()},y.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(e,t){var n=e.request;this.cancel=m.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",t&&(this.cancel+="Reason: "+t+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===u.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(e){var t=this,n=e.status_code;if(n>=100&&n<=199)switch(this.state){case u.STATUS_CALLING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(e);break;case u.STATUS_PROCEEDING:this.request_sender.receiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.M=setTimeout(function(){t.timer_M()},y.TIMER_M),this.request_sender.receiveResponse(e);break;case u.STATUS_ACCEPTED:this.request_sender.receiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.sendACK(e),this.request_sender.receiveResponse(e);break;case u.STATUS_COMPLETED:this.sendACK(e)}},c.inherits(o,d.EventEmitter),o.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},o.prototype.onTransportError=function(){p("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},c.inherits(s,d.EventEmitter),s.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.timer_J=function(){v("Timer J expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,v("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.receiveResponse=function(e,t,n,r){var i=this;if(100===e)switch(this.state){case u.STATUS_TRYING:this.stateChanged(u.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case u.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=200&&e<=699)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout(function(){i.timer_J()},y.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r());break;case u.STATUS_COMPLETED:}},c.inherits(a,d.EventEmitter),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){g("Timer H expired for transaction "+this.id),this.state===u.STATUS_COMPLETED&&g("ACK not received, dialog will be terminated"),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(u.STATUS_TERMINATED)},a.prototype.timer_L=function(){g("Timer L expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,g("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(e,t,n,r){var i=this;if(e>=100&&e<=199)switch(this.state){case u.STATUS_PROCEEDING:this.transport.send(t)||this.onTransportError(),this.last_response=t}if(e>100&&e<=199&&this.state===u.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){i.resend_provisional()},y.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(this.state){case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout(function(){i.timer_L()},y.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case u.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(e>=300&&e<=699)switch(this.state){case u.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(u.STATUS_COMPLETED),this.H=setTimeout(function(){i.timer_H()},y.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}}},{"./Constants":35,"./Timers":54,debug:12,events:11,util:23}],56:[function(e,t,n){function r(e,t){if(c("new()"),this.status=f.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=t||f.recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,"undefined"==typeof e)throw new TypeError("Invalid argument. undefined 'sockets' argument");e instanceof Array||(e=[e]),e.forEach(function(e){if(!u.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:f.SOCKET_STATUS_READY})},this),Object.defineProperties(this,{via_transport:{get:function(){return this.socket.via_transport}},url:{get:function(){return this.socket.url}},sip_uri:{get:function(){return this.socket.sip_uri}}}),l.call(this)}function i(){this.recover_attempts=0,this.status=f.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}function o(e,t,n){this.status=f.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),this.close_requested||(e&&(this.socket.status=f.SOCKET_STATUS_ERROR),a.call(this,e))}function s(e){if("\r\n"===e)return void c("received message with CRLF Keep Alive response");if("string"!=typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(t){return void c("received binary message failed to be converted into string, message discarded")}c("received binary message:\n\n"+e+"\n")}else c("received text message:\n\n"+e+"\n");this.ondata({transport:this,message:e})}function a(){var e,t=this;this.recover_attempts+=1,e=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1),e<this.recovery_options.min_interval?e=this.recovery_options.min_interval:e>this.recovery_options.max_interval&&(e=this.recovery_options.max_interval),c("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+e+" seconds"),this.recovery_timer=setTimeout(function(){t.close_requested||t.isConnected()||t.isConnecting()||(l.call(t),t.connect())},1e3*e)}function l(){var e=[];if(this.sockets.forEach(function(t){t.status!==f.SOCKET_STATUS_ERROR&&(0===e.length?e.push(t):t.weight>e[0].weight?e=[t]:t.weight===e[0].weight&&e.push(t))}),0===e.length)return this.sockets.forEach(function(e){e.status=f.SOCKET_STATUS_READY}),void l.call(this);var t=Math.floor(Math.random()*e.length);this.socket=e[t].socket}t.exports=r;var u=e("./Socket"),c=e("debug")("PlivoSIP:Transport"),d=e("debug")("PlivoSIP:ERROR:Transport"),f={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};r.prototype.connect=function(){return c("connect()"),this.isConnected()?void c("Transport is already connected"):this.isConnecting()?void c("Transport is connecting"):(this.close_requested=!1,this.status=f.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),void(this.close_requested||(this.socket.onconnect=i.bind(this),this.socket.ondisconnect=o.bind(this),this.socket.ondata=s.bind(this),this.socket.connect())))},r.prototype.disconnect=function(){c("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=f.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect()},r.prototype.send=function(e){if(c("send()"),!this.isConnected())return d("unable to send message, transport is not connected"),!1;var t=e.toString();return c("sending message:\n\n"+t+"\n"),this.socket.send(t)},r.prototype.isConnected=function(){return this.status===f.STATUS_CONNECTED},r.prototype.isConnecting=function(){return this.status===f.STATUS_CONNECTING}},{"./Socket":53,debug:12}],57:[function(e,t,n){function r(e){if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=l.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.closeTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===e)throw new TypeError("Not enough arguments");try{this.loadConfig(e)}catch(t){throw this.status=l.STATUS_NOT_READY,this.error=l.CONFIGURATION_ERROR,t}this._registrator=new p(this),c.EventEmitter.call(this)}function i(e){this.emit("connecting",e)}function o(e){this.status!==l.STATUS_USER_CLOSED&&(this.status=l.STATUS_READY,this.error=null,this.emit("connected",e),this.dynConfiguration.register&&this._registrator.register())}function s(e){var t,n,r,i=["nict","ict","nist","ist"];for(r=i.length,t=0;t<r;t++)for(n in this.transactions[i[t]])this.transactions[i[t]][n].onTransportError();this.emit("disconnected",e),this._registrator.onTransportClosed(),this.status!==l.STATUS_USER_CLOSED&&(this.status=l.STATUS_NOT_READY,this.error=l.NETWORK_ERROR)}function a(e){var t,n=e.transport,i=e.message;if(i=w.parseMessage(i,this),i&&!(this.status===r.C.STATUS_USER_CLOSED&&i instanceof E.IncomingRequest)&&k(i,this,n))if(i instanceof E.IncomingRequest)i.transport=n,this.receiveRequest(i);else if(i instanceof E.IncomingResponse)switch(i.method){case h.INVITE:t=this.transactions.ict[i.via_branch],t&&t.receiveResponse(i);break;case h.ACK:break;default:t=this.transactions.nict[i.via_branch],t&&t.receiveResponse(i)}}t.exports=r;var l={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};r.C=l;var u=e("util"),c=e("events"),d=e("debug")("PlivoSIP:UA"),f=e("debug")("PlivoSIP:ERROR:UA");f.log=console.warn.bind(console);var h=e("./Constants"),p=e("./Registrator"),v=e("./RTCSession"),g=e("./Message"),m=e("./Transactions"),y=e("./Transport"),b=e("./Socket"),_=e("./Utils"),S=e("./Exceptions"),T=e("./URI"),C=e("./Grammar"),w=e("./Parser"),E=e("./SIPMessage"),k=e("./sanityCheck");u.inherits(r,c.EventEmitter),r.prototype.start=function(){d("start()"),this.status===l.STATUS_INIT?this.transport.connect():this.status===l.STATUS_USER_CLOSED?(d("restarting UA"),null!==this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null,this.transport.disconnect()),this.status=l.STATUS_INIT,this.transport.connect()):d(this.status===l.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},r.prototype.register=function(){d("register()"),this.dynConfiguration.register=!0,this._registrator.register()},r.prototype.unregister=function(e){d("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(e)},r.prototype.registrator=function(){return this._registrator},r.prototype.isRegistered=function(){return!!this._registrator.registered},r.prototype.isConnected=function(){return this.transport.isConnected()},r.prototype.call=function(e,t){d("call()");var n;return n=new v(this),n.connect(e,t),n},r.prototype.sendMessage=function(e,t,n){d("sendMessage()");var r;return r=new g(this),r.send(e,t,n),r},r.prototype.terminateSessions=function(e){d("terminateSessions()");for(var t in this.sessions)this.sessions[t].isEnded()||this.sessions[t].terminate(e)},r.prototype.stop=function(){d("stop()");var e,t,n,r=this;if(this.dynConfiguration={},this.status===l.STATUS_USER_CLOSED)return void d("UA already closed");this._registrator.close(),n=Object.keys(this.sessions).length;for(e in this.sessions){d("closing session "+e);try{this.sessions[e].terminate()}catch(i){}}for(t in this.applicants)try{this.applicants[t].close()}catch(i){}this.status=l.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===this.ictTransactionsCount&&0===this.istTransactionsCount&&0===n?r.transport.disconnect():this.closeTimer=setTimeout(function(){r.closeTimer=null,r.transport.disconnect()},2e3)},r.prototype.normalizeTarget=function(e){return _.normalizeTarget(e,this.configuration.hostport_params)},r.prototype.get=function(e){switch(e){case"realm":return this.configuration.realm;case"ha1":return this.configuration.ha1;default:return void f('get() | cannot get "%s" parameter in runtime',e)}return!0},r.prototype.set=function(e,t){switch(e){case"password":this.configuration.password=String(t);break;case"realm":this.configuration.realm=String(t);break;case"ha1":this.configuration.ha1=String(t),this.configuration.password=null;break;case"display_name":if(C.parse('"'+t+'"',"display_name")===-1)return f('set() | wrong "display_name"'),!1;this.configuration.display_name=t;break;default:return f('set() | cannot set "%s" parameter in runtime',e),!1}return!0},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.newMessage=function(e){this.emit("newMessage",e)},r.prototype.newRTCSession=function(e){this.emit("newRTCSession",e)},r.prototype.registered=function(e){this.emit("registered",e)},r.prototype.unregistered=function(e){this.emit("unregistered",e)},r.prototype.registrationFailed=function(e){this.emit("registrationFailed",e)},r.prototype.receiveRequest=function(e){var t,n,r,i,o=e.method;if(e.ruri.user!==this.configuration.uri.user&&e.ruri.user!==this.contact.uri.user)return d("Request-URI does not point to us"),void(e.method!==h.ACK&&e.reply_sl(404));if(e.ruri.scheme===h.SIPS)return void e.reply_sl(416);if(!m.checkTransaction(this,e)){if(o===h.INVITE?new m.InviteServerTransaction(e,this):o!==h.ACK&&o!==h.CANCEL&&new m.NonInviteServerTransaction(e,this),o===h.OPTIONS)e.reply(200);else if(o===h.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);r=new g(this),r.init_incoming(e)}else if(o===h.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);if(e.to_tag)t=this.findDialog(e.call_id,e.from_tag,e.to_tag),t?t.receiveRequest(e):o===h.NOTIFY?(n=this.findSession(e),n?n.receiveRequest(e):(d("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist"))):o!==h.ACK&&e.reply(481);else switch(o){case h.INVITE:window.RTCPeerConnection?e.hasHeader("replaces")?(i=e.replaces,t=this.findDialog(i.call_id,i.from_tag,i.to_tag),t?(n=t.owner,n.isEnded()?e.reply(603):n.receiveRequest(e)):e.reply(481)):(n=new v(this),n.init_incoming(e)):(f("INVITE received but WebRTC is not supported"),e.reply(488));break;case h.BYE:e.reply(481);break;case h.CANCEL:n=this.findSession(e),n?n.receiveRequest(e):d("received CANCEL request for a non existent session");break;case h.ACK:break;default:e.reply(405)}}},r.prototype.findSession=function(e){var t=e.call_id+e.from_tag,n=this.sessions[t],r=e.call_id+e.to_tag,i=this.sessions[r];return n?n:i?i:null},r.prototype.findDialog=function(e,t,n){var r=e+t+n,i=this.dialogs[r];return i?i:(r=e+n+t,i=this.dialogs[r],i?i:null)},r.prototype.loadConfig=function(e){var t,n,l,u,c,h={via_host:_.createRandomToken(12)+".invalid",contact_uri:null,password:null,realm:null,ha1:null,register_expires:600,register:!0,registrar_server:null,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0};for(t in r.configuration_check.mandatory){if(!e.hasOwnProperty(t))throw new S.ConfigurationError(t);if(n=e[t],l=r.configuration_check.mandatory[t].call(this,n),void 0===l)throw new S.ConfigurationError(t,n);h[t]=l}for(t in r.configuration_check.optional)if(e.hasOwnProperty(t)){if(n=e[t],_.isEmpty(n))continue;if(l=r.configuration_check.optional[t].call(this,n,e),void 0===l)throw new S.ConfigurationError(t,n);h[t]=l}0===h.display_name&&(h.display_name="0"),h.instance_id||(h.instance_id=_.newUUID()),h.plivosip_id=_.createRandomToken(5),u=h.uri.clone(),u.user=null,h.hostport_params=u.toString().replace(/^sip:/i,"");var p=[];if(h.sockets&&Array.isArray(h.sockets)&&(p=p.concat(h.sockets)),0===p.length)throw new S.ConfigurationError("sockets");try{this.transport=new y(p,{max_interval:h.connection_recovery_max_interval,min_interval:h.connection_recovery_min_interval}),this.transport.onconnecting=i.bind(this),this.transport.onconnect=o.bind(this),this.transport.ondisconnect=s.bind(this),this.transport.ondata=a.bind(this),delete h.connection_recovery_max_interval,delete h.connection_recovery_min_interval,delete h.sockets}catch(v){throw f(v),new S.ConfigurationError("sockets",p)}h.authorization_user||(h.authorization_user=h.uri.user),h.registrar_server||(c=h.uri.clone(),c.user=null,c.clearParams(),c.clearHeaders(),h.registrar_server=c),h.no_answer_timeout=1e3*h.no_answer_timeout,h.contact_uri?h.via_host=h.contact_uri.host:h.contact_uri=new T("sip",_.createRandomToken(8),h.via_host,null,{transport:"ws"}),this.contact={pub_gruu:null,temp_gruu:null,uri:h.contact_uri,toString:function(e){e=e||{};var t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};for(t in h)r.configuration_skeleton[t].value=h[t];Object.defineProperties(this.configuration,r.configuration_skeleton);for(t in h)r.configuration_skeleton[t].value="";for(t in h)switch(t){case"uri":case"registrar_server":d("- "+t+": "+h[t]);break;case"password":case"ha1":d("- "+t+": NOT SHOWN");break;default:d("- "+t+": "+JSON.stringify(h[t]))}},r.configuration_skeleton=function(){var e,t,n,r={},i=["plivosip_id","hostport_params","uri","authorization_user","contact_uri","display_name","instance_id","no_answer_timeout","session_timers","password","realm","ha1","register_expires","registrar_server","sockets","use_preloaded_route","via_core_value","via_host"],o=["password","realm","ha1","display_name"];for(e in i)t=i[e],n=o.indexOf(t)!==-1,r[t]={value:"",writable:n,configurable:!1};return r.register={value:"",writable:!0,configurable:!1},r}(),r.configuration_check={mandatory:{uri:function(e){var t;return/^sip:/i.test(e)||(e=h.SIP+":"+e),t=T.parse(e),t&&t.user?t:void 0}},optional:{authorization_user:function(e){return C.parse('"'+e+'"',"quoted_string")===-1?void 0:e},connection_recovery_max_interval:function(e){var t;if(_.isDecimal(e)&&(t=Number(e),t>0))return t},connection_recovery_min_interval:function(e){var t;if(_.isDecimal(e)&&(t=Number(e),t>0))return t},contact_uri:function(e){if("string"==typeof e){var t=C.parse(e,"SIP_URI");if(t!==-1)return t}},display_name:function(e){return C.parse('"'+e+'"',"display_name")===-1?void 0:e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),C.parse(e,"uuid")===-1?void 0:e},no_answer_timeout:function(e){var t;if(_.isDecimal(e)&&(t=Number(e),t>0))return t},session_timers:function(e){if("boolean"==typeof e)return e},password:function(e){return String(e)},realm:function(e){return String(e)},ha1:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){var t;if(_.isDecimal(e)&&(t=Number(e),t>0))return t},registrar_server:function(e){var t;return/^sip:/i.test(e)||(e=h.SIP+":"+e),t=T.parse(e),t?t.user?void 0:t:void 0},sockets:function(e){var t,n;if(b.isSocket(e))e=[{socket:e}];else{if(!Array.isArray(e)||!e.length)return;for(n=e.length,t=0;t<n;t++)b.isSocket(e[t])&&(e[t]={socket:e[t]})}return e},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}}},{"./Constants":35,"./Exceptions":39,"./Grammar":40,"./Message":42,"./Parser":44,"./RTCSession":45,"./Registrator":50,"./SIPMessage":52,"./Socket":53,"./Transactions":55,"./Transport":56,"./URI":58,"./Utils":59,"./sanityCheck":61,debug:12,events:11,util:23}],58:[function(e,t,n){function r(e,t,n,r,o,s){var a,l;if(!n)throw new TypeError('missing or invalid "host" parameter');e=e||i.SIP,this.parameters={},this.headers={};for(a in o)this.setParam(a,o[a]);for(l in s)this.setHeader(l,s[l]);Object.defineProperties(this,{scheme:{get:function(){return e},set:function(t){e=t.toLowerCase()}},user:{get:function(){return t},set:function(e){t=e}},host:{get:function(){return n},set:function(e){n=e.toLowerCase()}},port:{get:function(){return r},set:function(e){r=0===e?e:parseInt(e,10)||null}}})}t.exports=r;var i=e("./Constants"),o=e("./Utils"),s=e("./Grammar");r.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof t||null===t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(e,t){this.headers[o.headerize(e)]=Array.isArray(t)?t:[t]},getHeader:function(e){if(e)return this.headers[o.headerize(e)]},hasHeader:function(e){if(e)return this.headers.hasOwnProperty(o.headerize(e))&&!0||!1},deleteHeader:function(e){var t;if(e=o.headerize(e),this.headers.hasOwnProperty(e))return t=this.headers[e],delete this.headers[e],t},clearHeaders:function(){this.headers={}},clone:function(){return new r(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var e,t,n,r,i=[];r=this.scheme+":",this.user&&(r+=o.escapeUser(this.user)+"@"),r+=this.host,(this.port||0===this.port)&&(r+=":"+this.port);for(t in this.parameters)r+=";"+t,null!==this.parameters[t]&&(r+="="+this.parameters[t]);for(e in this.headers)for(n=0;n<this.headers[e].length;n++)i.push(e+"="+this.headers[e][n]);return i.length>0&&(r+="?"+i.join("&")),r},toAor:function(e){var t;return t=this.scheme+":",this.user&&(t+=o.escapeUser(this.user)+"@"),t+=this.host,e&&(this.port||0===this.port)&&(t+=":"+this.port),t}},r.parse=function(e){return e=s.parse(e,"SIP_URI"),e!==-1?e:void 0}},{"./Constants":35,"./Grammar":40,"./Utils":59}],59:[function(e,t,n){var r={};t.exports=r;var i=e("./Constants"),o=e("./URI"),s=e("./Grammar");r.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length},r.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},r.isString=function(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)},r.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},r.isEmpty=function(e){if(null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e))return!0},r.hasMethods=function(e){for(var t,n=1;t=arguments[n++];)if(this.isFunction(e[t]))return!1;return!0},r.createRandomToken=function(e,t){var n,r,i="";for(t=t||32,n=0;n<e;n++)r=Math.random()*t|0,i+=r.toString(t);return i},r.newTag=function(){return r.createRandomToken(10)},r.newUUID=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return e},r.hostType=function(e){if(e)return e=s.parse(e,"host"),e!==-1?e.host_type:void 0},r.normalizeTarget=function(e,t){var n,s,a,l;if(e){if(e instanceof o)return e;if("string"==typeof e){switch(s=e.split("@"),s.length){case 1:if(!t)return;a=e,l=t;break;case 2:a=s[0],l=s[1];break;default:a=s.slice(0,s.length-1).join("@"),l=s[s.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),e=i.SIP+":"+r.escapeUser(a)+"@"+l,(n=o.parse(e))?n:void 0}}else;},r.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},r.headerize=function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",o=r.length;for(t=0;t<o;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},r.sipErrorCause=function(e){var t;for(t in i.SIP_ERROR_CAUSES)if(i.SIP_ERROR_CAUSES[t].indexOf(e)!==-1)return i.causes[t];return i.causes.SIP_FAILURE_CODE},r.getRandomTestNetIP=function(){function e(e,t){return Math.floor(Math.random()*(t-e+1)+e)}return"192.0.2."+e(1,254)},r.calculateMD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,o,s;return i=2147483648&e,o=2147483648&t,n=1073741824&e,r=1073741824&t,s=(1073741823&e)+(1073741823&t),n&r?2147483648^s^i^o:n|r?1073741824&s?3221225472^s^i^o:1073741824^s^i^o:s^i^o;
}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function o(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function a(e,i,o,s,a,l,u){return e=n(e,n(n(r(i,o,s),a),u)),n(t(e,l),i)}function l(e,r,o,s,a,l,u){return e=n(e,n(n(i(r,o,s),a),u)),n(t(e,l),r)}function u(e,r,i,s,a,l,u){return e=n(e,n(n(o(r,i,s),a),u)),n(t(e,l),r)}function c(e,r,i,o,a,l,u){return e=n(e,n(n(s(r,i,o),a),u)),n(t(e,l),r)}function d(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,o=16*(i+1),s=new Array(o-1),a=0,l=0;l<n;)t=(l-l%4)/4,a=l%4*8,s[t]=s[t]|e.charCodeAt(l)<<a,l++;return t=(l-l%4)/4,a=l%4*8,s[t]=s[t]|128<<a,s[o-2]=n<<3,s[o-1]=n>>>29,s}function f(e){var t,n,r="",i="";for(n=0;n<=3;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r}function h(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var p,v,g,m,y,b,_,S,T,C=[],w=7,E=12,k=17,R=22,I=5,P=9,A=14,O=20,M=4,D=11,x=16,N=23,F=6,U=10,j=15,L=21;for(e=h(e),C=d(e),b=1732584193,_=4023233417,S=2562383102,T=271733878,p=0;p<C.length;p+=16)v=b,g=_,m=S,y=T,b=a(b,_,S,T,C[p+0],w,3614090360),T=a(T,b,_,S,C[p+1],E,3905402710),S=a(S,T,b,_,C[p+2],k,606105819),_=a(_,S,T,b,C[p+3],R,3250441966),b=a(b,_,S,T,C[p+4],w,4118548399),T=a(T,b,_,S,C[p+5],E,1200080426),S=a(S,T,b,_,C[p+6],k,2821735955),_=a(_,S,T,b,C[p+7],R,4249261313),b=a(b,_,S,T,C[p+8],w,1770035416),T=a(T,b,_,S,C[p+9],E,2336552879),S=a(S,T,b,_,C[p+10],k,4294925233),_=a(_,S,T,b,C[p+11],R,2304563134),b=a(b,_,S,T,C[p+12],w,1804603682),T=a(T,b,_,S,C[p+13],E,4254626195),S=a(S,T,b,_,C[p+14],k,2792965006),_=a(_,S,T,b,C[p+15],R,1236535329),b=l(b,_,S,T,C[p+1],I,4129170786),T=l(T,b,_,S,C[p+6],P,3225465664),S=l(S,T,b,_,C[p+11],A,643717713),_=l(_,S,T,b,C[p+0],O,3921069994),b=l(b,_,S,T,C[p+5],I,3593408605),T=l(T,b,_,S,C[p+10],P,38016083),S=l(S,T,b,_,C[p+15],A,3634488961),_=l(_,S,T,b,C[p+4],O,3889429448),b=l(b,_,S,T,C[p+9],I,568446438),T=l(T,b,_,S,C[p+14],P,3275163606),S=l(S,T,b,_,C[p+3],A,4107603335),_=l(_,S,T,b,C[p+8],O,1163531501),b=l(b,_,S,T,C[p+13],I,2850285829),T=l(T,b,_,S,C[p+2],P,4243563512),S=l(S,T,b,_,C[p+7],A,1735328473),_=l(_,S,T,b,C[p+12],O,2368359562),b=u(b,_,S,T,C[p+5],M,4294588738),T=u(T,b,_,S,C[p+8],D,2272392833),S=u(S,T,b,_,C[p+11],x,1839030562),_=u(_,S,T,b,C[p+14],N,4259657740),b=u(b,_,S,T,C[p+1],M,2763975236),T=u(T,b,_,S,C[p+4],D,1272893353),S=u(S,T,b,_,C[p+7],x,4139469664),_=u(_,S,T,b,C[p+10],N,3200236656),b=u(b,_,S,T,C[p+13],M,681279174),T=u(T,b,_,S,C[p+0],D,3936430074),S=u(S,T,b,_,C[p+3],x,3572445317),_=u(_,S,T,b,C[p+6],N,76029189),b=u(b,_,S,T,C[p+9],M,3654602809),T=u(T,b,_,S,C[p+12],D,3873151461),S=u(S,T,b,_,C[p+15],x,530742520),_=u(_,S,T,b,C[p+2],N,3299628645),b=c(b,_,S,T,C[p+0],F,4096336452),T=c(T,b,_,S,C[p+7],U,1126891415),S=c(S,T,b,_,C[p+14],j,2878612391),_=c(_,S,T,b,C[p+5],L,4237533241),b=c(b,_,S,T,C[p+12],F,1700485571),T=c(T,b,_,S,C[p+3],U,2399980690),S=c(S,T,b,_,C[p+10],j,4293915773),_=c(_,S,T,b,C[p+1],L,2240044497),b=c(b,_,S,T,C[p+8],F,1873313359),T=c(T,b,_,S,C[p+15],U,4264355552),S=c(S,T,b,_,C[p+6],j,2734768916),_=c(_,S,T,b,C[p+13],L,1309151649),b=c(b,_,S,T,C[p+4],F,4149444226),T=c(T,b,_,S,C[p+11],U,3174756917),S=c(S,T,b,_,C[p+2],j,718787259),_=c(_,S,T,b,C[p+9],L,3951481745),b=n(b,v),_=n(_,g),S=n(S,m),T=n(T,y);var H=f(b)+f(_)+f(S)+f(T);return H.toLowerCase()},r.closeMediaStream=function(e){if(e)try{var t,n,r;if(e.getTracks)for(t=e.getTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();else{for(t=e.getAudioTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop();for(t=e.getVideoTracks(),n=0,r=t.length;n<r;n+=1)t[n].stop()}}catch(i){"function"!=typeof e.stop&&"object"!=typeof e.stop||e.stop()}}},{"./Constants":35,"./Grammar":40,"./URI":58}],60:[function(e,t,n){function r(e){u('new() [url:"%s"]',e);var t=null,n=null;this.ws=null,Object.defineProperties(this,{via_transport:{get:function(){return n},set:function(e){n=e.toUpperCase()}},sip_uri:{get:function(){return t}},url:{get:function(){return e}}});var r=l.parse(e,"absoluteURI");if(r===-1)throw c("invalid WebSocket URI: "+e),new TypeError("Invalid argument: "+e);if("wss"!==r.scheme&&"ws"!==r.scheme)throw c("invalid WebSocket URI scheme: "+r.scheme),new TypeError("Invalid argument: "+e);t="sip:"+r.host+(r.port?":"+r.port:"")+";transport=ws",this.via_transport=r.scheme}function i(){u("WebSocket "+this.url+" connected"),this.onconnect()}function o(e){u("WebSocket "+this.url+" closed"),e.wasClean===!1&&u("WebSocket abrupt disconnection"),this.ondisconnect(e.wasClean,e.code,e.reason)}function s(e){u("received WebSocket message"),this.ondata(e.data)}function a(e){c("WebSocket "+this.url+" error: "+e)}t.exports=r;var l=e("./Grammar"),u=e("debug")("PlivoSIP:WebSocketInterface"),c=e("debug")("PlivoSIP:ERROR:WebSocketInterface");c.log=console.warn.bind(console),r.prototype.connect=function(){if(u("connect()"),this.isConnected())return void u("WebSocket "+this.url+" is already connected");if(this.isConnecting())return void u("WebSocket "+this.url+" is connecting");this.ws&&this.disconnect(),u("connecting to WebSocket "+this.url);try{this.ws=new WebSocket(this.url,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=i.bind(this),this.ws.onclose=o.bind(this),this.ws.onmessage=s.bind(this),this.ws.onerror=a.bind(this)}catch(e){a.call(this,e)}},r.prototype.disconnect=function(){u("disconnect()"),this.ws&&(this.ws.onopen=function(){},this.ws.onclose=function(){},this.ws.onmessage=function(){},this.ws.onerror=function(){},this.ws.close(),this.ws=null)},r.prototype.send=function(e){return u("send()"),this.isConnected()?(this.ws.send(e),!0):(c("unable to send message, WebSocket is not open"),!1)},r.prototype.isConnected=function(){return this.ws&&this.ws.readyState===this.ws.OPEN},r.prototype.isConnecting=function(){return this.ws&&this.ws.readyState===this.ws.CONNECTING}},{"./Grammar":40,debug:12}],61:[function(e,t,n){function r(e,t,n){var r,i;for(f=e,h=t,p=n,r=S.length;r--;)if(i=S[r](f),i===!1)return!1;if(f instanceof m.IncomingRequest){for(r=b.length;r--;)if(i=b[r](f),i===!1)return!1}else if(f instanceof m.IncomingResponse)for(r=_.length;r--;)if(i=_[r](f),i===!1)return!1;return!0}function i(){if("sip"!==f.s("to").uri.scheme)return d(416),!1}function o(){if(!f.to_tag&&f.call_id.substr(0,5)===h.configuration.plivosip_id)return d(482),!1}function s(){var e=y.str_utf8_length(f.body),t=f.getHeader("content-length");if(e<t)return d(400),!1}function a(){var e,t,n=f.from_tag,r=f.call_id,i=f.cseq;if(!f.to_tag)if(f.method===g.INVITE){if(h.transactions.ist[f.via_branch])return!1;for(t in h.transactions.ist)if(e=h.transactions.ist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return d(482),!1}else{if(h.transactions.nist[f.via_branch])return!1;for(t in h.transactions.nist)if(e=h.transactions.nist[t],e.request.from_tag===n&&e.request.call_id===r&&e.request.cseq===i)return d(482),!1}}function l(){if(f.getHeaders("via").length>1)return v("more than one Via header field present in the response, dropping the response"),!1}function u(){var e=y.str_utf8_length(f.body),t=f.getHeader("content-length");if(e<t)return v("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function c(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!f.hasHeader(e[t]))return v("missing mandatory header field : "+e[t]+", dropping the response"),!1}function d(e){var t,n="SIP/2.0 "+e+" "+g.REASON_PHRASE[e]+"\r\n",r=f.getHeaders("via"),i=r.length,o=0;for(o;o<i;o++)n+="Via: "+r[o]+"\r\n";t=f.getHeader("To"),f.to_tag||(t+=";tag="+y.newTag()),n+="To: "+t+"\r\n",n+="From: "+f.getHeader("From")+"\r\n",n+="Call-ID: "+f.call_id+"\r\n",n+="CSeq: "+f.cseq+" "+f.method+"\r\n",n+="\r\n",p.send(n)}t.exports=r;var f,h,p,v=e("debug")("PlivoSIP:sanityCheck"),g=e("./Constants"),m=e("./SIPMessage"),y=e("./Utils"),b=[],_=[],S=[];b.push(i),b.push(o),b.push(s),b.push(a),_.push(l),_.push(u),S.push(c)},{"./Constants":35,"./SIPMessage":52,"./Utils":59,debug:12}]},{},[1]);return t(e)}();!function(){function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){return i(t[s][1][e]||e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(e,t,n){(function(e,r){!function(e){if("object"==typeof n&&void 0!==t)t.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i;"undefined"!=typeof window?i=window:void 0!==r?i=r:"undefined"!=typeof self&&(i=self),i.Promise=e()}}(function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof _dereq_&&_dereq_;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){"use strict";function r(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new c(16),this._normalQueue=new c(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=u}function i(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function o(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var a;try{throw new Error}catch(l){a=l}var u=e("./schedule"),c=e("./queue"),d=e("./util");r.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},r.prototype.hasCustomScheduler=function(){return this._customScheduler},r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(e,t){t?(l.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),l.exit(2)):this.throwLater(e)},r.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(r.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?i.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},r.prototype.invoke=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},r.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=s),r.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},t.exports=r,t.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var u=n(o),c=new e(t);c._propagateFrom(this,1);var d=this._target();if(c._setBoundTo(u),u instanceof e){var f={promiseRejectionQueued:!1,promise:c,target:d,bindingPromise:u};d._then(t,s,void 0,c,f),u._then(a,l,void 0,c,f),c._setOnCancel(u)}else c._resolveCallback(d);return c},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+a.classString(e)+" has no method '"+a.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util"),l=a.canEvaluate;a.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t,n="number"==typeof e;if(n)t=o;else if(l){var r=s(e);t=null!==r?r:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,l=t._async;t.prototype["break"]=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=s(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),l.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){function n(e,n,a){return function(l){var u=a._boundValue();e:for(var c=0;c<e.length;++c){var d=e[c];if(d===Error||null!=d&&d.prototype instanceof Error){if(l instanceof d)return o(n).call(u,l)}else if("function"==typeof d){var f=o(d).call(u,l);if(f===s)return f;if(f)return o(n).call(u,l)}else if(r.isObject(l)){for(var h=i(d),p=0;p<h.length;++p){var v=h[p];if(d[v]!=l[v])continue e}return o(n).call(u,l)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,s=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,l=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=l,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(t,n,r){"use strict";n.exports=function(n,r){function i(e,t){return{promise:t}}function o(){return!1}function s(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+L.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?L.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function l(){return this._onCancelField}function u(e){this._onCancelField=e}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function d(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var e=this._boundTo;return void 0!==e&&e instanceof n?e.isFulfilled()?e.value():void 0:e}function p(){this._trace=new M(this._peekContext())}function v(e,t){if(H(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=w(e);L.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),L.notEnumerableProp(e,"__stackCleaned__",!0)}}}function g(e,t,n,r,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),l=T(a),u=l.length-1;u>=0;--u){var c=l[u];if(!q.test(c)){var d=c.match(G);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(l.length>0)for(var f=l[0],u=0;u<a.length;++u)if(a[u]===f){u>0&&(s="\n"+a[u-1]);break}}var h="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(h,!0,t)}}function m(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),y(n)}function y(e,t,r){if(se.warnings){var i,o=new j(e);if(t)r._attachExtraTrace(o);else if(se.longStackTraces&&(i=n._peekContext()))i.attachExtraTrace(o);else{var s=w(o);o.stack=s.message+"\n"+s.stack.join("\n")}te("warning",o)||E(o,"",!0)}}function b(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function _(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function S(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(var a=s;a>=0;--a){var l=r[a];if(t[i]!==l)break;t.pop(),i--}t=r}}function T(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||W.test(r),o=i&&re(r);i&&!o&&(z&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||W.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function w(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:T(t)}}function E(e,t,n){if("undefined"!=typeof console){var r;if(L.isObject(e)){var i=e.stack;r=t+V(i,e)}else r=t+String(e);"function"==typeof N?N(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function k(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){U.throwLater(e)}"unhandledRejection"===e?te(e,n,r)||i||E(n,"Unhandled rejection "):te(e,r)}function R(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():L.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+I(t)+">, no stack trace)"}function I(e){return e.length<41?e:e.substr(0,38)+"..."}function P(){return"function"==typeof oe}function A(e){var t=e.match(ie);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function O(e,t){if(P()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,l=0;l<i.length;++l){var u=A(i[l]);if(u){n=u.fileName,s=u.line;break}}for(var l=0;l<o.length;++l){var u=A(o[l]);if(u){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(re=function(e){if(B.test(e))return!0;var t=A(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}}function M(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);oe(this,M),t>32&&this.uncycle()}var D,x,N,F=n._getDomain,U=n._async,j=t("./errors").Warning,L=t("./util"),H=L.canAttachTrace,B=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,q=/\((?:timers\.js):\d+:\d+\)/,G=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,V=null,z=!1,K=!(0==L.env("BLUEBIRD_DEBUG")),J=!(0==L.env("BLUEBIRD_WARNINGS")||!K&&!L.env("BLUEBIRD_WARNINGS")),Q=!(0==L.env("BLUEBIRD_LONG_STACK_TRACES")||!K&&!L.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=L.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(J||!!L.env("BLUEBIRD_W_FORGOTTEN_RETURN"));n.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},n.prototype._notifyUnhandledRejectionIsHandled=function(){k("rejectionHandled",D,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),k("unhandledRejection",x,e,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(e,t,n){return y(e,t,n||this)},n.onPossiblyUnhandledRejection=function(e){var t=F();x="function"==typeof e?null===t?e:L.domainBind(t,e):void 0},n.onUnhandledRejectionHandled=function(e){var t=F();D="function"==typeof e?null===t?e:L.domainBind(t,e):void 0};var $=function(){};n.longStackTraces=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&P()){var e=n.prototype._captureStackTrace,t=n.prototype._attachExtraTrace;se.longStackTraces=!0,$=function(){if(U.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=e,n.prototype._attachExtraTrace=t,r.deactivateLongStackTraces(),U.enableTrampoline(),se.longStackTraces=!1},n.prototype._captureStackTrace=p,n.prototype._attachExtraTrace=v,r.activateLongStackTraces(),U.disableTrampolineIfNecessary()}},n.hasLongStackTraces=function(){return se.longStackTraces&&P()};var Y=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return L.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!L.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return L.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!L.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),L.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!L.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),Z=function(){return L.isNode?function(){return e.emit.apply(e,arguments)}:L.global?function(e){var t="on"+e.toLowerCase(),n=L.global[t];return!!n&&(n.apply(L.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),ee={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},te=function(e){var t=!1;try{t=Z.apply(null,arguments)}catch(e){U.throwLater(e),t=!0}var n=!1;try{n=Y(e,ee[e].apply(null,arguments))}catch(e){U.throwLater(e),n=!0}return n||t};n.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?n.longStackTraces():!e.longStackTraces&&n.hasLongStackTraces()&&$()),"warnings"in e){var t=e.warnings;se.warnings=!!t,X=se.warnings,L.isObject(t)&&"wForgottenReturn"in t&&(X=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(U.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=c,n.prototype._propagateFrom=d,n.prototype._onCancel=l,n.prototype._setOnCancel=u,n.prototype._attachCancellationCallback=a,n.prototype._execute=s,ne=d,se.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,n.prototype._fireEvent=te):!e.monitoring&&se.monitoring&&(se.monitoring=!1,n.prototype._fireEvent=o)),n},n.prototype._fireEvent=o,n.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(e){},n.prototype._attachCancellationCallback=function(e){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(e,t){};var ne=f,re=function(){return!1},ie=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;L.inherits(M,Error),r.CapturedTrace=M,M.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<e;++r){var s=t[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var l=r>0?t[r-1]:this;a<e-1?(l._parent=t[a+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var u=l._length+1,c=r-2;c>=0;--c)t[c]._length=u,u++;return}}}},M.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=w(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(T(i.stack.split("\n"))),i=i._parent;S(r),_(r),L.notEnumerableProp(e,"stack",b(n,r)),L.notEnumerableProp(e,"__stackCleaned__",!0)}};var oe=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():R(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=e,V=t;var n=Error.captureStackTrace;return re=function(e){return B.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,V=t,z=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(V=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?R(t):t.toString()},null):(W=e,V=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(N=function(e){console.warn(e)},L.isNode&&e.stderr.isTTY?N=function(e,t){var n=t?"\x1b[33m":"\x1b[31m";console.warn(n+e+"\x1b[0m\n")}:L.isNode||"string"!=typeof(new Error).stack||(N=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:J,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&n.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return ne},boundValueFunction:function(){return h},checkForgottenReturns:g,setBounds:O,warn:y,deprecated:m,CapturedTrace:M,fireDomEvent:Y,fireGlobalEvent:Z}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype["return"]=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;
e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){return this instanceof n?(d(this,"message","string"==typeof r?r:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this),void 0):new n(r)}return c(n,Error),n}function i(e){return this instanceof i?(d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),void 0):new i(e)}var o,s,a=e("./es5"),l=a.freeze,u=e("./util"),c=u.inherits,d=u.notEnumerableProp,f=r("Warning","warning"),h=r("CancellationError","cancellation error"),p=r("TimeoutError","timeout error"),v=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<g.length;++m)"function"==typeof Array.prototype[g[m]]&&(v.prototype[g[m]]=Array.prototype[g[m]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];r=i.join("\n"),t+=r+"\n"}return y--,t},c(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=l({CancellationError:h,TimeoutError:p,OperationalError:i,RejectionError:i,AggregateError:v}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},l=function(e,t){return{value:e[t]}},u=function(e,t,n){return e[t]=n.value,e},c=function(e){return e},d=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},f=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:f,keys:a,names:a,defineProperty:u,getDescriptor:l,freeze:c,getPrototypeOf:d,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function s(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function a(){return u.call(this,this.promise._target()._settledValue())}function l(e){if(!s(this,e))return f.e=e,f}function u(e){var i=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(i._boundValue()):u.call(i._boundValue(),e);if(c===r)return c;if(void 0!==c){i._setReturnedNonUndefined();var h=n(c,i);if(h instanceof t){if(null!=this.cancelPromise){if(h._isCancelled()){var p=new d("late cancellation observer");return i._attachExtraTrace(p),f.e=p,f}h.isPending()&&h._attachCancellationCallback(new o(this))}return h._then(a,l,void 0,this,void 0)}}}return i.isRejected()?(s(this),f.e=e,f):(s(this),e)}var c=e("./util"),d=t.CancellationError,f=c.errorObj,h=e("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){s(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,u);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var s=arguments[r];if(!c.isObject(s))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+c.classString(s)));i[o++]=s}i.length=o;var a=arguments[r];return this._passThrough(h(i,a,this),1,void 0,u)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=h(n[o])(e);if(r._popContext(),s===f){r._pushContext();var a=t.reject(f.e);return r._popContext(),a}var l=i(s,r);if(l instanceof t)return l}return null}function l(e,n,i,o){if(s.cancellation()){var a=new t(r),l=this._finallyPromise=new t(r);this._promise=a.lastly(function(){return l}),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}var u=e("./errors"),c=u.TypeError,d=e("./util"),f=d.errorObj,h=d.tryCatch,p=[];d.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,n=void 0!==this._generator["return"];if(n)this._promise._pushContext(),e=h(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var r=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),e=h(this._generator["throw"]).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator["throw"]).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var n=this._promise;if(e===f)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof t)&&null===(o=a(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=l,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r((void 0),(void 0),n,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new c("expecting a function but got "+d.classString(e));p.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new l(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj,t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var r}var i=[].slice.call(arguments);e&&i.pop();var r=new n(i).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=u();this._callback=null===i?t:c.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function l(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+c.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+c.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,n,s,o).promise()}var u=t._getDomain,c=e("./util"),d=c.tryCatch,f=c.errorObj,h=t._async;c.inherits(a,n),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(n<0){if(n=-1*n-1,r[n]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return r[n]=e,this._queue.push(n),!1;null!==a&&(a[n]=e);var u=this._promise,c=this._callback,h=u._boundValue();u._pushContext();var p=d(c).call(h,e,n,o),v=u._popContext();if(s.checkForgottenReturns(p,v,null!==a?"Promise.filter":"Promise.map",u),p===f)return this._reject(p.e),!0;var g=i(p,this._promise);if(g instanceof t){g=g._target();var m=g._bitField;if(0==(50397184&m))return l>=1&&this._inFlight++,r[n]=g,g._proxy(this,-1*(n+1)),!1;if(0==(33554432&m))return 0!=(16777216&m)?(this._reject(g._reason()),!0):(this._cancel(),!0);p=g._value()}r[n]=p}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return l(this,e,t,null)},t.map=function(e,t,n,r){return l(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=a(e).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t["try"]=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];l=s.isArray(u)?a(e).apply(c,u):a(e).call(c,u)}else l=a(e)();var d=r._popContext();return o.checkForgottenReturns(l,d,"Promise.try",r),r._resolveFromSyncValue(l),r},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&c.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){t=new u(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=c.keys(e),i=0;i<n.length;++i){var o=n[i];d.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(a(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(r);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,l=e("./errors"),u=l.OperationalError,c=e("./es5"),d=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=a(t).apply(n._boundValue(),[null].concat(e));i===l&&s.throwLater(i.e)}function r(e,t){var n=this,r=n._boundValue(),i=void 0===e?a(t).call(r,null):a(t).call(r,null,e);i===l&&s.throwLater(i.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=a(t).call(n._boundValue(),e);i===l&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,l=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(t,n,r){"use strict";n.exports=function(){function r(){}function i(e,t){if(null==e||e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new b("expecting a function but got "+p.classString(t))}function o(e){e!==S&&i(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function s(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function l(e){var t=new o(S);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u,c=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},d=function(){return new o.PromiseInspection(this._target())},f=function(e){return o.reject(new b(e))},h={},p=t("./util");u=p.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},p.notEnumerableProp(o,"_getDomain",u);var v=t("./es5"),g=t("./async"),m=new g;v.defineProperty(o,"_async",{value:m});var y=t("./errors"),b=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var _=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var S=function(){},T={},C={},w=t("./thenables")(o,S),E=t("./promise_array")(o,S,w,f,r),k=t("./context")(o),R=k.create,I=t("./debuggability")(o,k),P=(I.CapturedTrace,t("./finally")(o,w,C)),A=t("./catch_filter")(C),O=t("./nodeback"),M=p.errorObj,D=p.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype["catch"]=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!p.isObject(o))return f("Catch statement predicate: expecting an object but got "+p.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,A(r,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(d,d,void 0,this,void 0)},o.prototype.then=function(e,t){if(I.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+p.classString(e);arguments.length>1&&(n+=", "+p.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?f("expecting a function but got "+p.classString(e)):this.all()._then(e,void 0,void 0,T,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},o.prototype.error=function(e){return this.caught(p.originatesFromRejection,e)},o.getNewLibraryCopy=n.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(S);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=D(e)(O(t,n));return r===M&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new E(e).promise()},o.cast=function(e){var t=w(e);return t instanceof o||(t=new o(S),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(S);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+p.classString(e));return m.setScheduler(e)},o.prototype._then=function(e,t,n,r,i){var s=void 0!==i,a=s?i:new o(S),l=this._target(),c=l._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&c)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var d=u();if(0!=(50397184&c)){var f,h,v=l._settlePromiseCtx;0!=(33554432&c)?(h=l._rejectionHandler0,f=e):0!=(16777216&c)?(h=l._fulfillmentHandler0,f=t,l._unsetRejectionIsUnhandled()):(v=l._settlePromiseLateCancellationObserver,h=new _("late cancellation observer"),l._attachExtraTrace(h),f=t),m.invoke(v,l,{handler:null===d?f:"function"==typeof f&&p.domainBind(d,f),promise:a,receiver:r,value:h})}else l._addCallbacks(e,t,a,r,d);return a},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==h)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(t,n,r,i,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=h),this._addCallbacks(n,r,i,o,null)},o.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:p.domainBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=null===i?e:p.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:p.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(c(),!1);var n=w(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(c());var i=r._bitField;if(0==(50397184&i)){var s=this._length();s>0&&r._migrateCallback0(this);for(var a=1;a<s;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var l=new _("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}},o.prototype._rejectCallback=function(e,t,n){var r=p.ensureErrorObject(e),i=r===e;if(!i&&!n&&I.warnings()){var o="a promise was rejected with a non-error: "+p.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==S){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===T?n&&"number"==typeof n.length?o=D(e).apply(this._boundValue(),n):(o=M,o.e=new b("cannot .spread() a non-array: "+p.classString(n))):o=D(e).call(t,n);var s=r._popContext();i=r._bitField,0==(65536&i)&&(o===C?r._reject(n):o===M?r._rejectCallback(o.e,!1):(I.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,i){var s=e instanceof o,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(s&&e._invokeInternalOnCancel(),n instanceof P&&n.isFinallyHandler()?(n.cancelPromise=e,D(t).call(n,i)===M&&e._reject(M.e)):t===d?e._fulfill(d.call(n)):n instanceof r?n._promiseCancelled(e):s||e instanceof E?e._cancel():n.cancel()):"function"==typeof t?s?(l&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,i,e)):t.call(n,i,e):n instanceof r?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(i,e):n._promiseRejected(i,e)):s&&(l&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof o&&n._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=c();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():m.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return m.fatalError(e,p.isNode);(65535&t)>0?m.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return I.deprecated("Promise.defer","new Promise"),{promise:new o(S),resolve:s,reject:a}},p.notEnumerableProp(o,"_makeSelfResolutionError",c),t("./method")(o,S,w,f,I),t("./bind")(o,S,w,I),t("./cancel")(o,E,f,I),t("./direct_resolve")(o),t("./synchronous_inspection")(o),t("./join")(o,E,w,S,m,u),o.Promise=o,o.version="3.5.1",t("./map.js")(o,E,f,w,S,I),t("./call_get.js")(o),t("./using.js")(o,f,w,R,S,I),t("./timers.js")(o,S,I),t("./generators.js")(o,f,S,w,r,I),t("./nodeify.js")(o),t("./promisify.js")(o,S),t("./props.js")(o,E,w,f),t("./race.js")(o,S,w,f),t("./reduce.js")(o,E,f,w,S,I),t("./settle.js")(o,E,I),t("./some.js")(o,E,f),t("./filter.js")(o,S),t("./each.js")(o,S),t("./any.js")(o),p.toFastProperties(o),p.toFastProperties(o.prototype),l({a:1}),l({b:2}),l({c:3}),l(1),l(function(){}),l(void 0),l(!1),l(new o(S)),I.setBounds(g.firstLineError,p.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function s(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function a(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=e("./util");return l.isArray,l.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function u(e,n){var o=r(this._values,this._promise);if(o instanceof t){o=o._target();var a=o._bitField;if(this._values=o,0==(50397184&a))return this._promise._setAsyncGuaranteed(),o._then(u,this._reject,void 0,this,n);if(0==(33554432&a))return 0!=(16777216&a)?this._reject(o._reason()):this._cancel();o=o._value()}if(null===(o=l.asArray(o))){var c=i("expecting an array or an iterable object but got "+l.classString(o)).reason();return void this._promise._rejectCallback(c,!1)}return 0===o.length?void(-5===n?this._resolveEmptyArray():this._resolve(s(n))):void this._iterate(o)},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var l=r(e[a],i);l instanceof t?(l=l._target(),s=l._bitField):s=null,o?null!==s&&l.suppressUnhandledRejections():null!==s?0==(50397184&s)?(l._proxy(this,a),this._values[a]=l):o=0!=(33554432&s)?this._promiseFulfilled(l._value(),a):0!=(16777216&s)?this._promiseRejected(l._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(l,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!S.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=h.getDataPropertyOrDefault(e,t+n,b);return!!r&&i(r)}function s(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,n,r){for(var a=h.inheritedDataKeys(e),l=[],u=0;u<a.length;++u){var c=a[u],d=e[c],f=r===T||T(c,d,e);"function"!=typeof d||i(d)||o(e,c,t)||!r(c,d,e,f)||l.push(c,d)}return s(l,t,n),l}function l(e,r,i,o,s,a){function l(){var e=r;r===f&&(e=this);var i=new t(n);i._captureStackTrace();var o="string"==typeof c&&this!==u?this[c]:l,s=p(i,a);try{o.apply(e,v(arguments,s))}catch(l){i._rejectCallback(g(l),!0,!0)}return i._isFateSealed()||i._setAsyncGuaranteed(),i}var u=function(){return this}(),c=e;return"string"==typeof c&&(e=o),h.notEnumerableProp(l,"__isPromisified__",!0),l}function u(e,t,n,r,i){for(var o=new RegExp(C(t)+"$"),s=a(e,t,o,n),l=0,u=s.length;l<u;l+=2){var c=s[l],d=s[l+1],p=c+t;if(r===w)e[p]=w(c,f,c,d,t,i);else{var v=r(d,function(){return w(c,f,c,d,t,i)});h.notEnumerableProp(v,"__isPromisified__",!0),e[p]=v}}return h.toFastProperties(e),e}function c(e,t,n){return w(e,t,void 0,e,null,n)}var d,f={},h=e("./util"),p=e("./nodeback"),v=h.withAppended,g=h.maybeWrapAsError,m=h.canEvaluate,y=e("./errors").TypeError,b={__isPromisified__:!0},_=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],S=new RegExp("^(?:"+_.join("|")+")$"),T=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},w=m?d:l;t.promisify=function(e,t){
if("function"!=typeof e)throw new y("expecting a function but got "+h.classString(e));if(i(e))return e;t=Object(t);var n=void 0===t.context?f:t.context,o=!!t.multiArgs,s=c(e,n,o);return h.copyDescriptors(e,s,r),s},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=T);var o=t.promisifier;if("function"!=typeof o&&(o=w),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=h.inheritedDataKeys(e),a=0;a<s.length;++a){var l=e[s[a]];"constructor"!==s[a]&&h.isClass(l)&&(u(l.prototype,r,i,o,n),u(l,r,i,o,n))}return u(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==a&&e instanceof a)t=d(e),n=!0;else{var r=c.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function s(e){var n,s=r(e);return u(s)?(n=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&n._propagateFrom(s,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,l=e("./util"),u=l.isObject,c=e("./es5");"function"==typeof Map&&(a=Map);var d=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),f=function(e){for(var t=new a,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};l.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=f(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var l=r(e);if(l instanceof t)return a(l);if(null===(e=s.asArray(e)))return i("expecting an array or an iterable object but got "+s.classString(e));var u=new t(n);void 0!==o&&u._propagateFrom(o,3);for(var c=u._fulfill,d=u._reject,f=0,h=e.length;f<h;++f){var p=e[f];(void 0!==p||f in e)&&t.cast(p)._then(c,d,void 0,u,null)}return u}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r,i){this.constructor$(e);var s=f();this._fn=null===s?n:h.domainBind(s,n),void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+h.classString(t)):new a(e,t,n,i).promise()}function c(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n=this.array,r=n._promise,i=p(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=o);var a=r._popContext();return s.checkForgottenReturns(o,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var f=t._getDomain,h=e("./util"),p=h.tryCatch;h.inherits(a,n),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},a.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(c,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],29:[function(t,n,i){"use strict";var o,s=t("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},l=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var u=r.setImmediate,c=e.nextTick;o=s.isRecentNode?function(e){u.call(r,e)}:function(t){c.call(e,t)}}else if("function"==typeof l&&"function"==typeof l.resolve){var d=l.resolve();o=function(e){d.then(e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:a:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();n.exports=o},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var s=e("./util"),a=e("./errors").RangeError,l=e("./errors").AggregateError,u=s.isArray,c={};s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new l,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(c(e)){if(e instanceof t)return e;var i=o(e);if(i===u){r&&r._pushContext();var l=t.reject(i.e);return r&&r._popContext(),l}if("function"==typeof i){if(s(e)){var l=new t(n);return e._then(l._fulfill,l._reject,void 0,l,null),l}return a(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return u.e=e,u}}function s(e){try{return d.call(e,"_promise0")}catch(e){return!1}}function a(e,r,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,d,!0),a=null)}var a=new t(n),c=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var d=!0,f=l.tryCatch(r).call(e,o,s);return d=!1,a&&f===u&&(a._rejectCallback(f.e,!0,!0),a=null),c}var l=e("./util"),u=l.errorObj,c=l.isObject,d={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),l=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return c(+this).thenReturn(e)},c=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(u,null,null,e,void 0),r.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(n),a=setTimeout(function(){s._fulfill()},+e),r.cancellation()&&s._setOnCancel(new i(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return c(e,this)};var d=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new l("operation timed out"):new l(t),a.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,a,l=new i(setTimeout(function(){n.isPending()&&d(n,t,a)},e));return r.cancellation()?(a=this.then(),n=a._then(o,s,void 0,l,void 0),n._setOnCancel(l)):n=this._then(o,s,void 0,l,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e){setTimeout(function(){throw e},0)}function l(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(e,n){function i(){if(s>=u)return c._fulfill();var e=l(o[s++]);if(e instanceof t&&e._isDisposable()){try{e=r(e._getDisposer().tryDispose(n),o.promise)}catch(o){return a(o)}if(e instanceof t)return e._then(i,a,null,null,null)}i()}var s=0,u=e.length,c=new t(o);return i(),c}function c(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function f(e){return c.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function h(e){this.length=e,this.promise=null,this[e-1]=null}var p=e("./util"),v=e("./errors").TypeError,g=e("./util").inherits,m=p.errorObj,y=p.tryCatch,b={};c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},c.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==b?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},c.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},g(d,c),d.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},h.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+p.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,a=!1):(o=arguments,e--);for(var l=new h(e),d=0;d<e;++d){var v=o[d];if(c.isDisposer(v)){var g=v;v=v.promise(),v._setDisposable(g)}else{var b=r(v);b instanceof t&&(v=b._then(f,null,null,{resources:l,index:d},void 0))}l[d]=v}for(var _=new Array(l.length),d=0;d<_.length;++d)_[d]=t.resolve(l[d]).reflect();var S=t.all(_).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return m.e=n.error(),m;if(!n.isFulfilled())return void S.cancel();e[t]=n.value()}T._pushContext(),i=y(i);var r=a?i.apply(void 0,e):i(e),o=T._popContext();return s.checkForgottenReturns(r,o,"Promise.using",T),r}),T=S.lastly(function(){var e=new t.PromiseInspection(S);return u(l,e)});return l.promise=T,T._setOnCancel(l),T},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,i());throw new v}}},{"./errors":12,"./util":36}],36:[function(e,t,n){"use strict";function i(){try{var e=R;return R=null,e.apply(this,arguments)}catch(e){return A.e=e,A}}function o(e){return R=e,i}function s(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function a(e){return"function"==typeof e||"object"==typeof e&&null!==e}function l(e){return s(e)?new Error(m(e)):e}function u(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function c(e,t,n){if(!I.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function d(e,t,n){if(s(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return I.defineProperty(e,t,r),e}function f(e){throw e}function h(e){try{if("function"==typeof e){var t=I.names(e.prototype),n=I.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=x.test(e+"")&&I.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function p(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function v(e){return N.test(e)}function g(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function m(e){try{return e+""}catch(e){return"[no string representation]"}}function y(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function b(e){try{d(e,"isOperational",!0)}catch(e){}}function _(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function S(e){return y(e)&&I.propertyIsWritable(e,"stack")}function T(e){return{}.toString.call(e)}function C(e,t,n){for(var r=I.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{I.defineProperty(t,o,I.getDescriptor(e,o))}catch(e){}}}function w(e){return H?q.env[e]:void 0}function E(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function k(e,t){return e.bind(t)}var R,I=e("./es5"),P="undefined"==typeof navigator,A={e:{}},O="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==this?this:null,M=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},D=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(I.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var l=Object.getOwnPropertyDescriptor(e,a);null!=l&&null==l.get&&null==l.set&&r.push(a)}}e=I.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<e.length;++s)if(r.call(e[s],o))continue e;i.push(o)}return i}}(),x=/this\s*\.\s*\S+\s*=/,N=/^[a-z$_][a-z$_0-9]*$/i,F=function(){return"stack"in new Error?function(e){return S(e)?e:new Error(m(e))}:function(e){if(S(e))return e;try{throw new Error(m(e))}catch(e){return e}}}(),U=function(e){return I.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var j="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};U=function(e){return I.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?j(e):null}}var L=void 0!==q&&"[object process]"===T(q).toLowerCase(),H=void 0!==q&&void 0!==q.env,B={isClass:h,isIdentifier:v,inheritedDataKeys:D,getDataPropertyOrDefault:c,thrower:f,isArray:I.isArray,asArray:U,notEnumerableProp:d,isPrimitive:s,isObject:a,isError:y,canEvaluate:P,errorObj:A,tryCatch:o,inherits:M,withAppended:u,maybeWrapAsError:l,toFastProperties:p,filledRange:g,toString:m,canAttachTrace:S,ensureErrorObject:F,originatesFromRejection:_,markAsOriginatingFromRejection:b,classString:T,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:L,hasEnvVariables:H,env:w,global:O,getNativePromise:E,domainBind:k};B.isRecentNode=B.isNode&&function(){var e=q.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),B.isNode&&B.toFastProperties(q);try{throw new Error}catch(q){B.lastLineError=q}t.exports=B},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:15}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PreCallTest=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./turnConnection"),s=e("./tests/rttTest"),a=e("./tests/throughputTest"),l=e("./utility/resultsHandler"),u=e("./utility/onlineCheck"),c=e("./utility/stats/detectbrowser"),d=e("bluebird"),f={RTT:"rtt",THROUGHPUT:"throughput"},h=function(){function e(){r(this,e),this.browserInfo=(0,c.detect)(),this.turnConnection=new o.TurnConnection(this.browserInfo),this.onlineCheck=new u.OnlineCheck,this.callsInProgress=0,this.turnTests=[f.RTT,f.THROUGHPUT],this.active=!1,this.rtt=null,this.resultsHandler=null}return i(e,[{key:"start",value:function(e,t){if(this.browserInfo.browserName!==c.Constants.browserName.msie)if(this.iceServers=e,this.callback=t,this.active)this.callback&&this.callback(null,"Not started: already in progress");else if(this.callsInProgress>0)this.callback&&this.callback(null,"Not started: call in progress");else if(e){this.turnTestCounter=0,this.resultsHandler=new l.ResultsHandler;var n={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",n),this.onlineCheck.start(),this.active=!0,this._start()}else this.callback&&this.callback(null,"Not started: no ICE servers given");else this.callback&&this.callback(null,"Not started: disabled for IE")}},{key:"_start",value:function(){var e=this;this.active&&this.turnConnection.connect(this.iceServers).then(function(){e.active?e.startTurnTests().then(function(){e.stop()},function(t){e.stop()}):e.stop()},function(e){var t=e.continueFlag;if(r.resultsHandler.failure(e),!t){r.turnConnection.disconnect(),r.active=!1;var n="";try{n=e.stack}catch(r){n=e.toString()}return n&&""!==n||(n=e.toString()),void r.callback(null,n)}r.resultsHandler.getFailureNumber()>=10?r.stop():(r.turnConnection.disconnect(),setTimeout(function(){r._start()},0))})}},{key:"stop",value:function(){var e=this;if(this.browserInfo.browserName!==c.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var t=this.onlineCheck.stop();this.resultsHandler&&this.resultsHandler.add("onlineStatus",t),this.turnConnection.getIceResults().then(function(t){e.resultsHandler&&e.resultsHandler.add("ice",t),e.turnConnection.disconnect(),e.sendResults()},function(t){e.resultsHandler&&e.resultsHandler.failure(t),e.turnConnection.disconnect(),e.sendResults()})}}},{key:"sendResults",value:function(){this.resultsHandler||this.callback&&this.callback(null,"No results present");var e=this.resultsHandler.getResults();this.callback&&this.callback(e,null),this.resultsHandler=null}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var e=this;if(this.turnTestCounter>=this.turnTests.length)return new d(function(e,t){e()});var t=this.turnTests[this.turnTestCounter],n=null;switch(t){case f.RTT:n=new s.RttTest(this.turnConnection);break;case f.THROUGHPUT:n=new a.ThroughputTest(this.turnConnection,this.rtt);break;default:return new d(function(e,n){n(new Error("Unknown test: "+t))})}return this.activeTurnTest=n,this.active?n.start().then(function(){return e.handleTestResults(t,n.getResults()),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()},function(r){return e.handleTestResults(t,n.getResults(),r),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()}):new d(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){null==(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)&&e==f.RTT&&(this.rtt=t.median),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),e}();n.PreCallTest=h},{"./tests/rttTest":3,"./tests/throughputTest":4,"./turnConnection":6,"./utility/onlineCheck":8,"./utility/resultsHandler":10,"./utility/stats/detectbrowser":11,bluebird:1}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.RttTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function f(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:f(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},l=e("../utility/timestamps"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(l),c=e("./turnTest"),d=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.sendTimer=null,n.countSent=0,n.rtts=[],n}return o(t,c.TurnTest),s(t,[{key:"initiate",value:function(){this.results.startTimestamp=u.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){if(this.isActive()){var t=parseInt(e,10),n=this.calculateRtt(t);this.rtts.push(n),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){if(this.isActive()){var e=u.getCurrent();this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(e){return u.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.variance=this.variance(),this.results.endTimestamp=u.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return null;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"variance",value:function(){if(0==this.rtts.length)return null;for(var e=0,t=this.median(),n=0;n<this.rtts.length;n++){var r=this.rtts[n];e+=Math.abs(r-t)}return e/=this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.RttTest=d},{"../utility/timestamps":14,"./turnTest":5}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:h(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},l=e("../utility/timestamps"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(l),c=e("../utility/messageMaker"),d=e("./turnTest"),f=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(o.sentBytes=0,o.receivedBytes=0,o.secondHalfBytes=0,o.secondHalfStart=null,o.bufferEmpty=0,o.chunkSize=1200,o.messageMaker=new c.MessageMaker(o.chunkSize),o.duration=5e3,null!=n){var s=50*n;o.duration=Math.max(Math.min(s,1e4),1e3);
}return o.sendTimer=null,o.lastMessage=null,o.intervals=[],o.intervalStart=0,o.intervalLength=100,o.intervalBytes=0,o}return o(t,d.TurnTest),s(t,[{key:"initiate",value:function(){window&&window.csioReactNative?this.handleError(new Error("Not running throughput test for react-native")):this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=u.getCurrent();if(this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,i=this.averageThroughput(this.intervalBytes,r),o=null;try{o=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:i,rtt:o}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=u.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e=0,t=0;this.secondHalfStart&&(e=this.results.endTimestamp-this.secondHalfStart,t=this.averageThroughput(this.secondHalfBytes,e));var n=this.results.endTimestamp-this.results.startTimestamp,r=this.averageThroughput(this.receivedBytes,n);r>t&&(t=r),this.results.average=t;var i=null;try{i=JSON.parse(this.lastMessage)}catch(e){return}if(i){var o=i.sentBytes+this.lastMessage.length;this.results.bytesSent=o,this.results.fractionLostBytes=1-this.receivedBytes/o}else this.results.bytesSent=-1,this.results.fractionLostBytes=-1}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();n.ThroughputTest=f},{"../utility/messageMaker":7,"../utility/timestamps":14,"./turnTest":5}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("bluebird"),s=function(){function e(t){r(this,e),this.connection=t,this.active=!1,this.results={}}return i(e,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var e=this,t=new o(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),t}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb&&(this.resolveCb(),this.resolveCb=null)}},{key:"failed",value:function(e){this.active=!1,this.rejectCb&&(this.rejectCb(e),this.rejectCb=null)}}]),e}();n.TurnTest=s},{bluebird:1}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TurnConnection=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./utility/parsedIceCandidate"),s=e("./utility/stats/getstatshandler"),a=e("./utility/stats/detectbrowser"),l=e("bluebird"),u=function(){function e(t){r(this,e),this.reset(),this.statshandler=new s.GetStatsHandler(t)}return i(e,[{key:"reset",value:function(){this.disconnect(),this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={},this.resolveCb=null,this.rejectCb=null}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(e)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&(t="on"+t,e.attachEvent(t,n.bind(this)))}},{key:"connect",value:function(e){var t=this;this.reset();var n=new l(function(e,n){t.resolveCb=e,t.rejectCb=n});this.iceServers=e;var r=null;try{if(RTCPeerConnection?r=RTCPeerConnection:webkitRTCPeerConnection?r=webkitRTCPeerConnection:mozRTCPeerConnection?r=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(r=window.RTCPeerConnection),!r){var i=new Error("RTCPeerConnection not found");return i.continueFlag=!1,this.rejectCb(i),n}}catch(i){return i.continueFlag=!1,this.rejectCb(i),n}var o={ordered:!1,maxRetransmits:0},s={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new r(s),this.pctpc2=new r(s)}catch(i){return this.rejectDisconnect(!1,i),n}this.connectionTimer=setTimeout(function(){delete t.connectionTimer,t.rejectDisconnect(!1,new Error("Connection timeout"))},3e4);try{this.sendChannel=this.pctpc1.createDataChannel("precalltest",o),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){t.raiseSendError(e),t.rejectDisconnect(!0,e)}),this.assignEvent(this.pctpc2,"datachannel",function(e){var n=e.channel;t.assignEvent(n,"open",function(e){t.resolveCb&&(t.resolveCb(),t.resolveCb=null)}),t.assignEvent(n,"close",function(e){t&&t.disconnect&&t.disconnect()}),t.assignEvent(n,"message",function(e){t.messageCallback&&t.messageCallback(e.data)}),t.assignEvent(n,"error",function(e){t.errorCallback&&t.errorCallback(e),t.rejectDisconnect(!0,e)})})}catch(i){return this.rejectDisconnect(!1,i),n}try{this.assignEvent(this.pctpc1,"icecandidate",function(e){t.onIceCandidate(t.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){t.onIceCandidate(t.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,n){t.onCreateOfferSuccess(e)},function(e){t.onCreateOfferError(t.pctpc1,e)})}catch(i){return this.rejectDisconnect(!1,i),n}return n}},{key:"rejectDisconnect",value:function(e,t){this.disconnect(),this.rejectCb&&(t.continueFlag=e,this.rejectCb(t)),this.resolveCb=null,this.rejectCb=null}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),clearTimeout(this.iceTimer),this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateOfferSuccess",value:function(e){var t=this;try{this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;try{this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onIceCandidate",value:function(e,t){var n=this;try{if(!t.candidate)return;var r=new o.ParsedIceCandidate(t.candidate);if(e==this.pctpc1&&this.statshandler.codeBase==a.Constants.codeBaseType.chrome&&(r.isRelay()&&(r.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),r.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),r.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),r.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),!r.isRelay())return;this.getOtherPc(e).addIceCandidate(t.candidate).then(function(){n.onAddIceCandidateSuccess(e)},function(t){n.onAddIceCandidateError(e,t,r.isRelay())})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(!1,t)}},{key:"onIceStateChange",value:function(e,t){var n=this;try{var r="(?)";e&&(r=e.iceConnectionState),"failed"===r&&this.rejectDisconnect(!0,new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(!0,new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||(clearTimeout(this.iceTimer),delete this.iceTimer)}catch(e){this.rejectDisconnect(!1,e)}}},{key:"getIceResults",value:function(){var e=this;return new l(function(t,n){for(var r=JSON.parse(JSON.stringify(e.iceServers)),i=0;i<r.length;i++){var o=r[i];r.hasOwnProperty(o)||delete o.credential}var s={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:r,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var a in e.parsedIceResults)e.parsedIceResults.hasOwnProperty(a)&&(s[a]=e.parsedIceResults[a]);e.pctpc1?e.statshandler.getIceCandidates(e.pctpc1).then(function(e){for(var n=0;n<e.iceCandidatePairs.length;n++){var r=e.iceCandidatePairs[n];if(r.googActiveConnection||r.selected)for(var i=0;i<e.localCandidates.length;i++){var o=e.localCandidates[i],a=null;if(a=o.ip?o.ip:o.ipAddress,o.id==r.localCandidateId){s.turnIpAddress=a;var l=-1!==a.indexOf(":");s.turnIpVersion=l?"ipv6":"ipv4",s.turnTransport=o.mozLocalTransport}"relay"!==o.candidateType&&"relayed"!==o.candidateType||("udp"===o.mozLocalTransport&&(s.relayUdpSuccess=!0),"tcp"===o.mozLocalTransport&&(s.relayTcpSuccess=!0),"tls"===o.mozLocalTransport&&(s.relayTlsSuccess=!0)),-1!==a.indexOf(":")?s.ipv6Supported=!0:s.ipv4Supported=!0}}for(var u=0;u<e.localCandidates.length;u++){var c=e.localCandidates[u];"relay"!==c.candidateType&&"relayed"!==c.candidateType||("udp"===c.mozLocalTransport&&(s.relayUdpGathered=!0),"tcp"===c.mozLocalTransport&&(s.relayTcpGathered=!0),"tls"===c.mozLocalTransport&&(s.relayTlsGathered=!0)),"srflx"!==c.candidateType&&"serverreflexive"!==c.candidateType||(s.srflxGathered=!0)}for(var d=0;d<e.iceCandidatePairs.length;d++){var f=e.iceCandidatePairs[d];if("succeeded"===f.state)for(var h=0;h<e.localCandidates.length;h++){var p=e.localCandidates[h];p.id==f.localCandidateId&&("relay"!==p.candidateType&&"relayed"!==p.candidateType||("udp"===p.mozLocalTransport&&(s.relayUdpSuccess=!0),"tcp"===p.mozLocalTransport&&(s.relayTcpSuccess=!0),"tls"===p.mozLocalTransport&&(s.relayTlsSuccess=!0)),"srflx"!==p.candidateType&&"serverreflexive"!==p.candidateType||(s.srflxSuccess=!0))}}t(s)},function(e){n(e)}):n(new Error("PC not available for stats"))},function(e){reject(e)})}}]),e}();n.TurnConnection=u},{"./utility/parsedIceCandidate":9,"./utility/stats/detectbrowser":11,"./utility/stats/getstatshandler":12,bluebird:1}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}Object.defineProperty(n,"__esModule",{value:!0}),n.randomAsciiString=n.MessageMaker=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utility/timestamps"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;r(this,e),this.message={timestamp:"",sentBytes:1e4,padding:""};var n=i(t-a.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=n}return o(e,[{key:"make",value:function(e){return this.message.timestamp=a.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),e}();n.MessageMaker=l,n.randomAsciiString=i},{"../utility/timestamps":14}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.OnlineCheck=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./timestamps"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=function(){function e(){r(this,e),this.active=!1}return i(e,[{key:"start",value:function(){var e=this;this.active=!0,this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){if(this.active){var e=s.getCurrent();if(navigator&&navigator.onLine){var t=navigator.onLine;this.onlineCheck.push({timestamp:e,online:t})}}}},{key:"stop",value:function(){var e=this;return this.active=!1,window&&window.removeEventListener&&"function"==typeof window.removeEventListener&&(window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()})),this.onlineCheck}}]),e}();n.OnlineCheck=a},{"./timestamps":14}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.iceCandidateStr=t.candidate,this.parse()}return i(e,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",n=e>>24;if("rtp"===this.protocol&&n>=0&&n<=2)switch(n){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),e}();n.ParsedIceCandidate=o},{}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ResultsHandler=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./timestamps"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=e("./messageMaker"),u=function(){function e(){r(this,e),this.start=a.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,l.randomAsciiString)(20),this.version="1.2.0",this.failures=[],this.results={},this.forceStopped=!1}return o(e,[{key:"getResults",value:function(){return{id:this.id,version:this.version,forceStopped:this.forceStopped,startTimestamp:this.start,endTimestamp:a.getCurrent(),failures:this.failures,tests:this.results}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){this.results[e]=t,t.forceStopped&&!0===t.forceStopped&&(this.forceStopped=!0)}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":i(e))&&(e=e.toString());var t={timestamp:a.getCurrent(),reason:e};this.failures.push(t)}}]),e}();n.ResultsHandler=u},{"./messageMaker":7,"./timestamps":14}],11:[function(e,t,n){"use strict";function r(){var e=i.browserName.chrome,t=null,n=null,r=null,o=i.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:o,os:t,osVersion:n,userAgent:r};var s=(r=navigator.userAgent).toLowerCase(),a=navigator.appVersion,l=""+parseFloat(navigator.appVersion),u=void 0;-1!==(u=s.indexOf("opera"))?(e=i.browserName.opera,l=s.substring(u+6),-1!==(u=s.indexOf("Version"))&&(l=s.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=s.indexOf("opr"))?(e=i.browserName.opera,l=s.substring(u+4),-1!==(u=s.indexOf("Version"))&&(l=s.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=s.indexOf("msie"))?(e=i.browserName.msie,l=s.substring(u+5),o=i.codeBaseType.chrome):-1!==(u=s.indexOf("edge"))?(e=i.browserName.edge,l=s.substring(u+5),o=i.codeBaseType.edge):-1!==(u=s.indexOf("chrome"))?(e=i.browserName.chrome,l=s.substring(u+7),o=i.codeBaseType.chrome):-1!==(u=s.indexOf("safari"))?(e=i.browserName.safari,l=s.substring(u+7),-1!==(u=s.indexOf("Version"))&&(l=s.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=s.indexOf("firefox"))?(e=i.browserName.firefox,l=s.substring(u+8),o=i.codeBaseType.firefox):-1!==(u=s.indexOf("trident"))&&(e=i.browserName.msie,u=s.indexOf("rv"),l=s.substring(u+3,u+7),o=i.codeBaseType.chrome);var c=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],d=void 0,f=void 0;for(d in c)if(c.hasOwnProperty(d)&&(f=c[d]).r.test(s)){t=f.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=i.osName.windows),t){case i.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(s)[1];break;case i.osName.android:n=/android ([\.\_\d]+)/.exec(s)[1];break;case i.osName.ios:n=(n=/os (\d+)_(\d+)_?(\d+)?/.exec(a))[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:l.toString(),os:t,osVersion:n,codeBase:o,userAgent:r}}Object.defineProperty(n,"__esModule",{value:!0}),n.detect=r;var i=n.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},{}],12:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./detectbrowser"),s=e("./statsadapter"),a=e("bluebird"),l=function(){function e(t){r(this,e),this.codeBase=t.codeBase,this.browserName=t.browserName,this.adapter=new s.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return i(e,[{key:"getIceCandidates",value:function(e){var t=this;return new a(function(n,r){t.csioGetStats(t.iceCandidatesHandler.bind(t),e,function(e){n(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,s=o.Constants.codeBaseType.edge,a=o.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===a?this.getStatsSafari(e,t,n):this.codeBase===i?this.getStatsChrome(e,t,n):this.codeBase===s&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(e,t,n){var r=this;if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)})["catch"](function(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})})}catch(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})}else t.getStats(null,function(t){e(t,n)},function(){})}},{key:"getStatsChrome",value:function(e,t,n){var r=this;if(window&&window.csioReactNative)t.getStats(null,function(t){e(t,n)},function(e){});else if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)})["catch"](function(i){r.isPromiseBased=!1,t.getStats(function(t){e(t,n)})})}catch(r){isPromiseBased=!1,t.getStats(function(t){e(t,n)})}else t.getStats(function(t){e(t,n)})}},{key:"getStatsEdge",value:function(e,t,n){t.getStats().then(function(t){e(t,n)})["catch"](function(e){})}},{key:"getStatsSafari",value:function(e,t,n){t.getStats().then(function(t){e(t,n)})["catch"](function(e){})}}]),e}();n.GetStatsHandler=l},{"./detectbrowser":11,"./statsadapter":13,bluebird:1}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./detectbrowser"),s=function(){function e(t,n){r(this,e),this.codeBase=t,this.browser=n}return i(e,[{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,s=o.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==s)e.forEach(function(e){t.push(e)});else if(this.codeBase===i&&this.browser!==s)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);if(a.candidatePair)r.push(a.candidatePair);else if(a.transportStats){if("transport"===a.transportStats.type){i=a.transportStats.selectedCandidatePairId;continue}r.push(a.transportStats)}else if(a.localCandidate){var l=a.localCandidate;if("relay"==l.candidateType||"relayed"==l.candidateType){if(!l.mozLocalTransport){var u=l.priority>>24;l.mozLocalTransport=this.formatRelayType(u)}l.mozLocalTransport=l.mozLocalTransport.toLowerCase()}t.push(l)}else a.remoteCandidate&&n.push(a.remoteCandidate)}if(i)for(var c=0;c<r.length;++c)r[c].id===i&&(r[c].googActiveConnection="true");return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;i++){var o=t.values[i];Object.assign(t,o)}delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++){var o=n[i];if(e.type===o)return!0}return!1},r=n("inbound-rtp","inboundrtp"),i="true"===e.isRemote||!0===e.isRemote;return r||n("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType="local",void 0!==e.isRemote&&(t.tracks.reportType=i?"remote":"local")):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]),e}();n.StatsAdapter=s},{"./detectbrowser":11}],14:[function(e,t,n){"use strict";function r(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=r},{}],15:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){g&&p&&(g=!1,p.length?v=p.concat(v):m=-1,v.length&&l())}function l(){if(!g){var e=o(a);g=!0;for(var t=v.length;t;){for(p=v,v=[];++m<t;)p&&p[m].run();m=-1,t=v.length}p=null,g=!1,s(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var d,f,h=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(e){d=r}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var p,v=[],g=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];v.push(new u(e,t)),1!==v.length||g||o(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],16:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{
value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=this;r(this,e),this.batteryManager=null,"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){t.batteryManager=e})}return i(e,[{key:"getLevel",value:function(){return this.batteryManager?this.batteryManager.level:-1}},{key:"getCharging",value:function(){return this.batteryManager?this.batteryManager.charging:null}}]),e}();n.Battery=o},{}],17:[function(e,t,n){"use strict";function r(){var e=o.browserName.chrome,t=null,n=null,r=null,i=null,s=o.codeBaseType.chrome;if(!window.navigator.userAgent||window.csioReactNative)return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:s,os:t,osVersion:n,userAgent:r,browserVersion:null};r=navigator.userAgent;var a=r.toLowerCase();i=navigator.appVersion;var l=i.toLowerCase(),u=""+parseFloat(l),c=void 0;-1!==(c=a.indexOf("opera"))?(e=o.browserName.opera,u=a.substring(c+6),-1!==(c=a.indexOf("Version"))&&(u=a.substring(c+8)),s=o.codeBaseType.chrome):-1!==(c=a.indexOf("opr"))?(e=o.browserName.opera,u=a.substring(c+4),-1!==(c=a.indexOf("Version"))&&(u=a.substring(c+8)),s=o.codeBaseType.chrome):-1!==(c=a.indexOf("msie"))?(e=o.browserName.msie,u=a.substring(c+5),s=o.codeBaseType.chrome):-1!==(c=a.indexOf("edge"))?(e=o.browserName.edge,u=a.substring(c+5),s=o.codeBaseType.edge):-1!==(c=a.indexOf("chrome"))?(e=o.browserName.chrome,u=a.substring(c+7),s=o.codeBaseType.chrome):-1!==(c=a.indexOf("safari"))?(e=o.browserName.safari,u=a.substring(c+7),-1!==(c=a.indexOf("Version"))&&(u=a.substring(c+8)),s=o.codeBaseType.chrome):-1!==(c=a.indexOf("firefox"))?(e=o.browserName.firefox,u=a.substring(c+8),s=o.codeBaseType.firefox):-1!==(c=a.indexOf("trident"))&&(e=o.browserName.msie,c=a.indexOf("rv"),u=a.substring(c+3,c+7),s=o.codeBaseType.chrome);var d=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],f=void 0,h=void 0;for(f in d)if(d.hasOwnProperty(f)&&(h=d[f],h.r.test(a))){t=h.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=o.osName.windows),t){case o.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(a)[1];break;case o.osName.android:n=/android ([\.\_\d]+)/.exec(a)[1];break;case o.osName.ios:if(!(n=/os (\d+)_(\d+)_?(\d+)?/.exec(l)))break;n=n[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:u.toString(),os:t,osVersion:n,codeBase:s,userAgent:r}}Object.defineProperty(n,"__esModule",{value:!0}),n.detect=r;var i=e("../config/constants"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(i)},{"../config/constants":32}],18:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Devices=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/constants"),a=r(s),l=e("../utility/registry"),u=e("../utility/csiologger"),c=r(u),d=e("../utility/utils"),f=r(d),h=function(){function e(t,n){i(this,e),this.conferenceId=t,this.pc=n,this.devices=null,this.emb=l.Registry.getEventMessageBuilder()}return o(e,[{key:"collectConnected",value:function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var t=this;navigator.mediaDevices.enumerateDevices().then(function(n){var r=f.normalizeMediaDeviceList(n);t.sendConnected(r),setTimeout(e.collectConnected.bind(t),1e4)})["catch"](function(n){setTimeout(e.collectConnected.bind(t),1e4)})}}},{key:"sendConnected",value:function(e){this.devices?this.compare(e)||(this.devices=e,this.send()):(this.devices=e,this.send())}},{key:"compare",value:function(e){return self.devices.sort().toString()===e.sort().toString()}},{key:"send",value:function(){var e={mediaDeviceList:this.devices};c.log("sending connectedDevice",a.internalFabricEvent.connectedDeviceList,e),this.emb.make(a.internalFabricEvent.connectedDeviceList,this.conferenceId,this.pc,e)}}]),e}();n.Devices=h},{"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/utils":100}],19:[function(e,t,n){"use strict";function r(e,t){if(t)try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){return}}function i(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){return null}return null}function o(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){return}}Object.defineProperty(n,"__esModule",{value:!0}),n.store=r,n.get=i,n.remove=o},{}],20:[function(e,t,n){"use strict";function r(e,t){if(t)try{window&&window.sessionStorage&&window.sessionStorage.setItem(e,t)}catch(e){return}}function i(e){try{if(window&&window.sessionStorage)return window.sessionStorage.getItem(e)}catch(e){return null}return null}function o(e){try{window&&window.sessionStorage&&window.sessionStorage.removeItem(e)}catch(e){return}}function s(e,t){if(e){var n=JSON.parse(i("csio_ucid_data"));n||(n={}),n[e]||(n[e]={}),n[e].ucID=t,r("csio_ucid_data",JSON.stringify(n))}}function a(e){if(!e)return null;var t=JSON.parse(i("csio_ucid_data"));return t&&t[e]?t[e].ucID:null}Object.defineProperty(n,"__esModule",{value:!0}),n.store=r,n.get=i,n.remove=o,n.storeUcId=s,n.getUcId=a},{}],21:[function(e,t,n){(function(n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var n={};return n.status=e,t&&(n.message=t),n}function s(e,t){return e+": "+t+" "+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")}function a(){var e=null,t=m.Registry.getEndpoint().getBrowserName();return"Firefox"===t?e=mozRTCPeerConnection:"Chrome"===t||"Opera"===t?e=webkitRTCPeerConnection:"Safari"===t?b.log("Browser type Safari"):"Edge"===t&&(e=window.RTCPeerConnection),e}function l(e){if(null===e)return!1;var t=m.Registry.getEndpoint().getCodeBase();if(t===f.codeBaseType.firefox)return"undefined"!=typeof mozRTCPeerConnection&&e instanceof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection&&e instanceof RTCPeerConnection;if(t===f.codeBaseType.edge||"function"==typeof e)return!0;var n=a();return null!==n&&e instanceof n||void 0!==e.createOffer}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=e("./config/constants"),f=r(d),h=e("./config/settings"),p=r(h),v=e("./config/callstatserrors"),g=e("./fsm/mainfsm"),m=e("./utility/registry"),y=e("./utility/csiologger"),b=r(y),_=e("./utility/onerroreventlistner"),S=r(_),T=e("./utility/utils"),C=r(T);S.setErrorEventListener(),C.assignPollyfill(),C.isIntegerPollyfill();var w=null,E=function(){function e(){i(this,e),w=new g.MainFSM}return c(e,[{key:"initialize",value:function(e,t,n,r,i,a){if(!e||!n||!t){var l=s("initialize",v.csErrorStrings.argumentError);return b.error(l),o(f.callstatsAPIReturnStatus.failure,l)}if(r&&"function"!=typeof r){var u=s("initialize",v.csErrorStrings.argumentError);b.warn(u),r=null}if(i&&"function"!=typeof i){var c=s("initialize",v.csErrorStrings.argumentError);b.warn(c),i=null}if("function"!=typeof t&&!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative)){var d=s("initialize",v.csErrorStrings.cryptoError);return b.error(d),r&&r(v.csError.tokenGenerationError,v.csErrorStrings.cryptoError),o(f.callstatsAPIReturnStatus.failure,d)}try{w.fire(g.MainEvents.onInitialize,e,n,t,r,i,a),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"initialize: Error",error:e.message+":"+e.stack}),b.error("initialize: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"addNewFabric",value:function(e,t,n,r,i,a){var u=null,c=f.endpointType.peer,d=f.transmissionDirection.sendrecv;if(r||(r=f.tmpConferenceId),!e||!n){var h=s("addNewFabric",v.csErrorStrings.argumentError);return b.error(h),o(f.callstatsAPIReturnStatus.failure,h)}if(a&&"function"==typeof a&&(u=a),i&&"function"==typeof i&&(u=i),i&&"function"!=typeof i){if(i.remoteEndpointType){if(!f.endpointType.hasOwnProperty(i.remoteEndpointType)){var p=s("addNewFabric",v.csErrorStrings.invalidEndPointType,i.remoteEndpointType);return b.error(p),o(f.callstatsAPIReturnStatus.failure,p)}c=i.remoteEndpointType}if(i.fabricTransmissionDirection){if(!f.transmissionDirection.hasOwnProperty(i.fabricTransmissionDirection)){var y=s("addNewFabric",v.csErrorStrings.invalidTransmissionDirection,i.fabricTransmissionDirection);return b.error(y),o(f.callstatsAPIReturnStatus.failure,y)}d=i.fabricTransmissionDirection}}if(!f.fabricUsage.hasOwnProperty(n)||n instanceof Function){var _=s("addNewFabric",v.csErrorStrings.fabricUsageInvalid,n);return b.error(_),o(f.callstatsAPIReturnStatus.failure,_)}if(!l(e)){var S=s("addNewFabric",v.csErrorStrings.pcInvalid);return b.error(S),o(f.callstatsAPIReturnStatus.failure,S)}var T=m.Registry.getConferenceManager().get(r);if(T&&T.getPeerConnectionManager().getPcHandler(e))return o(f.callstatsAPIReturnStatus.success);if(!m.Registry.getCredentials().getAppId()||!m.Registry.getCredentials().getUserId()){var C=s("addNewFabric",v.csErrorStrings.notInitialized);return b.error(C),o(f.callstatsAPIReturnStatus.failure,C)}try{w.fire(g.MainEvents.onAddNewFabric,e,t,n,r,c,d,u),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"addNewFabric: Error",error:e.message+":"+e.stack}),b.error("addNewFabric: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"sendFabricEvent",value:function(e,t,n,r){if(b.log("sendFabricEvent ",t),n||(n=f.tmpConferenceId),!e||!t){var i=s("sendFabricEvent",v.csErrorStrings.argumentError);return b.error(i),o(f.callstatsAPIReturnStatus.failure,i)}if(t===f.fabricEvent.fabricSetupFailed){var a=s("sendFabricEvent",v.csErrorStrings.fabricEventUnsupported,t);return b.error(a),o(f.callstatsAPIReturnStatus.failure,a)}if(!f.fabricEvent.hasOwnProperty(t)&&!f.internalFabricEvent.hasOwnProperty(t)){var l=s("sendFabricEvent",v.csErrorStrings.fabricEventInvalid,t);return b.error(l),o(f.callstatsAPIReturnStatus.failure,l)}if(!(t!==f.fabricEvent.activeDeviceList||r&&r.deviceList)){var u=s("sendFabricEvent ",v.csErrorStrings.argumentError);return b.error(u),o(f.callstatsAPIReturnStatus.failure,u)}var c=m.Registry.getConferenceManager().get(n);if(!m.Registry.getCredentials().getAppId()||!m.Registry.getCredentials().getUserId()||!c){var d=s("sendFabricEvent ",v.csErrorStrings.notInitialized);return b.error(d),o(f.callstatsAPIReturnStatus.failure,d)}if(!c.getPeerConnectionManager().getPcHandler(e)){var h=s("sendFabricEvent ",v.csErrorStrings.pcInvalid);return b.error(h),o(f.callstatsAPIReturnStatus.failure,h)}try{w.fire(g.MainEvents.onSendFabricEvent,e,t,n,r),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"sendFabricEvent: Error",error:e.message+":"+e.stack}),b.error("sendFabricEvent: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"sendUserFeedback",value:function(e,t,n){if(!t||!e){var r=s("sendUserFeedback",v.csErrorStrings.argumentError);return b.error(r),o(f.callstatsAPIReturnStatus.failure,r)}if("object"!==(void 0===t?"undefined":u(t))){var i=s("sendUserFeedback",v.csErrorStrings.argumentError);return b.error(i),o(f.callstatsAPIReturnStatus.failure,i)}if(0===Object.keys(t).length){var a=s("sendUserFeedback",v.csErrorStrings.argumentError);return b.error(a),o(f.callstatsAPIReturnStatus.failure,a)}try{w.fire(g.MainEvents.onSendUserFeedback,e,t,n),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"sendUserFeedback: Error",error:e.message+":"+e.stack}),b.error("sendUserFeedback: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"associateMstWithUserID",value:function(e,t,n,r,i,a){if(n||(n=f.tmpConferenceId),!e||!r||!i){var u=s("associateMstWithUserID",v.csErrorStrings.argumentError);return b.error(u),o(f.callstatsAPIReturnStatus.failure,u)}if(!l(e)){var c=s("associateMstWithUserID",v.csErrorStrings.pcInvalid);return b.error(c),o(f.callstatsAPIReturnStatus.failure,c)}var d=m.Registry.getConferenceManager().get(n);if(!d){var h=s("associateMstWithUserID",v.csErrorStrings.confereneDoesNotExist);return b.error(h),o(f.callstatsAPIReturnStatus.failure,h)}if(!d.getPeerConnectionManager().getPcHandler(e)){var p=s("associateMstWithUserID",v.csErrorStrings.pcInvalid);return b.error(p),o(f.callstatsAPIReturnStatus.failure,p)}a&&"string"!=typeof a&&(b.error("associateMstWithUserID: Invalid videoTag"),a=null);try{w.fire(g.MainEvents.onAssociateMstWithUserID,e,t,n,r,i,a),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"associateMstWithUserID: Error",error:e.message+":"+e.stack}),b.error("associateMstWithUserID: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"reportError",value:function(e,t,n,r,i,a){if(t||(t=f.tmpConferenceId),void 0===e||!n){var l=s("reportError",v.csErrorStrings.argumentError);return b.error(l),o(f.callstatsAPIReturnStatus.failure,l)}if(!f.webRTCFunctions.hasOwnProperty(n)){var u=s("reportError",v.csErrorStrings.webRTCFunctionsInvalid,n);return b.error(u),o(f.callstatsAPIReturnStatus.failure,u)}if(void 0===r&&b.warn("reportError: Missing DOM error parameter"),!m.Registry.getCredentials().getAppId()||!m.Registry.getCredentials().getUserId()){var c=s("reportError",v.csErrorStrings.notInitialized);return b.error(c),o(f.callstatsAPIReturnStatus.failure,c)}try{w.fire(g.MainEvents.onReportError,e,t,n,r,i,a),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"reportError: Error",error:e.message+":"+e.stack}),b.error("reportError: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"setProxyConfig",value:function(e){if(window&&!window.csioproxy){var t=s("setProxyConfig",v.csErrorStrings.setProxyConfigInvokeError);return b.error(t),o(f.callstatsAPIReturnStatus.failure,t)}if(!e){var n=s("setProxyConfig",v.csErrorStrings.argumentError);return b.error(n),o(f.callstatsAPIReturnStatus.failure,n)}try{w.fire(g.MainEvents.onSetProxyConfig,e),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"setProxyConfig: Error",error:e.message+":"+e.stack}),b.error("setProxyConfig: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"attachWifiStatsHandler",value:function(e){if(!e){var t=s("attachWifiStatsHandler",v.csErrorStrings.argumentError);return b.error(t),o(f.callstatsAPIReturnStatus.failure,t)}if("function"!=typeof e){var n=s("attachWifiStatsHandler",v.csErrorStrings.argumentError);return b.error(n),o(f.callstatsAPIReturnStatus.failure,n)}try{w.fire(g.MainEvents.onAttachWifiStatsHandler,e),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"attachWifiStatsHandler: Error",error:e.message+":"+e.stack}),b.error("attachWifiStatsHandler: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"setIdentifiers",value:function(e,t){if(!e){var n=s("setIdentifiers",v.csErrorStrings.argumentError);return b.error(n),o(f.callstatsAPIReturnStatus.failure,n)}try{w.fire(g.MainEvents.onSetIdentifiers,e,t),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"setIdentifiers: Error",error:e.message+":"+e.stack}),b.error("setIdentifiers: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"makePrecallTest",value:function(){if(!m.Registry.getAuthenticator().getToken()||!m.Registry.getCredentials().getAppId()){var e=s("makePrecallTest",v.csErrorStrings.notInitialized);return b.error(e),o(f.callstatsAPIReturnStatus.failure,e)}if(!m.Registry.getAuthenticator().getIceServers()){var t=s("makePrecallTest",v.csErrorStrings.notInitialized);return b.error(t),o(f.callstatsAPIReturnStatus.failure,t)}if(!m.Registry.getCredentials().getCollectSDP()){var n=s("makePrecallTest",v.csErrorStrings.apiaccesserror);return b.error(n),o(f.callstatsAPIReturnStatus.failure,n)}try{w.fire(g.MainEvents.onMakePrecallTest),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),b.error("makePrecallTest: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"on",value:function(e,t){if(!t||"function"!=typeof t){var n=s("on",v.csErrorStrings.argumentError);return b.error(n),o(f.callstatsAPIReturnStatus.failure,n)}if(!e||!f.callbackFunctions.hasOwnProperty(e)){var r=s("on",v.csErrorStrings.argumentError);return b.error(r),o(f.callstatsAPIReturnStatus.failure,r)}try{w.fire(g.MainEvents.onOn,e,t),w.run()}catch(e){m.Registry.getGenericEventHandler().sendEvent(f.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),b.error("on: Error",e)}return o(f.callstatsAPIReturnStatus.success)}},{key:"fabricUsage",get:function(){return this.constructor.fabricUsage}},{key:"fabricEvent",get:function(){return this.constructor.fabricEvent}},{key:"webRTCFunctions",get:function(){return this.constructor.webRTCFunctions}},{key:"csError",get:function(){return this.constructor.csError}},{key:"qualityRating",get:function(){return this.constructor.qualityRating}},{key:"callStatsAPIReturnStatus",get:function(){return this.constructor.callStatsAPIReturnStatus}},{key:"version",get:function(){return this.constructor.version}},{key:"userIDType",get:function(){return this.constructor.userIDType}},{key:"transmissionDirection",get:function(){return this.constructor.transmissionDirection}},{key:"endpointType",get:function(){return this.constructor.endpointType}}]),e}();E.fabricUsage=f.fabricUsage,E.fabricEvent=f.fabricEvent,E.webRTCFunctions=f.webRTCFunctions,E.csError=v.csError,E.qualityRating=f.qualityRating,E.callStatsAPIReturnStatus=f.callstatsAPIReturnStatus,E.version=p.version,E.userIDType=f.userIdType,E.endpointType=f.endpointType,E.transmissionDirection=f.transmissionDirection,function(){function e(){return new E}"function"==typeof define&&define.amd?define("callstats",[],e):n.callstats=e,t.exports=e}("undefined"!=typeof window&&window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./config/callstatserrors":31,"./config/constants":32,"./config/settings":33,"./fsm/mainfsm":34,"./utility/csiologger":87,"./utility/onerroreventlistner":93,"./utility/registry":94,"./utility/utils":100}],22:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryTree=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./binarytreenode.js"),a=e("../utility/csiologger"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(a),u=function(){function e(t){i(this,e),this.root=null,this.top=null,this.bottom=null,this.comparator=t,this.node_counter=0,this.duplicate_counter=0}return o(e,[{key:"getTopNode",value:function(){return this.top}},{key:"getTopValue",value:function(){return null===this.top?null:this.top.peek()}},{key:"getBottomValue",value:function(){return null===this.bottom?null:this.bottom.peek()}},{key:"getBottomNode",value:function(){return this.bottom}},{key:"getDuplicatedCounter",value:function(){return this.duplicate_counter}},{key:"getNodeCounter",value:function(){return this.node_counter}},{key:"getSize",value:function(){return this.duplicate_counter+this.node_counter}},{key:"insertNodeAtTop",value:function(e){e&&this.inserting(e.getValues(),this.top)}},{key:"insertNodeAtBottom",value:function(e){e&&this.inserting(e.getValues(),this.bottom)}},{key:"insert",value:function(e){this.inserting([e],this.root)}},{key:"createNode",value:function(e){var t=new(Function.prototype.bind.apply(s.BinaryTreeNode,[null].concat(r(e))));return null===this.top?this.top=t:this.comparator(this.top.peek(),t.peek())<0&&(this.top=t),null===this.bottom?this.bottom=t:this.comparator(t.peek(),this.bottom.peek())<0&&(this.bottom=t),t}},{key:"inserting",value:function(e,t){if(null===this.root)return this.root=this.createNode(e),this.node_counter=1,void(this.duplicate_counter+=e.length-1);for(var n=null,r=t,i=0;null!==r;){if(0===(i=this.comparator(e[0],r.peek())))return r.concat(e),this.duplicate_counter+=e.length,void r.find(e[0]);n=r,r=i<0?r.getLeft():r.getRight()}++this.node_counter,this.duplicate_counter+=e.length-1,r=this.createNode(e),i<0?n.setLeft(r):n.setRight(r)}},{key:"getRightist",value:function(e){for(var t=null;null!==e.right;)t=e,e=e.right;return[e,t]}},{key:"getLeftist",value:function(e){for(var t=null;null!==e.getLeft();)t=e,e=e.getLeft();return[e,t]}},{key:"popBottomNode",value:function(){if(null===this.bottom)return null;var e=this.search(this.bottom.peek()),t=e[0],n=e[1];return this.replaceNode(t,n,t.getRight()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setRight(null),t}},{key:"popTopNode",value:function(){if(null===this.top)return null;var e=this.search(this.top.peek()),t=e[0],n=e[1];return null===t?null:(this.replaceNode(t,n,t.getLeft()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setLeft(null),t)}},{key:"search",value:function(e){for(var t=this.root,n=null,r=void 0;null!==t;){if(0===(r=this.comparator(e,t.peek())))return t.find(e)?[t,n]:[null,null];n=t,t=r<0?t.getLeft():t.getRight()}return[null,null]}},{key:"replaceNode",value:function(e,t,n){null!==t?t.left===e?t.left=n:t.right=n:this.root=n}},{key:"disposeNode",value:function(e){if(null===this.root)return void(this.bottom=this.top=null);if(0===this.comparator(this.top.peek(),e.peek())){var t=this.getRightist(this.root);this.top=t[0]}if(0===this.comparator(this.bottom.peek(),e.peek())){var n=this.getLeftist(this.root);this.bottom=n[0]}}},{key:"delete",value:function(e){var t=this.search(e),n=t[0],r=t[1];if(null===n)return!1;if(1<n.getLength())return n.remove(e),--this.duplicate_counter,!0;if(--this.node_counter,null===n.getLeft()&&null===n.getRight())this.replaceNode(n,r,null);else if(null===n.getLeft())this.replaceNode(n,r,n.getRight());else if(null===n.getRight())this.replaceNode(n,r,n.getLeft());else{for(var i=n.getLeft(),o=n;null!==i.getRight();o=i,i=i.getRight());var s=i.getLeft();o===n?o.setLeft(s):o.setRight(s),n.setValues(i.getValues())}return this.disposeNode(n),!0}},{key:"logging",value:function(){return null===this.root?void l.log("This tree is empty Duplicate Counter: "+this.duplicate_counter):(l.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTopNode().toString()+" Bottom: "+this.getBottomNode().toString()),void function e(t,n,r){if(null!==t){for(var i="-",o=0;o<n;++o)i+="--";l.log(i+"> ("+r+") ["+t.toString()+"]"),null!==t.getLeft()&&e(t.getLeft(),n+1,"Left"),null!==t.getRight()&&e(t.getRight(),n+1,"Right")}}(this.root,0,"Root"))}}]),e}();n.BinaryTree=u},{"../utility/csiologger":87,"./binarytreenode.js":23}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];this.values=n,this.left=null,this.right=null}return i(e,[{key:"getRight",value:function(){return this.right}},{key:"setRight",value:function(e){this.right=e}},{key:"getLeft",value:function(){return this.left}},{key:"setLeft",value:function(e){this.left=e}},{key:"push",value:function(e){this.values.push(e)}},{key:"concat",value:function(e){this.values=this.values.concat(e)}},{key:"pop",value:function(){return this.values.length<1?null:this.values.shift()}},{key:"remove",value:function(e){this.values.splice(this.values.indexOf(e),1)}},{key:"setValues",value:function(e){this.values=e}},{key:"getValues",value:function(){return this.values}},{key:"hasValue",value:function(){return 0<this.values.length}},{key:"getLength",value:function(){return this.values.length}},{key:"peek",value:function(){return this.values.length<1?null:this.values[0]}},{key:"find",value:function(e){return this.values.find(function(t){return t===e})}},{key:"toString",value:function(){return this.values.toString()}}]),e}();n.BinaryTreeNode=o},{}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../utility/csiologger"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=function(){function e(){r(this,e),this.queue=[],this.priority=[]}return i(e,[{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.length()>1e6?void s.error("Maximum cached items reached, dropping."):void(t?this.priority.push(e):this.queue.push(e))}},{key:"pop",value:function(){return this.priority.length>0?this.priority.shift():this.queue.shift()}},{key:"peak",value:function(){return this.priority.length>0?this.priority[0]:this.queue.length>0?this.queue[0]:null}},{key:"length",value:function(){return this.queue.length+this.priority.length}},{key:"updateConferenceId",value:function(e){for(var t=0;t<this.queue.length;++t)this.queue[t].updateConferenceId(e);for(var n=0;n<this.priority.length;++n)this.priority[n].updateConferenceId(e)}}]),e}();n.Cache=a},{"../utility/csiologger":87}],25:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Component=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./port"),s=e("../utility/csiologger"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown";r(this,e),this.name=t,this.ports=new Map}return i(e,[{key:"bindPort",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;return this.ports.has(e)?void a.warn("Port ("+e+") for "+this.name+" already exists."):void this.ports.set(e,new o.Port(t,n))}},{key:"declarePort",value:function(e){return this.ports.has(e)?void a.warn("Port ("+e+") for "+this.name+" already exists."):void this.ports.set(e,null)}},{key:"getPort",value:function(e){return this.ports.get(e)}},{key:"isConnected",value:function(e){return!!this.ports.has(e)&&null!==this.ports.get(e)}},{key:"connect",value:function(e,t){return this.ports.has(e)?void this.ports.set(e,t):void a.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"transmit",value:function(e){var t=this.ports.get(e);if(void 0===t)return void a.warn("Port ("+e+") for "+this.name+" does not exists.");if(null===t)return void a.warn("Port ("+e+") for "+this.name+" is not connected.");for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.transmit(r)}},{key:"request",value:function(e){var t=this.ports.get(e);if(void 0===t)return a.warn("Port ("+e+") for "+this.name+" does not exists."),null;if(null===t)return a.warn("Port ("+e+") for "+this.name+" is not connected."),null;for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.request(r)}}]),e}();n.Component=l},{"../utility/csiologger":87,"./port":26}],26:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this.target=t,this.object=n}return i(e,[{key:"transmit",value:function(e){this.target.apply(this.object,e)}},{key:"request",value:function(e){return this.target.apply(this.object,e)}}]),e}();n.Port=o},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SlidingWindow=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./switem"),s=e("../utility/timestamps"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);
return t["default"]=e,t}(s),l=function(){function e(t,n){r(this,e),this.items=[],this.plugins=[],this.postProcesses=[],this.preProcesses=[],this.timeoutInMs=n,this.maxItemsNum=t,this.minItemsNum=0}return i(e,[{key:"setMaxItemsNum",value:function(e){this.maxItemsNum=e}},{key:"setTimeoutInMs",value:function(e){this.timeoutInMs=e}},{key:"setMinItemsNum",value:function(e){this.minItemsNum=e}},{key:"refresh",value:function(){var e=a.getCurrent();if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();this.timeoutInMs&&this.timeoutInMs<e-this.items[0].getCreated()&&(this.remove(),this.refresh())}}},{key:"getLength",value:function(){return this.items.length}},{key:"add",value:function(e){this.refresh(),this.items.push(new o.SWItem(e));for(var t=0;t<this.preProcesses.length;t++)(0,this.preProcesses[t])(e);for(var n=0;n<this.plugins.length;n++)this.plugins[n].add(e);for(var r=0;r<this.postProcesses.length;r++)(0,this.postProcesses[r])(e)}},{key:"remove",value:function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)}},{key:"peek",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.items.length<=e?null:this.items[this.items.length-e-1].getValue()}},{key:"attach",value:function(e){this.plugins.push(e)}},{key:"addPreProcess",value:function(e){this.preProcesses.push(e)}},{key:"addPostProcess",value:function(e){this.postProcesses.push(e)}},{key:"detach",value:function(e){this.plugins=this.plugins.filter(function(t){return t!==e})}}]),e}();n.SlidingWindow=l},{"../utility/timestamps":98,"./switem":28}],28:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SWItem=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../utility/timestamps"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=function(){function e(t){r(this,e),this.value=t,this.created=s.getCurrent()}return i(e,[{key:"getValue",value:function(){return this.value}},{key:"getCreated",value:function(){return this.created}},{key:"toString",value:function(){return""}}]),e}();n.SWItem=a},{"../utility/timestamps":98}],29:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Conference=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../peerconnection/peerconnectionmanager"),a=e("../config/settings"),l=r(a),u=e("../utility/registry"),c=e("../browserapi/sessionstorage"),d=r(c),f=function(){function e(t,n){i(this,e),this.conferenceId=t,this.startTime,this.peerConnectionManager=new s.PeerConnectionManager,this.credentials=n,this.ucId=null,this.url=null,this.userJoinedSent=!1}return o(e,[{key:"getCredentials",value:function(){return this.credentials}},{key:"getUcId",value:function(){return this.ucId}},{key:"setUcId",value:function(e){this.ucId=e,this.url=l.conferenceBaseUrl+u.Registry.getCredentials().getAppId()+"/conferences/"+encodeURIComponent(this.conferenceId)+"/"+e+"/general",d.storeUcId(this.conferenceId,e)}},{key:"getPeerConnectionManager",value:function(){return this.peerConnectionManager}},{key:"getUrl",value:function(){return this.url}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.peerConnectionManager.updateConferenceId(e)}},{key:"close",value:function(e){}}]),e}();n.Conference=f},{"../browserapi/sessionstorage":20,"../config/settings":33,"../peerconnection/peerconnectionmanager":41,"../utility/registry":94}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./conference"),s=e("../config/constants"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(){r(this,e),this.conferenceMap=new Map}return i(e,[{key:"add",value:function(e,t){if(!this.get(e)){var n=new o.Conference(e,t);this.conferenceMap.set(e,n)}}},{key:"get",value:function(e){return this.conferenceMap.get(e)}},{key:"getConferenceForPc",value:function(e){var t=null;return e?(this.conferenceMap.forEach(function(n,r){var i=n.getPeerConnectionManager().getPcHandler(e);i&&i.getConferenceId()===r&&(t=n)}),t):t}},{key:"getConferenceForPcHash",value:function(e){var t=null;return e?(this.conferenceMap.forEach(function(n,r){var i=n.getPeerConnectionManager().getPcHandlerByHash(e);i&&i.getConferenceId()===r&&(t=n)}),t):t}},{key:"updateConferenceId",value:function(e){var t=a.tmpConferenceId,n=this.get(t);n&&(n.updateConferenceId(e),this.conferenceMap.set(e,n),this.conferenceMap["delete"](t))}},{key:"getConferenceIds",value:function(){var e=[];return this.conferenceMap.forEach(function(t,n){e.push(n)}),e}}]),e}();n.ConferenceManager=l},{"../config/constants":32,"./conference":29}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.csError={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK",authOngoing:"authOngoing",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction"},n.csErrorStrings={argumentError:"Argument missing/invalid",cryptoError:"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",fabricEventUnsupported:"Unsupported fabricEvent",fabricEventInvalid:"Invalid fabricEvents value",fabricUsageInvalid:"Invalid fabricUsage value",notInitialized:"SDK is not initialized or no Fabrics added",pcInvalid:"Invalid PeerConnection object passed",confereneDoesNotExist:"conferenceId does not exist",webRTCFunctionsInvalid:"Invalid webRTC functionName value",setProxyConfigInvokeError:"cannot be called if window.csioproxy is false",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction",apiaccesserror:"API access Error"},n.csErrorReason={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},n.internalErrors={authOngoing:"authOngoing"},n.authErrorActions={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2}},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.logEvents={stateMachine:"stateMachine",log:"log",timing:"timing",error:"error",getStatsError:"getStatsError",restResponseError:"restResponseError"},n.fabricEvent={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},n.internalFabricEvent={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",userAlive:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStart:"mediaPlaybackStart",mediaPlaybackSuspended:"mediaPlaybackSuspended",mediaPlaybackStalled:"mediaPlaybackStalled",oneWayMedia:"oneWayMedia",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDeviceList:"connectedDeviceList",sdpSubmission:"sdpSubmissionEvent",sendingThroughputObservations:"sendingThroughputObservations",limitationObservations:"limitationObservations",userDetails:"userDetails"},n.callstatsChannels={sdpSubmission:"sdpSubmissionEvent",processedStats:"processedStats",callstatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",preCallTest:"preCallTest",senderConfiguration:"senderConfiguration"},n.precalltestEvents={results:"preCallTestResults",associate:"preCallTestAssociate"},n.callstatsAPIReturnStatus={success:"success",failure:"failure"},n.fabricUsage={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},n.userIdType={local:"local",remote:"remote"},n.qualityRating={excellent:5,good:4,fair:3,poor:2,bad:1},n.reportType={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},n.avQualityRatings={excellent:"excellent",fair:"fair",bad:"bad",unknown:"unknown"},n.fabricState={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",hold:"hold",checkingDisrupted:"checkingDisrupted",terminated:"terminated"},n.webRTCFunctions={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},n.callFailureReasons={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog",invalidWebRTCFunctionName:"Invalid WebRTC function name"},n.throughputThreshold={video:{green:1024,red:256},audio:{green:30,red:8}},n.currOverPrevFrameRateThreshold={video:{green:.8,red:.3}},n.rttThreshold={video:{green:400,red:1e3}},n.fractionalLossThreshold={video:{green:.1,red:.5},audio:{green:.15,red:.3}},n.eModelThreshold={audio:{green:240,red:400}},n.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},n.browserName={chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari",opera:"Opera"},n.osName={windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"},n.mediaType={audio:"audio",video:"video"},n.streamType={inbound:"inbound",outbound:"outbound"},n.fabricStateChangeType={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},n.transportType={rest:"rest",ws:"ws"},n.wsConnectionState={initiated:"initiated",connected:"connected",closed:"closed"},n.csCallBackMessages={authSuccessful:"SDK authentication successful.",authFailed:"SDK authentication failed.",authProtocolInvalid:"Fatal authentication error. Invalid auth protocol message.",authOngoing:"Authentication on going.",wsConnected:"WebSocket establishment successful.",wsClosed:"WebSocket server closed.",wsFailed:"WebSocket establishment failed."},n.oneWayMediaTypes={audio:"audio",video:"video",screen:"screen"},n.limitationType={cpu:"cpu",network:"network"},n.qualityDisruptionTypes={qpchange:"qpchange"},n.callbackFunctions={stats:"stats",defaultConfig:"defaultConfig",recommendedConfig:"recommendedConfig",preCallTestResults:"preCallTestResults"},n.endpointType={peer:"peer",server:"server"},n.transmissionDirection={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},n.tmpConferenceId="csio-conf-id-tmp"},{}],33:[function(e,t,n){"use strict";function r(e){n.configServiceUrl=f=e}function i(e){n.authServiceUrl=h=e}function o(e){n.conferenceBaseUrl=p=e}function s(e){n.wsUrl=v=e}function a(e){n.restEventUrl=g=e}function l(e){n.restStatsUrl=m=e}function u(e){n.baseUrl=y=e}function c(e){n.qmodelThresholdsAPIUrl=b=e}function d(e){n.transportType=_=e}Object.defineProperty(n,"__esModule",{value:!0}),n.setConfigServiceUrl=r,n.setAuthServiceUrl=i,n.setConferenceBaseUrl=o,n.setWsUrl=s,n.setRestEventUrl=a,n.setRestStatsUrl=l,n.setBaseUrl=u,n.setQmodelThresholdsAPIUrl=c,n.setTransportType=d;var f=(n.version="3.50.3",n.configServiceUrl="https://appsettings.callstats.io/v1/apps/"),h=n.authServiceUrl="https://auth.callstats.io/",p=(n.authRetryTimeout=5e3,n.conferenceBaseUrl="https://dashboard.callstats.io/apps/"),v=n.wsUrl="wss://collector.callstats.io:443/csiows/collectCallStats",g=n.restEventUrl="https://events.callstats.io/v1/apps/",m=n.restStatsUrl="https://stats.callstats.io/v1/apps/",y=n.baseUrl="https://collector.callstats.io:443/",b=n.qmodelThresholdsAPIUrl="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",_=(n.csioDebug="false",n.transportType="@@transportType")},{}],34:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],i=void 0,o=0;o<n;o++)if(i=t[o],e.call(r,i,o,t))return i}})}Object.defineProperty(n,"__esModule",{value:!0}),n.MainFSM=n.MainEvents=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=e("./statemachine"),f=e("../utility/registry"),h=e("../utility/csiologger"),p=r(h),v=e("../utility/utils"),g=r(v),m=e("../utility/timestamps"),y=r(m),b=e("../config/constants"),_=r(b),S=e("../config/settings"),T=r(S),C=e("./utility"),w=r(C),E=e("../statspipeline/statsadapter"),k=e("../statspipeline/statsparser"),R=e("../statspipeline/statsmonitor"),I=e("../statspipeline/statstransmitter"),P=e("../statspipeline/statsassembler"),A={Created:"Created",Initializing:"Initializing",Idle:"Idle",Run:"Run"},O=n.MainEvents={onStart:"onStart",onInitialize:"onInitialize",onAddNewFabric:"onAddNewFabric",onSendFabricEvent:"onSendFabricEvent",onReportError:"onReportError",onAssociateMstWithUserID:"onAssociateMstWithUserID",onSetProxyConfig:"onSetProxyConfig",onAttachWifiStatsHandler:"onAttachWifiStatsHandler",onSendUserFeedback:"onSendUserFeedback",onOn:"onOn",onSetIdentifiers:"onSetIdentifiers",onMakePrecallTest:"onMakePrecallTest"},M={onServicesFinished:"onServicesFinished"},D=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,A.Created));return p.log("FSM:",e.getState()),e.fire(O.onStart),e.run(),l(),e}return a(t,e),c(t,[{key:"proceed",value:function(e,t){switch(this.getState()){case A.Created:switch(e){case O.onStart:this.onStart.apply(this,i(t));break;case O.onInitialize:this.setState(A.Initializing),p.log("FSM:",this.getState()),this.onInitialize.apply(this,i(t));break;case O.onOn:this.onOn.apply(this,i(t))}break;case A.Initializing:switch(e){case M.onServicesFinished:this.onServicesFinished()&&(this.setState(A.Idle),p.log("FSM:",this.getState()));break;case O.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case O.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case O.onReportError:this.onReportError.apply(this,i(t));break;case O.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case O.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case O.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case O.onOn:this.onOn.apply(this,i(t));break;case O.onMakePrecallTest:this.onMakePrecallTest();break;case O.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t))}break;case A.Idle:case A.Run:switch(e){case O.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case O.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case O.onReportError:this.onReportError.apply(this,i(t));break;case O.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case O.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case O.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case O.onOn:this.onOn.apply(this,i(t));break;case O.onMakePrecallTest:this.onMakePrecallTest();break;case O.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t))}}}},{key:"onStart",value:function(){f.Registry.getEndpoint().setup(),this.authenticator=f.Registry.getAuthenticator(),this.configservicewrapper=f.Registry.getConfigServiceWrapper(),this.precalltest=f.Registry.getPreCallTest(),this.precalltestIds=[];var e=f.Registry.getStatsAdapter(),t=f.Registry.getStatsParser(),n=f.Registry.getStatsMonitor(),r=f.Registry.getStatsTransmitter(),i=f.Registry.getStatsAssembler();e.connect(E.StatsAdapterIO.RawStatsOut,t.getPort(k.StatsParserIO.RawStatsIn)),t.connect(k.StatsParserIO.PcStatsTupleOut,n.getPort(R.StatsMonitorIO.PcStatsTupleIn)),n.connect(R.StatsMonitorIO.StatsTupleOut,i.getPort(P.StatsAssemblerIO.StatsTupleIn)),i.connect(P.StatsAssemblerIO.CallstatsOut,r.getPort(I.StatsTransmitterIO.CallstatsIn)),e.connect(E.StatsAdapterIO.UnprocessedOut,r.getPort(I.StatsTransmitterIO.UnprocessedIn))}},{key:"setupConnection",value:function(){var e=this;this.connectionManager=f.Registry.getConnectionManager(),this.connectionManager.setupCollectorConnection(f.Registry.getCredentials().getTransportType()),this.connectionManager.setup().then(function(){p.log("Connected to connectionManager"),e.fire(M.onServicesFinished),e.run()})["catch"](function(e){return p.log("Could not connect to connectionManager",e)})}},{key:"setup",value:function(){var e=this;this.clocksync=f.Registry.getClockSync(),this.clocksync.initiate().then(function(){p.log("Clocksync completed"),e.fire(M.onServicesFinished),e.run()})["catch"](function(e){return p.log("Could not finish ClockSync",e)})}},{key:"onInitialize",value:function(e,t,n,r,i,o){var s=this,a=f.Registry.getCredentials();a.setAppId(e),a.setUserId(t),f.Registry.getCallbacks().set(_.callbackFunctions.stats,i),this.doPrecalltest=!0,f.Registry.getGenericEventHandler().sendEvent(_.logEvents.log,{msg:"callstats initialize in progress"}),o&&(!0===o.disableBeforeUnloadHandler&&this.setBeforeUnloadHandler(),o.applicationVersion&&f.Registry.getEndpoint().setAppVersion(o.applicationVersion),o.transportType&&T.setTransportType(o.transportType),o.disablePrecalltest&&(this.doPrecalltest=!1)),this.setup(),this.authenticator.initiate(n,r).then(function(e){p.log("Authentication complete"),s.setupConnection();var t=f.Registry.getCredentials().getStatsSubmissionInterval();f.Registry.getStatsMonitor().setIntervals(t,t),s.fire(M.onServicesFinished),s.run();var n=s.authenticator.getIceServers();n&&s.doPrecalltest&&s.precalltest.start(n,s.precalltestCallback.bind(s)),s.configservicewrapper.initiateInternalConfig().then(function(){p.log("ConfigService internal config:",s.configservicewrapper.getInternalConfig()),s.fire(M.onServicesFinished),s.run()},function(e){return p.log(e)}),s.configservicewrapper.initiateAppConfig().then(function(){var e=f.Registry.getCallbacks().get(_.callbackFunctions.defaultConfig),t=s.configservicewrapper.getAppDefaultConfig();e&&t&&e(t);var n=f.Registry.getCallbacks().get(_.callbackFunctions.recommendedConfig),r=s.configservicewrapper.getAppRecommendedConfig();n&&r&&n(r),s.fire(M.onServicesFinished),s.run()},function(e){return p.log(e)})},function(e){p.log(e)}),this.genericevent=f.Registry.getGenericEventHandler(),this.genericevent.sendEvent(_.logEvents.log,{msg:"callstats initialize in progress"})}},{key:"precalltestCallback",value:function(e,t){var n=f.Registry.getCallbacks().get(_.callbackFunctions.preCallTestResults);if(n){if(t){var r={msg:"precalltest error: "+t};return p.warn("backendlog",r),this.genericevent.sendEvent(_.logEvents.log,r),void n(_.callstatsAPIReturnStatus.failure,null)}var i=w.getPublicPrecalltestResults(e);n(_.callstatsAPIReturnStatus.success,i)}e&&(this.precalltestIds.push(e.id),e.tests&&e.tests.ice&&(""===e.tests.ice.turnIpAddress&&delete e.tests.ice.turnIpAddress,""===e.tests.ice.turnIpVersion&&delete e.tests.ice.turnIpVersion,""===e.tests.ice.turnTransport&&delete e.tests.ice.turnTransport),p.log("sending preCallTest results",e),f.Registry.getEventMessageBuilder().make(_.precalltestEvents.results,null,null,{results:e}))}},{key:"setBeforeUnloadHandler",value:function(){window&&window.addEventListener&&(p.log("setBeforeUnloadHandler"),window.addEventListener("beforeunload",function(e){return f.Registry.getConferenceManager().conferenceMap.forEach(function(e,t){e&&e.getPeerConnectionManager().pcHandlers.forEach(function(e,t){f.Registry.getEventMessageBuilder().make(_.internalFabricEvent.userLeft,e.getConferenceId(),e.getPeerConnection())})}),"Are you sure you want to close the call?"}))}},{key:"onServicesFinished",value:function(){return!!(this.connectionManager&&this.connectionManager.isReady()&&this.clocksync.isCompleted()&&this.authenticator.isCompleted())&&(f.Registry.getTransmissionManager().trySend(),!0)}},{key:"onAddNewFabric",value:function(e,t,n,r,i,o,s){p.warn("FSM onAddNewFabric"),f.Registry.getConferenceManager().add(r,f.Registry.getCredentials());var a=f.Registry.getConferenceManager().get(r);a.getPeerConnectionManager().addPcHandler(e,t,n,r,i,o,s);var l={endpointInfo:f.Registry.getEndpoint().serialize()};f.Registry.getCredentials().getUserIdObject()&&(l.localUserIDObject=f.Registry.getCredentials().getUserIdObject()),a.userJoinedSent||(f.Registry.getEventMessageBuilder().make(_.internalFabricEvent.userJoined,r,e,l),a.userJoinedSent=!0,f.Registry.getCredentials().getTransportType()===_.transportType.rest&&l.localUserIDObject&&l.localUserIDObject.userName&&f.Registry.getEventMessageBuilder().make(_.internalFabricEvent.userDetails,r,e,{userName:String(l.localUserIDObject.userName)}));var u=this.precalltestIds;this.precalltestIds=[];var c=this.precalltest.getId();c&&u.push(c),u.length>0&&f.Registry.getEventMessageBuilder().make(_.precalltestEvents.associate,r,e,{ids:u})}},{key:"onSendFabricEvent",value:function(e,t,n,r){p.warn("FSM onSendFabricEvent");var i={};r&&(i=r),t===_.fabricEvent.activeDeviceList&&(i={mediaDeviceList:g.normalizeMediaDeviceList(r.deviceList)}),f.Registry.getEventMessageBuilder().make(t,n,e,i);var o=f.Registry.getConferenceManager().get(n);if(o){var s=o.getPeerConnectionManager().getPcHandler(e);t!==_.fabricEvent.fabricTerminated&&t!==_.internalFabricEvent.fabricSetupFailed||(s.stopUserAliveHandler(),s.setPcState(_.fabricState.terminated),s.stopStatsPolling()),t===_.fabricEvent.fabricHold&&(s.setPcState(_.fabricState.hold),s.stopStatsPolling()),t===_.fabricEvent.fabricResume&&(s.setPcState(_.fabricState.established),s.startStatsPolling())}}},{key:"onReportError",value:function(e,t,n,r,i,o){p.warn("FSM onReportError");var s={failureDelay:0,reason:this.callFailureClassifier(n),"function":n,magicKey:f.Registry.getEndpoint().getMagicKey(),endpoint:f.Registry.getEndpoint().serialize(),level:"debug"};if(r){var a=this.formatDomError(r);s.message=a.message,s.messageType=a.messageType,s.name=r.name,s.stack=r.stack}if(e){var l=f.Registry.getConferenceManager().get(t),u=void 0;if(l&&(u=l.getPeerConnectionManager().getPcHandler(e)),!u)return void p.error("onReportError: No handler found for given PeerConnection!");if(s.failureDelay=y.getCurrent()-u.getStartTime(),s.fabricState=u.getPcState(),s.iceConnectionState=u.getIceConnectionState(),(i||o||e&&"closed"!==e.signalingState)&&f.Registry.getCredentials().getCollectSDP()&&n===_.fabricEvent.fabricSetupFailed){var c={};c.localSDP=this.pickSDP(e,i,"localDescription"),c.remoteSDP=this.pickSDP(e,o,"remoteDescription"),f.Registry.getEventMessageBuilder().make(_.callstatsChannels.sdpSubmission,t,e,c)}}n===_.webRTCFunctions.applicationLog||n===_.webRTCFunctions.applicationError?f.Registry.getEventMessageBuilder().make(_.fabricEvent.applicationErrorLog,t,e,s):f.Registry.getEventMessageBuilder().make(_.fabricEvent.fabricSetupFailed,t,e,s)}},{key:"onAssociateMstWithUserID",value:function(e,t,n,r,i,o){var s=f.Registry.getConferenceManager().get(n);if(s){var a=s.getPeerConnectionManager().getPcHandler(e);"string"!=typeof r&&(r+=""),a.updateSSRCInfo(r,t,i,o)}}},{key:"onAttachWifiStatsHandler",value:function(e){f.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(e)}},{key:"onSetProxyConfig",value:function(e){e.collectorURL&&T.setBaseUrl(e.collectorURL),e.authServiceURL&&T.setAuthServiceUrl(e.authServiceURL),e.csioInternalAPIURL&&T.setQmodelThresholdsAPIUrl(e.csioInternalAPIURL),e.wsURL&&T.setWsUrl(e.wsURL),e.restEventUrl&&T.setRestEventUrl(e.restEventURL),e.restStatsUrl&&T.setRestStatsUrl(e.restStatsURL),this.setup()}},{key:"onSendUserFeedback",value:function(e,t,n){var r={feedback:{overallRating:t.overall}};t.video&&(r.feedback.videoQualityRating=t.video),t.audio&&(r.feedback.audioQualityRating=t.audio),t.comment&&(r.feedback.comments=t.comment),f.Registry.getEventMessageBuilder().make(_.callstatsChannels.userFeedback,e,null,r)}},{key:"onOn",value:function(e,t){f.Registry.getCallbacks().set(e,t)}},{key:"onSetIdentifiers",value:function(e,t){if(e.conferenceID&&(f.Registry.getConferenceManager().updateConferenceId(e.conferenceID),f.Registry.getTransmissionManager().updateConferenceId(e.conferenceID),f.Registry.getTransmissionManager().trySend()),e.remoteUserID&&t){var n=f.Registry.getConferenceManager().getConferenceForPc(t);if(!n)return void p.log("onSetIdentifiers conference not found");var r=n.getPeerConnectionManager().getPcHandler(t);if(!r)return void p.log("pcHandler not found");r.updateRemoteId(e.remoteUserID),f.Registry.getTransmissionManager().trySend()}}},{key:"onMakePrecallTest",value:function(){var e=this,t=this.authenticator.getIceServers();e.precalltest.start(t,e.precalltestCallback.bind(e))}},{key:"callFailureClassifier",value:function(e){var t=void 0;return _.webRTCFunctions.hasOwnProperty(e)?e===_.webRTCFunctions.createOffer||e===_.webRTCFunctions.createAnswer||e===_.webRTCFunctions.setRemoteDescription?t=_.callFailureReasons.negotiationFailure:e===_.webRTCFunctions.setLocalDescription?t=_.callFailureReasons.sdpError:e===_.webRTCFunctions.addIceCandidate?t=_.callFailureReasons.sdpError:e===_.webRTCFunctions.getUserMedia?t=_.callFailureReasons.mediaConfigError:e===_.webRTCFunctions.iceConnectionFailure?t=_.callFailureReasons.iceFailure:e===_.webRTCFunctions.signalingError?t=_.callFailureReasons.signalingError:(e===_.webRTCFunctions.applicationLog||_.webRTCFunctions.applicationError)&&(t=_.callFailureReasons.applicationLog):t=_.callFailureReasons.invalidWebRTCFunctionName,t}},{key:"formatDomError",value:function(e){var t={},n={};e&&(window.DOMException&&e instanceof window.DOMException?(n.message=e.message,n.name=e.name,t.messageType="domError"):"object"===(void 0===e?"undefined":u(e))?(e.message&&(n.message=e.message),e.name&&(n.name=e.name),e.constraintName&&(n.name=e.constraintName),e.stack&&(n.stack=e.stack),t.messageType="json"):(n=e,t.messageType="text"));var r=this.truncateLog(n);return"object"===(void 0===r?"undefined":u(r))?t.message=JSON.stringify(r):t.message=r,t}},{key:"pickSDP",value:function(e,t,n){return t||(e&&e[n]?e[n].sdp:"")}},{key:"truncateString",value:function(e){return e.length>2e4&&(p.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e}},{key:"truncateLog",value:function(e){return e?("string"==typeof e?e=this.truncateString(e):"object"===(void 0===e?"undefined":u(e))&&e.message&&(e.message=this.truncateString(e.message)),e):e}}]),t}(d.StateMachine);n.MainFSM=D},{"../config/constants":32,"../config/settings":33,"../statspipeline/statsadapter":68,"../statspipeline/statsassembler":69,"../statspipeline/statsmonitor":71,"../statspipeline/statsparser":72,"../statspipeline/statstransmitter":73,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98,"../utility/utils":100,"./statemachine":36,"./utility":37}],35:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n){r(this,e),this.type=t,this.args=void 0!==n?n:null}return i(e,[{key:"getType",value:function(){return this.type}},{key:"getArgs",value:function(){return this.args}}]),e}();n.ProgramEvent=o},{}],36:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.StateMachine=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./programevent"),s=e("../utility/csiologger"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(t){r(this,e),this.events=[],this.state=t}return i(e,[{key:"fire",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=new o.ProgramEvent(e,n);this.events.push(i)}},{key:"proceed",value:function(e,t){a.warn("You need to overwrite the proceed function inan extended StateMachine")}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}},{key:"run",value:function(){if(!(this.events.length<1)){var e=this.events.shift();this.proceed(e.getType(),e.getArgs())}}}]),e}();n.StateMachine=l},{"../utility/csiologger":87,"./programevent":35
}],37:[function(e,t,n){"use strict";function r(e){var t={mediaConnectivity:!1,throughput:null,fractionalLoss:null,rtt:null};return e&&e.tests?(e.tests.rtt&&(t.rtt=e.tests.rtt.median,t.mediaConnectivity=!0),e.tests.throughput&&(t.throughput=e.tests.throughput.average,t.fractionalLoss=Math.max(e.tests.throughput.fractionLostBytes,0),t.mediaConnectivity=!0),e.tests.ice&&(e.tests.ice.relayTcpSuccess||e.tests.ice.relayTlsSuccess||e.tests.ice.relayUdpSuccess)&&(t.mediaConnectivity=!0),t):t}Object.defineProperty(n,"__esModule",{value:!0}),n.getPublicPrecalltestResults=r},{}],38:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/constants"),a=r(s),l=e("../statspipeline/statsadapter"),u=e("../utility/registry"),c=e("../utility/rttregistry"),d=e("../utility/csiologger"),f=r(d),h=function(){function e(t,n,r,o,s){i(this,e),this.pc=t,this.interval=r,this.codeBase=o,this.browserName=s,this.getStatsTimer=null,this.isPromiseBased=!0,this.pcHash=n,this.genericevent=u.Registry.getGenericEventHandler()}return o(e,[{key:"startStatsPolling",value:function(){var e=this;e.getStatsTimer||(f.log("startStatsPolling for ",e.pcHash),this.getStatsTimer=setInterval(function(){e.csioGetStats(e.statsHandler,e.pcHash)},e.interval))}},{key:"stopStatsPolling",value:function(){this.getStatsTimer&&(clearInterval(this.getStatsTimer),this.getStatsTimer=null)}},{key:"csioGetStats",value:function(e,t){var n=a.codeBaseType.firefox,r=a.codeBaseType.chrome,i=a.codeBaseType.edge,o=a.browserName.safari;if(this.pc)try{this.isTemaSys()?this.getStatsTemasys(e,t):this.codeBase===n?this.getStatsFirefox(e,t):this.browserName===o?this.getStatsSafari(e,t):this.codeBase===r?this.getStatsChrome(e,t):this.codeBase===i&&this.getStatsEdge(e,t)}catch(e){f.log("csioGetStats: Error ",e)}}},{key:"getStatsTemasys",value:function(e,t){this.pc.getStats(null,function(n){e(n,t)},function(e){f("getStatsTemasys error",e)})}},{key:"getStatsFirefox",value:function(e,t){var n=this,r=this.pc;if(!n.isPromiseBased)return void r.getStats(null,function(n){e(n,t)});try{r.getStats().then(function(n){e(n,t)})["catch"](function(i){n.isPromiseBased=!1,r.getStats(null,function(n){e(n,t)})})}catch(i){n.isPromiseBased=!1,n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Firefox getStats reports error ",error:i.message+":"+i.stack}),r.getStats(null,function(n){e(n,t)})}}},{key:"getStatsChrome",value:function(e,t){var n=this,r=n.pc;if(window&&window.csioReactNative)return void r.getStats(null,function(n){e(n,t)},function(e){n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"react-native getStats reports error",error:e.message+":"+e.stack})});if(!n.isPromiseBased)return void r.getStats(function(n){e(n,t)});try{r.getStats().then(function(n){(0,c.getRTTRegistry)().update(r),e(n,t)})["catch"](function(i){f.log("Chrome getStats Error ",i),n.isPromiseBased=!1,n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:i.message+":"+i.stack}),r.getStats(function(n){e(n,t)})})}catch(i){n.isPromiseBased=!1,n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:i.message+":"+i.stack}),r.getStats(function(n){e(n,t)})}}},{key:"getStatsEdge",value:function(e,t){var n=this;n.pc.getStats().then(function(n){e(n,t)})["catch"](function(r){e({},t),r?n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Edge getStats reports error",error:r.message+":"+r.stack}):n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Edge getStats reports error"})})}},{key:"getStatsSafari",value:function(e,t){var n=this;n.pc.getStats().then(function(n){e(n,t)})["catch"](function(e){n.genericevent.sendEvent(a.logEvents.getStatsError,{msg:"Safari getStats reports error",error:e.message+":"+e.stack})})}},{key:"statsHandler",value:function(e,t){var n=u.Registry.getStatsAdapter();if(e&&n)try{n.transmit(l.StatsAdapterIO.RawStatsIn,e,t)}catch(e){f.log("statsHandler 123: Error ",e),u.Registry.getGenericEventHandler().sendEvent(a.logEvents.error,{msg:"statsHandler: Error",error:e.message+":"+e.stack})}}},{key:"iceCandidatesHandler",value:function(e,t){var n=u.Registry.getStatsAdapter(),r=void 0;r=n.getIceCandidates(e),t(r)}},{key:"getIceCandidates",value:function(){var e=this;return new Promise(function(t,n){e.csioGetStats(e.iceCandidatesHandler,function(e){t(e)})})}},{key:"isTemaSys",value:function(){return!!(window&&window.AdapterJS&&window.AdapterJS.WebRTCPlugin&&window.AdapterJS.WebRTCPlugin.plugin)}}]),e}();n.GetStatsHandler=h},{"../config/constants":32,"../statspipeline/statsadapter":68,"../utility/csiologger":87,"../utility/registry":94,"../utility/rttregistry":95}],39:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PcCallbackHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/constants"),a=r(s),l=e("../utility/registry"),u=e("../utility/timestamps"),c=r(u),d=e("../config/callstatserrors"),f=r(d),h=e("../utility/csiologger"),p=r(h),v=function(){function e(t,n,r,o,s,u){var d=this;i(this,e),n&&(this.conferenceId=t,this.pc=n,this.getStatsHandler=r,this.userAlive=o,this.callback=u,this.remoteId=s,this.clocksync=l.Registry.getClockSync(),this.emb=l.Registry.getEventMessageBuilder(),this.precalltest=l.Registry.getPreCallTest(),this.genericevent=l.Registry.getGenericEventHandler(),this.iceCandidates=[],this.iceConnectionState=n.iceConnectionState,this.iceGatheringState=n.iceGatheringState,this.signalingState=n.signalingState,this.oldIceConnectionState="",this.oldIceGatheringState="",this.iceConnectionStateTS="",this.negotiationNeeded=0,this.pcState=a.fabricState.initializing,this.disruptedTS=0,this.startTime=c.getCurrent(),this.established=!1,this.activeIceCandidatePair=null,this.prevActiveIceCandidatePair=null,this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceCandidatePairs=[],this.iceConnectivityDelay=0,this.iceGatheringDelay=0,this.fabricSetupSent=!1,this.pc&&this.pc.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):this.pc&&this.pc.attachEvent?(p.info("attachEvent"),this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this))):p.error("callstats cannot monitor or collect stats"),!n||"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState||(this.pcState=a.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(e){d.localIceCandidates=e.localIceCandidates,d.remoteIceCandidates=e.remoteIceCandidates,d.iceCandidatePairs=e.iceCandidatePairs,d.prevActiveIceCandidatePair=d.activeIceCandidatePair,d.activeIceCandidatePair=d.getActiveIceCandidatePair(),d.sendfabricSetup(),d.startStatsPolling()})))}return o(e,[{key:"iceCandidateCallback",value:function(e){if(e&&e.candidate){var t=e.candidate.candidate.split(" ");if("0"!==t[4]&&"0"!==t[5]){var n=-1!==t[4].indexOf(":"),r="1"===t[1]?"rtp":"rtcp",i={transport:t[2],protocol:r,typePreference:t[3],address:n?"["+t[4]+"]:"+t[5]:t[4]+":"+t[5],type:t[7],media:e.candidate.sdpMid};-1===this.iceCandidates.indexOf(i)&&(this.iceCandidates.push(i),p.warn("CALLBACK: ICE candidate",i))}}}},{key:"iceConnectionStateChangeCallback",value:function(e){var t=this;if(e){p.log("pc states ",this.pc.iceGatheringState,this.pc.iceConnectionState),this.iceConnectionStateTS=this.clocksync.getSynchronizedTimestamp(),this.handleIceGatheringState(),this.handleIceConnectionState(),p.log("states ",this.iceGatheringState,this.iceConnectionState),"complete"===this.iceGatheringState&&"checking"===this.iceConnectionState&&this.handleIceChecking();var n={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState},r=this.iceConnectionState;this.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.prevActiveIceCandidatePair=t.activeIceCandidatePair,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),"connected"===r||"completed"===r?t.handleIceConnectedOrCompleted(n):"failed"===r?t.handleIceFailed(n):"disconnected"===r?t.handleIceDisconnected(n):"closed"===r?t.handleIceClosed(n):"new"===r&&t.handleIceRestart(n)})}}},{key:"sendFabricStateChange",value:function(e){this.emb.make(a.internalFabricEvent.fabricStateChange,this.conferenceId,this.pc,e)}},{key:"handleIceConnectionState",value:function(){this.oldIceConnectionState=this.iceConnectionState,this.iceConnectionState=this.pc.iceConnectionState,p.warn("CALLBACK: ICE connection state change",this.oldIceConnectionState,"->",this.iceConnectionState);var e={changedState:a.fabricStateChangeType.iceConnectionState,prevState:this.oldIceConnectionState,newState:this.iceConnectionState};this.sendFabricStateChange(e)}},{key:"handleIceGatheringState",value:function(){if(this.iceGatheringState!==this.pc.iceGatheringState){"complete"===this.pc.iceGatheringState&&(this.iceGatheringDelay=c.getCurrent()-this.startTime),this.oldIceGatheringState=this.iceGatheringState,this.iceGatheringState=this.pc.iceGatheringState,p.warn("CALLBACK: ICE gathering state change",this.oldIceGatheringState,"->",this.iceGatheringState);var e={changedState:a.fabricStateChangeType.iceGatheringState,prevState:this.oldIceGatheringState,newState:this.iceGatheringState};this.sendFabricStateChange(e)}}},{key:"handleIceChecking",value:function(){if("disconnected"===this.oldIceConnectionState&&this.pcState===a.fabricState.checkingDisrupted){var e={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState,disruptionDelay:c.getCurrent()-this.disruptedTS};this.emb.make(a.internalFabricEvent.iceConnectionDisruptionEnd,this.conferenceId,this.pc,e)}}},{key:"handleIceConnectedOrCompleted",value:function(e){var t=c.getCurrent();this.pcState===a.fabricState.disrupted&&(e.prevIceCandidatePair=this.prevActiveIceCandidatePair,e.currIceCandidatePair=this.activeIceCandidatePair,e.disruptionDelay=t-this.disruptedTS,this.emb.make(a.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,e)),this.iceConnectivityDelay=t-this.startTime,this.established=!0,this.pcState=a.fabricState.established,this.sendfabricSetup(),this.startStatsPolling()}},{key:"sendfabricSetup",value:function(){if(this.fabricSetupSent)return void p.log("fabricSetup has been sent already");var e={delay:c.getCurrent()-this.startTime,iceGatheringDelay:this.iceGatheringDelay,iceConnectivityDelay:this.iceConnectivityDelay,localIceCandidates:this.localIceCandidates,remoteIceCandidates:this.remoteIceCandidates,iceCandidatePairs:this.iceCandidatePairs};this.fabricSetupSent=!0;var t=void 0;this.conferenceId&&(t=l.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc),e.remoteEndpointType=t.getRemoteEndpointType(),e.fabricTransmissionDirection=t.getFabricTransmissionDirection()),this.pcState=a.fabricState.established,this.emb.make(a.internalFabricEvent.fabricSetup,this.conferenceId,this.pc,e)}},{key:"isFabricSetupSent",value:function(){return this.fabricSetupSent}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"handleIceFailed",value:function(e){e.currIceCandidatePair=this.activeIceCandidatePair,e.failureDelay=c.getCurrent()-this.startTime,e.delay=c.getCurrent()-this.startTime,this.pcState=a.fabricState.failed,"checking"===this.oldIceConnectionState?this.sendIceFailed(e):"completed"===this.oldIceConnectionState||"connected"===this.oldIceConnectionState?this.emb.make(a.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===this.oldIceConnectionState&&this.established?this.emb.make(a.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===this.oldIceConnectionState&&this.sendIceFailed(e)}},{key:"getActiveIceCandidatePair",value:function(){var e=null,t=this.iceCandidatePairs;if(t&&t.length>0){var n=t.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection});n.length>0&&(e=n[0])}return e}},{key:"sendIceFailed",value:function(e){e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,p.log("sending icefailed ",e),this.emb.make(a.internalFabricEvent.iceFailed,this.conferenceId,this.pc,e)}},{key:"sendFabricTransportSwitch",value:function(e){var t=this,n={};n.prevIceCandidatePair=t.activeIceCandidatePair,n.relayType=e,n.currIceConnectionState=t.iceConnectionState,n.prevIceConnectionState=t.oldIceConnectionState,n.switchDelay=null,t.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),n.currIceCandidatePair=t.activeIceCandidatePair,n.localIceCandidates=t.localIceCandidates,n.remoteIceCandidates=t.remoteIceCandidates,p.log("sending fabric transport switch ",n),"completed"!==n.currIceConnectionState&&"connected"!==n.currIceConnectionState||"completed"!==n.prevIceConnectionState&&"connected"!==n.prevIceConnectionState||t.emb.make(a.internalFabricEvent.fabricTransportSwitch,t.conferenceId,t.pc,n)})}},{key:"handleIceDisconnected",value:function(e){var t=c.getCurrent();this.startTime=t,e.prevIceConnectionStateTs=this.iceConnectionStateTS,e.currIceCandidatePair=this.activeIceCandidatePair,"connected"===this.oldIceConnectionState||"completed"===this.oldIceConnectionState?(this.pcState=a.fabricState.disrupted,this.disruptedTS=t,this.emb.make(a.internalFabricEvent.iceDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(f.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed.")):"checking"===this.oldIceConnectionState&&(this.pcState=a.fabricState.checkingDisrupted,this.disruptedTS=t,this.emb.make(a.internalFabricEvent.iceConnectionDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(f.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed."))}},{key:"handleIceClosed",value:function(e){"new"===this.oldIceConnectionState||"checking"===this.oldIceConnectionState?(e.failureDelay=c.getCurrent()-this.startTime,e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,this.emb.make(a.internalFabricEvent.iceAborted,this.conferenceId,this.pc,e)):(e.currIceCandidatePair=this.activeIceCandidatePair,this.emb.make(a.internalFabricEvent.iceTerminated,this.conferenceId,this.pc,e),this.stopStatsPolling())}},{key:"handleIceRestart",value:function(e){e.prevIceCandidatePair=this.prevActiveIceCandidatePair,"new"!==this.oldIceConnectionState&&(p.log("iceRestarted sending"),this.established=!1,this.emb.make(a.internalFabricEvent.iceRestarted,this.conferenceId,this.pc,e))}},{key:"pcSignalingStateChangeCallback",value:function(e){var t=this;if(e){var n=this.signalingState;this.signalingState=this.pc.signalingState,p.warn("CALLBACK: signaling state change",n,"->",this.signalingState);var r={changedState:a.fabricStateChangeType.signalingState,prevState:n,newState:this.signalingState};this.sendFabricStateChange(r),"have-remote-offer"!==this.signalingState&&"stable"!==this.signalingState||(this.precalltest.callStarts(),this.genericevent.sendEvent(a.logEvents.log,{msg:"precalltest told to stop "})),"closed"===this.signalingState&&(this.emb.make(a.fabricEvent.fabricTerminated,this.conferenceId,this.pc),this.userAlive.stop(),this.precalltest.callFinished(),this.stopStatsPolling(),this.genericevent.sendEvent(a.logEvents.log,{msg:"precalltest finished "})),"have-local-offer"!==this.signalingState&&"have-local-pranswer"!==this.signalingState&&"stable"!==this.signalingState||(p.log(this.signalingState,".. requesting sender config."),l.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function(){var e=l.Registry.getConfigServiceWrapper().getSenderConfig();p.log("Sender config:",e);var n=a.callstatsChannels.senderConfiguration;l.Registry.getEventMessageBuilder().make(n,t.conferenceId,t.pc,e)})["catch"](function(e){p.warn(e)}))}}},{key:"pcNegotiationNeededCallback",value:function(e){e&&(this.negotiationNeeded++,this.startTime=c.getCurrent(),p.warn("CALLBACK: negotiation needed",this.negotiationNeeded))}}]),e}();n.PcCallbackHandler=v},{"../config/callstatserrors":31,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],40:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utility/registry"),a=e("../peerconnection/pccallbackhandler"),l=e("../browserapi/devices"),u=e("./useralivehandler"),c=e("./getstatshandler"),d=e("../config/constants"),f=r(d),h=e("../utility/timestamps"),p=r(h),v=e("../utility/csiologger"),g=r(v),m=function(){function e(t){i(this,e),this.pc=t.pc,this.remoteId=t.remoteId,this.fabricUsage=t.fabricUsage,this.callback=t.callback,this.conferenceId=t.conferenceId,this.remoteEndpointType=t.remoteEndpointType,this.fabricTransmissionDirection=t.fabricTransmissionDirection,this.clocksync=s.Registry.getClockSync(),this.startTime=this.clocksync.getSynchronizedTimestamp(),this.credentials=s.Registry.getCredentials(),this.pcHash=this.generatePcHash(),this.ssrcMap=new Map,this.localSdp=null,this.remoteSdp=null,this.transportInfo=null,this.userAliveHandler=new u.UserAliveHandler(this.conferenceId,this.pc),this.userAliveHandler.start(),this.emb=s.Registry.getEventMessageBuilder(),this.devices=new l.Devices(this.conferenceId,this.pc);var n=s.Registry.getEndpoint();this.getStatsHandler=new c.GetStatsHandler(this.pc,this.pcHash,5e3,n.getCodeBase(),n.getBrowserName()),this.pcCallbackHandler=new a.PcCallbackHandler(this.conferenceId,this.pc,this.getStatsHandler,this.userAliveHandler,this.remoteId,this.callback),this.devices.collectConnected(),this.fabricTransmissionDirection||(this.fabricTransmissionDirection="sendrecv"),this.remoteEndpointType||(this.remoteEndpointType="peer")}return o(e,[{key:"getFabricTransmissionDirection",value:function(){return this.fabricTransmissionDirection}},{key:"getRemoteEndpointType",value:function(){return this.remoteEndpointType}},{key:"stopUserAliveHandler",value:function(){this.userAliveHandler.stop()}},{key:"getPcState",value:function(){return this.pcCallbackHandler.pcState}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"setPcState",value:function(e){e in f.fabricState?this.pcCallbackHandler.pcState=e:g.error("setPcState: Invalid state")}},{key:"getAppId",value:function(){return this.credentials.getAppId()}},{key:"getLocalId",value:function(){return this.credentials.getUserId()}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getRemoteId",value:function(){return this.remoteId}},{key:"isFabricSetupSent",value:function(){return this.pcCallbackHandler.isFabricSetupSent()}},{key:"getStartTime",value:function(){return this.startTime}},{key:"getCallback",value:function(){return this.callback}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getIceCandidates",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceCandidates:null}},{key:"getIceConnectionState",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceConnectionState:null}},{key:"getNegotiationsNumber",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.negotiationNeeded:0}},{key:"sendFabricTransportSwitch",value:function(e){this.pcCallbackHandler&&this.pcCallbackHandler.sendFabricTransportSwitch(e)}},{key:"getSdp",value:function(){return{localSdp:this.localSdp,remoteSdp:this.remoteSdp}}},{key:"setSdp",value:function(e,t){this.localSdp=e,this.remoteSdp=t}},{key:"generatePcHash",value:function(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}},{key:"getTransportInfo",value:function(){return this.transportInfo}},{key:"setTransportInfo",value:function(e){this.transportInfo=e}},{key:"updateSDP",value:function(e){var t=this,n=this.pc.localDescription.sdp,r=this.pc.remoteDescription.sdp;if(n&&r&&(n!==this.localSdp||r!==this.remoteSdp)){this.parseSDP(n,f.streamType.outbound),this.parseSDP(r,f.streamType.inbound);var i={localSDP:n!==this.localSdp?n:"",remoteSDP:r!==this.remoteSdp?r:""};""===n&&""===remoteSDP||!s.Registry.getCredentials().getCollectSDP()||this.emb.make(f.internalFabricEvent.sdpSubmission,this.conferenceId,this.pc,i),e&&e.forEach(function(e){var n=String(e.data.ssrc),r=t.ssrcMap.get(n);r||(r={}),r.mediaType=e.data.mediaType,r.reportType=e.data.isRemote?"remote":"local",r.ssrc=n,t.ssrcMap.set(n,r)});var o=[];this.ssrcMap.forEach(function(e,t){o.push(e)});for(var a={ssrcData:o},l=0;l<a.ssrcData.length;l+=1)a.ssrcData[l].userID=s.Registry.getCredentials().getUserId();this.emb.make(f.internalFabricEvent.ssrcMap,this.conferenceId,this.pc,a),this.setSdp(n,r)}}},{key:"parseSDP",value:function(e,t){var n=this,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/),i=/^ssrc:(\d*) ([\w_]*):(.*)/,o=/^ssrc-group:SIM (\d*)/;e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var r=e[0],s=e.slice(2);if("a"===r&&i.test(s)){var a=s.match(i),l=a[1],u=a[2],c=a[3],d=n.ssrcMap.get(l);if(d||(d={}),d.ssrc=l,d[u]=c,d.localStartTime=p.getCurrent(),d.syncedStartTime=n.clocksync.getSynchronizedTimestamp(),d.streamType=t,!o.test(s))return void n.ssrcMap.set(l,d);d.ssrcGroup={},d.ssrcGroup[t]={},d.ssrcGroup[t].simulcastGroup=s.match(/\d+/g),n.ssrcMap.set(l,d)}})}},{key:"getSSRCInfo",value:function(e){return this.ssrcMap.get(e)}},{key:"setupVideoTagMethods",value:function(e,t){var n=this,r=document.getElementById(e);r&&(r.oncanplay=function(){var e={ssrc:String(t),highResTs:p.getCurrent()};n.emb.make(f.internalFabricEvent.mediaPlaybackStart,n.conferenceId,n.pc,e)},r.onsuspend=function(){var e={ssrc:String(t),highResTs:p.getCurrent()};n.emb.make(f.internalFabricEvent.mediaPlaybackSuspended,n.conferenceId,n.pc,e)})}},{key:"updateSSRCInfo",value:function(e,t,n,r){var i=this.ssrcMap.get(e);i||(i={}),i.ssrc=e,i.remoteUserID=t,i.usageLabel=n,i.associatedVideoTag=r,this.ssrcMap.set(e,i),r&&t!==this.credentials.getUserId()&&this.setupVideoTagMethods(r,e)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.userAliveHandler.updateConferenceId(e)}},{key:"updateRemoteId",value:function(e){this.remoteId=e}}],[{key:"Builder",get:function(){return function(){function t(){i(this,t)}return o(t,[{key:"withPc",value:function(e){return this.pc=e,this}},{key:"withRemoteId",value:function(e){return this.remoteId=e,this}},{key:"withFabricUsage",value:function(e){return this.fabricUsage=e,this}},{key:"withConferenceId",value:function(e){return this.conferenceId=e,this}},{key:"withRemoteEndpointType",value:function(e){return this.remoteEndpointType=e,this}},{key:"withFabricTransmissionDirection",value:function(e){return this.fabricTransmissionDirection=e,this}},{key:"withCallback",value:function(e){return this.callback=e,this}},{key:"make",value:function(){return new e(this)}}]),t}()}}]),e}();n.PeerConnectionHandler=m},{"../browserapi/devices":18,"../config/constants":32,"../peerconnection/pccallbackhandler":39,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98,"./getstatshandler":38,"./useralivehandler":42}],41:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./peerconnectionhandler"),s=function(){function e(){r(this,e),this.pcHandlers=new Map}return i(e,[{key:"addPcHandler",value:function(e,t,n,r,i,s,a){if(!this.getPcHandler(e)){var l=(new o.PeerConnectionHandler.Builder).withPc(e).withRemoteId(t).withFabricUsage(n).withConferenceId(r).withRemoteEndpointType(i).withFabricTransmissionDirection(s).withCallback(a).make();this.pcHandlers.set(l.getPcHash(),l)}}},{key:"getPcHandler",value:function(e){var t=null;return e?(this.pcHandlers.forEach(function(n,r){n&&n.getPeerConnection()===e&&(t=n)}),t):t}},{key:"getPcHandlerByHash",value:function(e){return e&&this.pcHandlers.has(e)?this.pcHandlers.get(e):null}},{key:"updateConferenceId",value:function(e){this.pcHandlers.forEach(function(t,n){t.updateConferenceId(e)})}}]),e}();n.PeerConnectionManager=s},{"./peerconnectionhandler":40}],42:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.UserAliveHandler=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../config/constants"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(a),u=e("../utility/timeoutprocess"),c=e("../utility/registry"),d=1e4,f=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,d));return o.emb=c.Registry.getEventMessageBuilder(),o.pc=n,o.conferenceId=e,o.setCallback(o.send),o}return o(t,e),s(t,[{key:"send",value:function(){this.conferenceId!==l.tmpConferenceId&&this.pc&&this.emb.make(l.internalFabricEvent.userAlive,this.conferenceId,this.pc)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e}}]),t}(u.TimeoutProcess);n.UserAliveHandler=f},{"../config/constants":32,"../utility/registry":94,"../utility/timeoutprocess":97}],43:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Authenticator=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function A(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:A(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},u=e("./jwt/jwt"),c=e("./jwt/jwttoken"),d=e("../config/settings"),f=r(d),h=e("../utility/base64"),p=r(h),v=e("../config/callstatserrors"),g=r(v),m=e("../config/constants"),y=r(m),b=e("../browserapi/localstorage"),_=r(b),S=e("../utility/json"),T=r(S),C=e("./xmlhttp"),w=e("./xmlhttpservice"),E=e("../utility/registry"),k=e("../utility/csiologger"),R=r(k),I=f.authRetryTimeout,P=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Authenticator"));return e.clockSync=E.Registry.getClockSync(),e.credentials=E.Registry.getCredentials(),e.url=f.authServiceUrl,e}return s(t,e),a(t,[{key:"initiate",value:function(e,n){var r=this;return this.inProgress?(n&&n(g.csError.authOngoing,null),new Promise(function(e,t){t(new Error(r.name+": in progress"))})):this.credentials.getAppId()&&this.credentials.getUserId()?(this.initCallback=n,"function"==typeof e?(this.setTokenGenerator(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this)):new Promise(function(n,i){r.createTokenGenerator(e).then(function(e){r.setTokenGenerator(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",r).call(r).then(function(){n()},function(e){i(e)})},function(e){i(new Error(r.name+": tokenGenerator creation problem ("+e+")"))})})):new Promise(function(e,t){t(new Error(r.name+": credentials not set"))})}},{key:"getToken",value:function(){var e=null;return this.token&&(e=this.token.getToken()),e}},{key:"isTokenValid",value:function(){return!!this.token&&this.token.isValid(this.credentials)}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"getIceServers",value:function(){return this.iceServers}},{key:"reset",value:function(){this.token=null,this.reauthTimer=null,this.renew=!1,this.credentials=null,this.jwt=new u.Jwt,this.tokenGenerator=function(e,t){t("Token generator is not set")},this.elapsed=0,this.iceServers=null,l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this);
}},{key:"setupToken",value:function(e){_.store("csio_auth_data",JSON.stringify(e)),this.token=new c.JwtToken(e,this.clockSync)}},{key:"clearReauthTimer",value:function(){null!==this.reauthTimer&&(clearTimeout(this.reauthTimer),this.reauthTimer=null)}},{key:"setupReauthTimer",value:function(e){var t=this;t.clearReauthTimer(),t.reauthTimer=setTimeout(function(){t.reAuthenticate()},e)}},{key:"reAuthenticate",value:function(){this.inProgress||(this.inProgress=!0,this.token=null,this.sendRequest())}},{key:"handleErrorActions",value:function(e){if(0!==e.length){var t=e.shift();if(t.action===g.authErrorActions.RETRY){var n=t.params.timeout?t.params.timeout:f.authRetryTimeout;this.setupReauthTimer(n),this.handleErrorActions(e)}t.action===g.authErrorActions.GET_NEW_TOKEN&&(this.renew=!0,this.handleErrorActions(e)),t.action===g.authErrorActions.REPORT_ERROR&&(R.error(this.name+": "+t.params.errorReason),this.handleErrorActions(e))}}},{key:"setTokenGenerator",value:function(e){this.tokenGenerator=e}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=T.parse(t.response);if(!r)return R.error(this.name+": invalid authentication response"),void this.sendNextRequest();if(r["urn:x-callstats:auth:errorActions"]&&r["urn:x-callstats:auth:errorActions"].length>0)return void this.handleErrorActions(r["urn:x-callstats:auth:errorActions"]);if(200===t.status){if("bearer"!==r.token_type)return R.error(this.name+": successful, but token type was not bearer. Scheduling retry."),void this.sendNextRequest();this.setupToken(r.access_token),r.iceServers&&(this.iceServers=r.iceServers);var i=parseInt(1e3*parseInt(r.expires_in)*.9);return this.setupReauthTimer(i),this.renew=!1,this.initCallback&&this.initCallback(g.csError.success,y.csCallBackMessages.authSuccessful),this.elapsed=n,void this.completeProcess()}R.error("Authentication failed, but no error actions were defined in response."),this.sendNextRequest()}},{key:"request",value:function(){var e=this;this.clearReauthTimer();var t=new Promise(function(t,n){e.tempResolve=t,e.tempReject=n});return this.tokenGenerator(this.renew,function(t,n){if(null!==t)return e.initCallback&&e.initCallback(g.csError.tokenGenerationError,t.toString()),e.rejectCb(new Error(e.name+": tokenGenerationError")),R.error("tokenGenerationError ",t),null;var r=e.url+"authenticate",i={client_id:e.credentials.userId+"@"+e.credentials.getAppId(),code:n,grant_type:"authorization_code"},o={"Content-Type":"application/x-www-form-urlencoded"};(0,C.sendPostRequest)(r,o,I,i).then(function(t){e.tempResolve(t)},function(t){e.tempReject(t)})}),t}},{key:"tokenGeneratorCreator",value:function(e,t){var n=this;return function(r,i){var o=null,s={alg:"HS256"};if(!r&&null!==o)return i(null,o);var a=n.credentials,l={userID:a.getUserId(),appID:a.getAppId()};t&&(l.keyId=t),n.jwt.sign(s,l,e).then(function(e){o=e,i(null,e)})["catch"](function(e){i(e)})}}},{key:"createTokenGenerator",value:function(e){var t=this;return new Promise(function(n,r){var i=null;e.indexOf(":")>-1&&(i=p.strtohex(e.split(":")[0]),e=e.split(":")[1]),t.jwt.importKey(e).then(function(r){e=null;var o=t.tokenGeneratorCreator(r,i);n(o)})["catch"](function(e){R.error(t.name+": could not import key ("+e+")"),r(e)})})}}]),t}(w.XMLHttpService);n.Authenticator=P},{"../browserapi/localstorage":19,"../config/callstatserrors":31,"../config/constants":32,"../config/settings":33,"../utility/base64":84,"../utility/csiologger":87,"../utility/json":92,"../utility/registry":94,"./jwt/jwt":51,"./jwt/jwttoken":52,"./xmlhttp":57,"./xmlhttpservice":58}],44:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.GenericEventHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/settings"),a=r(s),l=e("./xmlhttp"),u=e("../utility/registry"),c=e("../utility/csiologger"),d=r(c),f=a.baseUrl+"generics",h=function(){function e(){i(this,e),this.credentials=u.Registry.getCredentials(),this.enabled=!1}return o(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"sendEvent",value:function(e,t){this.send(e,t).then(function(e){d.log("Got generic response: %o",e)})["catch"](function(e){d.log("Got error for generic request",e)})}},{key:"send",value:function(e,t){if(!this.enabled)return new Promise(function(e,t){t(new Error("GenericEvent Error: not enabled"))});var n=this;return new Promise(function(r,i){var o={"Content-Type":"application/json"},s={appID:n.credentials.appId,userID:encodeURIComponent(n.credentials.userId),version:a.version,eventType:e,data:t};(0,l.sendPostRequest)(f,o,5e3,s).then(function(e){r(e.getXhr().response)},function(e){i(e)})})}}]),e}();n.GenericEventHandler=h},{"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"./xmlhttp":57}],45:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.ClockSync=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function _(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:_(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},u=e("../config/settings"),c=r(u),d=e("./xmlhttp"),f=e("../utility/timestamps"),h=r(f),p=e("./xmlhttpservice"),v=e("../utility/registry"),g=e("../config/constants"),m=r(g),y=c.baseUrl+"clockSync",b=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ClockSync"));return e.currentOffset=0,e.completed=!1,e}return s(t,e),a(t,[{key:"initiate",value:function(){return this.startTime=h.getCurrent(),v.Registry.getGenericEventHandler().sendEvent(m.logEvents.log,{msg:"Starting clocksync"}),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this)}},{key:"getSynchronizedTimestamp",value:function(){return h.getCurrent()+this.currentOffset}},{key:"getElapsed",value:function(){return this.isCompleted()?this.endTime-this.startTime:null}},{key:"getOffset",value:function(){return this.currentOffset}},{key:"reset",value:function(){this.currentOffset=0,this.offsetResults=[],this.startTime=0,this.endTime=0,l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){return(0,d.sendGetRequest)(y,null,5e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=JSON.parse(t.response),i=h.getCurrent();this.handleMessage(r,n,i)}},{key:"handleMessage",value:function(e,t,n){var r=t/2;r>6e4?(this.offsetResults=[],v.Registry.getGenericEventHandler().sendEvent(m.logEvents.log,{msg:"clockSync restarting"})):this.addOffset(e,r,n),this.offsetResults.length>=5?(this.calculateOffset(),this.endTime=h.getCurrent(),this.completeProcess()):this.sendRequest()}},{key:"isCompleted",value:function(){return this.completed}},{key:"addOffset",value:function(e,t,n){var r=e.now+t,i=r-n;this.offsetResults.push(i),v.Registry.getGenericEventHandler().sendEvent(m.logEvents.log,{msg:"clockSync Info: serverTime "+r+" responseRecvTs: "+n})}},{key:"calculateOffset",value:function(){var e=this.offsetResults.reduce(function(e,t){return e+t});this.currentOffset=e/this.offsetResults.length,this.currentOffset=isNaN(this.currentOffset)?0:this.currentOffset,v.Registry.getGenericEventHandler().sendEvent(m.logEvents.log,{msg:"clockSync Done, offset is: "+this.currentOffset+"results length"+this.offsetResults.length}),this.offsetResults=[],this.completed=!0}}]),t}(p.XMLHttpService);n.ClockSync=b},{"../config/constants":32,"../config/settings":33,"../utility/registry":94,"../utility/timestamps":98,"./xmlhttp":57,"./xmlhttpservice":58}],46:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e),this.connected=!1,this.reconnected=!1,this.conferenceUrl={}}return i(e,[{key:"setup",value:function(){return new Promise(function(e,t){e()})}},{key:"isReady",value:function(){return this.connected}},{key:"send",value:function(e){}}]),e}();n.CollectorConnection=o},{}],47:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceGet=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function f(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:f(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},l=e("../xmlhttp"),u=e("../xmlhttpservice"),c=e("../../utility/registry"),d=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ConfigService"))}return o(t,e),s(t,[{key:"initiate",value:function(e){var n=this;return this.url=e,this.authToken=c.Registry.getAuthenticator().getToken(),this.authToken?a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this):new Promise(function(e,t){t(new Error(n.name+": authToken has to be string"))})}},{key:"getConfig",value:function(){return this.config}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"reset",value:function(){this.authToken=null,this.url=null,this.config=null,this.elapsed=0,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken};return(0,l.sendGetRequest)(this.url,e,2e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed();this.config=JSON.parse(t.response),this.elapsed=n,this.completeProcess()}}]),t}(u.XMLHttpService);n.ConfigServiceGet=d},{"../../utility/registry":94,"../xmlhttp":57,"../xmlhttpservice":58}],48:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServicePost=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function d(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:d(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},l=e("../xmlhttp"),u=e("./configserviceget"),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),s(t,[{key:"initiate",value:function(e,n){return this.body=n,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this,e)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken};return e["Content-Type"]="application/json",(0,l.sendPostRequest)(this.url,e,2e3,this.body)}}]),t}(u.ConfigServiceGet);n.ConfigServicePost=c},{"../xmlhttp":57,"./configserviceget":47}],49:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceWrapper=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./configserviceget"),l=e("./configservicepost"),u=e("../../config/settings"),c=r(u),d=e("../../utility/registry"),f=e("../../utility/csiologger"),h=r(f),p=c.configServiceUrl,v=function(){function e(){i(this,e),this.internalConfigService=new a.ConfigServiceGet,this.appConfigService=new a.ConfigServiceGet,this.senderConfigService=new l.ConfigServicePost,this.defaultSenderConfig=null}return s(e,[{key:"initiateInternalConfig",value:function(){var e=this,t=d.Registry.getCredentials().getAppId();if(!t)return new Promise(function(t,n){h.log("appId has to be string"),n(new Error(e.internalConfigService.name+": appId has to be string"))});var n=p+t;return this.internalConfigService.initiate(n+"/configurations/internal")}},{key:"initiateAppConfig",value:function(){var e=this,t=d.Registry.getCredentials().getAppId();if(!t)return new Promise(function(t,n){h.log("appId has to be string"),n(new Error(e.appConfigService.name+": appId has to be string"))});var n=p+t;return this.appConfigService.initiate(n+"/configurations")}},{key:"initiateSenderConfig",value:function(e){var t=this;if(this.senderConfigService.getConfig())return new Promise(function(e,n){h.log("sender config already present"),n(new Error(t.senderConfigService.name+": sender config already present"))});var n=d.Registry.getCredentials().getAppId(),r=d.Registry.getCredentials().getUserId();if(!n||!r)return new Promise(function(e,n){h.log("appId and userId have to be string"),n(new Error(t.senderConfigService.name+": appId and userId have to be string"))});if(this.defaultSenderConfig=this.getCurrentVideoSenderConfig(e),!this.defaultSenderConfig)return new Promise(function(e,n){h.log("Could not obtain a sender config"),n(new Error(t.senderConfigService.name+": Could not obtain a sender config"))});var i=p+n,o={app_id:n,local_id:r,rtc_rtp_parameters:this.defaultSenderConfig};return this.senderConfigService.initiate(i+"/configurations",o)}},{key:"getInternalConfig",value:function(){return this.internalConfigService.getConfig()}},{key:"getAppDefaultConfig",value:function(){var e=this.appConfigService.getConfig(),t={peerConnection:null,media:null};return e["default"]?(e["default"].peerConnection&&(t.peerConnection=e["default"].peerConnection),e["default"].media&&(t.media=e["default"].media),t):t}},{key:"getAppRecommendedConfig",value:function(){var e=this.appConfigService.getConfig(),t={};return e.recommended?(e.recommended.peerConnection&&(t.peerConnection=e.recommended.peerConnection),e.recommended.media&&(t.media=e.recommended.media),t):t}},{key:"getSenderConfig",value:function(){var e=this.senderConfigService.getConfig();return e&&e.recommended&&e.recommended.sender?e.recommended.sender:null}},{key:"getDefaultSenderConfig",value:function(){return this.defaultSenderConfig?this.defaultSenderConfig:null}},{key:"getInternalElapsed",value:function(){return this.internalConfigService.getElapsed()}},{key:"getAppElapsed",value:function(){return this.appConfigService.getElapsed()}},{key:"getSenderElapsed",value:function(){return this.senderConfigService.getElapsed()}},{key:"getCurrentVideoSenderConfig",value:function(e){var t={encodings:[{maxBitrate:0}]},n=d.Registry.getConferenceManager().getConferenceForPc(e);if(!n)return h.warn("No conference found for PC, skipping"),null;if(n.getPeerConnectionManager().pcHandlers.size>1)return h.warn("Multiple PCs found, skipping"),null;if(!e.getSenders||"function"!=typeof e.getSenders)return h.warn("Get senders error"),t;for(var r=e.getSenders(),i=void 0,s=0;s<r.length;s+=1){var a=r[s];if("object"!==(void 0===a?"undefined":o(a))||!a.track||"object"!==o(a.track)||!a.track.kind)return h.warn("Access senders error"),null;if("video"===a.track.kind){if(i)return h.warn("Multiple video sender, skipping"),null;i=a}}if(!i)return h.warn("No video sender found"),null;if(!i.getParameters||"function"!=typeof i.getParameters)return h.warn("Sender getParameters error"),t;var l=i.getParameters();return"object"!==(void 0===l?"undefined":o(l))?null:("encodings"in l||(l.encodings=[]),0===l.encodings.length&&l.encodings.push({maxBitrate:0}),l)}}]),e}();n.ConfigServiceWrapper=v},{"../../config/settings":33,"../../utility/csiologger":87,"../../utility/registry":94,"./configserviceget":47,"./configservicepost":48}],50:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../config/constants"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=e("./wscollectorconnection"),l=e("./restcollectorconnection"),u=e("../utility/registry"),c=function(){function e(){r(this,e),this.connection=null}return i(e,[{key:"setupCollectorConnection",value:function(e){e===s.transportType.rest?this.connection=new l.RestCollectorConnection:this.connection=new a.WsCollectorConnection}},{key:"setup",value:function(){return this.connection?this.connection.setup():new Promise(function(e,t){t()})}},{key:"isReady",value:function(){return!!this.connection&&this.connection.isReady()}},{key:"send",value:function(e){return this.connection?void this.connection.send(e):void u.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"Connection not available to the collector"})}}]),e}();n.ConnectionManager=c},{"../config/constants":32,"../utility/registry":94,"./restcollectorconnection":53,"./wscollectorconnection":56}],51:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Jwt=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../utility/base64"),a=r(s),l=e("../../utility/csiologger"),u=r(l),c=e("../../utility/registry"),d=e("../../config/constants"),f=r(d),h=function(){function e(){i(this,e),this.cryptotype=null,window.crypto&&window.crypto.subtle?(this.cryptotype="standard",this.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(this.cryptotype="webkit",this.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(this.cryptotype="ie",this.subtlecrypto=window.msCrypto.subtle):(this.subtlecrypto=null,u.info("WebCryptography API not supported in this browser.")),this.browserName=c.Registry.getEndpoint().getBrowserName()}return o(e,[{key:"sign",value:function(e,t,n){var r=this;return new Promise(function(i,o){"HS256"!==e.alg&&o("Use header.alg=HS256"),e=JSON.stringify(e),"string"!=typeof t&&(t=JSON.stringify(t));var s=a.urlencodeUnicode(e)+"."+a.urlencodeUnicode(t);window.csioReactNative&&window.csiosign(s,n,function(e,t){return e?(u.log("Token sign error",e),void o(error)):void i(t)});var l=new ArrayBuffer(s.length),c=new Uint8Array(l),d={name:"HMAC"};"ie"!==r.cryptotype&&"webkit"!==r.cryptotype&&r.browserName!==f.browserName.edge||(d.hash={name:"sha-256"});for(var h=s.length-1;h>=0;h--)c[h]=s.charCodeAt(h);var p=r.subtlecrypto.sign(d,n,c);"ie"===r.cryptotype?(p.onerror=o,p.oncomplete=function(e){s=r.buildToken(e.target.result,s),i(s)}):p.then(function(e){s=r.buildToken(e,s),i(s)})["catch"](function(e){o(e)})})}},{key:"buildToken",value:function(e,t){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return t+="."+a.urlencode(n)}},{key:"decode",value:function(e){try{var t=e.split(".")[1],n=a.decode(t);return JSON.parse(n)}catch(e){return u.error("Could not decode token. "),null}}},{key:"importKey",value:function(e){var t=this;return new Promise(function(n,r){if(window.csioReactNative)return void n(e);if("webkit"===t.cryptotype)for(;e.length<32;)e+="\0";var i={kty:"oct",k:a.urlencode(e),alg:"HS256"},o={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===t.cryptotype?i.extractable=!1:i.ext=!1,"webkit"===t.cryptotype&&(o=null,i.use="sig"),"ie"===t.cryptotype||"webkit"===t.cryptotype){var s=JSON.stringify(i);i=new Uint8Array(s.length);for(var l=0;l<s.length;l++)i[l]=s.charCodeAt(l)}var u=t.subtlecrypto.importKey("jwk",i,o,!1,["sign"]);"ie"===t.cryptotype?(u.onerror=r,u.oncomplete=function(e){n(e.target.result)}):u.then(n)["catch"](r)})}}]),e}();n.Jwt=h},{"../../config/constants":32,"../../utility/base64":84,"../../utility/csiologger":87,"../../utility/registry":94}],52:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JwtToken=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./jwt"),a=e("../../utility/registry"),l=e("../../config/constants"),u=r(l),c=e("../../utility/csiologger"),d=r(c),f=function(){function e(t){i(this,e),this.token=t,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.appId=null,this.userId=null,this.tokenPayload=null,this.jwt=new s.Jwt,this.expires=null,this.clockSync=a.Registry.getClockSync(),this.adaptiveInterval=!1,this.transportType=u.transportType.rest,this.setupTokenPayload(),this.restApiTransport=!1}return o(e,[{key:"getToken",value:function(){return this.token}},{key:"setupTokenPayload",value:function(){var e=this.jwt.decode(this.token);if(this.statsSubmissionInterval=parseInt(e.submissionInterval,10),this.collectSDP=e.collectSDP,this.adaptiveInterval=e.adaptiveInterval,this.appId=e.appID,this.userId=e.userID,this.restApiTransport=e.restApiTransport,navigator.mozGetUserMedia){var t=e.expiry.split(" ").join("T");this.expires=Date.parse(t)}else this.expires=new Date(e.expiry);this.restApiTransport?this.transportType=u.transportType.rest:this.transportType=u.transportType.ws,d.info("transportType is ",this.transportType,this.restApiTransport),a.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval),a.Registry.getCredentials().setCollectSDP(this.collectSDP),a.Registry.getCredentials().setTransportType(this.transportType),a.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval)}},{key:"isValid",value:function(e){var t=this,n=!1;return null!==t.token&&t.appId===e.appId&&t.userId===encodeURIComponent(e.userId)&&new Date(this.clockSync.getSynchronizedTimestamp())<t.expires&&(n=!0),n}}]),e}();n.JwtToken=f},{"../../config/constants":32,"../../utility/csiologger":87,"../../utility/registry":94,"./jwt":51}],53:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.RestCollectorConnection=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utility/registry"),u=e("./xmlhttp"),c=e("./collectorconnection"),d=e("./restrelays"),f=e("../config/constants"),h=r(f),p=e("../utility/csiologger"),v=r(p),g=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.relays=new d.RestRelays,e}return s(t,e),a(t,[{key:"isReady",value:function(){return!0}},{key:"send",value:function(e){var t={"Content-Type":"application/json",Authorization:"Bearer "+l.Registry.getAuthenticator().getToken()},n=e.eventType,r=e.confID,i=e.ucID,o=this.relays,s=o.getRequestUrl(n,r,i);if(!s)return void v.warn("No action for message type: "+n);var a=this.getMessage(n,e);v.log("sending ",s,e),(0,u.sendPostRequest)(s,t,5e3,a).then(function(e){o.handleResponse(n,e,r)},function(e){v.error(e)})}},{key:"getMessage",value:function(e,t){delete t.confID,delete t.channel,delete t.token,delete t.appID,delete t.action,delete t.ucID,delete t.version;var n=decodeURIComponent(t.localID);t.localID=n;var r=decodeURIComponent(t.remoteID);return t.remoteID=r,e===h.callstatsChannels.processedStats&&(t.eventType="stats"),t}}]),t}(c.CollectorConnection);n.RestCollectorConnection=g},{"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"./collectorconnection":46,"./restrelays":54,"./xmlhttp":57}],54:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n,r){if(!n||!n.xhr)return void v.log("Response for request is null");var i=n.xhr.response,o=JSON.parse(i);o.conferenceId=r,"success"===o.status?e&&e(o):t?t(o):(f.Registry.getGenericEventHandler().sendEvent(u.logEvents.restResponseError,{msg:"response failure "+o.msg+":"+o.status}),v.error("Response error:",o.msg,i))}}function s(e){var t=o();return new Map([[u.fabricEvent.fabricTerminated,new m(d.restEventUrl,"/events/fabric/terminated",t)],[u.fabricEvent.audioMute,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.audioUnmute,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.videoPause,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.videoResume,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.screenShareStart,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.screenShareStop,new m(d.restEventUrl,"/events/media/actions",t)],[u.fabricEvent.activeDeviceList,new m(d.restEventUrl,"/events/devices/list",t)],[u.fabricEvent.applicationErrorLog,new m(d.restEventUrl,"/events/app/logs",t)],[u.fabricEvent.dominantSpeaker,new m(d.restEventUrl,"/events/dominantspeaker",t)],[u.fabricEvent.fabricHold,new m(d.restEventUrl,"/events/fabric/actions",t)],[u.fabricEvent.fabricResume,new m(d.restEventUrl,"/events/fabric/actions",t)],[u.internalFabricEvent.fabricSetup,new m(d.restEventUrl,"/events/fabric/setup",t)],[u.fabricEvent.fabricSetupFailed,new m(d.restEventUrl,"/events/fabric/setupfailed",t)],[u.internalFabricEvent.userJoined,new m(d.restEventUrl,"",o(function(e){if("success"!==e.status)return void f.Registry.getGenericEventHandler().sendEvent(u.logEvents.restResponseError,{msg:"userJoined response failure"+e.msg+":"+e.status});var t=decodeURIComponent(e.conferenceId),n=f.Registry.getConferenceManager().get(t);n&&(v.log("UcId =",e.ucID,t),n.setUcId(e.ucID),f.Registry.getTransmissionManager().trySend())}))],[u.internalFabricEvent.userLeft,new m(d.restEventUrl,"/events/user/left",t)],[u.internalFabricEvent.userAlive,new m(d.restEventUrl,"/events/user/alive",t)],[u.internalFabricEvent.fabricTransportSwitch,new m(d.restEventUrl,"/events/fabric/transportchange",t)],[u.internalFabricEvent.mediaPlaybackStart,new m(d.restEventUrl,"/events/media/pipeline",t)],[u.internalFabricEvent.mediaPlaybackSuspended,new m(d.restEventUrl,"/events/media/pipeline",t)],[u.internalFabricEvent.mediaPlaybackStalled,new m(d.restEventUrl,"/events/media/pipeline",t)],[u.internalFabricEvent.ssrcMap,new m(d.restEventUrl,"/events/ssrcmap",t)],[u.internalFabricEvent.connectedDeviceList,new m(d.restEventUrl,"/events/devices/list",t)],[u.internalFabricEvent.sdpSubmission,new m(d.restEventUrl,"/events/sdp",t)],[u.internalFabricEvent.iceDisruptionStart,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceDisruptionEnd,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceConnectionDisruptionStart,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceConnectionDisruptionEnd,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceAborted,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceTerminated,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceFailed,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.iceRestarted,new m(d.restEventUrl,"/events/ice/status",t)],[u.internalFabricEvent.fabricDropped,new m(d.restEventUrl,"/events/fabric/status",t)],[u.callstatsChannels.processedStats,new m(d.restStatsUrl,"/stats",t)],[u.internalFabricEvent.fabricStateChange,new m(d.restEventUrl,"/events/fabric/statechange",t)],[u.callstatsChannels.userFeedback,new m(d.restEventUrl,"/events/feedback",t)],[u.precalltestEvents.results,new m(d.restEventUrl,"/events/precall",t)],[u.precalltestEvents.associate,new m(d.restEventUrl,"/events/precall",t)],[u.internalFabricEvent.userDetails,new m(d.restEventUrl,"/events/userdetails",t)]]);
}Object.defineProperty(n,"__esModule",{value:!0}),n.RestRelays=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../config/constants"),u=r(l),c=e("../config/settings"),d=r(c),f=e("../utility/registry"),h=e("../utility/url"),p=e("../utility/csiologger"),v=r(p),g=function(){function e(){i(this,e),this.items=s()}return a(e,[{key:"getRequestUrl",value:function(e,t,n){return this.items.has(e)?this.items.get(e).getRequestUrl(e,t,n):(v.warn("EventType Unsupported ",e),null)}},{key:"handleResponse",value:function(e,t,n){return this.items.has(e)?void this.items.get(e).handleResponse(t,n):void v.warn("No response handler for event type "+e)}}]),e}(),m=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,e),this.baseUrl=t,this.urlAppendix=n,this.responseHandler=r}return a(e,[{key:"getRequestUrl",value:function(e,t,n){return this.makeRequestUrl(e,t,n),this.requestUrl.toString()}},{key:"makeRequestUrl",value:function(e,t,n){e===u.precalltestEvents.results?this.requestUrl=new h.Url(this.baseUrl,f.Registry.getCredentials().getAppId(),this.urlAppendix):(e===u.internalFabricEvent.userJoined&&n&&(n=""),this.requestUrl=new h.Url(this.baseUrl,f.Registry.getCredentials().getAppId()+"/conferences/"+t,n,this.urlAppendix))}},{key:"handleResponse",value:function(e,t){this.responseHandler(e,t)}}]),e}();n.RestRelays=g},{"../config/constants":32,"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"../utility/url":99}],55:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TransmissionManager=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utility/timestamps"),a=r(s),l=e("../collections/cache"),u=e("../utility/registry"),c=e("../config/constants"),d=r(c),f=e("../utility/csiologger"),h=r(f),p=function(){function e(){i(this,e),this.cache=[],this.connectionManager=u.Registry.getConnectionManager(),this.lastTS=0,this.timerStarted=!1}return o(e,[{key:"send",value:function(e){(e.isCachable()||e.canBeSent())&&(this.cache[e.getConferenceId()]||(this.cache[e.getConferenceId()]=new l.Cache),this.cache[e.getConferenceId()].add(e,e.isPriority()),this.trySend())}},{key:"trySend",value:function(){return this.connectionManager.isReady()?this.timerStarted?void 0:this.timeToSend()?void(this.sendMessage()&&this.startTimer()):void(this.getCacheLength()>0&&this.startTimer()):void this.setupConnection()}},{key:"setupConnection",value:function(){this.connectionManager.setup().then(function(){h.log("Connected to connectionManager")})["catch"](function(e){return h.log("Could not connect to connectionManager",e)})}},{key:"sendMessage",value:function(){var e=void 0,t=void 0;if(0===this.getCacheLength())return!1;for(var n in this.cache)if(this.cache.hasOwnProperty(n)&&(t=n,(e=this.cache[t].peak())&&e.canBeSent()))break;return!(!e||!e.canBeSent()||(h.log("sending message type :",e.toJson().action,e.toJson()),e=this.cache[t].pop(),this.lastTS=a.getCurrent(),this.connectionManager.send(e.toJson()),0))}},{key:"startTimer",value:function(){var e=this;this.timerStarted||0!=this.getCacheLength()&&(this.timerStarted=!0,setTimeout(function(){e.timerStarted=!1,e.trySend()},200))}},{key:"timeToSend",value:function(){return a.getCurrent()>=this.lastTS+200}},{key:"getCacheLength",value:function(){var e=0;for(var t in this.cache)this.cache.hasOwnProperty(t)&&(e+=this.cache[t].length());return e}},{key:"updateConferenceId",value:function(e){var t=d.tmpConferenceId;this.cache[t]&&this.cache[t].updateConferenceId(e)}}]),e}();n.TransmissionManager=p},{"../collections/cache":24,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],56:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.WsCollectorConnection=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../config/callstatserrors"),u=r(l),c=e("../config/constants"),d=r(c),f=e("../config/settings"),h=r(f),p=e("../utility/registry"),v=e("../utility/csiologger"),g=r(v),m=e("./collectorconnection"),y=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.wsConnection=null,e.wsUrl=h.wsUrl,e.wsConnectionState=d.wsConnectionState.closed,e.connected=!1,e.reconnected=!1,e}return s(t,e),a(t,[{key:"onOpenHandler",value:function(){var e=this;e.wsConnectionState=d.wsConnectionState.connected,e.connected?e.reconnected=!0:e.connected=!0,e.reconnected=!1}},{key:"onCloseHandler",value:function(){var e=this;e.wsConnectionState=d.wsConnectionState.closed,g.log("**** Connection to the backend closed."),e.wsConnection&&(e.wsConnection=null)}},{key:"onErrorHandler",value:function(e){var t=this;t.wsConnectionState=d.wsConnectionState.closed,g.log("**** Connection establishment to the backend failed."),t.callback&&t.callback(u.csError.wsChannelFailure,"WebSocket establishment failed.",e)}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if("200 OK"===n.status){if("feedback"===n.event)window.localStorage.removeItem("feedback");else if(n.event===d.internalFabricEvent.userJoined){var r=p.Registry.getConferenceManager().get(decodeURIComponent(n.conferenceID));r&&r.setUcId(n.ucID),g.log("UcId =",n.ucID),p.Registry.getTransmissionManager().trySend()}}else g.error("Collector error:",n.reason)}},{key:"setup",value:function(){var e=this;return new Promise(function(t,n){return e.wsConnectionState===d.wsConnectionState.initiated||e.wsConnectionState===d.wsConnectionState.connected?(g.log("setupWebSocketConnection is called when already connected!"),e.callback&&e.callback(u.csError.success,d.csCallBackMessages.wsConnected),void t()):(e.wsConnectionState=d.wsConnectionState.initiated,g.log("creating new WebSocket",e.wsUrl),e.wsConnection=new WebSocket(e.wsUrl,"echo-protocol"),e.wsConnection.onopen=function(){t(),e.onOpenHandler()},e.wsConnection.onclose=function(){e.onCloseHandler()},e.wsConnection.onerror=function(t){n(t),e.onErrorHandler(t)},e.wsConnection.onmessage=function(t){e.onMessageHandler(t)},void 0)})}},{key:"isReady",value:function(){var e=this;return!(!e.wsConnection||1!==e.wsConnection.readyState)}},{key:"getState",value:function(){var e=this;return e.wsConnection?e.wsConnection.readyState:-1}},{key:"send",value:function(e){this.wsConnection.send(JSON.stringify(e))}}]),t}(m.CollectorConnection);n.WsCollectorConnection=y},{"../config/callstatserrors":31,"../config/constants":32,"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"./collectorconnection":46}],57:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n,r,i){return new Promise(function(o,s){var a=null,l=null,u=null,d=new XMLHttpRequest,v=h.Registry.getEndpoint().getBrowserName();if(!d)return void s(new Error("creating instance failed"));a=c.getCurrent(),d.open(e,t),v!==f.browserName.msie&&(d.timeout=r);for(var g in n)n.hasOwnProperty(g)&&d.setRequestHeader(g,n[g]);var m=null;if("POST"===e){if("application/x-www-form-urlencoded"===n["Content-Type"]){var y=[];for(var b in i)i.hasOwnProperty(b)&&y.push(encodeURIComponent(b)+"="+encodeURIComponent(i[b]));m=y.join("&")}"application/json"===n["Content-Type"]&&(m=JSON.stringify(i))}d.onload=function(){l=c.getCurrent(),u=l-a;var e=new p(d,u);o(e)},d.ontimeout=function(){s(new Error("connection timeout"))},d.onreadystatechange=function(){4===d.readyState&&0===d.status&&s(new Error("no server response received"))},d.send(m)})}function s(e,t,n){return o("GET",e,t,n,null)}function a(e,t,n,r){return o("POST",e,t,n,r)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.sendGetRequest=s,n.sendPostRequest=a;var u=e("../utility/timestamps"),c=r(u),d=e("../config/constants"),f=r(d),h=e("../utility/registry"),p=function(){function e(t,n){i(this,e),this.xhr=t,this.elapsed=n}return l(e,[{key:"getXhr",value:function(){return this.xhr}},{key:"getElapsed",value:function(){return this.elapsed}}]),e}()},{"../config/constants":32,"../utility/registry":94,"../utility/timestamps":98}],58:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.XMLHttpService=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../utility/sigmoid"),s=e("../utility/csiologger"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=100,u=1e4,c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"XMLHttpService",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u;r(this,e),this.name=t,this.minRetryTimeout=n,this.sigmoid=new o.Sigmoid(i-n,15,.5),this.reset()}return i(e,[{key:"reset",value:function(){this.inProgress=!1,this.completed=!1,this.resolveCb&&this.rejectCb(new Error(this.name+": resetting")),this.resolveCb=null,this.rejectCb=null}},{key:"initiate",value:function(){var e=this;if(this.inProgress)return new Promise(function(t,n){n(new Error(e.name+": in progress"))});var t=new Promise(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.inProgress=!0,this.sendRequest(),t}},{key:"isCompleted",value:function(){return this.completed}},{key:"handleSendError",value:function(e){a.log(this.name+": send next request ("+e+")"),this.sendNextRequest()}},{key:"handleResponseProxy",value:function(e){this.handleResponse(e),this.resetTimeout()}},{key:"handleResponse",value:function(e){a.error(this.name+": handleResponse() not implemented"),this.completeProcess()}},{key:"completeProcess",value:function(){this.inProgress=!1,this.completed=!0,this.resolveCb.apply(this,arguments)}},{key:"request",value:function(){return a.error(this.name+": request() not implemented!"),new Promise(function(e,t){e()})}},{key:"sendRequest",value:function(){if(this.inProgress){var e=this.request();e&&e.then(this.handleResponseProxy.bind(this),this.handleSendError.bind(this))}}},{key:"sendNextRequest",value:function(){setTimeout(this.sendRequest.bind(this),this.getTimeout())}},{key:"resetTimeout",value:function(){this.sigmoid.reset()}},{key:"getTimeout",value:function(){return this.minRetryTimeout+this.sigmoid.getActual()}}]),e}();n.XMLHttpService=c},{"../utility/csiologger":87,"../utility/sigmoid":96}],59:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Measurement=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./resolution"),s=e("./validator"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(){r(this,e),this.pcHash=null,this.ssrc=null,this.streamType=null,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameHeight=null,this.frameWidth=null,this.droppedFramesNum=null,this.rtt=null,this.jitter=null,this.lostPackets=-1,this.receivedPackets=-1,this.sentPackets=-1,this.discardedPackets=-1,this.sentBytes=-1,this.receivedBytes=-1,this.track=null,this.fractionLost=0}return i(e,null,[{key:"make",value:function(t,n,r,i,s,l,u,c,d,f,h,p,v,g,m,y,b){var _=new e,S=function(e,t){-1===[void 0,null].indexOf(t)&&(_[e]=t)};return S("pcHash",t),S("ssrc",n),S("streamType",r),S("mediaType",i),S("frameRateReceived",s),S("frameHeight",a.checkForNan(parseInt(l,10))),S("frameWidth",a.checkForNan(parseInt(u,10))),S("droppedFramesNum",c),S("rtt",d),S("jitter",f),S("lostPackets",h),S("receivedPackets",p),S("sentPackets",v),S("discardedPackets",g),S("sentBytes",m),S("receivedBytes",y),S("track",b),_.resolution=void 0!==s&&void 0!==u&&void 0!==l&&u>0&&l>0?new o.Resolution(u,l,s):null,_}}]),i(e,[{key:"getPcHash",value:function(){return this.pcHash}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getResolution",value:function(){return this.resolution?this.resolution.toString():null}},{key:"getFrameRateReceived",value:function(){return this.frameRateReceived}},{key:"getFrameHeight",value:function(){return this.frameHeight}},{key:"getFrameWidth",value:function(){return this.frameWidth}},{key:"getDroppedFramesNum",value:function(){return this.droppedFramesNum}},{key:"getJitter",value:function(){return this.jitter}},{key:"getRTT",value:function(){return this.rtt}},{key:"getLostPackets",value:function(){return this.lostPackets}},{key:"getDiscardedPackets",value:function(){return this.discardedPackets}},{key:"getReceivedPackets",value:function(){return this.receivedPackets}},{key:"getSentPackets",value:function(){return this.sentPackets}},{key:"getSentBytes",value:function(){return this.sentBytes}},{key:"getReceivedBytes",value:function(){return this.receivedBytes}},{key:"setFractionLost",value:function(e){this.fractionLost=void 0===e?null:e}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"extractTrack",value:function(){var e=this.track;return this.track=null,e}},{key:"toString",value:function(){return"pcHash: "+this.pcHash+", ssrc: "+this.ssrc+", streamType: "+this.streamType+", mediaType: "+this.mediaType+", frameRateReceived: "+this.frameRateReceived+", frameHeight: "+this.frameHeight+", frameWidth: "+this.frameWidth+", droppedFramesNum: "+this.droppedFramesNum+", rtt: "+this.rtt+", jitter: "+this.jitter+", lostPackets: "+this.lostPackets+", receivedPackets: "+this.receivedPackets+", sentPackets: "+this.sentPackets+", discardedPackets: "+this.discardedPackets+", sentBytes: "+this.sentBytes+", receivedBytes: "+this.receivedBytes}}]),e}();n.Measurement=l},{"./resolution":67,"./validator":82}],60:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.CPULimitationObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../config/constants"),a=r(s),l=e("../../utility/timestamps"),u=r(l),c=function(){function e(){i(this,e),this.ewmaDiscardedPackets=0,this.ewmaLostPackets=0,this.ewmaDroppedFrames=0,this.last=0,this.noticed=0}return o(e,[{key:"test",value:function(e){var t=e.discardedPackets,n=e.lostPackets;if(!n||n<1||!t||t<1)return!1;if(0===this.last)return this.last=u.getCurrent(),this.ewmaLostPackets=n,this.ewmaDiscardedPackets=t,!1;var r=u.getCurrent(),i=Math.max(r-this.last,1),o=Math.min((5e3-i)/5e3,.9),s=e.droppedFrames;return this.ewmaLostPackets=this.ewmaLostPackets*o+n,this.ewmaDroppedFrames=this.ewmaDroppedFrames*o+s,this.ewmaDiscardedPackets=this.ewmaDiscardedPackets*o+t,!(!s||s<1||1<this.ewmaLostPackets||1<this.ewmaDiscardedPackets||r-this.noticed<1e4||this.ewmaDroppedFrames<1||(this.noticed=r,0))}}]),e}(),d=function(){function e(t){i(this,e),this.notifyCallback=t,this.inbVideoTesters=new Map}return o(e,[{key:"accept",value:function(e){for(var t=e.filter(function(e){return e.getMediaType()===a.mediaType.video&&e.getStreamType()===a.streamType.inbound}),n=0;n<t.length;++n){var r=t[n];this.checkInboundVideo(r)}}},{key:"checkInboundVideo",value:function(e){var t=e.peek(),n=e.getSSRC();if(this.inbVideoTesters.has(n)||this.inbVideoTesters.set(n,new c),this.inbVideoTesters.get(n).test(t)){var r={reason:a.limitationType.cpu,ssrc:n};this.notifyCallback(r)}}},{key:"toString",value:function(){return"CPULimitationObserver"}}]),e}();n.CPULimitationObserver=d},{"../../config/constants":32,"../../utility/timestamps":98}],61:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.OneWayMediaObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../config/constants"),a=r(s),l=e("../onewaymediadisruption"),u=e("../../utility/timestamps"),c=r(u),d=function(){function e(t){i(this,e),this.notifierCallback=t,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}return o(e,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()==a.mediaType.audio&&e.getStreamType()===a.streamType.inbound}),n=e.filter(function(e){return e.getMediaType()==a.mediaType.audio&&e.getStreamType()===a.streamType.outbound}),r=[this.getInbOneWayAudioDisruption(t,n),this.getOutbOneWayAudioDisruption(t,n)],i=r.filter(function(e){return null!==e});0<i.length&&this.notifierCallback(i)}},{key:"toString",value:function(){return"DisruptionObserver"}},{key:"getInbOneWayAudioDisruption",value:function(e,t){var n=this.inbOneWayAudioDisruption;if(n.sent)return null;var r=t.filter(function(e){return 0===e.getStartTime()}).length<1,i=t.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||i)return null;var o=e.filter(function(e){return!e.hasTraffic()}).length<1;return 0<e.length&&o?(n.started=0,null):0===n.started?(n.started=c.getCurrent(),null):c.getCurrent()-5e3<n.started?null:(n.sent=!0,new l.OneWayMediaDisruption(a.oneWayMediaTypes.audio))}},{key:"getOutbOneWayAudioDisruption",value:function(e,t){var n=this.outbOneWayAudioDisruption;if(n.sent)return null;var r=e.filter(function(e){return 0===e.getStartTime()}).length<1,i=e.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||!i)return null;var o=t.filter(function(e){return!e.hasTraffic()}).length<1;return 0<t.length&&o?(n.started=0,null):0===n.started?(n.started=c.getCurrent(),null):c.getCurrent()-5e3<n.started?null:(n.sent=!0,new l.OneWayMediaDisruption(a.oneWayMediaTypes.audio))}}]),e}();n.OneWayMediaObserver=d},{"../../config/constants":32,"../../utility/timestamps":98,"../onewaymediadisruption":65}],62:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.QPSumObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../config/constants"),a=r(s),l=e("../../utility/timestamps"),u=r(l),c=function(){function e(t){i(this,e),this.lastQpSum=null,this.qpAvg=null,this.noticed=0}return o(e,[{key:"test",value:function(e){var t=e.getTrack();if(!t||!t.data||!t.data.qpSum)return!1;if(!this.lastQpSum)return this.lastQpSum=t.data.qpSum,!1;var n=t.data.qpSum-this.lastQpSum;this.lastQpSum=t.data.qpSum,null===this.qpAvg?this.qpAvg=n:this.qpAvg=.2*n+.8*this.qpAvg;var r=Math.max(2*this.qpAvg,1);if(n<this.qpAvg+r)return!1;var i=u.getCurrent();return this.noticed<i-1e4}}]),e}(),d=function(){function e(t){i(this,e),this.notifyCallback=t,this.testers=new Map}return o(e,[{key:"accept",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.getMediaType()===a.mediaType.video){var r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new c(n)),this.testers.get(r).test(n)){var i={reason:a.qualityDisruptionTypes.qpchange};this.notifyCallback(i)}}}}},{key:"toString",value:function(){return"QPSumObserver"}}]),e}();n.QPSumObserver=d},{"../../config/constants":32,"../../utility/timestamps":98}],63:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SendingTrigger=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../utility/timestamps"),a=r(s),l=e("../validator"),u=r(l),c=1e3,d=3e4,f=function(){function e(t,n,r){i(this,e),this.last=null,this.actual=0,this.name=t,this.alpha=n,this.supplier=r}return o(e,[{key:"update",value:function(e){if(null===this.last)return void(this.last=e);var t=Math.abs(e-this.last);this.actual=t*this.alpha+this.actual*(1-this.alpha),this.last=e}},{key:"doTest",value:function(e){var t=this.last;return this.update(e),null!==t&&t+this.supplier(this.actual)<e}}]),e}(),h=function(){function e(){i(this,e);var t=this;this.marginFactor=1,this.rttTester=new f("RTT Tester",.2,function(e){return Math.max(50,e)*t.marginFactor}),this.throughputTester=new f("Throughput Tester",.1,function(e){return Math.max(100,e)*t.marginFactor}),this.FLTester=new f("FL Tester",.1,function(e){return Math.max(.2,e)*t.marginFactor}),this.lastDecreased=a.getCurrent()}return o(e,[{key:"test",value:function(e){var t=e.peek();if(!t)return!1;var n=e.getTrack(),r=n.data,i=t.getRTT(),o=u.checkForNan(parseInt(r.csioIntBRKbps,10)),s=t.getFractionLost();if(this.rttTester.doTest(i)||this.throughputTester.doTest(o)||this.FLTester.doTest(s))return this.marginFactor=Math.min(2*this.marginFactor,15),!0;var l=a.getCurrent();return 3e3<l-this.lastChanged&&(this.marginFactor=Math.max(this.marginFactor-.5,1),this.lastDecreased=l),!1}}]),e}(),p=function(){function e(t){i(this,e),this.notifyCallback=t,this.minInterval=c,this.maxInterval=d,this.notified=0,this.testers=new Map}return o(e,[{key:"setup",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"accept",value:function(e){var t=a.getCurrent(),n=t-this.notified;if(this.minInterval===this.maxInterval)return void(this.minInterval<=n&&(this.notifyCallback(),this.notified=t));if(!(n<this.minInterval)){if(n<this.maxInterval&&!1===this.doSend(e))return;this.notifyCallback(),this.notified=t}}},{key:"setIntervals",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"toString",value:function(){return"SendingTrigger"}},{key:"doSend",value:function(e){for(var t=0;t<e.length;++t){var n=e[t],r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new h),this.testers.get(r).test(n))return!0}return!1}}]),e}();n.SendingTrigger=p},{"../../utility/timestamps":98,"../validator":82}],64:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputObserver=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../../config/constants"),a=r(s),l=e("../../utility/timestamps"),u=r(l),c=function(){function e(t){i(this,e),this.notifierCallback=t,this.observations=new Map}return o(e,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()===a.mediaType.video&&e.getStreamType()===a.streamType.outbound});if(!(t.length<1)){var n=this;t.forEach(function(e){n.observe(e)})}}},{key:"toString",value:function(){return"ThroughputObserver"}},{key:"getObservations",value:function(e){if(this.observations.has(e))return this.observations.get(e);var t={ssrc:0,started:0,max:0,maxTs:0,stable:0,stableTs:0,ready:!1,maxVerified:!1,stableVerified:!1};return this.observations.set(e,t),this.observations.get(e)}},{key:"observe",value:function(e){var t=e.getSSRC(),n=this.getObservations(t),r=u.getCurrent();if(!0!==n.ready){if(0===n.started)return n.ssrc=t,void(n.started=r);var i=e.getTrack(),o=i.data,s=o.csioIntBRKbps,a=Math.min(50,.05*s);if(n.max<s?(n.max=s,n.maxTs=r):1e4<r-n.maxTs&&(n.maxVerified=!0),!(r-n.started<15e3)&&(s-a<o.csioAvgBRKbps&&o.csioAvgBRKbps<s+a&&(n.stableTs=r,n.stable=s,n.stableVerified=!0),n.stableVerified&&n.maxVerified)){var l={ssrc:String(n.ssrc),maxsendingKBitrate:n.max,timeToMaxSendingKBitrate:n.maxTs-n.started,stablesendingKBitrate:n.stable,timeToStableSendingKBitrate:n.stableTs-n.started};this.notifierCallback(l),n.ready=!0}}}}]),e}();n.ThroughputObserver=c},{"../../config/constants":32,"../../utility/timestamps":98}],65:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";r(this,e),this.mediaType=t,this.ssrc=n}return i(e,[{key:"getContent",value:function(){var e=this;return{mediaType:e.mediaType,ssrc:e.ssrc}}}]),e}();n.OneWayMediaDisruption=o},{}],66:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i,o,s,a){r(this,e),this.candidatePair=t,this.codec=n,this.pcHash=i,this.trackStats=o,this.transportStats=s,this.measurements=a}return i(e,[{key:"getCandidatePair",value:function(){return this.candidatePair}},{key:"getCodec",value:function(){return this.codec}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getMeasurements",value:function(){return this.measurements}}]),e}();n.PcStats=o},{}],67:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i){r(this,e),this.width=t,this.height=n,this.frameRate=i}return i(e,[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getFrameRate",value:function(){return this.frameRate}},{key:"toString",value:function(){return this.width&&this.height&&this.frameRate?this.width.toString()+"X"+this.height.toString()+"X"+this.frameRate.toString():null}}]),e}();n.Resolution=o},{}],68:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=n.StatsAdapterIO=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../config/constants"),u=r(l),c=e("../collections/component"),d=e("../utility/registry"),f=e("../utility/hash"),h=r(f),p=n.StatsAdapterIO={RawStatsIn:"RawStatsIn",RawStatsOut:"RawStatsOut",UnprocessedOut:"UnprocessedOut"},v=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsAdapter"));return r.bindPort(p.RawStatsIn,r.receiveRawData,r),r.declarePort(p.RawStatsOut),r.declarePort(p.UnprocessedOut),r.codeBase=e,r.browser=n,r}return s(t,e),a(t,[{key:"receiveRawData",value:function(e,t){if(e){var n=this.extractRawStats(e);if(n){window&&window.csioReactNative&&(n=this.removeValues(n)),this.isConnected(p.UnprocessedOut)&&this.transmit(p.UnprocessedOut,n);var r=this.processRawStats(n,t);if(r&&r.transportStats)for(var i=0;i<r.transportStats.length;i++)r.transportStats[i].hash=this.getTransportHash(r.transportStats[i]);
r&&r.transportStats&&this.checkTransportStatsUpdates(r.transportStats,t),r&&r.trackStats&&(r=this.backFillTrackStats(r)),r&&r.transportStats&&r.candidatePair&&(r=this.backFillCandidatePairStats(r)),r.pcHash=t,this.transmit(p.RawStatsOut,r)}}}},{key:"removeValues",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.values){for(var r=0;r<n.values.length;++r)Object.assign(n,n.values[r]);delete n.values}}return e}},{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[];if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"normalizeIceCandidates",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];n.transport=n.protocol?n.protocol:"udp",n.ip=n.ip?n.ip:n.ipAddress,n.port=n.portNumber?Number(n.portNumber):n.port,"ssltcp"===n.transport&&(n.transport="tcp")}return e}},{key:"normalizeCanidatePairs",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];"in-progress"===n.state&&(n.state="inprogress"),n.state||(n.state="succeeded"),n.nominated||(n.nominated="true"===n.googActiveConnection),n.priority||(n.priority=123)}return e}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);if(a.candidatePair)r.push(a.candidatePair);else if(a.transportStats){if("transport"===a.transportStats.type){i=a.transportStats.selectedCandidatePairId;continue}r.push(a.transportStats)}else a.localCandidate?t.push(a.localCandidate):a.remoteCandidate&&n.push(a.remoteCandidate)}if(i)for(var l=0;l<r.length;++l)r[l].id===i&&(r[l].googActiveConnection="true");return{localIceCandidates:this.normalizeIceCandidates(t),remoteIceCandidates:this.normalizeIceCandidates(n),iceCandidatePairs:this.normalizeCanidatePairs(r)}}},{key:"processRawStats",value:function(e,t){var n={},r={},i={};n.tracks=[],n.candidatePair=[],n.transportStats=[],n.trackStats=[],n.codec=[];for(var o=0;o<e.length;o++){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);a.tracks?n.tracks.push(a.tracks):a.candidatePair?n.candidatePair.push(a.candidatePair):a.transportStats?this.codeBase!==u.codeBaseType.firefox?(parseInt(a.transportStats.bytesReceived,10)>0||parseInt(a.transportStats.bytesSent,10)>0)&&(n.transportStats.push(a.transportStats),"true"!==a.transportStats.googActiveConnection&&!0!==a.transportStats.googActiveConnection||(n.activeConnectionIndex=a.transportStats.length)):"true"!==a.transportStats.selected&&!0!==a.transportStats.selected||(n.transportStats.push(a.transportStats),n.activeConnectionIndex=a.transportStats.length):a.bwe?n.bwe=a.bwe:a.trackStats?n.trackStats.push(a.trackStats):a.codec?n.codec.push(a.codec):a.localCandidate?r[a.localCandidate.id]=a.localCandidate:a.remoteCandidate&&(i[a.remoteCandidate.id]=a.remoteCandidate)}if(n.tracks){var l=d.Registry.getConferenceManager().getConferenceForPcHash(t),c=void 0;l&&(c=l.getPeerConnectionManager().getPcHandlerByHash(t)),n.tracks.forEach(function(e){var t=c.getSSRCInfo(e.data.ssrc);void 0!==t&&t.localStartTime||c&&(c.updateSDP(n.tracks),t=c.getSSRCInfo(e.data.ssrc)),t&&(e.cname=t.cname,e.msid=t.msid,e.associatedVideoTag=t.associatedVideoTag,e.usageLabel=t.usageLabel)})}return n.transportStats&&this.codeBase===u.codeBaseType.firefox&&(n.transportStats=this.getAddressInfoFromCandidates(n.transportStats,r,i)),n}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names){for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);e.id&&(t.id=e.id)}else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;++i)Object.assign(t,t.values[i]);delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return-1!==n.indexOf(e.type)},r=n("inbound-rtp","inboundrtp"),i="true"===e.isRemote||!0===e.isRemote;return r||n("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType="local",void 0!==e.isRemote&&(t.tracks.reportType=i?"remote":"local")):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"getAddressInfoFromCandidates",value:function(e,t,n){for(var r=void 0,i=void 0,o=0;o<e.length;o++)r=t[e[o].localCandidateId],i=n[e[o].remoteCandidateId],r&&i&&(e[o].localAddr=r.ipAddress+":"+r.portNumber,e[o].remoteAddr=i.ipAddress+":"+i.portNumber,e[o].localAddrType=r.candidateType,e[o].remoteAddrType=i.candidateType,e[o].transportType=r.transport);return e}},{key:"getTransportHash",value:function(e){var t=void 0;return e&&(this.codeBase===u.codeBaseType.chrome?e.googLocalAddress?(t=e.googLocalAddress,t.concat(":",e.googRemoteAddress)):e.selectedCandidatePairId&&(t=e.selectedCandidatePairId):this.codeBase===u.codeBaseType.firefox&&(t=e.localAddr,t.concat(":",e.remoteAddr))),h.generateHash(t)}},{key:"backFillTrackStats",value:function(e){for(var t=e.tracks.length,n=void 0,r=void 0,i=void 0,o=0;o<t;o++)n=e.tracks[o],n.data.trackId&&(r=this.getStatsForId(e.trackStats,n.data.trackId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,r)),n.data.codecId&&(i=this.getStatsForId(e.codec,n.data.codecId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,i));return e}},{key:"backFillCandidatePairStats",value:function(e){for(var t=e.transportStats.length,n=void 0,r=void 0,i=0;i<t;i++)r=e.transportStats[i],r.selectedCandidatePairId&&(n=this.getStatsForId(e.candidatePair,r.selectedCandidatePairId))&&(e.transportStats[i]=this.mergeObjects(e.transportStats[i],n));return e}},{key:"mergeObjects",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&(e[n]=t[n]);return e}},{key:"getStatsForId",value:function(e,t){if(e){var n=e.filter(function(e){return e.id===t});if(n.length>0)return n[0]}}},{key:"formatRelayType",value:function(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}},{key:"getRelayType",value:function(e,t){var n=this,r=void 0,i=function(t){if(t.typePreference){var i=t.typePreference>>24;return"rtp"===t.protocol&&t.address===e&&(i>=0&&i<=2&&(r=n.formatTypePreference(i)),!0)}return!1};return t.getIceCandidates().some(i),r}},{key:"getTransportInfo",value:function(e,t){for(var n={},r=!1,i=0;i<e.length;i++){var o=e[i];if(navigator.mozGetUserMedia&&"candidatepair"===o.type&&("true"===o.selected||!0===o.selected)){n.foundActive=!0,n.localAddr=o.localAddr,n.remoteAddr=o.remoteAddr,n.localAddrType=o.localAddrType,n.remoteAddrType=o.remoteAddrType,n.transportType=o.transportType,n.localCandidateId=o.localCandidateId,n.remoteCandidateId=o.remoteCandidateId;break}if("googCandidatePair"===o.type&&("true"===o.googActiveConnection||!0===o.googActiveConnection)){n.foundActive=!0,n.localAddr=o.googLocalAddress,n.remoteAddr=o.googRemoteAddress,n.localAddrType=o.googLocalCandidateType,n.remoteAddrType=o.googRemoteCandidateType,n.transportType=o.googTransportType;break}if("transport"===o.type){r=!0,o.selectedCandidatePairId&&(n.selectedCandidatePairId=o.selectedCandidatePairId);break}}return r&&n.localAddr&&(n.ipv6=0===n.localAddr.indexOf("["),n.relayType=getRelayType(n.localAddr,t)),n}},{key:"sendFabricTransportSwitch",value:function(e,t){e.sendFabricTransportSwitch(t)}},{key:"checkTransportStatsUpdates",value:function(e,t){var n=d.Registry.getConferenceManager().getConferenceForPcHash(t);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(t);if(r){var i=this.getTransportInfo(e,r),o=r.getTransportInfo();o&&(o.localAddr===i.localAddr&&o.remoteAddr===i.remoteAddr&&o.transportType===i.transportType&&o.selectedCandidatePairId===i.selectedCandidatePairId&&o.localCandidateId===i.localCandidateId&&o.remoteCandidateId===i.remoteCandidateId||(r.setTransportInfo(i),this.sendFabricTransportSwitch(r,i.relayType)))}}}}]),t}(c.Component);n.StatsAdapter=v},{"../collections/component":25,"../config/constants":32,"../utility/hash":91,"../utility/registry":94}],69:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAssembler=n.StatsAssemblerIO=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../collections/component"),l=n.StatsAssemblerIO={StatsTupleIn:"StatsTupleIn",CallstatsOut:"CallstatsOut"},u=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsAssembler"));return e.pcHashes=[],e.bindPort(l.StatsTupleIn,e.receiveStats,e),e.declarePort(l.CallstatsOut),e}return o(t,e),s(t,[{key:"receiveStats",value:function(e){for(var t=this,n=0;n<e.tracks.length;n++)!function(n){var r=e.tracks[n];return t.pcHashes.find(function(e){return e===r.pcHash})?"continue":void t.pcHashes.push(r.pcHash)}(n);for(var r=e.getTransportStats(),n=0;n<this.pcHashes.length;n++){var i=this.pcHashes[n],o={};o.codec=e.getCodec(),o.trackStats=e.getTrackStats(),o.tracks=[];for(var s=0;s<e.tracks.length;s++){var a=e.tracks[s];a.pcHash===i&&o.tracks.push(a)}var u=r.get(i);1==u.length?o.Transport=u[0]:o.Transport=u,this.transmit(l.CallstatsOut,i,o)}}}]),t}(a.Component);n.StatsAssembler=u},{"../collections/component":25}],70:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsCallbackBuilder=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../utility/registry"),s=function(){function e(){r(this,e),this.callback=null}return i(e,[{key:"setCallback",value:function(e){this.callback=e}},{key:"buildStats",value:function(e,t){this.callback&&this.buildFromUnifiedFormat(e,t)}},{key:"getConnectionState",value:function(){return!0===navigator.onLine?"online":"offline"}},{key:"buildConferenceUrl",value:function(e){var t=e.getConferenceId(),n=o.Registry.getConferenceManager().get(t);return n?n.getUrl():null}},{key:"buildFromUnifiedFormat",value:function(e,t){var n={};n.connectionState=this.getConnectionState(),n.conferenceURL=this.buildConferenceUrl(t),n.fabricState=t.getPcState(),n.streams={};for(var r=0;r<e.length;r++){var i=e[r];if("inbound-rtp"===i.type||"outbound-rtp"===i.type){var o={ssrc:i.ssrc,statsType:i.type,fractionLoss:i.csioIntFL,bitrate:i.csioIntBRKbps,quality:i.csioMark,mediaType:i.csioMediaType,jitter:i.jitter,audioOutputLevel:i.audioOutputLevel,audioIntputLevel:i.audioIntputLevel,audioLevel:i.audioLevel,averageRTT:i.csioAvgRtt,averageJitter:i.csioAvgJitter,packetLossPercentage:i.csioPktLossPercentage,rtt:i.roundTripTime,remoteUserID:t.getRemoteId()},s=t.getSSRCInfo(i.ssrc+"");s&&(o.cname=s.cname,o.msid=s.msid,o.usageLabel=s.usageLabel,o.associatedVideoTag=s.associatedVideoTag),i.hasOwnProperty("googRtt")&&(o.rtt=i.googRtt),i.hasOwnProperty("mozRtt")&&(o.rtt=i.mozRtt),i.hasOwnProperty("googJitterReceived")&&(o.jitter=i.googJitterReceived),n.streams[i.ssrc]=o}}this.callback(n)}}]),e}();n.StatsCallbackBuilder=s},{"../utility/registry":94}],71:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsMonitor=n.StatsMonitorIO=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../collections/component"),u=e("./tracksmonitor"),c=e("./transportsmonitor"),d=e("./statstuple"),f=e("../utility/registry"),h=e("./monitorhooks/sendingtrigger"),p=e("./monitorhooks/onewaymediaobserver"),v=e("./monitorhooks/throughputobserver"),g=e("./monitorhooks/cpulimitationobserver"),m=e("./monitorhooks/qpsumobserver"),y=e("../config/constants"),b=r(y),_=e("../utility/csiologger"),S=r(_),T=n.StatsMonitorIO={PcStatsTupleIn:"PcStatsTupleIn",StatsTupleOut:"StatsTupleOut"},C=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsMonitor"));return n.bindPort(T.PcStatsTupleIn,n.receive,n),n.declarePort(T.StatsTupleOut),n.lastPcStats=null,n.lastPcHash=null,n.tracksmonitor=new u.TracksMonitor,n.transportsmonitor=new c.TransportsMonitor(e),n.candidatepairs=new Map,n.monitorhooks=[],n.sendingTrigger=new h.SendingTrigger(n.sendStatsTuple.bind(n)),n.oneWayMediaObserver=new p.OneWayMediaObserver(n.sendDisruptions.bind(n)),n.throughputObserver=new v.ThroughputObserver(n.sendThroughputObservations.bind(n)),n.cpuLimitationObserver=new g.CPULimitationObserver(n.sendCPULimitationObservations.bind(n)),n.qpSumObserver=new m.QPSumObserver(n.sendQPSumDistortions.bind(n)),n.setupHooks(),n}return s(t,e),a(t,[{key:"setupHooks",value:function(){this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)),this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)),this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)),this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)),this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver))}},{key:"setIntervals",value:function(e,t){this.sendingTrigger.setup(e,t)}},{key:"receive",value:function(e){var t=e.getPcHash(),n=e.getMeasurements();this.candidatepairs.set(t,e.getCandidatePair()),this.transportsmonitor.set(t,e.getTransportStats());for(var r=0;r<n.length;r++){var i=n[r],o=this.tracksmonitor.getMonitor(i);o?o.add(i):S.warn("No monitor for ssrc "+i.getSSRC())}this.lastPcStats=e,this.lastPcHash=t;for(var s=this.tracksmonitor.getMonitors(),a=this.monitorhooks,l=0;l<a.length;l++)(0,a[l])(s)}},{key:"getCandidatePairs",value:function(){var e=[];return this.candidatepairs.forEach(function(t,n){var r=[n,t];e.push(r)}),e}},{key:"sendStatsTuple",value:function(){var e=new d.StatsTuple(this.getCandidatePairs(),this.lastPcStats.getCodec(),this.lastPcStats.getTrackStats(),this.transportsmonitor.getIntervalStats(),this.tracksmonitor.extractTracks());this.transmit(T.StatsTupleOut,e)}},{key:"sendDisruptions",value:function(e){var t=this;e.forEach(function(e){t.sendEventMsg(b.internalFabricEvent.oneWayMedia,e.getContent())})}},{key:"sendCPULimitationObservations",value:function(e){}},{key:"sendQPSumDistortions",value:function(e){}},{key:"sendThroughputObservations",value:function(e){this.sendEventMsg(b.internalFabricEvent.sendingThroughputObservations,e)}},{key:"sendEventMsg",value:function(e,t){if(this.lastPcHash){var n=f.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash),i=r.getPeerConnection(),o=r.getConferenceId();f.Registry.getEventMessageBuilder().make(e,o,i,t)}}}}]),t}(l.Component);n.StatsMonitor=C},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"./monitorhooks/cpulimitationobserver":60,"./monitorhooks/onewaymediaobserver":61,"./monitorhooks/qpsumobserver":62,"./monitorhooks/sendingtrigger":63,"./monitorhooks/throughputobserver":64,"./statstuple":74,"./tracksmonitor":80,"./transportsmonitor":81}],72:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsParser=n.StatsParserIO=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../collections/component"),u=e("./measurement"),c=e("./pcstats"),d=e("../utility/rttregistry"),f=e("./validator"),h=r(f),p=e("../config/constants"),v=r(p),g=e("../utility/csiologger"),m=r(g),y=n.StatsParserIO={RawStatsIn:"RawStatsIn",PcStatsTupleOut:"PcStatsTupleOut"},b=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsParser"));return e.bindPort(y.RawStatsIn,e.receive,e),e.declarePort(y.PcStatsTupleOut),e}return s(t,e),a(t,[{key:"receive",value:function(e){if(null===e)return void m.warn("Stats object can not be null");for(var t=e.tracks,n=[],r=0;r<t.length;++r){var i=t[r];if(i&&i.data){var o=u.Measurement.make(e.pcHash,this.getSSRC(i),this.getStreamType(i),this.getMediaType(i),this.getFrameRateReceived(i),this.getFrameHeight(i),this.getFrameWidth(i),this.getDroppedFramesNum(i),this.getRTT(i),this.getJitter(i),this.getLostPackets(i),this.getReceivedPackets(i),this.getSentPackets(i),this.getDiscardedPackets(i),this.getSentBytes(i),this.getReceivedBytes(i),i);n.push(o)}else m.log("No track or track.data.")}var s=new c.PcStats(e.candidatePair,e.codec,e.pcHash,e.trackStats,e.transportStats,n);this.transmit(y.PcStatsTupleOut,s)}},{key:"getSSRC",value:function(e){return e.ssrc}},{key:"getStreamType",value:function(e){return e.streamType===v.streamType.inbound?v.streamType.inbound:e.streamType===v.streamType.outbound?v.streamType.outbound:void 0}},{key:"getSentBytes",value:function(e){if(void 0===e.data.bytesSent)return-1;var t=h.checkForNan(parseInt(e.data.bytesSent,10));return null!==t?t:-1}},{key:"getReceivedBytes",value:function(e){if(void 0===e.data.bytesReceived)return-1;var t=h.checkForNan(parseInt(e.data.bytesReceived,10));return null!==t?t:-1}},{key:"getReceivedPackets",value:function(e){if(void 0===e.data.packetsReceived)return-1;var t=h.checkForNegativeValue(parseInt(e.data.packetsReceived,10));return null!==t?t:-1}},{key:"getSentPackets",value:function(e){if(void 0===e.data.packetsSent)return-1;var t=h.checkForNegativeValue(parseInt(e.data.packetsSent,10));return null!==t?t:-1}},{key:"getDiscardedPackets",value:function(e){if(void 0===e.data.discardedPackets)return-1;var t=h.checkForNan(parseInt(e.data.discardedPackets,10));return null!==t?t:-1}},{key:"getLostPackets",value:function(e){if(void 0===e.data.packetsLost)return-1;var t=h.checkForNegativeValue(parseInt(e.data.packetsLost,10));return null!==t?t:-1}},{key:"getDroppedFramesNum",value:function(e){if(void 0===e.data.droppedFrames)return-1;var t=h.checkForNegativeValue(parseInt(e.data.droppedFrames,10));return null!==t?t:-1}},{key:"getFrameRateReceived",value:function(e){var t=null;return void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent?t=parseInt(e.data.googFrameRateSent,10):void 0!==e.data.framerateMean&&(t=parseInt(e.data.framerateMean,10)),void 0!==t&&(t=h.checkForNegativeValue(t)),t}},{key:"getFrameHeight",value:function(e){var t=void 0;return void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent?t=e.data.googFrameHeightSent:void 0!==e.data.frameHeight&&(t=e.data.frameHeight),t}},{key:"getJitter",value:function(e){return void 0!==e.data.googJitterReceived?h.checkForNan(parseInt(e.data.googJitterReceived,10)):void 0!==e.data.jitter?h.checkForNan(parseInt(e.data.jitter,10)):void 0}},{key:"getFrameWidth",value:function(e){return void 0!==e.data.googFrameWidthReceived?e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?e.data.googFrameWidthSent:void 0!==e.data.frameWidth?e.data.frameWidth:void 0}},{key:"getRTT",value:function(e){var t=function(e){return isNaN(e)||e<0?null:e};if(void 0!==e.data.googRtt)return t(parseInt(e.data.googRtt,10));if(void 0!==e.data.mozRtt)return t(parseInt(e.data.mozRtt,10));if(e.data.roundTripTime)return t(parseInt(e.data.roundTripTime,10));var n=this.getSSRC(e),r=(0,d.getRTTRegistry)().getRTT(n);return r&&(e.data.roundTripTime=r),r}},{key:"getMediaType",value:function(e){var t=v.mediaType.unknown;return e.data&&void 0!==e.data.mediaType?e.data.mediaType:(void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=v.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel?t=v.mediaType.audio:e.data.mediaType?t=e.data.mediaType:void 0!==e.data.framerateMean&&(t=v.mediaType.video),t)}}]),t}(l.Component);n.StatsParser=b},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/rttregistry":95,"./measurement":59,"./pcstats":66,"./validator":82}],73:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsTransmitter=n.StatsTransmitterIO=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../collections/component"),u=e("../utility/registry"),c=e("../config/constants"),d=r(c),f=e("../utility/csiologger"),h=r(f),p=n.StatsTransmitterIO={CallstatsIn:"CallstatsIn",UnprocessedIn:"UnprocessedIn"},v=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsTransmitter"));return e.pcHashes=[],e.battery=u.Registry.getBattery(),e.lastUnprocessed=null,e.bindPort(p.CallstatsIn,e.receiveCallstats,e),e.bindPort(p.UnprocessedIn,e.receiveUnprocessed,e),e}return s(t,e),a(t,[{key:"receiveUnprocessed",value:function(e){this.lastUnprocessed=e}},{key:"receiveCallstats",value:function(e,t){var n=null;return(n=this.getUnifiedFormat(t))?void this.send(e,n):void h.warn("Content can not be sent")}},{key:"send",value:function(e,t){var n=u.Registry.getConferenceManager().getConferenceForPcHash(e);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(e);r&&(u.Registry.getEventMessageBuilder().make(d.callstatsChannels.processedStats,r.getConferenceId(),r.getPeerConnection(),t),this.sendToStatsCallback(t.stats,r))}}},{key:"sendToStatsCallback",value:function(e,t){var n=u.Registry.getStatsCallbackBuilder();n&&n.buildStats(e,t)}},{key:"getUnifiedFormat",value:function(e){for(var t=this.lastUnprocessed,n=[],r=0;r<t.length;r++){var i=t[r],o={};i.id&&(o.id=i.id),i.timestamp&&(o.timestamp=i.timestamp),i.type&&(o.type=i.type),Object.assign(o,i);var s=function(t){for(var n=0;n<e.tracks.length;n++){var r=e.tracks[n];if(r.data.id===t.id&&r.data.type===t.type)return r.data}return t.id===e.Transport.id&&t.type===e.Transport.type?e.Transport:null}(i);if(s){for(var a in s)if(s.hasOwnProperty(a)){if("id"===a||"type"===a||"timestamp"===a)continue;o[a]=s[a]}n.push(o)}else n.push(o)}var l={stats:n};return l.wifiStats=u.Registry.getWifiStatsExecutor().getWifiStats(),l.batteryStatus={},l.batteryStatus.batteryLevel=this.battery.getLevel(),l.batteryStatus.isBatteryCharging=this.battery.getCharging(),l}}]),t}(l.Component);n.StatsTransmitter=v},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94}],74:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i,o,s){r(this,e),this.candidatePairs=t,this.codec=n,this.trackStats=i,this.transportStats=o,this.tracks=s}return i(e,[{key:"getCandidatePairs",value:function(){return this.candidatePairs}},{key:"getCodec",value:function(){return this.codec}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getTracks",value:function(){return this.tracks}}]),e}();n.StatsTuple=o},{}],75:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWAvg=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./swplugin"),l=function(e){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));return s.sum=0,s.counter=0,s}return o(t,e),s(t,[{key:"add",value:function(e){this.filter(e)&&(this.sum+=this.extract(e),++this.counter,this.calculate())}},{key:"remove",value:function(e){this.filter(e)&&(this.sum-=this.extract(e),--this.counter,this.calculate())}},{key:"calculate",value:function(){var e=0;return this.counter<1?void this.notify(e):(e=this.sum/this.counter,void this.notify(e))}}]),t}(a.SWPlugin);n.SWAvg=l},{"./swplugin":78}],76:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWBTreePercentile=void 0;var s=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./swplugin"),u=e("../../collections/binarytree"),c=function(e){function t(e,n,o,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;r(this,t);var d=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o,s,l));if(99<e||e<1)throw new RangeError("Percentile parameter must be between 1 and 99");return d.comparator=n,d.percentile=e,d.meanCalcer=c,d.estimator=a,d.ratio=e/(100-e),d.maxtree=new u.BinaryTree(n),d.mintree=new u.BinaryTree(n),d.ratio<1?d.required=1/d.ratio+1:1<d.ratio?d.required=d.ratio+1:d.required=2,d.result=null,d}return o(t,e),a(t,[{key:"add",value:function(e){if(this.filter(e)){if(this.maxtree.getNodeCounter()<1)return this.maxtree.insert(e),void this.calculate();this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree.insert(e):this.mintree.insert(e),this.balancing(),this.calculate()}}},{key:"remove",value:function(e){if(this.filter(e)){var t=this.mintree.getNodeCounter();this.maxtree.getNodeCounter()<1?this.mintree["delete"](e):t<1?this.maxtree["delete"](e):this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree["delete"](e):this.mintree["delete"](e),this.calculate()}}},{key:"getThresholds",value:function(){var e=this.mintree.getSize(),t=this.maxtree.getSize(),n=e+1,r=t+1;return 1<this.ratio?(n=Math.ceil(e*this.ratio),r=Math.floor(t/this.ratio)+1):this.ratio<1&&(n=Math.floor(e*this.ratio)+1,r=Math.ceil(t/this.ratio)),[n,r]}},{key:"balancing",value:function(){var e=this.mintree,t=this.maxtree,n=e.getSize(),r=t.getSize();if(!(r+n<this.required)){if(n<1)return void e.insertNodeAtBottom(t.popTopNode());for(r<1&&t.insertNodeAtTop(e.popBottomNode());;){var i=1<e.getNodeCounter(),o=1<t.getNodeCounter(),a=e.getBottomNode().getLength(),l=t.getTopNode().getLength();
if(e.getNodeCounter()<1||t.getNodeCounter()<1)break;var u=this.getThresholds(),c=s(u,2),d=c[0],f=c[1];if(o&=n+l<=f,i&=r+a<=d,n=e.getSize(),r=t.getSize(),d<r&&o)e.insertNodeAtBottom(t.popTopNode());else{if(!(f<n&&i))break;t.insertNodeAtTop(e.popBottomNode())}}}}},{key:"getMean",value:function(e,t){return this.meanCalcer?this.meanCalcer(e,t):e}},{key:"estimate",value:function(e,t){return this.estimator?this.estimator(e,t):null}},{key:"calculate",value:function(){var e=null,t=this.mintree,n=this.maxtree,r=t.getSize(),i=n.getSize(),o=i+r;if(!(o<1)){if(o<this.required||r<1||i<1){if(0==o)return;var s=void 0,a=void 0;r<1?(s=this.maxtree.getBottomValue(),a=this.maxtree.getTopValue()):i<1?(s=this.mintree.getBottomValue(),a=this.mintree.getTopValue()):(a=this.mintree.getTopValue(),s=this.maxtree.getBottomValue());var l=this.estimate(s,a);return void this.notify(l)}var u=n.getTopNode(),c=t.getBottomNode();if(u||c){if(!u){var d=this.extract(c);return void this.notify(d)}if(!c){var f=this.extract(u);return void this.notify(f)}var h=o*(this.percentile/100);if(Number.isInteger(h)){var p=Math.floor(h);e=Math.ceil(h+1)<=i?u.peek():p<=i?this.getMean(u.peek(),c.peek()):c.peek()}else{var v=i/r;e=this.ratio<v?u.peek():v<this.ratio?c.peek():this.ratio<1?c.peek():u.peek()}var g=this.extract(e);this.notify(g)}}}}]),t}(l.SWPlugin);n.SWBTreePercentile=c},{"../../collections/binarytree":22,"./swplugin":78}],77:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SWFunctor=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./swplugin"),l=function(e){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null,null,o));return s.addFunc=e,s.remFunc=n,s}return o(t,e),s(t,[{key:"add",value:function(e){this.filter(e)&&this.addFunc&&this.addFunc(e)}},{key:"remove",value:function(e){this.filter(e)&&this.remFunc&&this.remFunc(e)}},{key:"toString",value:function(){return"SWFuncPlugin"}}]),t}(a.SWPlugin);n.SWFunctor=l},{"./swplugin":78}],78:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SWPlugin=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../../utility/csiologger"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,e),this.extractorFnc=t,this.notifierFnc=n,this.filterFunc=i}return i(e,[{key:"notify",value:function(e){return this.notifierFnc?void this.notifierFnc(e):void s.warn("Failed notification for "+this.toString())}},{key:"extract",value:function(e){return this.extractorFnc?this.extractorFnc(e):(s.warn(this.toString()+" tried to extract without extractorFnc"),null)}},{key:"filter",value:function(e){return!this.filterFunc||this.filterFunc(e)}},{key:"add",value:function(e){s.log("Abstract method is called width value: "+e)}},{key:"remove",value:function(e){s.log("Abstract method is called with value: "+e)}},{key:"toString",value:function(){return"SWPlugin"}}]),e}();n.SWPlugin=a},{"../../utility/csiologger":87}],79:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return t.green<=e?b.avQualityRatings.excellent:t.red<e?b.avQualityRatings.fair:b.avQualityRatings.bad}function l(e,t){return t.red<e?b.avQualityRatings.bad:t.green<=e?b.avQualityRatings.fair:b.avQualityRatings.excellent}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackMonitor=void 0;var u=function w(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:w(i,t,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=e("../utility/registry"),f=e("../collections/slidingwindow"),h=e("../statspipeline/swplugins/swavg"),p=e("../statspipeline/swplugins/swbtreepercentile"),v=e("../statspipeline/swplugins/swfunctor"),g=e("../utility/timestamps"),m=r(g),y=e("../config/constants"),b=r(y),_=e("../utility/csiologger"),S=r(_),T=function(){function e(){s(this,e),this.evaluators=[]}return c(e,[{key:"addEvaluator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={processFnc:e,weight:t};this.evaluators.push(n)}},{key:"getQuality",value:function(e){for(var t=0,n=[],r=0,i=0;i<this.evaluators.length;i++){var o=this.evaluators[i],s=0,a=o.processFnc?o.processFnc(e):0;if(a){if(a===b.avQualityRatings.bad)s=b.qualityRating.bad;else if(a===b.avQualityRatings.fair)s=b.qualityRating.fair;else if(a===b.avQualityRatings.excellent)s=b.qualityRating.excellent;else if(a===b.avQualityRatings.unknown)continue;t+=o.weight,n.push({result:s,weight:o.weight})}}for(var l=0;l<n.length;l++){var u=n[l];r+=u.result*(u.weight/t)}return r=Math.floor(r),r===b.qualityRating.excellent?b.avQualityRatings.excellent:r===b.qualityRating.good?b.avQualityRatings.fair:r===b.qualityRating.fair?b.avQualityRatings.fair:r===b.qualityRating.poor?b.avQualityRatings.fair:r===b.qualityRating.bad?b.avQualityRatings.bad:void 0}}]),e}(),C=function(e){function t(e,n,r,o){s(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return a.thresholds=[],a.enableThresholds=!1,a.requestTime=0,a.started=0,a.created=m.getCurrent(),a.mediaType=o,a.streamType=r,a.qualityHelper=new T,a.metrics=a.makeTrack(),a.lastTrack={},a.prevFrameRateMean=null,a.ssrc=null,a.scsHelper={total:0,above:0,ccDriven:0,sumMaxBitrateDiff:0,sumThroughputDiff:0,prevCsioAvgBRKbps:0},a}return o(t,e),c(t,null,[{key:"make",value:function(e,n,r,i){var o=new t(e,n,r,i),s=o.metrics;return o.attach(new h.SWAvg(function(e){return e.getJitter()},function(e){s.csioAvgJitter=e},function(e){var t=e.getJitter();return null!==t&&void 0!==t})),o.attach(new h.SWAvg(function(e){return e.getRTT()},function(e){s.csioAvgRtt=e},function(e){var t=e.getRTT();return null!==t&&void 0!==t})),o.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getJitter(),r=t.getJitter();return n==r?0:n<r?-1:1},function(e){return e.getJitter()},function(e){s.csioPercentileJitter=e},function(e,t){return t?t.getJitter():e?e.getJitter():void 0},function(e){var t=e.getJitter();return null!==t&&void 0!==t},function(e,t){return e})),o.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getRTT(),r=t.getRTT();return n==r?0:n<r?-1:1},function(e){return e.getRTT()},function(e){s.csioSig2Latency=e,s.csioeM=e+40},function(e,t){return t?t.getRTT():e?e.getRTT():void 0},function(e){var t=e.getRTT();return null!==t&&void 0!==t},function(e,t){return e})),r===b.streamType.inbound?t.setupInboundMonitor(o):r===b.streamType.outbound?t.setupOutboundMonitor(o):S.warn("Unrecognized streamType ("+r+") at TrackMonitor"),i===b.mediaType.audio?t.setupAudioMonitor(o):i===b.mediaType.video?t.setupVideoMonitor(o):S.warn("Unrecognized mediaType ("+i+") at TrackMonitor"),r===b.streamType.inbound&&i===b.mediaType.audio?t.setupInbAudioQualityEvaluator(o):r===b.streamType.inbound&&i===b.mediaType.video?t.setupInbVideoQualityEvaluator(o):r===b.streamType.outbound&&i===b.mediaType.audio?t.setupOutbAudioQualityEvaluator(o):r===b.streamType.outbound&&i===b.mediaType.video&&(t.setupOutbVideoQualityEvaluator(o),t.setupSCSValidator(o)),o.addPostProcess(function(e){s.csioMark=o.getQuality(e)}),o}},{key:"setupInbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?b.avQualityRatings.unknown:a(t.csioIntBRKbps,b.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioIntFL||null===t.csioIntFL||t.csioIntFL<0?b.avQualityRatings.unknown:l(t.csioIntFL,b.fractionalLossThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?b.avQualityRatings.unknown:l(t.csioeM,b.eModelThreshold.audio)})}},{key:"setupOutbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?b.avQualityRatings.unknown:a(t.csioIntBRKbps,b.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?b.avQualityRatings.unknown:l(t.csioeM,b.eModelThreshold.audio)})}},{key:"setupInbVideoQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?b.avQualityRatings.unknown:a(t.csioIntBRKbps,b.throughputThreshold.video)}),e.addQualityEvaluator(function(n){return void 0===t.csioFrameRateMean||null===t.csioFrameRateMean?b.avQualityRatings.unknown:t.csioFrameRateMean&&e.prevFrameRateMean?a(t.csioFrameRateMean/e.prevFrameRateMean,b.currOverPrevFrameRateThreshold.video):b.avQualityRatings.bad}),e.addQualityEvaluator(function(e){return void 0===t.csioSig2Latency||null===t.csioSig2Latency?b.avQualityRatings.unknown:l(t.csioSig2Latency,b.rttThreshold.video)})}},{key:"setupOutbVideoQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0==t.csioIntBRKbps||null==t.csioIntBRKbps?b.avQualityRatings.unknown:a(t.csioIntBRKbps,b.throughputThreshold.video)}),e.addQualityEvaluator(function(n){return void 0===t.csioFrameRateMean||null===t.csioFrameRateMean?b.avQualityRatings.unknown:t.csioFrameRateMean&&e.prevFrameRateMean?a(t.csioFrameRateMean/e.prevFrameRateMean,b.currOverPrevFrameRateThreshold.video):b.avQualityRatings.bad}),e.addQualityEvaluator(function(e){return void 0===t.csioSig2Latency||null===t.csioSig2Latency?b.avQualityRatings.unknown:l(t.csioSig2Latency,b.rttThreshold.video)})}},{key:"setupInboundMonitor",value:function(e){var t=e.metrics;e.addPreProcess(function(n){var r=n.getLostPackets(),i=n.getReceivedPackets(),o=e.getRequestedMeasurement(),s=0,a=0;o?(s=r-o.getLostPackets(),a=i-o.getReceivedPackets()):(s=r,a=i);var l=0;(0<s||0<a)&&(l=s/(a+s)),t.csioIntPktLoss=s,t.csioIntFL=l,n.setFractionLost(l)}),e.attach(new v.SWFunctor(function(n){var r=m.getCurrent(),i=n.getResolution(),o=e.getRequestedMeasurement(),s=e.getRequestTime(),a=n.getLostPackets(),l=8*n.getReceivedBytes(),u=n.getReceivedPackets(),c=r-e.getStartTime(),f=0,h=0,p=0,v=0,g=1e3,y=Math.max(r-e.getStartTime(),g);o?(v=u-o.getReceivedPackets(),f=l-8*o.getReceivedBytes(),h=a-o.getLostPackets(),p=Math.max(r-s,g)):(d.Registry.getCredentials().getAdaptiveInterval(),g=d.Registry.getCredentials().getStatsSubmissionInterval(),y=Math.max(r-e.getStartTime(),g),v=u,f=l,h=a,p=Math.max(y,g)),t.csioIntPktRcv=v,t.csioIntPR=v/(p/1e3),t.csioAvgBRKbps=l/y,t.csioIntBRKbps=f/p,t.csioAvgPacketSize=n.getReceivedBytes()/u,t.csioIntMs=c,t.csioTimeElapseMs=p,t.csiores=i,t.csioPktLostPercentage=h/f*100},null,null)),e.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){t.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!==t&&void 0!==t},function(e,t){return e}))}},{key:"setupOutboundMonitor",value:function(e){var t=e.metrics;e.addPreProcess(function(n){var r=n.getLostPackets(),i=n.getSentPackets(),o=e.getRequestedMeasurement(),s=0,a=0;o?(s=r-o.getLostPackets(),a=i-o.getSentPackets()):(s=r,a=i);var l=0;(0<s||0<a)&&(l=s/(a+s)),t.csioIntPktLoss=s,t.csioIntFL=l,n.setFractionLost(l)}),e.attach(new v.SWFunctor(function(n){var r=m.getCurrent(),i=n.getResolution(),o=e.getRequestedMeasurement(),s=e.getRequestTime(),a=n.getLostPackets(),l=8*n.getSentBytes(),u=n.getSentPackets(),c=r-e.getStartTime(),f=0,h=0,p=0,v=0,g=1e3,y=Math.max(r-e.getStartTime(),g);o?(v=u-o.getSentPackets(),f=l-8*o.getSentBytes(),h=a-o.getLostPackets(),p=Math.max(r-s,g)):(d.Registry.getCredentials().getAdaptiveInterval(),g=d.Registry.getCredentials().getStatsSubmissionInterval(),y=Math.max(r-e.getStartTime(),g),v=u,f=l,h=a,p=Math.max(y,g)),t.csioIntPktRcv=v,t.csioAvgBRKbps=l/y,t.csioIntBRKbps=f/p,t.csioIntPR=v/(p/1e3),t.csioAvgPacketSize=n.getSentBytes()/u,t.csioIntMs=c,t.csioTimeElapseMs=p,t.csiores=i,t.csioPktLostPercentage=h/f*100},null,null)),e.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){t.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!==t&&void 0!==t},function(e,t){return e}))}},{key:"setupAudioMonitor",value:function(e){var t=e.metrics;e.attach(new v.SWFunctor(function(e){t.csioMediaType=b.mediaType.audio},null,null))}},{key:"setupVideoMonitor",value:function(e){var t=e.metrics;e.attach(new h.SWAvg(function(e){return e.getFrameRateReceived()},function(n){e.prevFrameRateMean=t.csioFrameRateMean,t.csioFrameRateMean=n},function(e){var t=e.getFrameRateReceived();return null!==t&&void 0!==t})),e.attach(new h.SWAvg(function(e){return e.getFrameHeight()},function(e){t.csioFrameHeightMean=e},function(e){var t=e.getFrameHeight();return null!==t&&void 0!==t})),e.attach(new h.SWAvg(function(e){return e.getFrameWidth()},function(e){t.csioFrameWidthMean=e},function(e){var t=e.getFrameWidth();return null!==t&&void 0!==t})),e.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){t.csioFrameRate95Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new p.SWBTreePercentile(50,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){t.csioFrameRate50Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){t.csioFrameHeight95Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new p.SWBTreePercentile(50,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){t.csioFrameHeight50Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new p.SWBTreePercentile(95,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){t.csioFrameWidth95Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new p.SWBTreePercentile(50,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){t.csioFrameWidth50Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!==t&&void 0!==t},function(e,t){return e})),e.attach(new v.SWFunctor(function(e){t.csioMediaType=b.mediaType.video},null,null))}},{key:"setupSCSValidator",value:function(e){var t=e.metrics;e.attach(new v.SWFunctor(function(n){var r=d.Registry.getConfigServiceWrapper().getSenderConfig();if(!r||!r.rtc_rtp_parameters||!r.rtc_rtp_parameters.encodings)return t.csioSCSValidationSampleCount=null,t.csioAvgMaxBitrateDiff=null,t.csioAvgDeltaThroughput=null,t.csioMaxBitrateAboveRatio=null,void(t.csioCCDrivenRatio=null);var i=0;r.rtc_rtp_parameters.encodings.forEach(function(e){e&&(i=Math.max(i,e.maxBitrate))});var o=0,s=d.Registry.getConfigServiceWrapper().getDefaultSenderConfig();if(s&&s.encodings){s.encodings.forEach(function(e){o=Math.max(o,e.maxBitrate)});var a=0,l=0,u=null,c=null,f=e.getSCSHelper();0<o&&.9*o<1e3*t.csioAvgBRKbps?(a=i-o,c=!1):(a=i-1e3*t.csioAvgBRKbps,c=!0),u=0<a,l=t.csioAvgBRKbps-t.prevCsioAvgBRKbps,f.prevCsioAvgBRKbps=t.csioAvgBRKbps,t.csioSCSValidationSampleCount=++f.total,f.sumMaxBitrateDiff+=a,t.csioAvgMaxBitrateDiff=f.sumMaxBitrateDiff/f.total,f.sumThroughputDiff+=l,t.csioAvgDeltaThroughput=f.sumThroughputDiff/f.total,u&&(f.above+=1),t.csioMaxBitrateAboveRatio=f.above/f.total,c&&(f.ccDriven+=1),t.csioCCDrivenRatio=f.ccDriven/f.total}},null,null))}}]),c(t,[{key:"makeTrack",value:function(){var e={};return e.csioMediaType=void 0,e.csioMark=void 0,e.csioIntBRKbps=void 0,e.csioAvgBRKbps=void 0,e.csioIntFL=void 0,e.csioIntMs=void 0,e.csioIntPR=void 0,e.csioPercentileFl=void 0,e.csioAvgJitter=void 0,e.csioAvgRtt=void 0,e.csioPercentileJitter=void 0,e.csioSig2Latency=void 0,e.csioTimeElapseMs=void 0,e.csioeM=void 0,e.csiores=void 0,e.csioFrameWidth95Percentile=void 0,e.csioFrameWidth50Percentile=void 0,e.csioFrameHeight95Percentile=void 0,e.csioFrameHeight50Percentile=void 0,e.csioFrameRate95Percentile=void 0,e.csioFrameRate50Percentile=void 0,e.csioFrameWidthMean=void 0,e.csioFrameHeightMean=void 0,e.csioFrameRateMean=void 0,e.csioIntPktRcv=void 0,e.csioSCSValidationSampleCount=null,e.csioAvgMaxBitrateDiff=null,e.csioAvgDeltaThroughput=null,e.csioMaxBitrateAboveRatio=null,e.csioCCDrivenRatio=null,e}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"add",value:function(e){this.ssrc=e.getSSRC(),this.lastTrack=e.extractTrack(),this.lastTrack.pcHash=e.getPcHash(),0===this.started&&(this.started=m.getCurrent()),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e)}},{key:"hasTraffic",value:function(){return 0<this.metrics.csioIntBRKbps}},{key:"getTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),e}},{key:"extractTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),this.requestTime=m.getCurrent(),this.requestedMeasurement=this.peek(),e}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getStartTime",value:function(){return this.started}},{key:"getCreationTime",value:function(){return this.created}},{key:"getRequestTime",value:function(){return Math.max(this.started,this.requestTime)}},{key:"getRequestedMeasurement",value:function(){return this.requestedMeasurement}},{key:"getSCSHelper",value:function(){return this.scsHelper}},{key:"addQualityEvaluator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.qualityHelper.addEvaluator(e,t)}},{key:"getQuality",value:function(e){return this.qualityHelper.getQuality(e)}},{key:"addPreProcess",value:function(e){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPreProcess",this).call(this,e)}},{key:"addPostProcess",value:function(e){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addPostProcess",this).call(this,e)}}]),t}(f.SlidingWindow);n.TrackMonitor=C},{"../collections/slidingwindow":27,"../config/constants":32,"../statspipeline/swplugins/swavg":75,"../statspipeline/swplugins/swbtreepercentile":76,"../statspipeline/swplugins/swfunctor":77,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],80:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TracksMonitor=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./trackmonitor"),s=e("../config/constants"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=function(){function e(){r(this,e),this.inbMonitors=new Map,this.outbMonitors=new Map}return i(e,[{key:"getMonitor",value:function(e){var t=e.getStreamType(),n=e.getMediaType(),r=e.getSSRC(),i=null;return t===a.streamType.inbound?n===a.mediaType.audio?i=this.getInbAudioMonitor(r):n===a.mediaType.video&&(i=this.getInbVideoMonitor(r)):t===a.streamType.outbound&&(n===a.mediaType.audio?i=this.getOutbAudioMonitor(r):n===a.mediaType.video&&(i=this.getOutbVideoMonitor(r))),i}},{key:"extractTracks",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t.extractTrack())}),this.inbMonitors.forEach(function(t,n){e.push(t.extractTrack())}),e}},{key:"getTracks",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t.getTrack())}),this.inbMonitors.forEach(function(t,n){e.push(t.getTrack())}),e}},{key:"getMonitors",value:function(){var e=[];return this.outbMonitors.forEach(function(t,n){e.push(t)}),this.inbMonitors.forEach(function(t,n){e.push(t)}),e}},{key:"getInbAudioMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=o.TrackMonitor.make(1e3,3e4,a.streamType.inbound,a.mediaType.audio),this.inbMonitors.set(e,t)),t}},{key:"getInbVideoMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=o.TrackMonitor.make(1e3,3e4,a.streamType.inbound,a.mediaType.video),this.inbMonitors.set(e,t)),t}},{key:"getOutbAudioMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=o.TrackMonitor.make(1e3,3e4,a.streamType.outbound,a.mediaType.audio),this.outbMonitors.set(e,t)),t}},{key:"getOutbVideoMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=o.TrackMonitor.make(1e3,3e4,a.streamType.outbound,a.mediaType.video),this.outbMonitors.set(e,t)),t}}]),e}();n.TracksMonitor=l},{"../config/constants":32,"./trackmonitor":79}],81:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TransportsMonitor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/constants"),a=r(s),l=e("../utility/timestamps"),u=r(l),c=e("../utility/rttregistry"),d=function(){function e(t){i(this,e),this.previous=t,this.actual=t,this.outdated=u.getCurrent()}return o(e,[{key:"setActual",value:function(e){this.actual=e}},{key:"outdate",value:function(){this.previous=this.actual,this.outdated=u.getCurrent()}},{key:"getActual",value:function(){return this.actual}},{key:"getPrevious",value:function(){return this.previous}},{key:"getElapsedTime",value:function(){return u.getCurrent()-this.outdated}}]),e}(),f=function(){function e(t){i(this,e),this.stats=new Map,this.codeBase=t}return o(e,[{key:"set",value:function(e,t){var n=this.stats.get(e);return n?void n.setActual(t):void this.stats.set(e,new d(t))}},{key:"getIntervalStats",value:function(){var e=this,t=new Map;return this.stats.forEach(function(n,r){t.set(r,e.getIntervalStat(n)),n.outdate()}),t}},{key:"getIntervalStat",value:function(e){var t=null;switch(this.codeBase){case a.codeBaseType.chrome:t=this.getIntervalStatForChrome(e);break;default:t=e.getActual()}return t}},{key:"getIntervalStatForChrome",value:function(e){var t=e.getActual(),n=e.getPrevious(),r=e.getElapsedTime();if(!n)return actual;for(var i=0;i<t.length;++i){var o=t[i],s=n[i];if(!s||!o)return t;var l=parseInt(s.bytesReceived,10),u=parseInt(s.bytesSent,10);o.csioReceivedBwKbps=8*(parseInt(o.bytesReceived,10)-l)/r,o.csioSentBwKbps=8*(parseInt(o.bytesSent,10)-u)/r,o.csioIntBytesReceived=parseInt(o.bytesReceived,10)-l,o.csioIntBytesSent=parseInt(o.bytesSent,10)-u,void 0!==s.packetsSent&&void 0!==o.packetsSent&&(o.csioSentPacketRate=(parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10))/(r/1e3),o.csioIntPacketsSent=parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10)),void 0!==s.packetsReceived&&void 0!==o.packetsReceived&&(o.csioReceivedPacketRate=(parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10))/(r/1e3),o.csioIntPacketsReceived=parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10)),this.codeBase==a.codeBaseType.chrome&&(o.currentRoundTripTime=(0,c.getRTTRegistry)().getTransportRTT())}return t}}]),e}();n.TransportsMonitor=f},{"../config/constants":32,"../utility/rttregistry":95,"../utility/timestamps":98}],82:[function(e,t,n){"use strict";function r(e){return isNaN(e)?null:e}function i(e){return null!==r(e)&&0<e?e:null}Object.defineProperty(n,"__esModule",{value:!0}),n.checkForNan=r,n.checkForNegativeValue=i},{}],83:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e),this.getWifiStatsMethod=null,this.wifiStats=null,this.interval=1e4}return i(e,[{key:"setGetWifiStatsMethod",value:function(e){this.getWifiStatsMethod=e,this.wifiStatsHandler()}},{key:"getWifiStats",value:function(){return this.wifiStats}},{key:"wifiStatsHandler",value:function(){var e=this;e.getWifiStatsMethod&&e.getWifiStatsMethod().then(function(t){e.wifiStats=JSON.parse(t),setTimeout(function(){e.wifiStatsHandler()},e.interval)})["catch"](function(){setTimeout(function(){e.wifiStatsHandler()},e.interval)})}}]),e}();n.WifiStatsExecutor=o},{}],84:[function(e,t,n){"use strict";function r(e){return window.btoa(e)}function i(e){return window.atob(e)}function o(e){return r(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function s(e){return r(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function a(e){return o(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function l(e){for(var t=i(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var o=t.charCodeAt(r).toString(16);1===o.length&&(o="0"+o),n.push(o)}return n.join("")}Object.defineProperty(n,"__esModule",{value:!0}),n.encode=r,n.decode=i,n.urlencode=s,n.urlencodeUnicode=a,n.strtohex=l},{}],85:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Callbacks=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../config/constants"),a=r(s),l=e("./registry"),u=e("./csiologger"),c=r(u),d=function(){function e(){i(this,e),this.callbacks={}}return o(e,[{key:"set",value:function(e,t){if("function"==typeof t)return a.callbackFunctions.hasOwnProperty(e)?(this.callbacks[e]=t,void(e===a.callbackFunctions.stats&&l.Registry.getStatsCallbackBuilder().setCallback(t))):void c.error("Couldn't set callback: "+e)}},{key:"get",value:function(e){return this.callbacks.hasOwnProperty(e)?this.callbacks[e]:null}}]),e}();n.Callbacks=d},{"../config/constants":32,"./csiologger":87,"./registry":94}],86:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Credentials=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../config/constants"),l=r(a),u=e("./csiologger"),c=r(u),d=function(){function e(){i(this,e),this.appId=null,this.userId=null,this.userIdObject=null,this.deviceId=null,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.transportType=l.transportType.rest,this.adaptiveInterval=!1}return s(e,[{key:"getAppId",value:function(){return this.appId}},{key:"setAppId",value:function(e){this.appId="string"==typeof e?parseInt(e,10):e}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(e){"object"===(void 0===e?"undefined":o(e))?(this.userId=e.aliasName,this.setUserIdObject(e)):this.userId=e}},{key:"getUserIdObject",value:function(){return this.userIdObject}},{key:"setUserIdObject",value:function(e){this.userIdObject=e}},{key:"getStatsSubmissionInterval",value:function(){return this.statsSubmissionInterval}},{key:"setStatsSubmissionInterval",value:function(e){c.log("setStatsSubmissionInterval is ",e),this.statsSubmissionInterval=e}},{key:"getCollectSDP",value:function(){return this.collectSDP}},{key:"setCollectSDP",value:function(e){this.collectSDP=e}},{key:"getTransportType",value:function(){
return this.transportType}},{key:"setTransportType",value:function(e){this.transportType=e}},{key:"getAdaptiveInterval",value:function(){return this.adaptiveInterval}},{key:"setAdaptiveInterval",value:function(e){this.adaptiveInterval=e}}]),e}();n.Credentials=d},{"../config/constants":32,"./csiologger":87}],87:[function(e,t,n){"use strict";function r(){if("true"===l.csioDebug){var e;(e=console).info.apply(e,arguments)}}function i(){if("true"===l.csioDebug){var e;(e=console).log.apply(e,arguments)}}function o(){if("true"===l.csioDebug){var e;(e=console).warn.apply(e,arguments)}}function s(){var e;(e=console).warn.apply(e,arguments)}Object.defineProperty(n,"__esModule",{value:!0}),n.info=r,n.log=i,n.warn=o,n.error=s;var a=e("../config/settings"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(a)},{"../config/settings":33}],88:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Endpoint=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../browserapi/localstorage"),a=r(s),l=e("../browserapi/detectbrowser"),u=r(l),c=e("../utility/timestamps"),d=r(c),f=e("../utility/hash"),h=r(f),p=function(){function e(){i(this,e),this.id=null,this.appversion=null,this.magicKey=Math.floor(4294967296*Math.random()),this.browserName=null,this.browserVersion=null,this.osName=null,this.osVersion=null,this.codeBase=null,this.userAgent=null,this.retrieveId()}return o(e,[{key:"setup",value:function(){var e=u.detect();this.browserName=e.browserName,this.browserVersion=e.browserVersion,this.osName=e.os,this.osVersion=e.osVersion,this.codeBase=e.codeBase,this.userAgent=e.userAgent}},{key:"retrieveId",value:function(){var e=this,t=a.get("endpointID");if(null===t){var n=d.getCurrent(),r=Math.random()*n;h.generateSHA256(r.toString(),function(t){e.id=t,a.store("endpointID",t)})}else this.id=t}},{key:"getId",value:function(){return this.id}},{key:"getAppVersion",value:function(){return this.appversion}},{key:"setAppVersion",value:function(e){this.appversion=e}},{key:"getMagicKey",value:function(){return this.magicKey}},{key:"getBrowserName",value:function(){return this.browserName}},{key:"getBrowserVersion",value:function(){return this.browserVersion}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getCodeBase",value:function(){return this.codeBase}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"serialize",value:function(){return{type:"browser",buildName:this.browserName,buildVersion:this.browserVersion,appVersion:this.appversion,os:this.osName,osVersion:this.osVersion,userAgent:this.userAgent}}}]),e}();n.Endpoint=p},{"../browserapi/detectbrowser":17,"../browserapi/localstorage":19,"../utility/hash":91,"../utility/timestamps":98}],89:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessage=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../config/constants"),l=r(a),u=e("../config/settings"),c=r(u),d=e("./registry"),f=e("./csiologger"),h=r(f),p=function(){function e(t,n,r,o){i(this,e),this.eventType=t,this.customEntries=r,this.pcHandler=o,this.auth=d.Registry.getAuthenticator(),this.clocksync=d.Registry.getClockSync(),this.timestamp=this.clocksync.getSynchronizedTimestamp(),this.conferenceId=n,this.clockUnSynced=!this.clocksync.isCompleted()}return s(e,[{key:"updateConferenceId",value:function(e){h.log("updating conferenceId to ",this.eventType,this.conferenceId,e),this.conferenceId=e}},{key:"toJson",value:function(){if(!this.canBeSent())return null;var e=this.getCommonHeader();return Object.assign(e,this.customEntries),this.eventType===l.internalFabricEvent.userJoined&&delete e.connectionID,e}},{key:"getCallback",value:function(){return this.pcHandler?this.pcHandler.getCallback():null}},{key:"canBeSent",value:function(){var e=void 0,t=l.tmpConferenceId;if(this.conferenceId===t)return!1;if(this.pcHandler&&!this.pcHandler.getRemoteId())return!1;if(this.eventType!==l.precalltestEvents.results){var n=d.Registry.getConferenceManager().get(this.conferenceId);if(!n)return!1;e=n.getUcId()}return!(!this.auth.getToken()||(this.auth.isTokenValid()?!(this.isPriority()||this.clocksync.isCompleted()&&e)||this.eventType===l.internalFabricEvent.userAlive&&!e:(this.auth.reAuthenticate(),1)))}},{key:"isCachable",value:function(){return-1===[l.internalFabricEvent.userAlive].indexOf(this.eventType)}},{key:"isPriority",value:function(){var e=!1;return this.eventType!==l.internalFabricEvent.userJoined&&this.eventType!==l.precalltestEvents.results&&this.eventType!==l.internalFabricEvent.userAlive||(e=!0),e}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getCommonHeader",value:function(){var e={version:c.version,callstatsVersion:c.version,channel:this.decideChannel(),timestamp:this.timestamp,action:this.eventType,eventType:this.eventType,localID:encodeURIComponent(d.Registry.getCredentials().getUserId()),timeShift:0,appID:d.Registry.getCredentials().getAppId(),deviceID:d.Registry.getEndpoint().getId(),token:this.auth.getToken(),confID:encodeURIComponent(this.conferenceId)};this.clockUnSynced&&(e.timestamp+=this.clocksync.getOffset());var t=d.Registry.getConferenceManager().get(this.conferenceId);return e.ucID=t?t.getUcId():null,this.eventType!==l.callstatsChannels.userFeedback&&this.eventType!==l.precalltestEvents.results&&(this.pcHandler?(e.remoteID=encodeURIComponent(this.pcHandler.getRemoteId()),e.connectionID=this.pcHandler.getPcHash()):(e.remoteID=encodeURIComponent(d.Registry.getCredentials().getUserId()),e.connectionID=encodeURIComponent(d.Registry.getCredentials().getUserId()))),e}},{key:"decideChannel",value:function(){if(this.eventType==l.callstatsChannels.sdpSubmission)return l.callstatsChannels.sdpSubmission;if(this.eventType==l.callstatsChannels.userFeedback)return l.callstatsChannels.userFeedback;if(this.eventType==l.callstatsChannels.processedStats)return l.callstatsChannels.processedStats;for(var e in l.precalltestEvents)if(this.eventType==l.precalltestEvents[e])return l.callstatsChannels.preCallTest;return l.callstatsChannels.callstatsEvent}}],[{key:"checkCustomEntries",value:function(e,t){if(!v[e])return h.error("eventType not recognized:",e),!1;var n=v[e];for(var r in n)if(!t.hasOwnProperty(r)||o(t[r])!==n[r])return h.error("customEntries for",e,"should have",r,"of type",n[r]),!1;return!0}}]),e}(),v={};v[l.internalFabricEvent.userJoined]={endpointInfo:"object"},v[l.internalFabricEvent.userLeft]={},v[l.internalFabricEvent.userAlive]={},v[l.internalFabricEvent.userDetails]={userName:"string"},v[l.internalFabricEvent.connectedDeviceList]={mediaDeviceList:"object"},v[l.fabricEvent.activeDeviceList]={mediaDeviceList:"object"},v[l.fabricEvent.audioMute]={},v[l.fabricEvent.audioUnmute]={},v[l.fabricEvent.videoPause]={},v[l.fabricEvent.videoResume]={},v[l.fabricEvent.screenShareStart]={},v[l.fabricEvent.screenShareStop]={},v[l.internalFabricEvent.mediaPlaybackStart]={ssrc:"string"},v[l.internalFabricEvent.mediaPlaybackSuspended]={ssrc:"string"},v[l.internalFabricEvent.mediaPlaybackStalled]={ssrc:"string"},v[l.internalFabricEvent.oneWayMedia]={mediaType:"string",ssrc:"string"},v[l.internalFabricEvent.fabricSetup]={localIceCandidates:"object",remoteIceCandidates:"object",iceCandidatePairs:"object"},v[l.fabricEvent.fabricSetupFailed]={failureDelay:"number",reason:"string","function":"string",endpoint:"object"},v[l.internalFabricEvent.fabricStateChange]={changedState:"string",prevState:"string",newState:"string"},v[l.internalFabricEvent.fabricDropped]={prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},v[l.internalFabricEvent.iceConnectionDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},v[l.internalFabricEvent.iceConnectionDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",disruptionDelay:"number"},v[l.internalFabricEvent.iceDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},v[l.internalFabricEvent.iceDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},v[l.internalFabricEvent.iceFailed]={localIceCandidates:"object",prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},v[l.internalFabricEvent.iceAborted]={prevIceConnectionState:"string",currIceConnectionState:"string"},v[l.internalFabricEvent.iceRestarted]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},v[l.internalFabricEvent.fabricTransportSwitch]={prevIceCandidatePair:"object",currIceCandidatePair:"object"},v[l.internalFabricEvent.iceTerminated]={prevIceConnectionState:"string",currIceConnectionState:"string"},v[l.fabricEvent.fabricTerminated]={},v[l.fabricEvent.fabricHold]={},v[l.fabricEvent.fabricResume]={},v[l.callstatsChannels.sdpSubmission]={localSDP:"string",remoteSDP:"string"},v[l.internalFabricEvent.ssrcMap]={ssrcData:"object"},v[l.callstatsChannels.userFeedback]={feedback:"object"},v[l.internalFabricEvent.sendingThroughputObservations]={ssrc:"string",maxsendingKBitrate:"number",timeToMaxSendingKBitrate:"number",stablesendingKBitrate:"number",timeToStableSendingKBitrate:"number"},v[l.fabricEvent.dominantSpeaker]={},v[l.fabricEvent.applicationErrorLog]={message:"string",messageType:"string"},v[l.callstatsChannels.processedStats]={stats:"object"},v[l.callstatsChannels.senderConfiguration]={rtc_rtp_parameters:"object"},v[l.internalFabricEvent.limitationObservations]={reason:"string"},v[l.qualityDisruptionTypes.qpchange]={reason:"string"},v[l.precalltestEvents.results]={results:"object"},v[l.precalltestEvents.associate]={ids:"object"},n.EventMessage=p},{"../config/constants":32,"../config/settings":33,"./csiologger":87,"./registry":94}],90:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessageBuilder=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./eventmessage"),l=e("../config/constants"),u=r(l),c=e("./registry"),d=e("./csiologger"),f=r(d),h=function(){function e(){i(this,e),this.transmissionmanager=c.Registry.getTransmissionManager()}return s(e,[{key:"make",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e||null===r||"object"!==(void 0===r?"undefined":o(r)))return f.error("failed typeof checks:",e,void 0===e?"undefined":o(e),void 0===r?"undefined":o(r),r),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed typeof checks:"+e+":"+(void 0===r?"undefined":o(r))}),!1;if(null===t&&e!==u.precalltestEvents.results)return f.error("failed conferenceId checks:",e,t),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed conferenceId checks:"+e}),!1;if(!n&&e!==u.callstatsChannels.userFeedback&&e!==u.fabricEvent.applicationErrorLog&&e!==u.fabricEvent.fabricSetupFailed&&e!==u.precalltestEvents.results)return f.error("peerconnection cannot be null",e),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"peerconnection cannot be null"+e}),!1;if(!a.EventMessage.checkCustomEntries(e,r))return f.error("failed checks:",e,r),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed customEntries checks:"+e}),!1;var i=void 0;if(t){var s=c.Registry.getConferenceManager().get(t);s&&n&&(i=s.getPeerConnectionManager().getPcHandler(n))}var l=new a.EventMessage(e,t,r,i);return this.transmissionmanager.send(l),!0}}]),e}();n.EventMessageBuilder=h},{"../config/constants":32,"./csiologger":87,"./eventmessage":89,"./registry":94}],91:[function(e,t,n){"use strict";function r(e,t){var n={name:"SHA-256"};if(window.crypto){var r=window.crypto.subtle||window.crypto.webkitSubtle;if(!r)return void i(e,t);r.digest(n,o(e)).then(function(e){t(s(e))})["catch"](function(){i(e,t)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void i(e,t);var a=window.msCrypto.subtle.digest(n,o(e));a.oncomplete=function(e){e.target&&t(s(e.target.result))},a.onerror=function(){i(e,t)}}else i(e,t)}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0;if(!e)return n;for(var r=0,i=e.length;r<i;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t&&t(n+""),n+""}function o(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t[t.length]=r:r>127&&r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128)}return new Uint8Array(t).buffer}function s(e){for(var t=new DataView(e),n="",r=void 0,i=0;i<t.byteLength;i++)r=t.getUint8(i).toString(16),r.length<2&&(r="0"+r),n+=r;return n}Object.defineProperty(n,"__esModule",{value:!0}),n.generateSHA256=r,n.generateHash=i},{}],92:[function(e,t,n){"use strict";function r(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}function i(e){var t=null;return null===e?t:(r(e)&&(t=JSON.parse(e)),t)}Object.defineProperty(n,"__esModule",{value:!0}),n.isValid=r,n.parse=i},{}],93:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(){window&&window.addEventListener&&window.addEventListener("error",function(e){var t=o.Registry.getGenericEventHandler();if(e&&e.filename&&e.filename.indexOf("callstats")>-1){for(var n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:a.version,eventType:"error",message:e.message,pageURL:window.location.href},i=o.Registry.getConferenceManager().getConferenceIds(),s=0;s<i.length;s++)r.conferenceID=i[s],t.sendEvent(u.logEvents.error,r),n=!0;n||t.sendEvent(u.logEvents.error,r)}})}Object.defineProperty(n,"__esModule",{value:!0}),n.setErrorEventListener=i;var o=e("./registry"),s=e("../config/settings"),a=r(s),l=e("../config/constants"),u=r(l)},{"../config/constants":32,"../config/settings":33,"./registry":94}],94:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Registry=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../services/clocksync"),s=e("../services/configservice/configservicewrapper"),a=e("../services/authenticator"),l=e("../services/backendlog"),u=e("../services/transmissionmanager"),c=e("./eventmessagebuilder"),d=e("../conference/conferencemanager"),f=e("../utility/credentials"),h=e("../statspipeline/statsadapter"),p=e("../statspipeline/statsparser"),v=e("../statspipeline/statsmonitor"),g=e("../statspipeline/statstransmitter"),m=e("../statspipeline/statsassembler"),y=e("../utility/endpoint"),b=e("../browserapi/battery"),_=e("precalltest"),S=e("../statspipeline/wifistatsexecutor"),T=e("./callbacks"),C=e("../statspipeline/statscallbackbuilder"),w=e("../services/connectionmanager"),E=null,k=null,R=null,I=null,P=null,A=null,O=null,M=null,D=null,x=null,N=null,F=null,U=null,j=null,L=null,H=null,B=null,q=null,G=null,W=null,V=function(){function e(){r(this,e)}return i(e,null,[{key:"getConferenceManager",value:function(){return H||(H=new d.ConferenceManager),H}},{key:"getStatsCallbackBuilder",value:function(){return G||(G=new C.StatsCallbackBuilder),G}},{key:"getClockSync",value:function(){return k||(k=new o.ClockSync),k}},{key:"getWifiStatsExecutor",value:function(){return B||(B=new S.WifiStatsExecutor),B}},{key:"getAuthenticator",value:function(){return R||(R=new a.Authenticator),R}},{key:"getConfigServiceWrapper",value:function(){return I||(I=new s.ConfigServiceWrapper),I}},{key:"getGenericEventHandler",value:function(){return P||(P=new l.GenericEventHandler,P.enable()),P}},{key:"getConnectionManager",value:function(){return W||(W=new w.ConnectionManager),W}},{key:"getTransmissionManager",value:function(){return A||(A=new u.TransmissionManager),A}},{key:"getEventMessageBuilder",value:function(){return O||(O=new c.EventMessageBuilder),O}},{key:"getCredentials",value:function(){return M||(M=new f.Credentials),M}},{key:"getEndpoint",value:function(){return D||(D=new y.Endpoint),D}},{key:"getStatsAdapter",value:function(){if(!x){var t=e.getEndpoint().getCodeBase(),n=e.getEndpoint().getBrowserName();x=new h.StatsAdapter(t,n)}return x}},{key:"getPreCallTest",value:function(){return E||(E=new _.PreCallTest),E}},{key:"getStatsParser",value:function(){return N||(N=new p.StatsParser),N}},{key:"getStatsMonitor",value:function(){if(!F){var t=e.getEndpoint().getCodeBase();F=new v.StatsMonitor(t)}return F}},{key:"getStatsTransmitter",value:function(){return U||(U=new g.StatsTransmitter),U}},{key:"getStatsAssembler",value:function(){return j||(j=new m.StatsAssembler),j}},{key:"getBattery",value:function(){return L||(L=new b.Battery),L}},{key:"getCallbacks",value:function(){return q||(q=new T.Callbacks),q}}]),e}();n.Registry=V},{"../browserapi/battery":16,"../conference/conferencemanager":30,"../services/authenticator":43,"../services/backendlog":44,"../services/clocksync":45,"../services/configservice/configservicewrapper":49,"../services/connectionmanager":50,"../services/transmissionmanager":55,"../statspipeline/statsadapter":68,"../statspipeline/statsassembler":69,"../statspipeline/statscallbackbuilder":70,"../statspipeline/statsmonitor":71,"../statspipeline/statsparser":72,"../statspipeline/statstransmitter":73,"../statspipeline/wifistatsexecutor":83,"../utility/credentials":86,"../utility/endpoint":88,"./callbacks":85,"./eventmessagebuilder":90,precalltest:2}],95:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){return null===l&&(l=new u),l}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.getRTTRegistry=i;var s=e("../statspipeline/validator"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(s),l=null,u=function(){function e(){r(this,e),this.rtts=new Map,this.transportRTT=null}return o(e,[{key:"update",value:function(e){var t=this;e.getStats(function(e){for(var n=[],r=e.result(),i=0;i<r.length;++i){var o=r[i];if("googCandidatePair"!==o.type){if("ssrc"===o.type){var s=o.stat("googRtt"),l=o.stat("ssrc");s&&t.rtts.set(a.checkForNan(parseInt(l,10)),a.checkForNan(parseInt(s,10)))}}else{var u=o.stat("googRtt");n.push(u)}}t.transportRTT=Math.max.apply(Math,n)})}},{key:"getTransportRTT",value:function(){return this.transportRTT}},{key:"getRTT",value:function(e){var t=a.checkForNan(parseInt(e,10));return this.rtts.has(t)?this.rtts.get(t):null}}]),e}()},{"../statspipeline/validator":82}],96:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i){r(this,e),this.max=t,this.midpoint=n,this.stepness=i,this.actualStep=0,this.reset()}return i(e,[{key:"reset",value:function(){this.actualStep=0}},{key:"setMidpoint",value:function(e){this.midpoint=e}},{key:"setMax",value:function(e){this.max=e}},{key:"setStepness",value:function(e){this.stepness=e}},{key:"increaseActualStep",value:function(e){this.actualStep+=e}},{key:"getActual",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.actualStep+=e,this.max/(1+Math.exp(-1*this.stepness*(this.actualStep-this.midpoint)))}}]),e}();n.Sigmoid=o},{}],97:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TimeoutProcess=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./csiologger"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}(o),a=function(){function e(t){r(this,e),this.interval=t,this.timerId=null,this.callback=function(){s.warn("no callback function set",this)}}return i(e,[{key:"setCallback",value:function(e){this.callback=e}},{key:"start",value:function(){var e=this;this.timerId=setInterval(function(){e.callback()},this.interval)}},{key:"stop",value:function(){clearInterval(this.timerId),this.timerId=null}},{key:"isStarted",value:function(){return null!==this.timerId}}]),e}();n.TimeoutProcess=a},{"./csiologger":87}],98:[function(e,t,n){"use strict";function r(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function i(){return window&&window.performance&&window.performance.now?window.performance.now():null}Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=r,n.getSinceOrigin=i},{}],99:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(t){r(this,e),this.base=t;for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.appendixes=i}return o(e,null,[{key:"concat",value:function(e,t){if(!t)return e;if(!e)return t;var n="/"===e.substr(e.length-1),r="/"===t.substring(0,1);return n||r?n&&r?e+t.substring(1):e+t:e+"/"+t}}]),o(e,[{key:"append",value:function(e){this.appendixes.push(e)}},{key:"toString",value:function(){var t=this.getString(this.base),n=this;return this.appendixes.forEach(function(r){if(null!==r&&void 0!==r){var i=n.getString(r);t=e.concat(t,i)}}),t}},{key:"getString",value:function(e){switch(void 0===e?"undefined":i(e)){case"function":return this.getString(e());case"number":return e+"";case"string":default:return e}}}]),e}();n.Url=s},{}],100:[function(e,t,n){"use strict";function r(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++){var r={};r.mediaDeviceID=e[n].deviceId,r.groupID=e[n].groupId,r.kind=e[n].kind,r.label=e[n].label,t.push(r)}return t}function i(){Number.isInteger||(Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e})}function o(){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})}Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeMediaDeviceList=r,n.isIntegerPollyfill=i,n.assignPollyfill=o},{}]},{},[21]);
/***
Copyright (c) 2013-2018, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats  version = 3.50.3 2018-05-30 01-17-11 */

!function() {
    function a(b, c, d) {
        function e(g, h) {
            if (!c[g]) {
                if (!b[g]) {
                    var i = "function" == typeof require && require;
                    if (!h && i) return i(g, !0);
                    if (f) return f(g, !0);
                    var j = new Error("Cannot find module '" + g + "'");
                    throw j.code = "MODULE_NOT_FOUND", j;
                }
                var k = c[g] = {
                    exports: {}
                };
                b[g][0].call(k.exports, function(a) {
                    return e(b[g][1][a] || a);
                }, k, k.exports, a, b, c, d);
            }
            return c[g].exports;
        }
        for (var f = "function" == typeof require && require, g = 0; g < d.length; g++) e(d[g]);
        return e;
    }
    return a;
}()({
    1: [ function(a, b, c) {
        (function(a, d) {
            !function(a) {
                if ("object" == typeof c && void 0 !== b) b.exports = a(); else if ("function" == typeof define && define.amd) define([], a); else {
                    var e;
                    "undefined" != typeof window ? e = window : void 0 !== d ? e = d : "undefined" != typeof self && (e = self), 
                    e.Promise = a();
                }
            }(function() {
                var b, c, e;
                return function a(b, c, d) {
                    function e(g, h) {
                        if (!c[g]) {
                            if (!b[g]) {
                                var i = "function" == typeof _dereq_ && _dereq_;
                                if (!h && i) return i(g, !0);
                                if (f) return f(g, !0);
                                var j = new Error("Cannot find module '" + g + "'");
                                throw j.code = "MODULE_NOT_FOUND", j;
                            }
                            var k = c[g] = {
                                exports: {}
                            };
                            b[g][0].call(k.exports, function(a) {
                                var c = b[g][1][a];
                                return e(c || a);
                            }, k, k.exports, a, b, c, d);
                        }
                        return c[g].exports;
                    }
                    for (var f = "function" == typeof _dereq_ && _dereq_, g = 0; g < d.length; g++) e(d[g]);
                    return e;
                }({
                    1: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b(a) {
                                var b = new c(a), d = b.promise();
                                return b.setHowMany(1), b.setUnwrap(), b.init(), d;
                            }
                            var c = a._SomePromiseArray;
                            a.any = function(a) {
                                return b(a);
                            }, a.prototype.any = function() {
                                return b(this);
                            };
                        };
                    }, {} ],
                    2: [ function(b, c, d) {
                        "use strict";
                        function e() {
                            this._customScheduler = !1, this._isTickUsed = !1, this._lateQueue = new k(16), 
                            this._normalQueue = new k(16), this._haveDrainedQueues = !1, this._trampolineEnabled = !0;
                            var a = this;
                            this.drainQueues = function() {
                                a._drainQueues();
                            }, this._schedule = j;
                        }
                        function f(a, b, c) {
                            this._lateQueue.push(a, b, c), this._queueTick();
                        }
                        function g(a, b, c) {
                            this._normalQueue.push(a, b, c), this._queueTick();
                        }
                        function h(a) {
                            this._normalQueue._pushOne(a), this._queueTick();
                        }
                        var i;
                        try {
                            throw new Error();
                        } catch (a) {
                            i = a;
                        }
                        var j = b("./schedule"), k = b("./queue"), l = b("./util");
                        e.prototype.setScheduler = function(a) {
                            var b = this._schedule;
                            return this._schedule = a, this._customScheduler = !0, b;
                        }, e.prototype.hasCustomScheduler = function() {
                            return this._customScheduler;
                        }, e.prototype.enableTrampoline = function() {
                            this._trampolineEnabled = !0;
                        }, e.prototype.disableTrampolineIfNecessary = function() {
                            l.hasDevTools && (this._trampolineEnabled = !1);
                        }, e.prototype.haveItemsQueued = function() {
                            return this._isTickUsed || this._haveDrainedQueues;
                        }, e.prototype.fatalError = function(b, c) {
                            c ? (a.stderr.write("Fatal " + (b instanceof Error ? b.stack : b) + "\n"), a.exit(2)) : this.throwLater(b);
                        }, e.prototype.throwLater = function(a, b) {
                            if (1 === arguments.length && (b = a, a = function() {
                                throw b;
                            }), "undefined" != typeof setTimeout) setTimeout(function() {
                                a(b);
                            }, 0); else try {
                                this._schedule(function() {
                                    a(b);
                                });
                            } catch (a) {
                                throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");
                            }
                        }, l.hasDevTools ? (e.prototype.invokeLater = function(a, b, c) {
                            this._trampolineEnabled ? f.call(this, a, b, c) : this._schedule(function() {
                                setTimeout(function() {
                                    a.call(b, c);
                                }, 100);
                            });
                        }, e.prototype.invoke = function(a, b, c) {
                            this._trampolineEnabled ? g.call(this, a, b, c) : this._schedule(function() {
                                a.call(b, c);
                            });
                        }, e.prototype.settlePromises = function(a) {
                            this._trampolineEnabled ? h.call(this, a) : this._schedule(function() {
                                a._settlePromises();
                            });
                        }) : (e.prototype.invokeLater = f, e.prototype.invoke = g, e.prototype.settlePromises = h), 
                        e.prototype._drainQueue = function(a) {
                            for (;a.length() > 0; ) {
                                var b = a.shift();
                                if ("function" == typeof b) {
                                    var c = a.shift(), d = a.shift();
                                    b.call(c, d);
                                } else b._settlePromises();
                            }
                        }, e.prototype._drainQueues = function() {
                            this._drainQueue(this._normalQueue), this._reset(), this._haveDrainedQueues = !0, 
                            this._drainQueue(this._lateQueue);
                        }, e.prototype._queueTick = function() {
                            this._isTickUsed || (this._isTickUsed = !0, this._schedule(this.drainQueues));
                        }, e.prototype._reset = function() {
                            this._isTickUsed = !1;
                        }, c.exports = e, c.exports.firstLineError = i;
                    }, {
                        "./queue": 26,
                        "./schedule": 29,
                        "./util": 36
                    } ],
                    3: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b, c, d) {
                            var e = !1, f = function(a, b) {
                                this._reject(b);
                            }, g = function(a, b) {
                                b.promiseRejectionQueued = !0, b.bindingPromise._then(f, f, null, this, a);
                            }, h = function(a, b) {
                                0 == (50397184 & this._bitField) && this._resolveCallback(b.target);
                            }, i = function(a, b) {
                                b.promiseRejectionQueued || this._reject(a);
                            };
                            a.prototype.bind = function(f) {
                                e || (e = !0, a.prototype._propagateFrom = d.propagateFromFunction(), a.prototype._boundValue = d.boundValueFunction());
                                var j = c(f), k = new a(b);
                                k._propagateFrom(this, 1);
                                var l = this._target();
                                if (k._setBoundTo(j), j instanceof a) {
                                    var m = {
                                        promiseRejectionQueued: !1,
                                        promise: k,
                                        target: l,
                                        bindingPromise: j
                                    };
                                    l._then(b, g, void 0, k, m), j._then(h, i, void 0, k, m), k._setOnCancel(j);
                                } else k._resolveCallback(l);
                                return k;
                            }, a.prototype._setBoundTo = function(a) {
                                void 0 !== a ? (this._bitField = 2097152 | this._bitField, this._boundTo = a) : this._bitField = -2097153 & this._bitField;
                            }, a.prototype._isBound = function() {
                                return 2097152 == (2097152 & this._bitField);
                            }, a.bind = function(b, c) {
                                return a.resolve(c).bind(b);
                            };
                        };
                    }, {} ],
                    4: [ function(a, b, c) {
                        "use strict";
                        function d() {
                            try {
                                Promise === f && (Promise = e);
                            } catch (a) {}
                            return f;
                        }
                        var e;
                        "undefined" != typeof Promise && (e = Promise);
                        var f = a("./promise")();
                        f.noConflict = d, b.exports = f;
                    }, {
                        "./promise": 22
                    } ],
                    5: [ function(a, b, c) {
                        "use strict";
                        var d = Object.create;
                        if (d) {
                            var e = d(null), f = d(null);
                            e[" size"] = f[" size"] = 0;
                        }
                        b.exports = function(b) {
                            function c(a, c) {
                                var d;
                                if (null != a && (d = a[c]), "function" != typeof d) {
                                    var e = "Object " + h.classString(a) + " has no method '" + h.toString(c) + "'";
                                    throw new b.TypeError(e);
                                }
                                return d;
                            }
                            function d(a) {
                                return c(a, this.pop()).apply(a, this);
                            }
                            function e(a) {
                                return a[this];
                            }
                            function f(a) {
                                var b = +this;
                                return b < 0 && (b = Math.max(0, b + a.length)), a[b];
                            }
                            var g, h = a("./util"), i = h.canEvaluate;
                            h.isIdentifier;
                            b.prototype.call = function(a) {
                                var b = [].slice.call(arguments, 1);
                                return b.push(a), this._then(d, void 0, void 0, b, void 0);
                            }, b.prototype.get = function(a) {
                                var b, c = "number" == typeof a;
                                if (c) b = f; else if (i) {
                                    var d = g(a);
                                    b = null !== d ? d : e;
                                } else b = e;
                                return this._then(b, void 0, void 0, a, void 0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    6: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            var f = a("./util"), g = f.tryCatch, h = f.errorObj, i = b._async;
                            b.prototype.break = b.prototype.cancel = function() {
                                if (!e.cancellation()) return this._warn("cancellation is disabled");
                                for (var a = this, b = a; a._isCancellable(); ) {
                                    if (!a._cancelBy(b)) {
                                        b._isFollowing() ? b._followee().cancel() : b._cancelBranched();
                                        break;
                                    }
                                    var c = a._cancellationParent;
                                    if (null == c || !c._isCancellable()) {
                                        a._isFollowing() ? a._followee().cancel() : a._cancelBranched();
                                        break;
                                    }
                                    a._isFollowing() && a._followee().cancel(), a._setWillBeCancelled(), b = a, a = c;
                                }
                            }, b.prototype._branchHasCancelled = function() {
                                this._branchesRemainingToCancel--;
                            }, b.prototype._enoughBranchesHaveCancelled = function() {
                                return void 0 === this._branchesRemainingToCancel || this._branchesRemainingToCancel <= 0;
                            }, b.prototype._cancelBy = function(a) {
                                return a === this ? (this._branchesRemainingToCancel = 0, this._invokeOnCancel(), 
                                !0) : (this._branchHasCancelled(), !!this._enoughBranchesHaveCancelled() && (this._invokeOnCancel(), 
                                !0));
                            }, b.prototype._cancelBranched = function() {
                                this._enoughBranchesHaveCancelled() && this._cancel();
                            }, b.prototype._cancel = function() {
                                this._isCancellable() && (this._setCancelled(), i.invoke(this._cancelPromises, this, void 0));
                            }, b.prototype._cancelPromises = function() {
                                this._length() > 0 && this._settlePromises();
                            }, b.prototype._unsetOnCancel = function() {
                                this._onCancelField = void 0;
                            }, b.prototype._isCancellable = function() {
                                return this.isPending() && !this._isCancelled();
                            }, b.prototype.isCancellable = function() {
                                return this.isPending() && !this.isCancelled();
                            }, b.prototype._doInvokeOnCancel = function(a, b) {
                                if (f.isArray(a)) for (var c = 0; c < a.length; ++c) this._doInvokeOnCancel(a[c], b); else if (void 0 !== a) if ("function" == typeof a) {
                                    if (!b) {
                                        var d = g(a).call(this._boundValue());
                                        d === h && (this._attachExtraTrace(d.e), i.throwLater(d.e));
                                    }
                                } else a._resultCancelled(this);
                            }, b.prototype._invokeOnCancel = function() {
                                var a = this._onCancel();
                                this._unsetOnCancel(), i.invoke(this._doInvokeOnCancel, this, a);
                            }, b.prototype._invokeInternalOnCancel = function() {
                                this._isCancellable() && (this._doInvokeOnCancel(this._onCancel(), !0), this._unsetOnCancel());
                            }, b.prototype._resultCancelled = function() {
                                this.cancel();
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    7: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b) {
                            function c(a, c, h) {
                                return function(i) {
                                    var j = h._boundValue();
                                    a: for (var k = 0; k < a.length; ++k) {
                                        var l = a[k];
                                        if (l === Error || null != l && l.prototype instanceof Error) {
                                            if (i instanceof l) return f(c).call(j, i);
                                        } else if ("function" == typeof l) {
                                            var m = f(l).call(j, i);
                                            if (m === g) return m;
                                            if (m) return f(c).call(j, i);
                                        } else if (d.isObject(i)) {
                                            for (var n = e(l), o = 0; o < n.length; ++o) {
                                                var p = n[o];
                                                if (l[p] != i[p]) continue a;
                                            }
                                            return f(c).call(j, i);
                                        }
                                    }
                                    return b;
                                };
                            }
                            var d = a("./util"), e = a("./es5").keys, f = d.tryCatch, g = d.errorObj;
                            return c;
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    8: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b() {
                                this._trace = new b.CapturedTrace(d());
                            }
                            function c() {
                                if (e) return new b();
                            }
                            function d() {
                                var a = f.length - 1;
                                if (a >= 0) return f[a];
                            }
                            var e = !1, f = [];
                            return a.prototype._promiseCreated = function() {}, a.prototype._pushContext = function() {}, 
                            a.prototype._popContext = function() {
                                return null;
                            }, a._peekContext = a.prototype._peekContext = function() {}, b.prototype._pushContext = function() {
                                void 0 !== this._trace && (this._trace._promiseCreated = null, f.push(this._trace));
                            }, b.prototype._popContext = function() {
                                if (void 0 !== this._trace) {
                                    var a = f.pop(), b = a._promiseCreated;
                                    return a._promiseCreated = null, b;
                                }
                                return null;
                            }, b.CapturedTrace = null, b.create = c, b.deactivateLongStackTraces = function() {}, 
                            b.activateLongStackTraces = function() {
                                var c = a.prototype._pushContext, f = a.prototype._popContext, g = a._peekContext, h = a.prototype._peekContext, i = a.prototype._promiseCreated;
                                b.deactivateLongStackTraces = function() {
                                    a.prototype._pushContext = c, a.prototype._popContext = f, a._peekContext = g, a.prototype._peekContext = h, 
                                    a.prototype._promiseCreated = i, e = !1;
                                }, e = !0, a.prototype._pushContext = b.prototype._pushContext, a.prototype._popContext = b.prototype._popContext, 
                                a._peekContext = a.prototype._peekContext = d, a.prototype._promiseCreated = function() {
                                    var a = this._peekContext();
                                    a && null == a._promiseCreated && (a._promiseCreated = this);
                                };
                            }, b;
                        };
                    }, {} ],
                    9: [ function(b, c, d) {
                        "use strict";
                        c.exports = function(c, d) {
                            function e(a, b) {
                                return {
                                    promise: b
                                };
                            }
                            function f() {
                                return !1;
                            }
                            function g(a, b, c) {
                                var d = this;
                                try {
                                    a(b, c, function(a) {
                                        if ("function" != typeof a) throw new TypeError("onCancel must be a function, got: " + N.toString(a));
                                        d._attachCancellationCallback(a);
                                    });
                                } catch (a) {
                                    return a;
                                }
                            }
                            function h(a) {
                                if (!this._isCancellable()) return this;
                                var b = this._onCancel();
                                void 0 !== b ? N.isArray(b) ? b.push(a) : this._setOnCancel([ b, a ]) : this._setOnCancel(a);
                            }
                            function i() {
                                return this._onCancelField;
                            }
                            function j(a) {
                                this._onCancelField = a;
                            }
                            function k() {
                                this._cancellationParent = void 0, this._onCancelField = void 0;
                            }
                            function l(a, b) {
                                if (0 != (1 & b)) {
                                    this._cancellationParent = a;
                                    var c = a._branchesRemainingToCancel;
                                    void 0 === c && (c = 0), a._branchesRemainingToCancel = c + 1;
                                }
                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);
                            }
                            function m(a, b) {
                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);
                            }
                            function n() {
                                var a = this._boundTo;
                                return void 0 !== a && a instanceof c ? a.isFulfilled() ? a.value() : void 0 : a;
                            }
                            function o() {
                                this._trace = new G(this._peekContext());
                            }
                            function p(a, b) {
                                if (O(a)) {
                                    var c = this._trace;
                                    if (void 0 !== c && b && (c = c._parent), void 0 !== c) c.attachExtraTrace(a); else if (!a.__stackCleaned__) {
                                        var d = y(a);
                                        N.notEnumerableProp(a, "stack", d.message + "\n" + d.stack.join("\n")), N.notEnumerableProp(a, "__stackCleaned__", !0);
                                    }
                                }
                            }
                            function q(a, b, c, d, e) {
                                if (void 0 === a && null !== b && Y) {
                                    if (void 0 !== e && e._returnedNonUndefined()) return;
                                    if (0 == (65535 & d._bitField)) return;
                                    c && (c += " ");
                                    var f = "", g = "";
                                    if (b._trace) {
                                        for (var h = b._trace.stack.split("\n"), i = w(h), j = i.length - 1; j >= 0; --j) {
                                            var k = i[j];
                                            if (!Q.test(k)) {
                                                var l = k.match(R);
                                                l && (f = "at " + l[1] + ":" + l[2] + ":" + l[3] + " ");
                                                break;
                                            }
                                        }
                                        if (i.length > 0) for (var m = i[0], j = 0; j < h.length; ++j) if (h[j] === m) {
                                            j > 0 && (g = "\n" + h[j - 1]);
                                            break;
                                        }
                                    }
                                    var n = "a promise was created in a " + c + "handler " + f + "but was not returned from it, see http://goo.gl/rRqMUw" + g;
                                    d._warn(n, !0, b);
                                }
                            }
                            function r(a, b) {
                                var c = a + " is deprecated and will be removed in a future version.";
                                return b && (c += " Use " + b + " instead."), s(c);
                            }
                            function s(a, b, d) {
                                if (ga.warnings) {
                                    var e, f = new M(a);
                                    if (b) d._attachExtraTrace(f); else if (ga.longStackTraces && (e = c._peekContext())) e.attachExtraTrace(f); else {
                                        var g = y(f);
                                        f.stack = g.message + "\n" + g.stack.join("\n");
                                    }
                                    ba("warning", f) || z(f, "", !0);
                                }
                            }
                            function t(a, b) {
                                for (var c = 0; c < b.length - 1; ++c) b[c].push("From previous event:"), b[c] = b[c].join("\n");
                                return c < b.length && (b[c] = b[c].join("\n")), a + "\n" + b.join("\n");
                            }
                            function u(a) {
                                for (var b = 0; b < a.length; ++b) (0 === a[b].length || b + 1 < a.length && a[b][0] === a[b + 1][0]) && (a.splice(b, 1), 
                                b--);
                            }
                            function v(a) {
                                for (var b = a[0], c = 1; c < a.length; ++c) {
                                    for (var d = a[c], e = b.length - 1, f = b[e], g = -1, h = d.length - 1; h >= 0; --h) if (d[h] === f) {
                                        g = h;
                                        break;
                                    }
                                    for (var h = g; h >= 0; --h) {
                                        var i = d[h];
                                        if (b[e] !== i) break;
                                        b.pop(), e--;
                                    }
                                    b = d;
                                }
                            }
                            function w(a) {
                                for (var b = [], c = 0; c < a.length; ++c) {
                                    var d = a[c], e = "    (No stack trace)" === d || S.test(d), f = e && da(d);
                                    e && !f && (U && " " !== d.charAt(0) && (d = "    " + d), b.push(d));
                                }
                                return b;
                            }
                            function x(a) {
                                for (var b = a.stack.replace(/\s+$/g, "").split("\n"), c = 0; c < b.length; ++c) {
                                    var d = b[c];
                                    if ("    (No stack trace)" === d || S.test(d)) break;
                                }
                                return c > 0 && "SyntaxError" != a.name && (b = b.slice(c)), b;
                            }
                            function y(a) {
                                var b = a.stack, c = a.toString();
                                return b = "string" == typeof b && b.length > 0 ? x(a) : [ "    (No stack trace)" ], 
                                {
                                    message: c,
                                    stack: "SyntaxError" == a.name ? b : w(b)
                                };
                            }
                            function z(a, b, c) {
                                if ("undefined" != typeof console) {
                                    var d;
                                    if (N.isObject(a)) {
                                        var e = a.stack;
                                        d = b + T(e, a);
                                    } else d = b + String(a);
                                    "function" == typeof J ? J(d, c) : "function" != typeof console.log && "object" != typeof console.log || console.log(d);
                                }
                            }
                            function A(a, b, c, d) {
                                var e = !1;
                                try {
                                    "function" == typeof b && (e = !0, "rejectionHandled" === a ? b(d) : b(c, d));
                                } catch (a) {
                                    L.throwLater(a);
                                }
                                "unhandledRejection" === a ? ba(a, c, d) || e || z(c, "Unhandled rejection ") : ba(a, d);
                            }
                            function B(a) {
                                var b;
                                if ("function" == typeof a) b = "[function " + (a.name || "anonymous") + "]"; else {
                                    b = a && "function" == typeof a.toString ? a.toString() : N.toString(a);
                                    if (/\[object [a-zA-Z0-9$_]+\]/.test(b)) try {
                                        b = JSON.stringify(a);
                                    } catch (a) {}
                                    0 === b.length && (b = "(empty array)");
                                }
                                return "(<" + C(b) + ">, no stack trace)";
                            }
                            function C(a) {
                                return a.length < 41 ? a : a.substr(0, 38) + "...";
                            }
                            function D() {
                                return "function" == typeof fa;
                            }
                            function E(a) {
                                var b = a.match(ea);
                                if (b) return {
                                    fileName: b[1],
                                    line: parseInt(b[2], 10)
                                };
                            }
                            function F(a, b) {
                                if (D()) {
                                    for (var c, d, e = a.stack.split("\n"), f = b.stack.split("\n"), g = -1, h = -1, i = 0; i < e.length; ++i) {
                                        var j = E(e[i]);
                                        if (j) {
                                            c = j.fileName, g = j.line;
                                            break;
                                        }
                                    }
                                    for (var i = 0; i < f.length; ++i) {
                                        var j = E(f[i]);
                                        if (j) {
                                            d = j.fileName, h = j.line;
                                            break;
                                        }
                                    }
                                    g < 0 || h < 0 || !c || !d || c !== d || g >= h || (da = function(a) {
                                        if (P.test(a)) return !0;
                                        var b = E(a);
                                        return !!(b && b.fileName === c && g <= b.line && b.line <= h);
                                    });
                                }
                            }
                            function G(a) {
                                this._parent = a, this._promisesCreated = 0;
                                var b = this._length = 1 + (void 0 === a ? 0 : a._length);
                                fa(this, G), b > 32 && this.uncycle();
                            }
                            var H, I, J, K = c._getDomain, L = c._async, M = b("./errors").Warning, N = b("./util"), O = N.canAttachTrace, P = /[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/, Q = /\((?:timers\.js):\d+:\d+\)/, R = /[\/<\(](.+?):(\d+):(\d+)\)?\s*$/, S = null, T = null, U = !1, V = !(0 == N.env("BLUEBIRD_DEBUG")), W = !(0 == N.env("BLUEBIRD_WARNINGS") || !V && !N.env("BLUEBIRD_WARNINGS")), X = !(0 == N.env("BLUEBIRD_LONG_STACK_TRACES") || !V && !N.env("BLUEBIRD_LONG_STACK_TRACES")), Y = 0 != N.env("BLUEBIRD_W_FORGOTTEN_RETURN") && (W || !!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));
                            c.prototype.suppressUnhandledRejections = function() {
                                var a = this._target();
                                a._bitField = -1048577 & a._bitField | 524288;
                            }, c.prototype._ensurePossibleRejectionHandled = function() {
                                if (0 == (524288 & this._bitField)) {
                                    this._setRejectionIsUnhandled();
                                    var a = this;
                                    setTimeout(function() {
                                        a._notifyUnhandledRejection();
                                    }, 1);
                                }
                            }, c.prototype._notifyUnhandledRejectionIsHandled = function() {
                                A("rejectionHandled", H, void 0, this);
                            }, c.prototype._setReturnedNonUndefined = function() {
                                this._bitField = 268435456 | this._bitField;
                            }, c.prototype._returnedNonUndefined = function() {
                                return 0 != (268435456 & this._bitField);
                            }, c.prototype._notifyUnhandledRejection = function() {
                                if (this._isRejectionUnhandled()) {
                                    var a = this._settledValue();
                                    this._setUnhandledRejectionIsNotified(), A("unhandledRejection", I, a, this);
                                }
                            }, c.prototype._setUnhandledRejectionIsNotified = function() {
                                this._bitField = 262144 | this._bitField;
                            }, c.prototype._unsetUnhandledRejectionIsNotified = function() {
                                this._bitField = -262145 & this._bitField;
                            }, c.prototype._isUnhandledRejectionNotified = function() {
                                return (262144 & this._bitField) > 0;
                            }, c.prototype._setRejectionIsUnhandled = function() {
                                this._bitField = 1048576 | this._bitField;
                            }, c.prototype._unsetRejectionIsUnhandled = function() {
                                this._bitField = -1048577 & this._bitField, this._isUnhandledRejectionNotified() && (this._unsetUnhandledRejectionIsNotified(), 
                                this._notifyUnhandledRejectionIsHandled());
                            }, c.prototype._isRejectionUnhandled = function() {
                                return (1048576 & this._bitField) > 0;
                            }, c.prototype._warn = function(a, b, c) {
                                return s(a, b, c || this);
                            }, c.onPossiblyUnhandledRejection = function(a) {
                                var b = K();
                                I = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;
                            }, c.onUnhandledRejectionHandled = function(a) {
                                var b = K();
                                H = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;
                            };
                            var Z = function() {};
                            c.longStackTraces = function() {
                                if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");
                                if (!ga.longStackTraces && D()) {
                                    var a = c.prototype._captureStackTrace, b = c.prototype._attachExtraTrace;
                                    ga.longStackTraces = !0, Z = function() {
                                        if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");
                                        c.prototype._captureStackTrace = a, c.prototype._attachExtraTrace = b, d.deactivateLongStackTraces(), 
                                        L.enableTrampoline(), ga.longStackTraces = !1;
                                    }, c.prototype._captureStackTrace = o, c.prototype._attachExtraTrace = p, d.activateLongStackTraces(), 
                                    L.disableTrampolineIfNecessary();
                                }
                            }, c.hasLongStackTraces = function() {
                                return ga.longStackTraces && D();
                            };
                            var $ = function() {
                                try {
                                    if ("function" == typeof CustomEvent) {
                                        var a = new CustomEvent("CustomEvent");
                                        return N.global.dispatchEvent(a), function(a, b) {
                                            var c = new CustomEvent(a.toLowerCase(), {
                                                detail: b,
                                                cancelable: !0
                                            });
                                            return !N.global.dispatchEvent(c);
                                        };
                                    }
                                    if ("function" == typeof Event) {
                                        var a = new Event("CustomEvent");
                                        return N.global.dispatchEvent(a), function(a, b) {
                                            var c = new Event(a.toLowerCase(), {
                                                cancelable: !0
                                            });
                                            return c.detail = b, !N.global.dispatchEvent(c);
                                        };
                                    }
                                    var a = document.createEvent("CustomEvent");
                                    return a.initCustomEvent("testingtheevent", !1, !0, {}), N.global.dispatchEvent(a), 
                                    function(a, b) {
                                        var c = document.createEvent("CustomEvent");
                                        return c.initCustomEvent(a.toLowerCase(), !1, !0, b), !N.global.dispatchEvent(c);
                                    };
                                } catch (a) {}
                                return function() {
                                    return !1;
                                };
                            }(), _ = function() {
                                return N.isNode ? function() {
                                    return a.emit.apply(a, arguments);
                                } : N.global ? function(a) {
                                    var b = "on" + a.toLowerCase(), c = N.global[b];
                                    return !!c && (c.apply(N.global, [].slice.call(arguments, 1)), !0);
                                } : function() {
                                    return !1;
                                };
                            }(), aa = {
                                promiseCreated: e,
                                promiseFulfilled: e,
                                promiseRejected: e,
                                promiseResolved: e,
                                promiseCancelled: e,
                                promiseChained: function(a, b, c) {
                                    return {
                                        promise: b,
                                        child: c
                                    };
                                },
                                warning: function(a, b) {
                                    return {
                                        warning: b
                                    };
                                },
                                unhandledRejection: function(a, b, c) {
                                    return {
                                        reason: b,
                                        promise: c
                                    };
                                },
                                rejectionHandled: e
                            }, ba = function(a) {
                                var b = !1;
                                try {
                                    b = _.apply(null, arguments);
                                } catch (a) {
                                    L.throwLater(a), b = !0;
                                }
                                var c = !1;
                                try {
                                    c = $(a, aa[a].apply(null, arguments));
                                } catch (a) {
                                    L.throwLater(a), c = !0;
                                }
                                return c || b;
                            };
                            c.config = function(a) {
                                if (a = Object(a), "longStackTraces" in a && (a.longStackTraces ? c.longStackTraces() : !a.longStackTraces && c.hasLongStackTraces() && Z()), 
                                "warnings" in a) {
                                    var b = a.warnings;
                                    ga.warnings = !!b, Y = ga.warnings, N.isObject(b) && "wForgottenReturn" in b && (Y = !!b.wForgottenReturn);
                                }
                                if ("cancellation" in a && a.cancellation && !ga.cancellation) {
                                    if (L.haveItemsQueued()) throw new Error("cannot enable cancellation after promises are in use");
                                    c.prototype._clearCancellationData = k, c.prototype._propagateFrom = l, c.prototype._onCancel = i, 
                                    c.prototype._setOnCancel = j, c.prototype._attachCancellationCallback = h, c.prototype._execute = g, 
                                    ca = l, ga.cancellation = !0;
                                }
                                return "monitoring" in a && (a.monitoring && !ga.monitoring ? (ga.monitoring = !0, 
                                c.prototype._fireEvent = ba) : !a.monitoring && ga.monitoring && (ga.monitoring = !1, 
                                c.prototype._fireEvent = f)), c;
                            }, c.prototype._fireEvent = f, c.prototype._execute = function(a, b, c) {
                                try {
                                    a(b, c);
                                } catch (a) {
                                    return a;
                                }
                            }, c.prototype._onCancel = function() {}, c.prototype._setOnCancel = function(a) {}, 
                            c.prototype._attachCancellationCallback = function(a) {}, c.prototype._captureStackTrace = function() {}, 
                            c.prototype._attachExtraTrace = function() {}, c.prototype._clearCancellationData = function() {}, 
                            c.prototype._propagateFrom = function(a, b) {};
                            var ca = m, da = function() {
                                return !1;
                            }, ea = /[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;
                            N.inherits(G, Error), d.CapturedTrace = G, G.prototype.uncycle = function() {
                                var a = this._length;
                                if (!(a < 2)) {
                                    for (var b = [], c = {}, d = 0, e = this; void 0 !== e; ++d) b.push(e), e = e._parent;
                                    a = this._length = d;
                                    for (var d = a - 1; d >= 0; --d) {
                                        var f = b[d].stack;
                                        void 0 === c[f] && (c[f] = d);
                                    }
                                    for (var d = 0; d < a; ++d) {
                                        var g = b[d].stack, h = c[g];
                                        if (void 0 !== h && h !== d) {
                                            h > 0 && (b[h - 1]._parent = void 0, b[h - 1]._length = 1), b[d]._parent = void 0, 
                                            b[d]._length = 1;
                                            var i = d > 0 ? b[d - 1] : this;
                                            h < a - 1 ? (i._parent = b[h + 1], i._parent.uncycle(), i._length = i._parent._length + 1) : (i._parent = void 0, 
                                            i._length = 1);
                                            for (var j = i._length + 1, k = d - 2; k >= 0; --k) b[k]._length = j, j++;
                                            return;
                                        }
                                    }
                                }
                            }, G.prototype.attachExtraTrace = function(a) {
                                if (!a.__stackCleaned__) {
                                    this.uncycle();
                                    for (var b = y(a), c = b.message, d = [ b.stack ], e = this; void 0 !== e; ) d.push(w(e.stack.split("\n"))), 
                                    e = e._parent;
                                    v(d), u(d), N.notEnumerableProp(a, "stack", t(c, d)), N.notEnumerableProp(a, "__stackCleaned__", !0);
                                }
                            };
                            var fa = function() {
                                var a = /^\s*at\s*/, b = function(a, b) {
                                    return "string" == typeof a ? a : void 0 !== b.name && void 0 !== b.message ? b.toString() : B(b);
                                };
                                if ("number" == typeof Error.stackTraceLimit && "function" == typeof Error.captureStackTrace) {
                                    Error.stackTraceLimit += 6, S = a, T = b;
                                    var c = Error.captureStackTrace;
                                    return da = function(a) {
                                        return P.test(a);
                                    }, function(a, b) {
                                        Error.stackTraceLimit += 6, c(a, b), Error.stackTraceLimit -= 6;
                                    };
                                }
                                var d = new Error();
                                if ("string" == typeof d.stack && d.stack.split("\n")[0].indexOf("stackDetection@") >= 0) return S = /@/, 
                                T = b, U = !0, function(a) {
                                    a.stack = new Error().stack;
                                };
                                var e;
                                try {
                                    throw new Error();
                                } catch (a) {
                                    e = "stack" in a;
                                }
                                return "stack" in d || !e || "number" != typeof Error.stackTraceLimit ? (T = function(a, b) {
                                    return "string" == typeof a ? a : "object" != typeof b && "function" != typeof b || void 0 === b.name || void 0 === b.message ? B(b) : b.toString();
                                }, null) : (S = a, T = b, function(a) {
                                    Error.stackTraceLimit += 6;
                                    try {
                                        throw new Error();
                                    } catch (b) {
                                        a.stack = b.stack;
                                    }
                                    Error.stackTraceLimit -= 6;
                                });
                            }();
                            "undefined" != typeof console && void 0 !== console.warn && (J = function(a) {
                                console.warn(a);
                            }, N.isNode && a.stderr.isTTY ? J = function(a, b) {
                                var c = b ? "[33m" : "[31m";
                                console.warn(c + a + "[0m\n");
                            } : N.isNode || "string" != typeof new Error().stack || (J = function(a, b) {
                                console.warn("%c" + a, b ? "color: darkorange" : "color: red");
                            }));
                            var ga = {
                                warnings: W,
                                longStackTraces: !1,
                                cancellation: !1,
                                monitoring: !1
                            };
                            return X && c.longStackTraces(), {
                                longStackTraces: function() {
                                    return ga.longStackTraces;
                                },
                                warnings: function() {
                                    return ga.warnings;
                                },
                                cancellation: function() {
                                    return ga.cancellation;
                                },
                                monitoring: function() {
                                    return ga.monitoring;
                                },
                                propagateFromFunction: function() {
                                    return ca;
                                },
                                boundValueFunction: function() {
                                    return n;
                                },
                                checkForgottenReturns: q,
                                setBounds: F,
                                warn: s,
                                deprecated: r,
                                CapturedTrace: G,
                                fireDomEvent: $,
                                fireGlobalEvent: _
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    10: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b() {
                                return this.value;
                            }
                            function c() {
                                throw this.reason;
                            }
                            a.prototype.return = a.prototype.thenReturn = function(c) {
                                return c instanceof a && c.suppressUnhandledRejections(), this._then(b, void 0, void 0, {
                                    value: c
                                }, void 0);
                            }, a.prototype.throw = a.prototype.thenThrow = function(a) {
                                return this._then(c, void 0, void 0, {
                                    reason: a
                                }, void 0);
                            }, a.prototype.catchThrow = function(a) {
                                if (arguments.length <= 1) return this._then(void 0, c, void 0, {
                                    reason: a
                                }, void 0);
                                var b = arguments[1], d = function() {
                                    throw b;
                                };
                                return this.caught(a, d);
                            }, a.prototype.catchReturn = function(c) {
                                if (arguments.length <= 1) return c instanceof a && c.suppressUnhandledRejections(), 
                                this._then(void 0, b, void 0, {
                                    value: c
                                }, void 0);
                                var d = arguments[1];
                                d instanceof a && d.suppressUnhandledRejections();
                                var e = function() {
                                    return d;
                                };
                                return this.caught(c, e);
                            };
                        };
                    }, {} ],
                    11: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b) {
                            function c() {
                                return f(this);
                            }
                            function d(a, c) {
                                return e(a, c, b, b);
                            }
                            var e = a.reduce, f = a.all;
                            a.prototype.each = function(a) {
                                return e(this, a, b, 0)._then(c, void 0, void 0, this, void 0);
                            }, a.prototype.mapSeries = function(a) {
                                return e(this, a, b, b);
                            }, a.each = function(a, d) {
                                return e(a, d, b, 0)._then(c, void 0, void 0, a, void 0);
                            }, a.mapSeries = d;
                        };
                    }, {} ],
                    12: [ function(a, b, c) {
                        "use strict";
                        function d(a, b) {
                            function c(d) {
                                if (!(this instanceof c)) return new c(d);
                                l(this, "message", "string" == typeof d ? d : b), l(this, "name", a), Error.captureStackTrace ? Error.captureStackTrace(this, this.constructor) : Error.call(this);
                            }
                            return k(c, Error), c;
                        }
                        function e(a) {
                            if (!(this instanceof e)) return new e(a);
                            l(this, "name", "OperationalError"), l(this, "message", a), this.cause = a, this.isOperational = !0, 
                            a instanceof Error ? (l(this, "message", a.message), l(this, "stack", a.stack)) : Error.captureStackTrace && Error.captureStackTrace(this, this.constructor);
                        }
                        var f, g, h = a("./es5"), i = h.freeze, j = a("./util"), k = j.inherits, l = j.notEnumerableProp, m = d("Warning", "warning"), n = d("CancellationError", "cancellation error"), o = d("TimeoutError", "timeout error"), p = d("AggregateError", "aggregate error");
                        try {
                            f = TypeError, g = RangeError;
                        } catch (a) {
                            f = d("TypeError", "type error"), g = d("RangeError", "range error");
                        }
                        for (var q = "join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "), r = 0; r < q.length; ++r) "function" == typeof Array.prototype[q[r]] && (p.prototype[q[r]] = Array.prototype[q[r]]);
                        h.defineProperty(p.prototype, "length", {
                            value: 0,
                            configurable: !1,
                            writable: !0,
                            enumerable: !0
                        }), p.prototype.isOperational = !0;
                        var s = 0;
                        p.prototype.toString = function() {
                            var a = Array(4 * s + 1).join(" "), b = "\n" + a + "AggregateError of:\n";
                            s++, a = Array(4 * s + 1).join(" ");
                            for (var c = 0; c < this.length; ++c) {
                                for (var d = this[c] === this ? "[Circular AggregateError]" : this[c] + "", e = d.split("\n"), f = 0; f < e.length; ++f) e[f] = a + e[f];
                                d = e.join("\n"), b += d + "\n";
                            }
                            return s--, b;
                        }, k(e, Error);
                        var t = Error.__BluebirdErrorTypes__;
                        t || (t = i({
                            CancellationError: n,
                            TimeoutError: o,
                            OperationalError: e,
                            RejectionError: e,
                            AggregateError: p
                        }), h.defineProperty(Error, "__BluebirdErrorTypes__", {
                            value: t,
                            writable: !1,
                            enumerable: !1,
                            configurable: !1
                        })), b.exports = {
                            Error: Error,
                            TypeError: f,
                            RangeError: g,
                            CancellationError: t.CancellationError,
                            OperationalError: t.OperationalError,
                            TimeoutError: t.TimeoutError,
                            AggregateError: t.AggregateError,
                            Warning: m
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    13: [ function(a, b, c) {
                        var d = function() {
                            "use strict";
                            return void 0 === this;
                        }();
                        if (d) b.exports = {
                            freeze: Object.freeze,
                            defineProperty: Object.defineProperty,
                            getDescriptor: Object.getOwnPropertyDescriptor,
                            keys: Object.keys,
                            names: Object.getOwnPropertyNames,
                            getPrototypeOf: Object.getPrototypeOf,
                            isArray: Array.isArray,
                            isES5: d,
                            propertyIsWritable: function(a, b) {
                                var c = Object.getOwnPropertyDescriptor(a, b);
                                return !(c && !c.writable && !c.set);
                            }
                        }; else {
                            var e = {}.hasOwnProperty, f = {}.toString, g = {}.constructor.prototype, h = function(a) {
                                var b = [];
                                for (var c in a) e.call(a, c) && b.push(c);
                                return b;
                            }, i = function(a, b) {
                                return {
                                    value: a[b]
                                };
                            }, j = function(a, b, c) {
                                return a[b] = c.value, a;
                            }, k = function(a) {
                                return a;
                            }, l = function(a) {
                                try {
                                    return Object(a).constructor.prototype;
                                } catch (a) {
                                    return g;
                                }
                            }, m = function(a) {
                                try {
                                    return "[object Array]" === f.call(a);
                                } catch (a) {
                                    return !1;
                                }
                            };
                            b.exports = {
                                isArray: m,
                                keys: h,
                                names: h,
                                defineProperty: j,
                                getDescriptor: i,
                                freeze: k,
                                getPrototypeOf: l,
                                isES5: d,
                                propertyIsWritable: function() {
                                    return !0;
                                }
                            };
                        }
                    }, {} ],
                    14: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b) {
                            var c = a.map;
                            a.prototype.filter = function(a, d) {
                                return c(this, a, d, b);
                            }, a.filter = function(a, d, e) {
                                return c(a, d, e, b);
                            };
                        };
                    }, {} ],
                    15: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a, b, c) {
                                this.promise = a, this.type = b, this.handler = c, this.called = !1, this.cancelPromise = null;
                            }
                            function f(a) {
                                this.finallyHandler = a;
                            }
                            function g(a, b) {
                                return null != a.cancelPromise && (arguments.length > 1 ? a.cancelPromise._reject(b) : a.cancelPromise._cancel(), 
                                a.cancelPromise = null, !0);
                            }
                            function h() {
                                return j.call(this, this.promise._target()._settledValue());
                            }
                            function i(a) {
                                if (!g(this, a)) return m.e = a, m;
                            }
                            function j(a) {
                                var e = this.promise, j = this.handler;
                                if (!this.called) {
                                    this.called = !0;
                                    var k = this.isFinallyHandler() ? j.call(e._boundValue()) : j.call(e._boundValue(), a);
                                    if (k === d) return k;
                                    if (void 0 !== k) {
                                        e._setReturnedNonUndefined();
                                        var n = c(k, e);
                                        if (n instanceof b) {
                                            if (null != this.cancelPromise) {
                                                if (n._isCancelled()) {
                                                    var o = new l("late cancellation observer");
                                                    return e._attachExtraTrace(o), m.e = o, m;
                                                }
                                                n.isPending() && n._attachCancellationCallback(new f(this));
                                            }
                                            return n._then(h, i, void 0, this, void 0);
                                        }
                                    }
                                }
                                return e.isRejected() ? (g(this), m.e = a, m) : (g(this), a);
                            }
                            var k = a("./util"), l = b.CancellationError, m = k.errorObj, n = a("./catch_filter")(d);
                            return e.prototype.isFinallyHandler = function() {
                                return 0 === this.type;
                            }, f.prototype._resultCancelled = function() {
                                g(this.finallyHandler);
                            }, b.prototype._passThrough = function(a, b, c, d) {
                                return "function" != typeof a ? this.then() : this._then(c, d, void 0, new e(this, b, a), void 0);
                            }, b.prototype.lastly = b.prototype.finally = function(a) {
                                return this._passThrough(a, 0, j, j);
                            }, b.prototype.tap = function(a) {
                                return this._passThrough(a, 1, j);
                            }, b.prototype.tapCatch = function(a) {
                                var c = arguments.length;
                                if (1 === c) return this._passThrough(a, 1, void 0, j);
                                var d, e = new Array(c - 1), f = 0;
                                for (d = 0; d < c - 1; ++d) {
                                    var g = arguments[d];
                                    if (!k.isObject(g)) return b.reject(new TypeError("tapCatch statement predicate: expecting an object but got " + k.classString(g)));
                                    e[f++] = g;
                                }
                                e.length = f;
                                var h = arguments[d];
                                return this._passThrough(n(e, h, this), 1, void 0, j);
                            }, e;
                        };
                    }, {
                        "./catch_filter": 7,
                        "./util": 36
                    } ],
                    16: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, c, d) {
                                for (var f = 0; f < c.length; ++f) {
                                    d._pushContext();
                                    var g = n(c[f])(a);
                                    if (d._popContext(), g === m) {
                                        d._pushContext();
                                        var h = b.reject(m.e);
                                        return d._popContext(), h;
                                    }
                                    var i = e(g, d);
                                    if (i instanceof b) return i;
                                }
                                return null;
                            }
                            function i(a, c, e, f) {
                                if (g.cancellation()) {
                                    var h = new b(d), i = this._finallyPromise = new b(d);
                                    this._promise = h.lastly(function() {
                                        return i;
                                    }), h._captureStackTrace(), h._setOnCancel(this);
                                } else {
                                    (this._promise = new b(d))._captureStackTrace();
                                }
                                this._stack = f, this._generatorFunction = a, this._receiver = c, this._generator = void 0, 
                                this._yieldHandlers = "function" == typeof e ? [ e ].concat(o) : o, this._yieldedPromise = null, 
                                this._cancellationPhase = !1;
                            }
                            var j = a("./errors"), k = j.TypeError, l = a("./util"), m = l.errorObj, n = l.tryCatch, o = [];
                            l.inherits(i, f), i.prototype._isResolved = function() {
                                return null === this._promise;
                            }, i.prototype._cleanup = function() {
                                this._promise = this._generator = null, g.cancellation() && null !== this._finallyPromise && (this._finallyPromise._fulfill(), 
                                this._finallyPromise = null);
                            }, i.prototype._promiseCancelled = function() {
                                if (!this._isResolved()) {
                                    var a, c = void 0 !== this._generator.return;
                                    if (c) this._promise._pushContext(), a = n(this._generator.return).call(this._generator, void 0), 
                                    this._promise._popContext(); else {
                                        var d = new b.CancellationError("generator .return() sentinel");
                                        b.coroutine.returnSentinel = d, this._promise._attachExtraTrace(d), this._promise._pushContext(), 
                                        a = n(this._generator.throw).call(this._generator, d), this._promise._popContext();
                                    }
                                    this._cancellationPhase = !0, this._yieldedPromise = null, this._continue(a);
                                }
                            }, i.prototype._promiseFulfilled = function(a) {
                                this._yieldedPromise = null, this._promise._pushContext();
                                var b = n(this._generator.next).call(this._generator, a);
                                this._promise._popContext(), this._continue(b);
                            }, i.prototype._promiseRejected = function(a) {
                                this._yieldedPromise = null, this._promise._attachExtraTrace(a), this._promise._pushContext();
                                var b = n(this._generator.throw).call(this._generator, a);
                                this._promise._popContext(), this._continue(b);
                            }, i.prototype._resultCancelled = function() {
                                if (this._yieldedPromise instanceof b) {
                                    var a = this._yieldedPromise;
                                    this._yieldedPromise = null, a.cancel();
                                }
                            }, i.prototype.promise = function() {
                                return this._promise;
                            }, i.prototype._run = function() {
                                this._generator = this._generatorFunction.call(this._receiver), this._receiver = this._generatorFunction = void 0, 
                                this._promiseFulfilled(void 0);
                            }, i.prototype._continue = function(a) {
                                var c = this._promise;
                                if (a === m) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._rejectCallback(a.e, !1);
                                var d = a.value;
                                if (!0 === a.done) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._resolveCallback(d);
                                var f = e(d, this._promise);
                                if (!(f instanceof b) && null === (f = h(f, this._yieldHandlers, this._promise))) return void this._promiseRejected(new k("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s", String(d)) + "From coroutine:\n" + this._stack.split("\n").slice(1, -7).join("\n")));
                                f = f._target();
                                var g = f._bitField;
                                0 == (50397184 & g) ? (this._yieldedPromise = f, f._proxy(this, null)) : 0 != (33554432 & g) ? b._async.invoke(this._promiseFulfilled, this, f._value()) : 0 != (16777216 & g) ? b._async.invoke(this._promiseRejected, this, f._reason()) : this._promiseCancelled();
                            }, b.coroutine = function(a, b) {
                                if ("function" != typeof a) throw new k("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");
                                var c = Object(b).yieldHandler, d = i, e = new Error().stack;
                                return function() {
                                    var b = a.apply(this, arguments), f = new d(void 0, void 0, c, e), g = f.promise();
                                    return f._generator = b, f._promiseFulfilled(void 0), g;
                                };
                            }, b.coroutine.addYieldHandler = function(a) {
                                if ("function" != typeof a) throw new k("expecting a function but got " + l.classString(a));
                                o.push(a);
                            }, b.spawn = function(a) {
                                if (g.deprecated("Promise.spawn()", "Promise.coroutine()"), "function" != typeof a) return c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");
                                var d = new i(a, this), e = d.promise();
                                return d._run(b.spawn), e;
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    17: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            var h = a("./util");
                            h.canEvaluate, h.tryCatch, h.errorObj;
                            b.join = function() {
                                var a, b = arguments.length - 1;
                                if (b > 0 && "function" == typeof arguments[b]) {
                                    a = arguments[b];
                                    var d;
                                }
                                var e = [].slice.call(arguments);
                                a && e.pop();
                                var d = new c(e).promise();
                                return void 0 !== a ? d.spread(a) : d;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    18: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, b, c, d) {
                                this.constructor$(a), this._promise._captureStackTrace();
                                var e = j();
                                this._callback = null === e ? b : k.domainBind(e, b), this._preservedValues = d === f ? new Array(this.length()) : null, 
                                this._limit = c, this._inFlight = 0, this._queue = [], n.invoke(this._asyncInit, this, void 0);
                            }
                            function i(a, c, e, f) {
                                if ("function" != typeof c) return d("expecting a function but got " + k.classString(c));
                                var g = 0;
                                if (void 0 !== e) {
                                    if ("object" != typeof e || null === e) return b.reject(new TypeError("options argument must be an object but it is " + k.classString(e)));
                                    if ("number" != typeof e.concurrency) return b.reject(new TypeError("'concurrency' must be a number but it is " + k.classString(e.concurrency)));
                                    g = e.concurrency;
                                }
                                return g = "number" == typeof g && isFinite(g) && g >= 1 ? g : 0, new h(a, c, g, f).promise();
                            }
                            var j = b._getDomain, k = a("./util"), l = k.tryCatch, m = k.errorObj, n = b._async;
                            k.inherits(h, c), h.prototype._asyncInit = function() {
                                this._init$(void 0, -2);
                            }, h.prototype._init = function() {}, h.prototype._promiseFulfilled = function(a, c) {
                                var d = this._values, f = this.length(), h = this._preservedValues, i = this._limit;
                                if (c < 0) {
                                    if (c = -1 * c - 1, d[c] = a, i >= 1 && (this._inFlight--, this._drainQueue(), this._isResolved())) return !0;
                                } else {
                                    if (i >= 1 && this._inFlight >= i) return d[c] = a, this._queue.push(c), !1;
                                    null !== h && (h[c] = a);
                                    var j = this._promise, k = this._callback, n = j._boundValue();
                                    j._pushContext();
                                    var o = l(k).call(n, a, c, f), p = j._popContext();
                                    if (g.checkForgottenReturns(o, p, null !== h ? "Promise.filter" : "Promise.map", j), 
                                    o === m) return this._reject(o.e), !0;
                                    var q = e(o, this._promise);
                                    if (q instanceof b) {
                                        q = q._target();
                                        var r = q._bitField;
                                        if (0 == (50397184 & r)) return i >= 1 && this._inFlight++, d[c] = q, q._proxy(this, -1 * (c + 1)), 
                                        !1;
                                        if (0 == (33554432 & r)) return 0 != (16777216 & r) ? (this._reject(q._reason()), 
                                        !0) : (this._cancel(), !0);
                                        o = q._value();
                                    }
                                    d[c] = o;
                                }
                                return ++this._totalResolved >= f && (null !== h ? this._filter(d, h) : this._resolve(d), 
                                !0);
                            }, h.prototype._drainQueue = function() {
                                for (var a = this._queue, b = this._limit, c = this._values; a.length > 0 && this._inFlight < b; ) {
                                    if (this._isResolved()) return;
                                    var d = a.pop();
                                    this._promiseFulfilled(c[d], d);
                                }
                            }, h.prototype._filter = function(a, b) {
                                for (var c = b.length, d = new Array(c), e = 0, f = 0; f < c; ++f) a[f] && (d[e++] = b[f]);
                                d.length = e, this._resolve(d);
                            }, h.prototype.preservedValues = function() {
                                return this._preservedValues;
                            }, b.prototype.map = function(a, b) {
                                return i(this, a, b, null);
                            }, b.map = function(a, b, c, d) {
                                return i(a, b, c, d);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    19: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f) {
                            var g = a("./util"), h = g.tryCatch;
                            b.method = function(a) {
                                if ("function" != typeof a) throw new b.TypeError("expecting a function but got " + g.classString(a));
                                return function() {
                                    var d = new b(c);
                                    d._captureStackTrace(), d._pushContext();
                                    var e = h(a).apply(this, arguments), g = d._popContext();
                                    return f.checkForgottenReturns(e, g, "Promise.method", d), d._resolveFromSyncValue(e), 
                                    d;
                                };
                            }, b.attempt = b.try = function(a) {
                                if ("function" != typeof a) return e("expecting a function but got " + g.classString(a));
                                var d = new b(c);
                                d._captureStackTrace(), d._pushContext();
                                var i;
                                if (arguments.length > 1) {
                                    f.deprecated("calling Promise.try with more than 1 argument");
                                    var j = arguments[1], k = arguments[2];
                                    i = g.isArray(j) ? h(a).apply(k, j) : h(a).call(k, j);
                                } else i = h(a)();
                                var l = d._popContext();
                                return f.checkForgottenReturns(i, l, "Promise.try", d), d._resolveFromSyncValue(i), 
                                d;
                            }, b.prototype._resolveFromSyncValue = function(a) {
                                a === g.errorObj ? this._rejectCallback(a.e, !1) : this._resolveCallback(a, !0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    20: [ function(a, b, c) {
                        "use strict";
                        function d(a) {
                            return a instanceof Error && k.getPrototypeOf(a) === Error.prototype;
                        }
                        function e(a) {
                            var b;
                            if (d(a)) {
                                b = new j(a), b.name = a.name, b.message = a.message, b.stack = a.stack;
                                for (var c = k.keys(a), e = 0; e < c.length; ++e) {
                                    var f = c[e];
                                    l.test(f) || (b[f] = a[f]);
                                }
                                return b;
                            }
                            return g.markAsOriginatingFromRejection(a), a;
                        }
                        function f(a, b) {
                            return function(c, d) {
                                if (null !== a) {
                                    if (c) {
                                        var f = e(h(c));
                                        a._attachExtraTrace(f), a._reject(f);
                                    } else if (b) {
                                        var g = [].slice.call(arguments, 1);
                                        a._fulfill(g);
                                    } else a._fulfill(d);
                                    a = null;
                                }
                            };
                        }
                        var g = a("./util"), h = g.maybeWrapAsError, i = a("./errors"), j = i.OperationalError, k = a("./es5"), l = /^(?:name|message|stack|cause)$/;
                        b.exports = f;
                    }, {
                        "./errors": 12,
                        "./es5": 13,
                        "./util": 36
                    } ],
                    21: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b) {
                            function c(a, b) {
                                var c = this;
                                if (!f.isArray(a)) return d.call(c, a, b);
                                var e = h(b).apply(c._boundValue(), [ null ].concat(a));
                                e === i && g.throwLater(e.e);
                            }
                            function d(a, b) {
                                var c = this, d = c._boundValue(), e = void 0 === a ? h(b).call(d, null) : h(b).call(d, null, a);
                                e === i && g.throwLater(e.e);
                            }
                            function e(a, b) {
                                var c = this;
                                if (!a) {
                                    var d = new Error(a + "");
                                    d.cause = a, a = d;
                                }
                                var e = h(b).call(c._boundValue(), a);
                                e === i && g.throwLater(e.e);
                            }
                            var f = a("./util"), g = b._async, h = f.tryCatch, i = f.errorObj;
                            b.prototype.asCallback = b.prototype.nodeify = function(a, b) {
                                if ("function" == typeof a) {
                                    var f = d;
                                    void 0 !== b && Object(b).spread && (f = c), this._then(f, e, void 0, this, a);
                                }
                                return this;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    22: [ function(b, c, d) {
                        "use strict";
                        c.exports = function() {
                            function d() {}
                            function e(a, b) {
                                if (null == a || a.constructor !== f) throw new t("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");
                                if ("function" != typeof b) throw new t("expecting a function but got " + o.classString(b));
                            }
                            function f(a) {
                                a !== v && e(this, a), this._bitField = 0, this._fulfillmentHandler0 = void 0, this._rejectionHandler0 = void 0, 
                                this._promise0 = void 0, this._receiver0 = void 0, this._resolveFromExecutor(a), 
                                this._promiseCreated(), this._fireEvent("promiseCreated", this);
                            }
                            function g(a) {
                                this.promise._resolveCallback(a);
                            }
                            function h(a) {
                                this.promise._rejectCallback(a, !1);
                            }
                            function i(a) {
                                var b = new f(v);
                                b._fulfillmentHandler0 = a, b._rejectionHandler0 = a, b._promise0 = a, b._receiver0 = a;
                            }
                            var j, k = function() {
                                return new t("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n");
                            }, l = function() {
                                return new f.PromiseInspection(this._target());
                            }, m = function(a) {
                                return f.reject(new t(a));
                            }, n = {}, o = b("./util");
                            j = o.isNode ? function() {
                                var b = a.domain;
                                return void 0 === b && (b = null), b;
                            } : function() {
                                return null;
                            }, o.notEnumerableProp(f, "_getDomain", j);
                            var p = b("./es5"), q = b("./async"), r = new q();
                            p.defineProperty(f, "_async", {
                                value: r
                            });
                            var s = b("./errors"), t = f.TypeError = s.TypeError;
                            f.RangeError = s.RangeError;
                            var u = f.CancellationError = s.CancellationError;
                            f.TimeoutError = s.TimeoutError, f.OperationalError = s.OperationalError, f.RejectionError = s.OperationalError, 
                            f.AggregateError = s.AggregateError;
                            var v = function() {}, w = {}, x = {}, y = b("./thenables")(f, v), z = b("./promise_array")(f, v, y, m, d), A = b("./context")(f), B = A.create, C = b("./debuggability")(f, A), D = (C.CapturedTrace, 
                            b("./finally")(f, y, x)), E = b("./catch_filter")(x), F = b("./nodeback"), G = o.errorObj, H = o.tryCatch;
                            return f.prototype.toString = function() {
                                return "[object Promise]";
                            }, f.prototype.caught = f.prototype.catch = function(a) {
                                var b = arguments.length;
                                if (b > 1) {
                                    var c, d = new Array(b - 1), e = 0;
                                    for (c = 0; c < b - 1; ++c) {
                                        var f = arguments[c];
                                        if (!o.isObject(f)) return m("Catch statement predicate: expecting an object but got " + o.classString(f));
                                        d[e++] = f;
                                    }
                                    return d.length = e, a = arguments[c], this.then(void 0, E(d, a, this));
                                }
                                return this.then(void 0, a);
                            }, f.prototype.reflect = function() {
                                return this._then(l, l, void 0, this, void 0);
                            }, f.prototype.then = function(a, b) {
                                if (C.warnings() && arguments.length > 0 && "function" != typeof a && "function" != typeof b) {
                                    var c = ".then() only accepts functions but was passed: " + o.classString(a);
                                    arguments.length > 1 && (c += ", " + o.classString(b)), this._warn(c);
                                }
                                return this._then(a, b, void 0, void 0, void 0);
                            }, f.prototype.done = function(a, b) {
                                this._then(a, b, void 0, void 0, void 0)._setIsFinal();
                            }, f.prototype.spread = function(a) {
                                return "function" != typeof a ? m("expecting a function but got " + o.classString(a)) : this.all()._then(a, void 0, void 0, w, void 0);
                            }, f.prototype.toJSON = function() {
                                var a = {
                                    isFulfilled: !1,
                                    isRejected: !1,
                                    fulfillmentValue: void 0,
                                    rejectionReason: void 0
                                };
                                return this.isFulfilled() ? (a.fulfillmentValue = this.value(), a.isFulfilled = !0) : this.isRejected() && (a.rejectionReason = this.reason(), 
                                a.isRejected = !0), a;
                            }, f.prototype.all = function() {
                                return arguments.length > 0 && this._warn(".all() was passed arguments but it does not take any"), 
                                new z(this).promise();
                            }, f.prototype.error = function(a) {
                                return this.caught(o.originatesFromRejection, a);
                            }, f.getNewLibraryCopy = c.exports, f.is = function(a) {
                                return a instanceof f;
                            }, f.fromNode = f.fromCallback = function(a) {
                                var b = new f(v);
                                b._captureStackTrace();
                                var c = arguments.length > 1 && !!Object(arguments[1]).multiArgs, d = H(a)(F(b, c));
                                return d === G && b._rejectCallback(d.e, !0), b._isFateSealed() || b._setAsyncGuaranteed(), 
                                b;
                            }, f.all = function(a) {
                                return new z(a).promise();
                            }, f.cast = function(a) {
                                var b = y(a);
                                return b instanceof f || (b = new f(v), b._captureStackTrace(), b._setFulfilled(), 
                                b._rejectionHandler0 = a), b;
                            }, f.resolve = f.fulfilled = f.cast, f.reject = f.rejected = function(a) {
                                var b = new f(v);
                                return b._captureStackTrace(), b._rejectCallback(a, !0), b;
                            }, f.setScheduler = function(a) {
                                if ("function" != typeof a) throw new t("expecting a function but got " + o.classString(a));
                                return r.setScheduler(a);
                            }, f.prototype._then = function(a, b, c, d, e) {
                                var g = void 0 !== e, h = g ? e : new f(v), i = this._target(), k = i._bitField;
                                g || (h._propagateFrom(this, 3), h._captureStackTrace(), void 0 === d && 0 != (2097152 & this._bitField) && (d = 0 != (50397184 & k) ? this._boundValue() : i === this ? void 0 : this._boundTo), 
                                this._fireEvent("promiseChained", this, h));
                                var l = j();
                                if (0 != (50397184 & k)) {
                                    var m, n, p = i._settlePromiseCtx;
                                    0 != (33554432 & k) ? (n = i._rejectionHandler0, m = a) : 0 != (16777216 & k) ? (n = i._fulfillmentHandler0, 
                                    m = b, i._unsetRejectionIsUnhandled()) : (p = i._settlePromiseLateCancellationObserver, 
                                    n = new u("late cancellation observer"), i._attachExtraTrace(n), m = b), r.invoke(p, i, {
                                        handler: null === l ? m : "function" == typeof m && o.domainBind(l, m),
                                        promise: h,
                                        receiver: d,
                                        value: n
                                    });
                                } else i._addCallbacks(a, b, h, d, l);
                                return h;
                            }, f.prototype._length = function() {
                                return 65535 & this._bitField;
                            }, f.prototype._isFateSealed = function() {
                                return 0 != (117506048 & this._bitField);
                            }, f.prototype._isFollowing = function() {
                                return 67108864 == (67108864 & this._bitField);
                            }, f.prototype._setLength = function(a) {
                                this._bitField = -65536 & this._bitField | 65535 & a;
                            }, f.prototype._setFulfilled = function() {
                                this._bitField = 33554432 | this._bitField, this._fireEvent("promiseFulfilled", this);
                            }, f.prototype._setRejected = function() {
                                this._bitField = 16777216 | this._bitField, this._fireEvent("promiseRejected", this);
                            }, f.prototype._setFollowing = function() {
                                this._bitField = 67108864 | this._bitField, this._fireEvent("promiseResolved", this);
                            }, f.prototype._setIsFinal = function() {
                                this._bitField = 4194304 | this._bitField;
                            }, f.prototype._isFinal = function() {
                                return (4194304 & this._bitField) > 0;
                            }, f.prototype._unsetCancelled = function() {
                                this._bitField = -65537 & this._bitField;
                            }, f.prototype._setCancelled = function() {
                                this._bitField = 65536 | this._bitField, this._fireEvent("promiseCancelled", this);
                            }, f.prototype._setWillBeCancelled = function() {
                                this._bitField = 8388608 | this._bitField;
                            }, f.prototype._setAsyncGuaranteed = function() {
                                r.hasCustomScheduler() || (this._bitField = 134217728 | this._bitField);
                            }, f.prototype._receiverAt = function(a) {
                                var b = 0 === a ? this._receiver0 : this[4 * a - 4 + 3];
                                if (b !== n) return void 0 === b && this._isBound() ? this._boundValue() : b;
                            }, f.prototype._promiseAt = function(a) {
                                return this[4 * a - 4 + 2];
                            }, f.prototype._fulfillmentHandlerAt = function(a) {
                                return this[4 * a - 4 + 0];
                            }, f.prototype._rejectionHandlerAt = function(a) {
                                return this[4 * a - 4 + 1];
                            }, f.prototype._boundValue = function() {}, f.prototype._migrateCallback0 = function(a) {
                                var b = (a._bitField, a._fulfillmentHandler0), c = a._rejectionHandler0, d = a._promise0, e = a._receiverAt(0);
                                void 0 === e && (e = n), this._addCallbacks(b, c, d, e, null);
                            }, f.prototype._migrateCallbackAt = function(a, b) {
                                var c = a._fulfillmentHandlerAt(b), d = a._rejectionHandlerAt(b), e = a._promiseAt(b), f = a._receiverAt(b);
                                void 0 === f && (f = n), this._addCallbacks(c, d, e, f, null);
                            }, f.prototype._addCallbacks = function(a, b, c, d, e) {
                                var f = this._length();
                                if (f >= 65531 && (f = 0, this._setLength(0)), 0 === f) this._promise0 = c, this._receiver0 = d, 
                                "function" == typeof a && (this._fulfillmentHandler0 = null === e ? a : o.domainBind(e, a)), 
                                "function" == typeof b && (this._rejectionHandler0 = null === e ? b : o.domainBind(e, b)); else {
                                    var g = 4 * f - 4;
                                    this[g + 2] = c, this[g + 3] = d, "function" == typeof a && (this[g + 0] = null === e ? a : o.domainBind(e, a)), 
                                    "function" == typeof b && (this[g + 1] = null === e ? b : o.domainBind(e, b));
                                }
                                return this._setLength(f + 1), f;
                            }, f.prototype._proxy = function(a, b) {
                                this._addCallbacks(void 0, void 0, b, a, null);
                            }, f.prototype._resolveCallback = function(a, b) {
                                if (0 == (117506048 & this._bitField)) {
                                    if (a === this) return this._rejectCallback(k(), !1);
                                    var c = y(a, this);
                                    if (!(c instanceof f)) return this._fulfill(a);
                                    b && this._propagateFrom(c, 2);
                                    var d = c._target();
                                    if (d === this) return void this._reject(k());
                                    var e = d._bitField;
                                    if (0 == (50397184 & e)) {
                                        var g = this._length();
                                        g > 0 && d._migrateCallback0(this);
                                        for (var h = 1; h < g; ++h) d._migrateCallbackAt(this, h);
                                        this._setFollowing(), this._setLength(0), this._setFollowee(d);
                                    } else if (0 != (33554432 & e)) this._fulfill(d._value()); else if (0 != (16777216 & e)) this._reject(d._reason()); else {
                                        var i = new u("late cancellation observer");
                                        d._attachExtraTrace(i), this._reject(i);
                                    }
                                }
                            }, f.prototype._rejectCallback = function(a, b, c) {
                                var d = o.ensureErrorObject(a), e = d === a;
                                if (!e && !c && C.warnings()) {
                                    var f = "a promise was rejected with a non-error: " + o.classString(a);
                                    this._warn(f, !0);
                                }
                                this._attachExtraTrace(d, !!b && e), this._reject(a);
                            }, f.prototype._resolveFromExecutor = function(a) {
                                if (a !== v) {
                                    var b = this;
                                    this._captureStackTrace(), this._pushContext();
                                    var c = !0, d = this._execute(a, function(a) {
                                        b._resolveCallback(a);
                                    }, function(a) {
                                        b._rejectCallback(a, c);
                                    });
                                    c = !1, this._popContext(), void 0 !== d && b._rejectCallback(d, !0);
                                }
                            }, f.prototype._settlePromiseFromHandler = function(a, b, c, d) {
                                var e = d._bitField;
                                if (0 == (65536 & e)) {
                                    d._pushContext();
                                    var f;
                                    b === w ? c && "number" == typeof c.length ? f = H(a).apply(this._boundValue(), c) : (f = G, 
                                    f.e = new t("cannot .spread() a non-array: " + o.classString(c))) : f = H(a).call(b, c);
                                    var g = d._popContext();
                                    e = d._bitField, 0 == (65536 & e) && (f === x ? d._reject(c) : f === G ? d._rejectCallback(f.e, !1) : (C.checkForgottenReturns(f, g, "", d, this), 
                                    d._resolveCallback(f)));
                                }
                            }, f.prototype._target = function() {
                                for (var a = this; a._isFollowing(); ) a = a._followee();
                                return a;
                            }, f.prototype._followee = function() {
                                return this._rejectionHandler0;
                            }, f.prototype._setFollowee = function(a) {
                                this._rejectionHandler0 = a;
                            }, f.prototype._settlePromise = function(a, b, c, e) {
                                var g = a instanceof f, h = this._bitField, i = 0 != (134217728 & h);
                                0 != (65536 & h) ? (g && a._invokeInternalOnCancel(), c instanceof D && c.isFinallyHandler() ? (c.cancelPromise = a, 
                                H(b).call(c, e) === G && a._reject(G.e)) : b === l ? a._fulfill(l.call(c)) : c instanceof d ? c._promiseCancelled(a) : g || a instanceof z ? a._cancel() : c.cancel()) : "function" == typeof b ? g ? (i && a._setAsyncGuaranteed(), 
                                this._settlePromiseFromHandler(b, c, e, a)) : b.call(c, e, a) : c instanceof d ? c._isResolved() || (0 != (33554432 & h) ? c._promiseFulfilled(e, a) : c._promiseRejected(e, a)) : g && (i && a._setAsyncGuaranteed(), 
                                0 != (33554432 & h) ? a._fulfill(e) : a._reject(e));
                            }, f.prototype._settlePromiseLateCancellationObserver = function(a) {
                                var b = a.handler, c = a.promise, d = a.receiver, e = a.value;
                                "function" == typeof b ? c instanceof f ? this._settlePromiseFromHandler(b, d, e, c) : b.call(d, e, c) : c instanceof f && c._reject(e);
                            }, f.prototype._settlePromiseCtx = function(a) {
                                this._settlePromise(a.promise, a.handler, a.receiver, a.value);
                            }, f.prototype._settlePromise0 = function(a, b, c) {
                                var d = this._promise0, e = this._receiverAt(0);
                                this._promise0 = void 0, this._receiver0 = void 0, this._settlePromise(d, a, e, b);
                            }, f.prototype._clearCallbackDataAtIndex = function(a) {
                                var b = 4 * a - 4;
                                this[b + 2] = this[b + 3] = this[b + 0] = this[b + 1] = void 0;
                            }, f.prototype._fulfill = function(a) {
                                var b = this._bitField;
                                if (!((117506048 & b) >>> 16)) {
                                    if (a === this) {
                                        var c = k();
                                        return this._attachExtraTrace(c), this._reject(c);
                                    }
                                    this._setFulfilled(), this._rejectionHandler0 = a, (65535 & b) > 0 && (0 != (134217728 & b) ? this._settlePromises() : r.settlePromises(this));
                                }
                            }, f.prototype._reject = function(a) {
                                var b = this._bitField;
                                if (!((117506048 & b) >>> 16)) {
                                    if (this._setRejected(), this._fulfillmentHandler0 = a, this._isFinal()) return r.fatalError(a, o.isNode);
                                    (65535 & b) > 0 ? r.settlePromises(this) : this._ensurePossibleRejectionHandled();
                                }
                            }, f.prototype._fulfillPromises = function(a, b) {
                                for (var c = 1; c < a; c++) {
                                    var d = this._fulfillmentHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);
                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);
                                }
                            }, f.prototype._rejectPromises = function(a, b) {
                                for (var c = 1; c < a; c++) {
                                    var d = this._rejectionHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);
                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);
                                }
                            }, f.prototype._settlePromises = function() {
                                var a = this._bitField, b = 65535 & a;
                                if (b > 0) {
                                    if (0 != (16842752 & a)) {
                                        var c = this._fulfillmentHandler0;
                                        this._settlePromise0(this._rejectionHandler0, c, a), this._rejectPromises(b, c);
                                    } else {
                                        var d = this._rejectionHandler0;
                                        this._settlePromise0(this._fulfillmentHandler0, d, a), this._fulfillPromises(b, d);
                                    }
                                    this._setLength(0);
                                }
                                this._clearCancellationData();
                            }, f.prototype._settledValue = function() {
                                var a = this._bitField;
                                return 0 != (33554432 & a) ? this._rejectionHandler0 : 0 != (16777216 & a) ? this._fulfillmentHandler0 : void 0;
                            }, f.defer = f.pending = function() {
                                return C.deprecated("Promise.defer", "new Promise"), {
                                    promise: new f(v),
                                    resolve: g,
                                    reject: h
                                };
                            }, o.notEnumerableProp(f, "_makeSelfResolutionError", k), b("./method")(f, v, y, m, C), 
                            b("./bind")(f, v, y, C), b("./cancel")(f, z, m, C), b("./direct_resolve")(f), b("./synchronous_inspection")(f), 
                            b("./join")(f, z, y, v, r, j), f.Promise = f, f.version = "3.5.1", b("./map.js")(f, z, m, y, v, C), 
                            b("./call_get.js")(f), b("./using.js")(f, m, y, B, v, C), b("./timers.js")(f, v, C), 
                            b("./generators.js")(f, m, v, y, d, C), b("./nodeify.js")(f), b("./promisify.js")(f, v), 
                            b("./props.js")(f, z, y, m), b("./race.js")(f, v, y, m), b("./reduce.js")(f, z, m, y, v, C), 
                            b("./settle.js")(f, z, C), b("./some.js")(f, z, m), b("./filter.js")(f, v), b("./each.js")(f, v), 
                            b("./any.js")(f), o.toFastProperties(f), o.toFastProperties(f.prototype), i({
                                a: 1
                            }), i({
                                b: 2
                            }), i({
                                c: 3
                            }), i(1), i(function() {}), i(void 0), i(!1), i(new f(v)), C.setBounds(q.firstLineError, o.lastLineError), 
                            f;
                        };
                    }, {
                        "./any.js": 1,
                        "./async": 2,
                        "./bind": 3,
                        "./call_get.js": 5,
                        "./cancel": 6,
                        "./catch_filter": 7,
                        "./context": 8,
                        "./debuggability": 9,
                        "./direct_resolve": 10,
                        "./each.js": 11,
                        "./errors": 12,
                        "./es5": 13,
                        "./filter.js": 14,
                        "./finally": 15,
                        "./generators.js": 16,
                        "./join": 17,
                        "./map.js": 18,
                        "./method": 19,
                        "./nodeback": 20,
                        "./nodeify.js": 21,
                        "./promise_array": 23,
                        "./promisify.js": 24,
                        "./props.js": 25,
                        "./race.js": 27,
                        "./reduce.js": 28,
                        "./settle.js": 30,
                        "./some.js": 31,
                        "./synchronous_inspection": 32,
                        "./thenables": 33,
                        "./timers.js": 34,
                        "./using.js": 35,
                        "./util": 36
                    } ],
                    23: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f) {
                            function g(a) {
                                switch (a) {
                                  case -2:
                                    return [];

                                  case -3:
                                    return {};

                                  case -6:
                                    return new Map();
                                }
                            }
                            function h(a) {
                                var d = this._promise = new b(c);
                                a instanceof b && d._propagateFrom(a, 3), d._setOnCancel(this), this._values = a, 
                                this._length = 0, this._totalResolved = 0, this._init(void 0, -2);
                            }
                            var i = a("./util");
                            i.isArray;
                            return i.inherits(h, f), h.prototype.length = function() {
                                return this._length;
                            }, h.prototype.promise = function() {
                                return this._promise;
                            }, h.prototype._init = function a(c, f) {
                                var h = d(this._values, this._promise);
                                if (h instanceof b) {
                                    h = h._target();
                                    var j = h._bitField;
                                    if (this._values = h, 0 == (50397184 & j)) return this._promise._setAsyncGuaranteed(), 
                                    h._then(a, this._reject, void 0, this, f);
                                    if (0 == (33554432 & j)) return 0 != (16777216 & j) ? this._reject(h._reason()) : this._cancel();
                                    h = h._value();
                                }
                                if (null === (h = i.asArray(h))) {
                                    var k = e("expecting an array or an iterable object but got " + i.classString(h)).reason();
                                    return void this._promise._rejectCallback(k, !1);
                                }
                                if (0 === h.length) return void (-5 === f ? this._resolveEmptyArray() : this._resolve(g(f)));
                                this._iterate(h);
                            }, h.prototype._iterate = function(a) {
                                var c = this.getActualLength(a.length);
                                this._length = c, this._values = this.shouldCopyValues() ? new Array(c) : this._values;
                                for (var e = this._promise, f = !1, g = null, h = 0; h < c; ++h) {
                                    var i = d(a[h], e);
                                    i instanceof b ? (i = i._target(), g = i._bitField) : g = null, f ? null !== g && i.suppressUnhandledRejections() : null !== g ? 0 == (50397184 & g) ? (i._proxy(this, h), 
                                    this._values[h] = i) : f = 0 != (33554432 & g) ? this._promiseFulfilled(i._value(), h) : 0 != (16777216 & g) ? this._promiseRejected(i._reason(), h) : this._promiseCancelled(h) : f = this._promiseFulfilled(i, h);
                                }
                                f || e._setAsyncGuaranteed();
                            }, h.prototype._isResolved = function() {
                                return null === this._values;
                            }, h.prototype._resolve = function(a) {
                                this._values = null, this._promise._fulfill(a);
                            }, h.prototype._cancel = function() {
                                !this._isResolved() && this._promise._isCancellable() && (this._values = null, this._promise._cancel());
                            }, h.prototype._reject = function(a) {
                                this._values = null, this._promise._rejectCallback(a, !1);
                            }, h.prototype._promiseFulfilled = function(a, b) {
                                return this._values[b] = a, ++this._totalResolved >= this._length && (this._resolve(this._values), 
                                !0);
                            }, h.prototype._promiseCancelled = function() {
                                return this._cancel(), !0;
                            }, h.prototype._promiseRejected = function(a) {
                                return this._totalResolved++, this._reject(a), !0;
                            }, h.prototype._resultCancelled = function() {
                                if (!this._isResolved()) {
                                    var a = this._values;
                                    if (this._cancel(), a instanceof b) a.cancel(); else for (var c = 0; c < a.length; ++c) a[c] instanceof b && a[c].cancel();
                                }
                            }, h.prototype.shouldCopyValues = function() {
                                return !0;
                            }, h.prototype.getActualLength = function(a) {
                                return a;
                            }, h;
                        };
                    }, {
                        "./util": 36
                    } ],
                    24: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c) {
                            function d(a) {
                                return !v.test(a);
                            }
                            function e(a) {
                                try {
                                    return !0 === a.__isPromisified__;
                                } catch (a) {
                                    return !1;
                                }
                            }
                            function f(a, b, c) {
                                var d = n.getDataPropertyOrDefault(a, b + c, t);
                                return !!d && e(d);
                            }
                            function g(a, b, c) {
                                for (var d = 0; d < a.length; d += 2) {
                                    var e = a[d];
                                    if (c.test(e)) for (var f = e.replace(c, ""), g = 0; g < a.length; g += 2) if (a[g] === f) throw new s("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s", b));
                                }
                            }
                            function h(a, b, c, d) {
                                for (var h = n.inheritedDataKeys(a), i = [], j = 0; j < h.length; ++j) {
                                    var k = h[j], l = a[k], m = d === w || w(k, l, a);
                                    "function" != typeof l || e(l) || f(a, k, b) || !d(k, l, a, m) || i.push(k, l);
                                }
                                return g(i, b, c), i;
                            }
                            function i(a, d, e, f, g, h) {
                                function i() {
                                    var e = d;
                                    d === m && (e = this);
                                    var f = new b(c);
                                    f._captureStackTrace();
                                    var g = "string" == typeof k && this !== j ? this[k] : a, i = o(f, h);
                                    try {
                                        g.apply(e, p(arguments, i));
                                    } catch (a) {
                                        f._rejectCallback(q(a), !0, !0);
                                    }
                                    return f._isFateSealed() || f._setAsyncGuaranteed(), f;
                                }
                                var j = function() {
                                    return this;
                                }(), k = a;
                                return "string" == typeof k && (a = f), n.notEnumerableProp(i, "__isPromisified__", !0), 
                                i;
                            }
                            function j(a, b, c, d, e) {
                                for (var f = new RegExp(x(b) + "$"), g = h(a, b, f, c), i = 0, j = g.length; i < j; i += 2) {
                                    var k = g[i], l = g[i + 1], o = k + b;
                                    if (d === y) a[o] = y(k, m, k, l, b, e); else {
                                        var p = d(l, function() {
                                            return y(k, m, k, l, b, e);
                                        });
                                        n.notEnumerableProp(p, "__isPromisified__", !0), a[o] = p;
                                    }
                                }
                                return n.toFastProperties(a), a;
                            }
                            function k(a, b, c) {
                                return y(a, b, void 0, a, null, c);
                            }
                            var l, m = {}, n = a("./util"), o = a("./nodeback"), p = n.withAppended, q = n.maybeWrapAsError, r = n.canEvaluate, s = a("./errors").TypeError, t = {
                                __isPromisified__: !0
                            }, u = [ "arity", "length", "name", "arguments", "caller", "callee", "prototype", "__isPromisified__" ], v = new RegExp("^(?:" + u.join("|") + ")$"), w = function(a) {
                                return n.isIdentifier(a) && "_" !== a.charAt(0) && "constructor" !== a;
                            }, x = function(a) {
                                return a.replace(/([$])/, "\\$");
                            }, y = r ? l : i;
                            b.promisify = function(a, b) {
                                if ("function" != typeof a) throw new s("expecting a function but got " + n.classString(a));
                                if (e(a)) return a;
                                b = Object(b);
                                var c = void 0 === b.context ? m : b.context, f = !!b.multiArgs, g = k(a, c, f);
                                return n.copyDescriptors(a, g, d), g;
                            }, b.promisifyAll = function(a, b) {
                                if ("function" != typeof a && "object" != typeof a) throw new s("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");
                                b = Object(b);
                                var c = !!b.multiArgs, d = b.suffix;
                                "string" != typeof d && (d = "Async");
                                var e = b.filter;
                                "function" != typeof e && (e = w);
                                var f = b.promisifier;
                                if ("function" != typeof f && (f = y), !n.isIdentifier(d)) throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");
                                for (var g = n.inheritedDataKeys(a), h = 0; h < g.length; ++h) {
                                    var i = a[g[h]];
                                    "constructor" !== g[h] && n.isClass(i) && (j(i.prototype, d, e, f, c), j(i, d, e, f, c));
                                }
                                return j(a, d, e, f, c);
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./nodeback": 20,
                        "./util": 36
                    } ],
                    25: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            function f(a) {
                                var b, c = !1;
                                if (void 0 !== h && a instanceof h) b = l(a), c = !0; else {
                                    var d = k.keys(a), e = d.length;
                                    b = new Array(2 * e);
                                    for (var f = 0; f < e; ++f) {
                                        var g = d[f];
                                        b[f] = a[g], b[f + e] = g;
                                    }
                                }
                                this.constructor$(b), this._isMap = c, this._init$(void 0, c ? -6 : -3);
                            }
                            function g(a) {
                                var c, g = d(a);
                                return j(g) ? (c = g instanceof b ? g._then(b.props, void 0, void 0, void 0, void 0) : new f(g).promise(), 
                                g instanceof b && c._propagateFrom(g, 2), c) : e("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n");
                            }
                            var h, i = a("./util"), j = i.isObject, k = a("./es5");
                            "function" == typeof Map && (h = Map);
                            var l = function() {
                                function a(a, d) {
                                    this[b] = a, this[b + c] = d, b++;
                                }
                                var b = 0, c = 0;
                                return function(d) {
                                    c = d.size, b = 0;
                                    var e = new Array(2 * d.size);
                                    return d.forEach(a, e), e;
                                };
                            }(), m = function(a) {
                                for (var b = new h(), c = a.length / 2 | 0, d = 0; d < c; ++d) {
                                    var e = a[c + d], f = a[d];
                                    b.set(e, f);
                                }
                                return b;
                            };
                            i.inherits(f, c), f.prototype._init = function() {}, f.prototype._promiseFulfilled = function(a, b) {
                                if (this._values[b] = a, ++this._totalResolved >= this._length) {
                                    var c;
                                    if (this._isMap) c = m(this._values); else {
                                        c = {};
                                        for (var d = this.length(), e = 0, f = this.length(); e < f; ++e) c[this._values[e + d]] = this._values[e];
                                    }
                                    return this._resolve(c), !0;
                                }
                                return !1;
                            }, f.prototype.shouldCopyValues = function() {
                                return !1;
                            }, f.prototype.getActualLength = function(a) {
                                return a >> 1;
                            }, b.prototype.props = function() {
                                return g(this);
                            }, b.props = function(a) {
                                return g(a);
                            };
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    26: [ function(a, b, c) {
                        "use strict";
                        function d(a, b, c, d, e) {
                            for (var f = 0; f < e; ++f) c[f + d] = a[f + b], a[f + b] = void 0;
                        }
                        function e(a) {
                            this._capacity = a, this._length = 0, this._front = 0;
                        }
                        e.prototype._willBeOverCapacity = function(a) {
                            return this._capacity < a;
                        }, e.prototype._pushOne = function(a) {
                            var b = this.length();
                            this._checkCapacity(b + 1), this[this._front + b & this._capacity - 1] = a, this._length = b + 1;
                        }, e.prototype.push = function(a, b, c) {
                            var d = this.length() + 3;
                            if (this._willBeOverCapacity(d)) return this._pushOne(a), this._pushOne(b), void this._pushOne(c);
                            var e = this._front + d - 3;
                            this._checkCapacity(d);
                            var f = this._capacity - 1;
                            this[e + 0 & f] = a, this[e + 1 & f] = b, this[e + 2 & f] = c, this._length = d;
                        }, e.prototype.shift = function() {
                            var a = this._front, b = this[a];
                            return this[a] = void 0, this._front = a + 1 & this._capacity - 1, this._length--, 
                            b;
                        }, e.prototype.length = function() {
                            return this._length;
                        }, e.prototype._checkCapacity = function(a) {
                            this._capacity < a && this._resizeTo(this._capacity << 1);
                        }, e.prototype._resizeTo = function(a) {
                            var b = this._capacity;
                            this._capacity = a, d(this, 0, this, b, this._front + this._length & b - 1);
                        }, b.exports = e;
                    }, {} ],
                    27: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            function f(a, f) {
                                var i = d(a);
                                if (i instanceof b) return h(i);
                                if (null === (a = g.asArray(a))) return e("expecting an array or an iterable object but got " + g.classString(a));
                                var j = new b(c);
                                void 0 !== f && j._propagateFrom(f, 3);
                                for (var k = j._fulfill, l = j._reject, m = 0, n = a.length; m < n; ++m) {
                                    var o = a[m];
                                    (void 0 !== o || m in a) && b.cast(o)._then(k, l, void 0, j, null);
                                }
                                return j;
                            }
                            var g = a("./util"), h = function(a) {
                                return a.then(function(b) {
                                    return f(b, a);
                                });
                            };
                            b.race = function(a) {
                                return f(a, void 0);
                            }, b.prototype.race = function() {
                                return f(this, void 0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    28: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, c, d, e) {
                                this.constructor$(a);
                                var g = m();
                                this._fn = null === g ? c : n.domainBind(g, c), void 0 !== d && (d = b.resolve(d), 
                                d._attachCancellationCallback(this)), this._initialValue = d, this._currentCancellable = null, 
                                this._eachValues = e === f ? Array(this._length) : 0 === e ? null : void 0, this._promise._captureStackTrace(), 
                                this._init$(void 0, -5);
                            }
                            function i(a, b) {
                                this.isFulfilled() ? b._resolve(a) : b._reject(a);
                            }
                            function j(a, b, c, e) {
                                return "function" != typeof b ? d("expecting a function but got " + n.classString(b)) : new h(a, b, c, e).promise();
                            }
                            function k(a) {
                                this.accum = a, this.array._gotAccum(a);
                                var c = e(this.value, this.array._promise);
                                return c instanceof b ? (this.array._currentCancellable = c, c._then(l, void 0, void 0, this, void 0)) : l.call(this, c);
                            }
                            function l(a) {
                                var c = this.array, d = c._promise, e = o(c._fn);
                                d._pushContext();
                                var f;
                                (f = void 0 !== c._eachValues ? e.call(d._boundValue(), a, this.index, this.length) : e.call(d._boundValue(), this.accum, a, this.index, this.length)) instanceof b && (c._currentCancellable = f);
                                var h = d._popContext();
                                return g.checkForgottenReturns(f, h, void 0 !== c._eachValues ? "Promise.each" : "Promise.reduce", d), 
                                f;
                            }
                            var m = b._getDomain, n = a("./util"), o = n.tryCatch;
                            n.inherits(h, c), h.prototype._gotAccum = function(a) {
                                void 0 !== this._eachValues && null !== this._eachValues && a !== f && this._eachValues.push(a);
                            }, h.prototype._eachComplete = function(a) {
                                return null !== this._eachValues && this._eachValues.push(a), this._eachValues;
                            }, h.prototype._init = function() {}, h.prototype._resolveEmptyArray = function() {
                                this._resolve(void 0 !== this._eachValues ? this._eachValues : this._initialValue);
                            }, h.prototype.shouldCopyValues = function() {
                                return !1;
                            }, h.prototype._resolve = function(a) {
                                this._promise._resolveCallback(a), this._values = null;
                            }, h.prototype._resultCancelled = function(a) {
                                if (a === this._initialValue) return this._cancel();
                                this._isResolved() || (this._resultCancelled$(), this._currentCancellable instanceof b && this._currentCancellable.cancel(), 
                                this._initialValue instanceof b && this._initialValue.cancel());
                            }, h.prototype._iterate = function(a) {
                                this._values = a;
                                var c, d, e = a.length;
                                if (void 0 !== this._initialValue ? (c = this._initialValue, d = 0) : (c = b.resolve(a[0]), 
                                d = 1), this._currentCancellable = c, !c.isRejected()) for (;d < e; ++d) {
                                    var f = {
                                        accum: null,
                                        value: a[d],
                                        index: d,
                                        length: e,
                                        array: this
                                    };
                                    c = c._then(k, void 0, void 0, f, void 0);
                                }
                                void 0 !== this._eachValues && (c = c._then(this._eachComplete, void 0, void 0, this, void 0)), 
                                c._then(i, i, void 0, c, this);
                            }, b.prototype.reduce = function(a, b) {
                                return j(this, a, b, null);
                            }, b.reduce = function(a, b, c, d) {
                                return j(a, b, c, d);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    29: [ function(b, c, e) {
                        "use strict";
                        var f, g = b("./util"), h = function() {
                            throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");
                        }, i = g.getNativePromise();
                        if (g.isNode && "undefined" == typeof MutationObserver) {
                            var j = d.setImmediate, k = a.nextTick;
                            f = g.isRecentNode ? function(a) {
                                j.call(d, a);
                            } : function(b) {
                                k.call(a, b);
                            };
                        } else if ("function" == typeof i && "function" == typeof i.resolve) {
                            var l = i.resolve();
                            f = function(a) {
                                l.then(a);
                            };
                        } else f = "undefined" == typeof MutationObserver || "undefined" != typeof window && window.navigator && (window.navigator.standalone || window.cordova) ? "undefined" != typeof setImmediate ? function(a) {
                            setImmediate(a);
                        } : "undefined" != typeof setTimeout ? function(a) {
                            setTimeout(a, 0);
                        } : h : function() {
                            var a = document.createElement("div"), b = {
                                attributes: !0
                            }, c = !1, d = document.createElement("div");
                            new MutationObserver(function() {
                                a.classList.toggle("foo"), c = !1;
                            }).observe(d, b);
                            var e = function() {
                                c || (c = !0, d.classList.toggle("foo"));
                            };
                            return function(c) {
                                var d = new MutationObserver(function() {
                                    d.disconnect(), c();
                                });
                                d.observe(a, b), e();
                            };
                        }();
                        c.exports = f;
                    }, {
                        "./util": 36
                    } ],
                    30: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.constructor$(a);
                            }
                            var f = b.PromiseInspection;
                            a("./util").inherits(e, c), e.prototype._promiseResolved = function(a, b) {
                                return this._values[a] = b, ++this._totalResolved >= this._length && (this._resolve(this._values), 
                                !0);
                            }, e.prototype._promiseFulfilled = function(a, b) {
                                var c = new f();
                                return c._bitField = 33554432, c._settledValueField = a, this._promiseResolved(b, c);
                            }, e.prototype._promiseRejected = function(a, b) {
                                var c = new f();
                                return c._bitField = 16777216, c._settledValueField = a, this._promiseResolved(b, c);
                            }, b.settle = function(a) {
                                return d.deprecated(".settle()", ".reflect()"), new e(a).promise();
                            }, b.prototype.settle = function() {
                                return b.settle(this);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    31: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.constructor$(a), this._howMany = 0, this._unwrap = !1, this._initialized = !1;
                            }
                            function f(a, b) {
                                if ((0 | b) !== b || b < 0) return d("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");
                                var c = new e(a), f = c.promise();
                                return c.setHowMany(b), c.init(), f;
                            }
                            var g = a("./util"), h = a("./errors").RangeError, i = a("./errors").AggregateError, j = g.isArray, k = {};
                            g.inherits(e, c), e.prototype._init = function() {
                                if (this._initialized) {
                                    if (0 === this._howMany) return void this._resolve([]);
                                    this._init$(void 0, -5);
                                    var a = j(this._values);
                                    !this._isResolved() && a && this._howMany > this._canPossiblyFulfill() && this._reject(this._getRangeError(this.length()));
                                }
                            }, e.prototype.init = function() {
                                this._initialized = !0, this._init();
                            }, e.prototype.setUnwrap = function() {
                                this._unwrap = !0;
                            }, e.prototype.howMany = function() {
                                return this._howMany;
                            }, e.prototype.setHowMany = function(a) {
                                this._howMany = a;
                            }, e.prototype._promiseFulfilled = function(a) {
                                return this._addFulfilled(a), this._fulfilled() === this.howMany() && (this._values.length = this.howMany(), 
                                1 === this.howMany() && this._unwrap ? this._resolve(this._values[0]) : this._resolve(this._values), 
                                !0);
                            }, e.prototype._promiseRejected = function(a) {
                                return this._addRejected(a), this._checkOutcome();
                            }, e.prototype._promiseCancelled = function() {
                                return this._values instanceof b || null == this._values ? this._cancel() : (this._addRejected(k), 
                                this._checkOutcome());
                            }, e.prototype._checkOutcome = function() {
                                if (this.howMany() > this._canPossiblyFulfill()) {
                                    for (var a = new i(), b = this.length(); b < this._values.length; ++b) this._values[b] !== k && a.push(this._values[b]);
                                    return a.length > 0 ? this._reject(a) : this._cancel(), !0;
                                }
                                return !1;
                            }, e.prototype._fulfilled = function() {
                                return this._totalResolved;
                            }, e.prototype._rejected = function() {
                                return this._values.length - this.length();
                            }, e.prototype._addRejected = function(a) {
                                this._values.push(a);
                            }, e.prototype._addFulfilled = function(a) {
                                this._values[this._totalResolved++] = a;
                            }, e.prototype._canPossiblyFulfill = function() {
                                return this.length() - this._rejected();
                            }, e.prototype._getRangeError = function(a) {
                                var b = "Input array must contain at least " + this._howMany + " items but contains only " + a + " items";
                                return new h(b);
                            }, e.prototype._resolveEmptyArray = function() {
                                this._reject(this._getRangeError(0));
                            }, b.some = function(a, b) {
                                return f(a, b);
                            }, b.prototype.some = function(a) {
                                return f(this, a);
                            }, b._SomePromiseArray = e;
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    32: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b(a) {
                                void 0 !== a ? (a = a._target(), this._bitField = a._bitField, this._settledValueField = a._isFateSealed() ? a._settledValue() : void 0) : (this._bitField = 0, 
                                this._settledValueField = void 0);
                            }
                            b.prototype._settledValue = function() {
                                return this._settledValueField;
                            };
                            var c = b.prototype.value = function() {
                                if (!this.isFulfilled()) throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");
                                return this._settledValue();
                            }, d = b.prototype.error = b.prototype.reason = function() {
                                if (!this.isRejected()) throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");
                                return this._settledValue();
                            }, e = b.prototype.isFulfilled = function() {
                                return 0 != (33554432 & this._bitField);
                            }, f = b.prototype.isRejected = function() {
                                return 0 != (16777216 & this._bitField);
                            }, g = b.prototype.isPending = function() {
                                return 0 == (50397184 & this._bitField);
                            }, h = b.prototype.isResolved = function() {
                                return 0 != (50331648 & this._bitField);
                            };
                            b.prototype.isCancelled = function() {
                                return 0 != (8454144 & this._bitField);
                            }, a.prototype.__isCancelled = function() {
                                return 65536 == (65536 & this._bitField);
                            }, a.prototype._isCancelled = function() {
                                return this._target().__isCancelled();
                            }, a.prototype.isCancelled = function() {
                                return 0 != (8454144 & this._target()._bitField);
                            }, a.prototype.isPending = function() {
                                return g.call(this._target());
                            }, a.prototype.isRejected = function() {
                                return f.call(this._target());
                            }, a.prototype.isFulfilled = function() {
                                return e.call(this._target());
                            }, a.prototype.isResolved = function() {
                                return h.call(this._target());
                            }, a.prototype.value = function() {
                                return c.call(this._target());
                            }, a.prototype.reason = function() {
                                var a = this._target();
                                return a._unsetRejectionIsUnhandled(), d.call(a);
                            }, a.prototype._value = function() {
                                return this._settledValue();
                            }, a.prototype._reason = function() {
                                return this._unsetRejectionIsUnhandled(), this._settledValue();
                            }, a.PromiseInspection = b;
                        };
                    }, {} ],
                    33: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c) {
                            function d(a, d) {
                                if (k(a)) {
                                    if (a instanceof b) return a;
                                    var e = f(a);
                                    if (e === j) {
                                        d && d._pushContext();
                                        var i = b.reject(e.e);
                                        return d && d._popContext(), i;
                                    }
                                    if ("function" == typeof e) {
                                        if (g(a)) {
                                            var i = new b(c);
                                            return a._then(i._fulfill, i._reject, void 0, i, null), i;
                                        }
                                        return h(a, e, d);
                                    }
                                }
                                return a;
                            }
                            function e(a) {
                                return a.then;
                            }
                            function f(a) {
                                try {
                                    return e(a);
                                } catch (a) {
                                    return j.e = a, j;
                                }
                            }
                            function g(a) {
                                try {
                                    return l.call(a, "_promise0");
                                } catch (a) {
                                    return !1;
                                }
                            }
                            function h(a, d, e) {
                                function f(a) {
                                    h && (h._resolveCallback(a), h = null);
                                }
                                function g(a) {
                                    h && (h._rejectCallback(a, l, !0), h = null);
                                }
                                var h = new b(c), k = h;
                                e && e._pushContext(), h._captureStackTrace(), e && e._popContext();
                                var l = !0, m = i.tryCatch(d).call(a, f, g);
                                return l = !1, h && m === j && (h._rejectCallback(m.e, !0, !0), h = null), k;
                            }
                            var i = a("./util"), j = i.errorObj, k = i.isObject, l = {}.hasOwnProperty;
                            return d;
                        };
                    }, {
                        "./util": 36
                    } ],
                    34: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.handle = a;
                            }
                            function f(a) {
                                return clearTimeout(this.handle), a;
                            }
                            function g(a) {
                                throw clearTimeout(this.handle), a;
                            }
                            var h = a("./util"), i = b.TimeoutError;
                            e.prototype._resultCancelled = function() {
                                clearTimeout(this.handle);
                            };
                            var j = function(a) {
                                return k(+this).thenReturn(a);
                            }, k = b.delay = function(a, f) {
                                var g, h;
                                return void 0 !== f ? (g = b.resolve(f)._then(j, null, null, a, void 0), d.cancellation() && f instanceof b && g._setOnCancel(f)) : (g = new b(c), 
                                h = setTimeout(function() {
                                    g._fulfill();
                                }, +a), d.cancellation() && g._setOnCancel(new e(h)), g._captureStackTrace()), g._setAsyncGuaranteed(), 
                                g;
                            };
                            b.prototype.delay = function(a) {
                                return k(a, this);
                            };
                            var l = function(a, b, c) {
                                var d;
                                d = "string" != typeof b ? b instanceof Error ? b : new i("operation timed out") : new i(b), 
                                h.markAsOriginatingFromRejection(d), a._attachExtraTrace(d), a._reject(d), null != c && c.cancel();
                            };
                            b.prototype.timeout = function(a, b) {
                                a = +a;
                                var c, h, i = new e(setTimeout(function() {
                                    c.isPending() && l(c, b, h);
                                }, a));
                                return d.cancellation() ? (h = this.then(), c = h._then(f, g, void 0, i, void 0), 
                                c._setOnCancel(i)) : c = this._then(f, g, void 0, i, void 0), c;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    35: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a) {
                                setTimeout(function() {
                                    throw a;
                                }, 0);
                            }
                            function i(a) {
                                var b = d(a);
                                return b !== a && "function" == typeof a._isDisposable && "function" == typeof a._getDisposer && a._isDisposable() && b._setDisposable(a._getDisposer()), 
                                b;
                            }
                            function j(a, c) {
                                function e() {
                                    if (g >= j) return k._fulfill();
                                    var f = i(a[g++]);
                                    if (f instanceof b && f._isDisposable()) {
                                        try {
                                            f = d(f._getDisposer().tryDispose(c), a.promise);
                                        } catch (a) {
                                            return h(a);
                                        }
                                        if (f instanceof b) return f._then(e, h, null, null, null);
                                    }
                                    e();
                                }
                                var g = 0, j = a.length, k = new b(f);
                                return e(), k;
                            }
                            function k(a, b, c) {
                                this._data = a, this._promise = b, this._context = c;
                            }
                            function l(a, b, c) {
                                this.constructor$(a, b, c);
                            }
                            function m(a) {
                                return k.isDisposer(a) ? (this.resources[this.index]._setDisposable(a), a.promise()) : a;
                            }
                            function n(a) {
                                this.length = a, this.promise = null, this[a - 1] = null;
                            }
                            var o = a("./util"), p = a("./errors").TypeError, q = a("./util").inherits, r = o.errorObj, s = o.tryCatch, t = {};
                            k.prototype.data = function() {
                                return this._data;
                            }, k.prototype.promise = function() {
                                return this._promise;
                            }, k.prototype.resource = function() {
                                return this.promise().isFulfilled() ? this.promise().value() : t;
                            }, k.prototype.tryDispose = function(a) {
                                var b = this.resource(), c = this._context;
                                void 0 !== c && c._pushContext();
                                var d = b !== t ? this.doDispose(b, a) : null;
                                return void 0 !== c && c._popContext(), this._promise._unsetDisposable(), this._data = null, 
                                d;
                            }, k.isDisposer = function(a) {
                                return null != a && "function" == typeof a.resource && "function" == typeof a.tryDispose;
                            }, q(l, k), l.prototype.doDispose = function(a, b) {
                                return this.data().call(a, a, b);
                            }, n.prototype._resultCancelled = function() {
                                for (var a = this.length, c = 0; c < a; ++c) {
                                    var d = this[c];
                                    d instanceof b && d.cancel();
                                }
                            }, b.using = function() {
                                var a = arguments.length;
                                if (a < 2) return c("you must pass at least 2 arguments to Promise.using");
                                var e = arguments[a - 1];
                                if ("function" != typeof e) return c("expecting a function but got " + o.classString(e));
                                var f, h = !0;
                                2 === a && Array.isArray(arguments[0]) ? (f = arguments[0], a = f.length, h = !1) : (f = arguments, 
                                a--);
                                for (var i = new n(a), l = 0; l < a; ++l) {
                                    var p = f[l];
                                    if (k.isDisposer(p)) {
                                        var q = p;
                                        p = p.promise(), p._setDisposable(q);
                                    } else {
                                        var t = d(p);
                                        t instanceof b && (p = t._then(m, null, null, {
                                            resources: i,
                                            index: l
                                        }, void 0));
                                    }
                                    i[l] = p;
                                }
                                for (var u = new Array(i.length), l = 0; l < u.length; ++l) u[l] = b.resolve(i[l]).reflect();
                                var v = b.all(u).then(function(a) {
                                    for (var b = 0; b < a.length; ++b) {
                                        var c = a[b];
                                        if (c.isRejected()) return r.e = c.error(), r;
                                        if (!c.isFulfilled()) return void v.cancel();
                                        a[b] = c.value();
                                    }
                                    w._pushContext(), e = s(e);
                                    var d = h ? e.apply(void 0, a) : e(a), f = w._popContext();
                                    return g.checkForgottenReturns(d, f, "Promise.using", w), d;
                                }), w = v.lastly(function() {
                                    var a = new b.PromiseInspection(v);
                                    return j(i, a);
                                });
                                return i.promise = w, w._setOnCancel(i), w;
                            }, b.prototype._setDisposable = function(a) {
                                this._bitField = 131072 | this._bitField, this._disposer = a;
                            }, b.prototype._isDisposable = function() {
                                return (131072 & this._bitField) > 0;
                            }, b.prototype._getDisposer = function() {
                                return this._disposer;
                            }, b.prototype._unsetDisposable = function() {
                                this._bitField = -131073 & this._bitField, this._disposer = void 0;
                            }, b.prototype.disposer = function(a) {
                                if ("function" == typeof a) return new l(a, this, e());
                                throw new p();
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    36: [ function(b, c, e) {
                        "use strict";
                        function f() {
                            try {
                                var a = F;
                                return F = null, a.apply(this, arguments);
                            } catch (a) {
                                return E.e = a, E;
                            }
                        }
                        function g(a) {
                            return F = a, f;
                        }
                        function h(a) {
                            return null == a || !0 === a || !1 === a || "string" == typeof a || "number" == typeof a;
                        }
                        function i(a) {
                            return "function" == typeof a || "object" == typeof a && null !== a;
                        }
                        function j(a) {
                            return h(a) ? new Error(s(a)) : a;
                        }
                        function k(a, b) {
                            var c, d = a.length, e = new Array(d + 1);
                            for (c = 0; c < d; ++c) e[c] = a[c];
                            return e[c] = b, e;
                        }
                        function l(a, b, c) {
                            if (!C.isES5) return {}.hasOwnProperty.call(a, b) ? a[b] : void 0;
                            var d = Object.getOwnPropertyDescriptor(a, b);
                            return null != d ? null == d.get && null == d.set ? d.value : c : void 0;
                        }
                        function m(a, b, c) {
                            if (h(a)) return a;
                            var d = {
                                value: c,
                                configurable: !0,
                                enumerable: !1,
                                writable: !0
                            };
                            return C.defineProperty(a, b, d), a;
                        }
                        function n(a) {
                            throw a;
                        }
                        function o(a) {
                            try {
                                if ("function" == typeof a) {
                                    var b = C.names(a.prototype), c = C.isES5 && b.length > 1, d = b.length > 0 && !(1 === b.length && "constructor" === b[0]), e = J.test(a + "") && C.names(a).length > 0;
                                    if (c || d || e) return !0;
                                }
                                return !1;
                            } catch (a) {
                                return !1;
                            }
                        }
                        function p(a) {
                            function b() {}
                            b.prototype = a;
                            for (var c = 8; c--; ) new b();
                            return a;
                        }
                        function q(a) {
                            return K.test(a);
                        }
                        function r(a, b, c) {
                            for (var d = new Array(a), e = 0; e < a; ++e) d[e] = b + e + c;
                            return d;
                        }
                        function s(a) {
                            try {
                                return a + "";
                            } catch (a) {
                                return "[no string representation]";
                            }
                        }
                        function t(a) {
                            return a instanceof Error || null !== a && "object" == typeof a && "string" == typeof a.message && "string" == typeof a.name;
                        }
                        function u(a) {
                            try {
                                m(a, "isOperational", !0);
                            } catch (a) {}
                        }
                        function v(a) {
                            return null != a && (a instanceof Error.__BluebirdErrorTypes__.OperationalError || !0 === a.isOperational);
                        }
                        function w(a) {
                            return t(a) && C.propertyIsWritable(a, "stack");
                        }
                        function x(a) {
                            return {}.toString.call(a);
                        }
                        function y(a, b, c) {
                            for (var d = C.names(a), e = 0; e < d.length; ++e) {
                                var f = d[e];
                                if (c(f)) try {
                                    C.defineProperty(b, f, C.getDescriptor(a, f));
                                } catch (a) {}
                            }
                        }
                        function z(b) {
                            return P ? a.env[b] : void 0;
                        }
                        function A() {
                            if ("function" == typeof Promise) try {
                                var a = new Promise(function() {});
                                if ("[object Promise]" === {}.toString.call(a)) return Promise;
                            } catch (a) {}
                        }
                        function B(a, b) {
                            return a.bind(b);
                        }
                        var C = b("./es5"), D = "undefined" == typeof navigator, E = {
                            e: {}
                        }, F, G = "undefined" != typeof self ? self : "undefined" != typeof window ? window : void 0 !== d ? d : void 0 !== this ? this : null, H = function(a, b) {
                            function c() {
                                this.constructor = a, this.constructor$ = b;
                                for (var c in b.prototype) d.call(b.prototype, c) && "$" !== c.charAt(c.length - 1) && (this[c + "$"] = b.prototype[c]);
                            }
                            var d = {}.hasOwnProperty;
                            return c.prototype = b.prototype, a.prototype = new c(), a.prototype;
                        }, I = function() {
                            var a = [ Array.prototype, Object.prototype, Function.prototype ], b = function(b) {
                                for (var c = 0; c < a.length; ++c) if (a[c] === b) return !0;
                                return !1;
                            };
                            if (C.isES5) {
                                var c = Object.getOwnPropertyNames;
                                return function(a) {
                                    for (var d = [], e = Object.create(null); null != a && !b(a); ) {
                                        var f;
                                        try {
                                            f = c(a);
                                        } catch (a) {
                                            return d;
                                        }
                                        for (var g = 0; g < f.length; ++g) {
                                            var h = f[g];
                                            if (!e[h]) {
                                                e[h] = !0;
                                                var i = Object.getOwnPropertyDescriptor(a, h);
                                                null != i && null == i.get && null == i.set && d.push(h);
                                            }
                                        }
                                        a = C.getPrototypeOf(a);
                                    }
                                    return d;
                                };
                            }
                            var d = {}.hasOwnProperty;
                            return function(c) {
                                if (b(c)) return [];
                                var e = [];
                                a: for (var f in c) if (d.call(c, f)) e.push(f); else {
                                    for (var g = 0; g < a.length; ++g) if (d.call(a[g], f)) continue a;
                                    e.push(f);
                                }
                                return e;
                            };
                        }(), J = /this\s*\.\s*\S+\s*=/, K = /^[a-z$_][a-z$_0-9]*$/i, L = function() {
                            return "stack" in new Error() ? function(a) {
                                return w(a) ? a : new Error(s(a));
                            } : function(a) {
                                if (w(a)) return a;
                                try {
                                    throw new Error(s(a));
                                } catch (a) {
                                    return a;
                                }
                            };
                        }(), M = function(a) {
                            return C.isArray(a) ? a : null;
                        };
                        if ("undefined" != typeof Symbol && Symbol.iterator) {
                            var N = "function" == typeof Array.from ? function(a) {
                                return Array.from(a);
                            } : function(a) {
                                for (var b, c = [], d = a[Symbol.iterator](); !(b = d.next()).done; ) c.push(b.value);
                                return c;
                            };
                            M = function(a) {
                                return C.isArray(a) ? a : null != a && "function" == typeof a[Symbol.iterator] ? N(a) : null;
                            };
                        }
                        var O = void 0 !== a && "[object process]" === x(a).toLowerCase(), P = void 0 !== a && void 0 !== a.env, Q = {
                            isClass: o,
                            isIdentifier: q,
                            inheritedDataKeys: I,
                            getDataPropertyOrDefault: l,
                            thrower: n,
                            isArray: C.isArray,
                            asArray: M,
                            notEnumerableProp: m,
                            isPrimitive: h,
                            isObject: i,
                            isError: t,
                            canEvaluate: D,
                            errorObj: E,
                            tryCatch: g,
                            inherits: H,
                            withAppended: k,
                            maybeWrapAsError: j,
                            toFastProperties: p,
                            filledRange: r,
                            toString: s,
                            canAttachTrace: w,
                            ensureErrorObject: L,
                            originatesFromRejection: v,
                            markAsOriginatingFromRejection: u,
                            classString: x,
                            copyDescriptors: y,
                            hasDevTools: "undefined" != typeof chrome && chrome && "function" == typeof chrome.loadTimes,
                            isNode: O,
                            hasEnvVariables: P,
                            env: z,
                            global: G,
                            getNativePromise: A,
                            domainBind: B
                        };
                        Q.isRecentNode = Q.isNode && function() {
                            var b = a.versions.node.split(".").map(Number);
                            return 0 === b[0] && b[1] > 10 || b[0] > 0;
                        }(), Q.isNode && Q.toFastProperties(a);
                        try {
                            throw new Error();
                        } catch (a) {
                            Q.lastLineError = a;
                        }
                        c.exports = Q;
                    }, {
                        "./es5": 13
                    } ]
                }, {}, [ 4 ])(4);
            }), "undefined" != typeof window && null !== window ? window.P = window.Promise : "undefined" != typeof self && null !== self && (self.P = self.Promise);
        }).call(this, a("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {
        _process: 15
    } ],
    2: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PreCallTest = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./turnConnection"), g = a("./tests/rttTest"), h = a("./tests/throughputTest"), i = a("./utility/resultsHandler"), j = a("./utility/onlineCheck"), k = a("./utility/stats/detectbrowser"), l = a("bluebird"), m = {
            RTT: "rtt",
            THROUGHPUT: "throughput"
        }, n = function() {
            function a() {
                d(this, a), this.browserInfo = (0, k.detect)(), this.turnConnection = new f.TurnConnection(this.browserInfo), 
                this.onlineCheck = new j.OnlineCheck(), this.callsInProgress = 0, this.turnTests = [ m.RTT, m.THROUGHPUT ], 
                this.active = !1, this.rtt = null, this.resultsHandler = null;
            }
            return e(a, [ {
                key: "start",
                value: function(a, b) {
                    if (this.browserInfo.browserName !== k.Constants.browserName.msie) if (this.iceServers = a, 
                    this.callback = b, this.active) this.callback && this.callback(null, "Not started: already in progress"); else if (this.callsInProgress > 0) this.callback && this.callback(null, "Not started: call in progress"); else if (a) {
                        this.turnTestCounter = 0, this.resultsHandler = new i.ResultsHandler();
                        var c = {
                            type: "browser",
                            os: this.browserInfo.os,
                            osVersion: this.browserInfo.osVersion,
                            buildName: this.browserInfo.browserName,
                            buildVersion: this.browserInfo.browserVersion
                        };
                        this.resultsHandler.add("endpointInfo", c), this.onlineCheck.start(), this.active = !0, 
                        this._start();
                    } else this.callback && this.callback(null, "Not started: no ICE servers given"); else this.callback && this.callback(null, "Not started: disabled for IE");
                }
            }, {
                key: "_start",
                value: function() {
                    var a = this;
                    this.active && this.turnConnection.connect(this.iceServers).then(function() {
                        a.active ? a.startTurnTests().then(function() {
                            a.stop();
                        }, function(b) {
                            a.stop();
                        }) : a.stop();
                    }, function(b) {
                        var c = b.continueFlag;
                        if (a.resultsHandler.failure(b), !c) {
                            a.turnConnection.disconnect(), a.active = !1;
                            var d = "";
                            try {
                                d = b.stack;
                            } catch (a) {
                                d = b.toString();
                            }
                            return d && "" !== d || (d = b.toString()), void a.callback(null, d);
                        }
                        a.resultsHandler.getFailureNumber() >= 10 ? a.stop() : (a.turnConnection.disconnect(), 
                        setTimeout(function() {
                            a._start();
                        }, 0));
                    });
                }
            }, {
                key: "stop",
                value: function() {
                    var a = this;
                    if (this.browserInfo.browserName !== k.Constants.browserName.msie && this.active) {
                        this.active = !1, this.activeTurnTest && this.activeTurnTest.forceStop();
                        var b = this.onlineCheck.stop();
                        this.resultsHandler && this.resultsHandler.add("onlineStatus", b), this.turnConnection.getIceResults().then(function(b) {
                            a.resultsHandler && a.resultsHandler.add("ice", b), a.turnConnection.disconnect(), 
                            a.sendResults();
                        }, function(b) {
                            a.resultsHandler && a.resultsHandler.failure(b), a.turnConnection.disconnect(), 
                            a.sendResults();
                        });
                    }
                }
            }, {
                key: "sendResults",
                value: function() {
                    this.resultsHandler || this.callback && this.callback(null, "No results present");
                    var a = this.resultsHandler.getResults();
                    this.callback && this.callback(a, null), this.resultsHandler = null;
                }
            }, {
                key: "callStarts",
                value: function() {
                    this.callsInProgress += 1, this.stop();
                }
            }, {
                key: "callFinished",
                value: function() {
                    this.callsInProgress -= 1;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.resultsHandler ? this.resultsHandler.getId() : null;
                }
            }, {
                key: "crashDisconnect",
                value: function() {
                    try {
                        this.turnConnection.disconnect();
                    } catch (a) {}
                }
            }, {
                key: "startTurnTests",
                value: function() {
                    var a = this;
                    if (this.turnTestCounter >= this.turnTests.length) return new l(function(a, b) {
                        a();
                    });
                    var b = this.turnTests[this.turnTestCounter], c = null;
                    switch (b) {
                      case m.RTT:
                        c = new g.RttTest(this.turnConnection);
                        break;

                      case m.THROUGHPUT:
                        c = new h.ThroughputTest(this.turnConnection, this.rtt);
                        break;

                      default:
                        return new l(function(a, c) {
                            c(new Error("Unknown test: " + b));
                        });
                    }
                    return this.activeTurnTest = c, this.active ? c.start().then(function() {
                        return a.handleTestResults(b, c.getResults()), a.turnTestCounter += 1, a.activeTurnTest = null, 
                        a.startTurnTests();
                    }, function(d) {
                        return a.handleTestResults(b, c.getResults(), d), a.turnTestCounter += 1, a.activeTurnTest = null, 
                        a.startTurnTests();
                    }) : new l(function(a, b) {
                        b(new Error("Test trying to start while testing is not active"));
                    });
                }
            }, {
                key: "handleTestResults",
                value: function(a, b) {
                    null == (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null) && a == m.RTT && (this.rtt = b.median), 
                    this.resultsHandler && this.resultsHandler.add(a, b);
                }
            } ]), a;
        }();
        c.PreCallTest = n;
    }, {
        "./tests/rttTest": 3,
        "./tests/throughputTest": 4,
        "./turnConnection": 6,
        "./utility/onlineCheck": 8,
        "./utility/resultsHandler": 10,
        "./utility/stats/detectbrowser": 11,
        bluebird: 1
    } ],
    3: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RttTest = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            return void 0 !== g ? g.call(d) : void 0;
        }, i = a("../utility/timestamps"), j = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(i), k = a("./turnTest"), l = function(a) {
            function b(a) {
                d(this, b);
                var c = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));
                return c.sendTimer = null, c.countSent = 0, c.rtts = [], c;
            }
            return f(b, k.TurnTest), g(b, [ {
                key: "initiate",
                value: function() {
                    this.results.startTimestamp = j.getCurrent(), this.sendPing();
                }
            }, {
                key: "handleMessage",
                value: function(a) {
                    if (this.isActive()) {
                        var b = parseInt(a, 10), c = this.calculateRtt(b);
                        this.rtts.push(c), this.countSent < 10 ? this.sendPing() : this.calculateMetrics();
                    }
                }
            }, {
                key: "handleError",
                value: function(a) {
                    this.fillResults(), this.failed(a);
                }
            }, {
                key: "sendPing",
                value: function() {
                    if (this.isActive()) {
                        var a = j.getCurrent();
                        this.send(a.toString()), this.countSent += 1, this.sendTimer && (clearTimeout(this.sendTimer), 
                        this.sendTimer = null), this.countSent < 10 ? this.sendTimer = setTimeout(this.sendPing.bind(this), 100) : this.sendTimer = setTimeout(this.calculateMetrics.bind(this), 500);
                    }
                }
            }, {
                key: "calculateRtt",
                value: function(a) {
                    return j.getCurrent() - a;
                }
            }, {
                key: "calculateMetrics",
                value: function() {
                    this.sendTimer && (clearTimeout(this.sendTimer), this.sendTimer = null), this.fillResults(), 
                    this.finished();
                }
            }, {
                key: "fillResults",
                value: function() {
                    this.results.sentMessages = this.countSent, this.results.unAckedMessages = this.countSent - this.rtts.length, 
                    this.results.maxMessages = 10, this.results.forceStopped = this.forceStopped, this.results.median = this.median(), 
                    this.results.variance = this.variance(), this.results.endTimestamp = j.getCurrent();
                }
            }, {
                key: "median",
                value: function() {
                    if (0 == this.rtts.length) return null;
                    this.rtts.sort();
                    var a = Math.floor(this.rtts.length / 2);
                    return this.rtts[a];
                }
            }, {
                key: "variance",
                value: function() {
                    if (0 == this.rtts.length) return null;
                    for (var a = 0, b = this.median(), c = 0; c < this.rtts.length; c++) {
                        var d = this.rtts[c];
                        a += Math.abs(d - b);
                    }
                    return a /= this.rtts.length;
                }
            }, {
                key: "stop",
                value: function() {
                    this.isActive() && (h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), 
                    this.fillResults());
                }
            } ]), b;
        }();
        c.RttTest = l;
    }, {
        "../utility/timestamps": 14,
        "./turnTest": 5
    } ],
    4: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ThroughputTest = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            return void 0 !== g ? g.call(d) : void 0;
        }, i = a("../utility/timestamps"), j = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(i), k = a("../utility/messageMaker"), l = a("./turnTest"), m = function(a) {
            function b(a, c) {
                d(this, b);
                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));
                if (f.sentBytes = 0, f.receivedBytes = 0, f.secondHalfBytes = 0, f.secondHalfStart = null, 
                f.bufferEmpty = 0, f.chunkSize = 1200, f.messageMaker = new k.MessageMaker(f.chunkSize), 
                f.duration = 5e3, null != c) {
                    var g = 50 * c;
                    f.duration = Math.max(Math.min(g, 1e4), 1e3);
                }
                return f.sendTimer = null, f.lastMessage = null, f.intervals = [], f.intervalStart = 0, 
                f.intervalLength = 100, f.intervalBytes = 0, f;
            }
            return f(b, l.TurnTest), g(b, [ {
                key: "initiate",
                value: function() {
                    if (window && window.csioReactNative) {
                        this.handleError(new Error("Not running throughput test for react-native"));
                    } else this.startSend();
                }
            }, {
                key: "handleMessage",
                value: function(a) {
                    var b = this;
                    if (this.isActive()) {
                        this.lastMessage = a, this.receivedBytes += a.length;
                        var c = j.getCurrent();
                        if (this.sendTimer || (this.results.startTimestamp = c, this.sendTimer = setTimeout(function() {
                            b.stop(), b.finished();
                        }, this.duration)), 0 == this.intervalStart && (this.intervalStart = c), this.intervalBytes += a.length, 
                        c - this.intervalStart >= this.intervalLength) {
                            var d = c - this.intervalStart, e = this.averageThroughput(this.intervalBytes, d), f = null;
                            try {
                                f = c - JSON.parse(this.lastMessage).timestamp;
                            } catch (a) {}
                            this.intervals.push({
                                startTimestamp: this.intervalStart,
                                endTimestamp: c,
                                bytesReceived: this.intervalBytes,
                                average: e,
                                rtt: f
                            }), this.intervalStart = c, this.intervalBytes = 0;
                        }
                        this.results.startTimestamp && c - this.results.startTimestamp > this.duration / 2 && (this.secondHalfStart || (this.secondHalfStart = c), 
                        this.secondHalfBytes += a.length);
                    }
                }
            }, {
                key: "handleError",
                value: function(a) {
                    this.stop(), this.failed(a);
                }
            }, {
                key: "averageThroughput",
                value: function(a, b) {
                    return a / (b / 1e3) * 8 / 1024;
                }
            }, {
                key: "bufferListener",
                value: function() {
                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this)), 
                    this.fillBuffer();
                }
            }, {
                key: "fillBuffer",
                value: function() {
                    for (0 == this.sendChannel.bufferedAmount && (this.bufferEmpty += 1); this.isActive(); ) {
                        if (this.sendChannel.bufferedAmount > this.bufferFullThreshold) return void (this.usePolling ? setTimeout(this.fillBuffer.bind(this), 250) : this.sendChannel.addEventListener("bufferedamountlow", this.bufferListener.bind(this)));
                        var a = this.messageMaker.make(this.sentBytes);
                        this.sentBytes += a.length, this.send(a);
                    }
                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this));
                }
            }, {
                key: "startSend",
                value: function() {
                    this.isActive() && (this.bufferFullThreshold = 1e3 * this.chunkSize, this.sendChannel = this.connection.sendChannel, 
                    this.usePolling = !0, "number" == typeof this.sendChannel.bufferedAmountLowThreshold && (this.usePolling = !1, 
                    this.sendChannel.bufferedAmountLowThreshold = this.bufferFullThreshold / 10), setTimeout(this.fillBuffer.bind(this), 0));
                }
            }, {
                key: "fillResults",
                value: function() {
                    this.results.endTimestamp = j.getCurrent(), this.results.maxDuration = this.duration, 
                    this.results.forceStopped = this.forceStopped, this.results.bufferEmpty = this.bufferEmpty, 
                    this.results.intervals = this.intervals, this.results.bytesPrepared = this.sentBytes, 
                    this.results.bytesReceived = this.receivedBytes;
                    var a = 0, b = 0;
                    this.secondHalfStart && (a = this.results.endTimestamp - this.secondHalfStart, b = this.averageThroughput(this.secondHalfBytes, a));
                    var c = this.results.endTimestamp - this.results.startTimestamp, d = this.averageThroughput(this.receivedBytes, c);
                    d > b && (b = d), this.results.average = b;
                    var e = null;
                    try {
                        e = JSON.parse(this.lastMessage);
                    } catch (a) {
                        return;
                    }
                    if (e) {
                        var f = e.sentBytes + this.lastMessage.length;
                        this.results.bytesSent = f, this.results.fractionLostBytes = 1 - this.receivedBytes / f;
                    } else this.results.bytesSent = -1, this.results.fractionLostBytes = -1;
                }
            }, {
                key: "stop",
                value: function() {
                    this.isActive() && (clearTimeout(this.sendTimer), this.sendTimer = null, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), 
                    this.fillResults());
                }
            } ]), b;
        }();
        c.ThroughputTest = m;
    }, {
        "../utility/messageMaker": 7,
        "../utility/timestamps": 14,
        "./turnTest": 5
    } ],
    5: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("bluebird"), g = function() {
            function a(b) {
                d(this, a), this.connection = b, this.active = !1, this.results = {};
            }
            return e(a, [ {
                key: "getResults",
                value: function() {
                    return this.results;
                }
            }, {
                key: "start",
                value: function() {
                    var a = this, b = new f(function(b, c) {
                        a.resolveCb = b, a.rejectCb = c;
                    });
                    return this.connection.setMessageCallback(this.handleMessage.bind(this)), this.connection.setErrorCallback(this.handleError.bind(this)), 
                    this.active = !0, this.forceStopped = !1, this.initiate(), b;
                }
            }, {
                key: "stop",
                value: function() {
                    this.active = !1;
                }
            }, {
                key: "forceStop",
                value: function() {
                    this.forceStopped = !0, this.stop(), this.finished();
                }
            }, {
                key: "isActive",
                value: function() {
                    return this.active;
                }
            }, {
                key: "initiate",
                value: function() {}
            }, {
                key: "handleMessage",
                value: function(a) {}
            }, {
                key: "handleError",
                value: function(a) {}
            }, {
                key: "send",
                value: function(a) {
                    this.connection.send(a);
                }
            }, {
                key: "finished",
                value: function() {
                    this.active = !1, this.resolveCb && (this.resolveCb(), this.resolveCb = null);
                }
            }, {
                key: "failed",
                value: function(a) {
                    this.active = !1, this.rejectCb && (this.rejectCb(a), this.rejectCb = null);
                }
            } ]), a;
        }();
        c.TurnTest = g;
    }, {
        bluebird: 1
    } ],
    6: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TurnConnection = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./utility/parsedIceCandidate"), g = a("./utility/stats/getstatshandler"), h = a("./utility/stats/detectbrowser"), i = a("bluebird"), j = function() {
            function a(b) {
                d(this, a), this.reset(), this.statshandler = new g.GetStatsHandler(b);
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.disconnect(), this.iceServers = null, this.pctpc1 = null, this.pctpc2 = null, 
                    this.sendChannel = null, this.messageCallback = null, this.errorCallback = null, 
                    this.parsedIceResults = {}, this.resolveCb = null, this.rejectCb = null;
                }
            }, {
                key: "setMessageCallback",
                value: function(a) {
                    this.messageCallback = a;
                }
            }, {
                key: "setErrorCallback",
                value: function(a) {
                    this.errorCallback = a;
                }
            }, {
                key: "send",
                value: function(a) {
                    if (this.sendChannel) try {
                        this.sendChannel.send(a);
                    } catch (a) {
                        this.raiseSendError(a);
                    } else this.raiseSendError(new Error("No send channel"));
                }
            }, {
                key: "raiseSendError",
                value: function(a) {
                    this.errorCallback && this.errorCallback(a);
                }
            }, {
                key: "assignEvent",
                value: function(a, b, c) {
                    a.addEventListener ? a.addEventListener(b, c.bind(this), !1) : a.attachEvent && (b = "on" + b, 
                    a.attachEvent(b, c.bind(this)));
                }
            }, {
                key: "connect",
                value: function(a) {
                    var b = this;
                    this.reset();
                    var c = new i(function(a, c) {
                        b.resolveCb = a, b.rejectCb = c;
                    });
                    this.iceServers = a;
                    var d = null;
                    try {
                        if (RTCPeerConnection ? d = RTCPeerConnection : webkitRTCPeerConnection ? d = webkitRTCPeerConnection : mozRTCPeerConnection ? d = mozRTCPeerConnection : window && window.RTCPeerConnection && (d = window.RTCPeerConnection), 
                        !d) {
                            var e = new Error("RTCPeerConnection not found");
                            return e.continueFlag = !1, this.rejectCb(e), c;
                        }
                    } catch (e) {
                        return e.continueFlag = !1, this.rejectCb(e), c;
                    }
                    var f = {
                        ordered: !1,
                        maxRetransmits: 0
                    }, g = {
                        iceTransportPolicy: "all",
                        iceServers: this.iceServers
                    };
                    try {
                        this.pctpc1 = new d(g), this.pctpc2 = new d(g);
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    this.connectionTimer = setTimeout(function() {
                        delete b.connectionTimer, b.rejectDisconnect(!1, new Error("Connection timeout"));
                    }, 3e4);
                    try {
                        this.sendChannel = this.pctpc1.createDataChannel("precalltest", f), this.sendChannel.binaryType = "arraybuffer", 
                        this.assignEvent(this.sendChannel, "error", function(a) {
                            b.raiseSendError(a), b.rejectDisconnect(!0, a);
                        }), this.assignEvent(this.pctpc2, "datachannel", function(a) {
                            var c = a.channel;
                            b.assignEvent(c, "open", function(a) {
                                b.resolveCb && (b.resolveCb(), b.resolveCb = null);
                            }), b.assignEvent(c, "close", function(a) {
                                b && b.disconnect && b.disconnect();
                            }), b.assignEvent(c, "message", function(a) {
                                b.messageCallback && b.messageCallback(a.data);
                            }), b.assignEvent(c, "error", function(a) {
                                b.errorCallback && b.errorCallback(a), b.rejectDisconnect(!0, a);
                            });
                        });
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    try {
                        this.assignEvent(this.pctpc1, "icecandidate", function(a) {
                            b.onIceCandidate(b.pctpc1, a);
                        }), this.assignEvent(this.pctpc1, "iceconnectionstatechange", function(a) {
                            b.onIceStateChange(b.pctpc1, a);
                        }), this.assignEvent(this.pctpc2, "icecandidate", function(a) {
                            b.onIceCandidate(b.pctpc2, a);
                        }), this.assignEvent(this.pctpc2, "iceconnectionstatechange", function(a) {
                            b.onIceStateChange(b.pctpc2, a);
                        }), this.pctpc1.createOffer().then(function(a, c) {
                            b.onCreateOfferSuccess(a);
                        }, function(a) {
                            b.onCreateOfferError(b.pctpc1, a);
                        });
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    return c;
                }
            }, {
                key: "rejectDisconnect",
                value: function(a, b) {
                    this.disconnect(), this.rejectCb && (b.continueFlag = a, this.rejectCb(b)), this.resolveCb = null, 
                    this.rejectCb = null;
                }
            }, {
                key: "disconnect",
                value: function() {
                    if (clearTimeout(this.connectionTimer), clearTimeout(this.iceTimer), this.pctpc1) try {
                        this.pctpc1.close();
                    } catch (a) {}
                    if (this.pctpc1 = null, this.pctpc2) try {
                        this.pctpc2.close();
                    } catch (a) {}
                    this.pctpc2 = null;
                }
            }, {
                key: "getName",
                value: function(a) {
                    return a === this.pctpc1 ? "pctpc1" : "pctpc2";
                }
            }, {
                key: "getOtherPc",
                value: function(a) {
                    return a === this.pctpc1 ? this.pctpc2 : this.pctpc1;
                }
            }, {
                key: "onCreateOfferError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateAnswerError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateOfferSuccess",
                value: function(a) {
                    var b = this;
                    try {
                        this.pctpc1.setLocalDescription(a).then(function() {
                            b.onSetLocalSuccess(b.pctpc1);
                        }, function(a) {
                            b.onSetSessionDescriptionError(b.pctpc1, a);
                        }), this.pctpc2.setRemoteDescription(a).then(function() {
                            b.onSetRemoteSuccess(b.pctpc2);
                        }, function(a) {
                            b.onSetRemoteSessionDescriptionError(b.pctpc2, a);
                        }), this.pctpc2.createAnswer().then(function(a) {
                            b.onCreateAnswerSuccess(a);
                        }, function(a) {
                            b.onCreateAnswerError(b.pctpc2, a);
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onSetLocalSuccess",
                value: function(a) {}
            }, {
                key: "onSetRemoteSuccess",
                value: function(a) {}
            }, {
                key: "onSetSessionDescriptionError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onSetRemoteSessionDescriptionError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateAnswerSuccess",
                value: function(a) {
                    var b = this;
                    try {
                        this.pctpc2.setLocalDescription(a).then(function() {
                            b.onSetLocalSuccess(b.pctpc2);
                        }, function(a) {
                            b.onSetSessionDescriptionError(b.pctpc2, a);
                        }), this.pctpc1.setRemoteDescription(a).then(function() {
                            b.onSetRemoteSuccess(b.pctpc1);
                        }, function(a) {
                            b.onSetRemoteSessionDescriptionError(b.pctpc1, a);
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onIceCandidate",
                value: function(a, b) {
                    var c = this;
                    try {
                        if (!b.candidate) return;
                        var d = new f.ParsedIceCandidate(b.candidate);
                        if (a == this.pctpc1 && this.statshandler.codeBase == h.Constants.codeBaseType.chrome && (d.isRelay() && (d.isTypeTransportUdp() && (this.parsedIceResults.relayUdpGathered = !0), 
                        d.isTypeTransportTcp() && (this.parsedIceResults.relayTcpGathered = !0), d.isTypeTransportTls() && (this.parsedIceResults.relayTlsGathered = !0)), 
                        d.isServerReflexive() && (this.parsedIceResults.srflxGathered = !0)), !d.isRelay()) return;
                        this.getOtherPc(a).addIceCandidate(b.candidate).then(function() {
                            c.onAddIceCandidateSuccess(a);
                        }, function(b) {
                            c.onAddIceCandidateError(a, b, d.isRelay());
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onAddIceCandidateSuccess",
                value: function(a) {}
            }, {
                key: "onAddIceCandidateError",
                value: function(a, b, c) {
                    c && this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onIceStateChange",
                value: function(a, b) {
                    var c = this;
                    try {
                        var d = "(?)";
                        a && (d = a.iceConnectionState), "failed" === d && this.rejectDisconnect(!0, new Error("ICE failure")), 
                        "checking" !== d || this.iceTimer || (this.iceTimer = setTimeout(function() {
                            delete c.iceTimer, c.rejectDisconnect(!0, new Error("ICE timeout"));
                        }, 1e4)), "completed" !== d && "connected" !== d || (clearTimeout(this.iceTimer), 
                        delete this.iceTimer);
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "getIceResults",
                value: function() {
                    var a = this;
                    return new i(function(b, c) {
                        for (var d = JSON.parse(JSON.stringify(a.iceServers)), e = 0; e < d.length; e++) {
                            var f = d[e];
                            d.hasOwnProperty(f) || delete f.credential;
                        }
                        var g = {
                            turnIpAddress: "",
                            turnIpVersion: "",
                            turnTransport: "",
                            iceServers: d,
                            ipv6Supported: !1,
                            ipv4Supported: !1,
                            relayTlsGathered: !1,
                            relayTcpGathered: !1,
                            relayUdpGathered: !1,
                            srflxGathered: !1,
                            relayTlsSuccess: !1,
                            relayTcpSuccess: !1,
                            relayUdpSuccess: !1,
                            srflxSuccess: !1
                        };
                        for (var h in a.parsedIceResults) a.parsedIceResults.hasOwnProperty(h) && (g[h] = a.parsedIceResults[h]);
                        a.pctpc1 ? a.statshandler.getIceCandidates(a.pctpc1).then(function(a) {
                            for (var c = 0; c < a.iceCandidatePairs.length; c++) {
                                var d = a.iceCandidatePairs[c];
                                if (d.googActiveConnection || d.selected) for (var e = 0; e < a.localCandidates.length; e++) {
                                    var f = a.localCandidates[e], h = null;
                                    if (h = f.ip ? f.ip : f.ipAddress, f.id == d.localCandidateId) {
                                        g.turnIpAddress = h;
                                        var i = -1 !== h.indexOf(":");
                                        g.turnIpVersion = i ? "ipv6" : "ipv4", g.turnTransport = f.mozLocalTransport;
                                    }
                                    "relay" !== f.candidateType && "relayed" !== f.candidateType || ("udp" === f.mozLocalTransport && (g.relayUdpSuccess = !0), 
                                    "tcp" === f.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === f.mozLocalTransport && (g.relayTlsSuccess = !0)), 
                                    -1 !== h.indexOf(":") ? g.ipv6Supported = !0 : g.ipv4Supported = !0;
                                }
                            }
                            for (var j = 0; j < a.localCandidates.length; j++) {
                                var k = a.localCandidates[j];
                                "relay" !== k.candidateType && "relayed" !== k.candidateType || ("udp" === k.mozLocalTransport && (g.relayUdpGathered = !0), 
                                "tcp" === k.mozLocalTransport && (g.relayTcpGathered = !0), "tls" === k.mozLocalTransport && (g.relayTlsGathered = !0)), 
                                "srflx" !== k.candidateType && "serverreflexive" !== k.candidateType || (g.srflxGathered = !0);
                            }
                            for (var l = 0; l < a.iceCandidatePairs.length; l++) {
                                var m = a.iceCandidatePairs[l];
                                if ("succeeded" === m.state) for (var n = 0; n < a.localCandidates.length; n++) {
                                    var o = a.localCandidates[n];
                                    o.id == m.localCandidateId && ("relay" !== o.candidateType && "relayed" !== o.candidateType || ("udp" === o.mozLocalTransport && (g.relayUdpSuccess = !0), 
                                    "tcp" === o.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === o.mozLocalTransport && (g.relayTlsSuccess = !0)), 
                                    "srflx" !== o.candidateType && "serverreflexive" !== o.candidateType || (g.srflxSuccess = !0));
                                }
                            }
                            b(g);
                        }, function(a) {
                            c(a);
                        }) : c(new Error("PC not available for stats"));
                    }, function(a) {
                        reject(a);
                    });
                }
            } ]), a;
        }();
        c.TurnConnection = j;
    }, {
        "./utility/parsedIceCandidate": 9,
        "./utility/stats/detectbrowser": 11,
        "./utility/stats/getstatshandler": 12,
        bluebird: 1
    } ],
    7: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a) {
            for (var b = "", c = 0; c < a; c++) b += String.fromCharCode(35 + 58 * Math.random());
            return b;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.randomAsciiString = c.MessageMaker = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1200;
                d(this, a), this.message = {
                    timestamp: "",
                    sentBytes: 1e4,
                    padding: ""
                };
                var c = e(b - h.getCurrent().toString().length - JSON.stringify(this.message).length);
                this.message.padding = c;
            }
            return f(a, [ {
                key: "make",
                value: function(a) {
                    return this.message.timestamp = h.getCurrent(), this.message.sentBytes = a, JSON.stringify(this.message);
                }
            } ]), a;
        }();
        c.MessageMaker = i, c.randomAsciiString = e;
    }, {
        "../utility/timestamps": 14
    } ],
    8: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.OnlineCheck = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./timestamps"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a() {
                d(this, a), this.active = !1;
            }
            return e(a, [ {
                key: "start",
                value: function() {
                    var a = this;
                    this.active = !0, this.onlineCheck = [], window && window.addEventListener && "function" == typeof window.addEventListener && (window.addEventListener("offline", function() {
                        a.addEntry();
                    }), window.addEventListener("online", function() {
                        a.addEntry();
                    }), this.addEntry());
                }
            }, {
                key: "addEntry",
                value: function() {
                    if (this.active) {
                        var a = g.getCurrent();
                        if (navigator && navigator.onLine) {
                            var b = navigator.onLine;
                            this.onlineCheck.push({
                                timestamp: a,
                                online: b
                            });
                        }
                    }
                }
            }, {
                key: "stop",
                value: function() {
                    var a = this;
                    return this.active = !1, window && window.removeEventListener && "function" == typeof window.removeEventListener && (window.removeEventListener("offline", function() {
                        a.addEntry();
                    }), window.removeEventListener("online", function() {
                        a.addEntry();
                    })), this.onlineCheck;
                }
            } ]), a;
        }();
        c.OnlineCheck = h;
    }, {
        "./timestamps": 14
    } ],
    9: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                d(this, a), this.iceCandidateStr = b.candidate, this.parse();
            }
            return e(a, [ {
                key: "parse",
                value: function() {
                    var a = this.iceCandidateStr.split(" ");
                    a.length < 8 || (this.protocol = "1" === a[1] ? "rtp" : "rtcp", this.transport = a[2], 
                    this.typeTransport = this.extractTypeTransport(a[3]), this.ipv6 = -1 !== a[4].indexOf(":"), 
                    this.ipAddress = a[4], this.port = a[5], this.type = a[7]);
                }
            }, {
                key: "extractTypeTransport",
                value: function(a) {
                    var b = "None", c = a >> 24;
                    if ("rtp" === this.protocol && c >= 0 && c <= 2) switch (c) {
                      case 0:
                        b = "TLS";
                        break;

                      case 1:
                        b = "TCP";
                        break;

                      case 2:
                        b = "UDP";
                    }
                    return b;
                }
            }, {
                key: "getString",
                value: function() {
                    return this.iceCandidateStr;
                }
            }, {
                key: "getType",
                value: function() {
                    return this.type;
                }
            }, {
                key: "isHost",
                value: function() {
                    return "host" === this.type.toLowerCase();
                }
            }, {
                key: "isServerReflexive",
                value: function() {
                    return "srflx" === this.type.toLowerCase();
                }
            }, {
                key: "isPeerReflexive",
                value: function() {
                    return "prflx" === this.type.toLowerCase();
                }
            }, {
                key: "isRelay",
                value: function() {
                    return "relay" === this.type.toLowerCase() || "relayed" === this.type.toLowerCase();
                }
            }, {
                key: "getTypeTransport",
                value: function() {
                    return this.typeTransport;
                }
            }, {
                key: "isTypeTransportUdp",
                value: function() {
                    return "UDP" === this.typeTransport;
                }
            }, {
                key: "isTypeTransportTcp",
                value: function() {
                    return "TCP" === this.typeTransport;
                }
            }, {
                key: "isTypeTransportTls",
                value: function() {
                    return "TLS" === this.typeTransport;
                }
            }, {
                key: "getTransport",
                value: function() {
                    return this.transport;
                }
            }, {
                key: "isUdp",
                value: function() {
                    return "udp" === this.transport.toLowerCase();
                }
            }, {
                key: "isTcp",
                value: function() {
                    return "tcp" === this.transport.toLowerCase();
                }
            }, {
                key: "getProtocol",
                value: function() {
                    return this.protocol;
                }
            }, {
                key: "isRtp",
                value: function() {
                    return "rtp" === this.protocol;
                }
            }, {
                key: "isRtcp",
                value: function() {
                    return "rtcp" === this.protocol;
                }
            }, {
                key: "isIpv6",
                value: function() {
                    return this.ipv6;
                }
            }, {
                key: "getIpAddress",
                value: function() {
                    return this.ipAddress;
                }
            }, {
                key: "getPort",
                value: function() {
                    return this.port;
                }
            } ]), a;
        }();
        c.ParsedIceCandidate = f;
    }, {} ],
    10: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ResultsHandler = void 0;
        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = a("./messageMaker"), j = function() {
            function a() {
                d(this, a), this.start = h.getCurrent(), this.id = Math.trunc(this.start) + "-" + (0, 
                i.randomAsciiString)(20), this.version = "1.2.0", this.failures = [], this.results = {}, 
                this.forceStopped = !1;
            }
            return f(a, [ {
                key: "getResults",
                value: function() {
                    return {
                        id: this.id,
                        version: this.version,
                        forceStopped: this.forceStopped,
                        startTimestamp: this.start,
                        endTimestamp: h.getCurrent(),
                        failures: this.failures,
                        tests: this.results
                    };
                }
            }, {
                key: "getFailureNumber",
                value: function() {
                    return this.failures.length;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.id;
                }
            }, {
                key: "add",
                value: function(a, b) {
                    this.results[a] = b, b.forceStopped && !0 === b.forceStopped && (this.forceStopped = !0);
                }
            }, {
                key: "failure",
                value: function(a) {
                    "object" === (void 0 === a ? "undefined" : e(a)) && (a = a.toString());
                    var b = {
                        timestamp: h.getCurrent(),
                        reason: a
                    };
                    this.failures.push(b);
                }
            } ]), a;
        }();
        c.ResultsHandler = j;
    }, {
        "./messageMaker": 7,
        "./timestamps": 14
    } ],
    11: [ function(a, b, c) {
        "use strict";
        function d() {
            var a = e.browserName.chrome, b = null, c = null, d = null, f = e.codeBaseType.chrome;
            if (window && (!window.navigator || !window.navigator.userAgent || window.csioReactNative)) return window && window.csioGetOsName && (b = window.csioGetOsName()), 
            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), 
            {
                browserName: a,
                codeBase: f,
                os: b,
                osVersion: c,
                userAgent: d
            };
            var g = (d = navigator.userAgent).toLowerCase(), h = navigator.appVersion, i = "" + parseFloat(navigator.appVersion), j = void 0;
            -1 !== (j = g.indexOf("opera")) ? (a = e.browserName.opera, i = g.substring(j + 6), 
            -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("opr")) ? (a = e.browserName.opera, 
            i = g.substring(j + 4), -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), 
            f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("msie")) ? (a = e.browserName.msie, 
            i = g.substring(j + 5), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("edge")) ? (a = e.browserName.edge, 
            i = g.substring(j + 5), f = e.codeBaseType.edge) : -1 !== (j = g.indexOf("chrome")) ? (a = e.browserName.chrome, 
            i = g.substring(j + 7), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("safari")) ? (a = e.browserName.safari, 
            i = g.substring(j + 7), -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), 
            f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("firefox")) ? (a = e.browserName.firefox, 
            i = g.substring(j + 8), f = e.codeBaseType.firefox) : -1 !== (j = g.indexOf("trident")) && (a = e.browserName.msie, 
            j = g.indexOf("rv"), i = g.substring(j + 3, j + 7), f = e.codeBaseType.chrome);
            var k = [ {
                s: "Windows 3.11",
                r: /win16/
            }, {
                s: "Windows 95",
                r: /(windows 95|win95|windows_95)/
            }, {
                s: "Windows ME",
                r: /(win 9x 4.90|windows me)/
            }, {
                s: "Windows 98",
                r: /(windows 98|win98)/
            }, {
                s: "Windows CE",
                r: /windows ce/
            }, {
                s: "Windows 2000",
                r: /(windows nt 5.0|windows 2000)/
            }, {
                s: "Windows XP",
                r: /(windows nt 5.1|windows xp)/
            }, {
                s: "Windows Server 2003",
                r: /windows nt 5.2/
            }, {
                s: "Windows Vista",
                r: /windows nt 6.0/
            }, {
                s: "Windows 7",
                r: /(windows 7|windows nt 6.1)/
            }, {
                s: "Windows 8.1",
                r: /(windows 8.1|windows nt 6.3)/
            }, {
                s: "Windows 8",
                r: /(windows 8|windows nt 6.2)/
            }, {
                s: "Windows 10",
                r: /(windows 10|windows nt 10.0)/
            }, {
                s: "Windows NT 4.0",
                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/
            }, {
                s: "Windows ME",
                r: /windows me/
            }, {
                s: "Android",
                r: /android/
            }, {
                s: "Open BSD",
                r: /openbsd/
            }, {
                s: "Sun OS",
                r: /sunos/
            }, {
                s: "Linux",
                r: /(linux|x11)/
            }, {
                s: "iOS",
                r: /(iphone|ipad|ipod)/
            }, {
                s: "Mac OS X",
                r: /mac os x/
            }, {
                s: "Mac OS",
                r: /(macppc|macintel|mac_powerpc|macintosh)/
            }, {
                s: "QNX",
                r: /qnx/
            }, {
                s: "UNIX",
                r: /unix/
            }, {
                s: "BeOS",
                r: /beos/
            }, {
                s: "OS/2",
                r: /os\/2/
            }, {
                s: "Search Bot",
                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/
            } ], l = void 0, m = void 0;
            for (l in k) if (k.hasOwnProperty(l) && (m = k[l]).r.test(g)) {
                b = m.s;
                break;
            }
            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = e.osName.windows), 
            b) {
              case e.osName.mac:
                c = /mac os x (10[\.\_\d]+)/.exec(g)[1];
                break;

              case e.osName.android:
                c = /android ([\.\_\d]+)/.exec(g)[1];
                break;

              case e.osName.ios:
                c = (c = /os (\d+)_(\d+)_?(\d+)?/.exec(h))[1] + "." + c[2] + "." + (0 | c[3]);
            }
            return {
                browserName: a,
                browserVersion: i.toString(),
                os: b,
                osVersion: c,
                codeBase: f,
                userAgent: d
            };
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.detect = d;
        var e = c.Constants = {
            codeBaseType: {
                chrome: "Chrome",
                firefox: "Firefox",
                edge: "Edge",
                plugin: "Plugin"
            },
            browserName: {
                chrome: "Chrome",
                firefox: "Firefox",
                edge: "Edge",
                msie: "Microsoft Internet Explorer",
                safari: "Safari"
            },
            osName: {
                windows: "Windows",
                mac: "Mac OS X",
                android: "Android",
                ios: "iOS"
            }
        };
    }, {} ],
    12: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GetStatsHandler = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./detectbrowser"), g = a("./statsadapter"), h = a("bluebird"), i = function() {
            function a(b) {
                d(this, a), this.codeBase = b.codeBase, this.browserName = b.browserName, this.adapter = new g.StatsAdapter(this.codeBase, this.browserName), 
                this.isPromiseBased = !0;
            }
            return e(a, [ {
                key: "getIceCandidates",
                value: function(a) {
                    var b = this;
                    return new h(function(c, d) {
                        b.csioGetStats(b.iceCandidatesHandler.bind(b), a, function(a) {
                            c(a);
                        });
                    });
                }
            }, {
                key: "iceCandidatesHandler",
                value: function(a, b) {
                    b(this.adapter.getIceCandidates(a));
                }
            }, {
                key: "csioGetStats",
                value: function(a, b, c) {
                    var d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.codeBaseType.edge, h = f.Constants.browserName.safari;
                    b && (this.codeBase === d ? this.getStatsFirefox(a, b, c) : this.browserName === h ? this.getStatsSafari(a, b, c) : this.codeBase === e ? this.getStatsChrome(a, b, c) : this.codeBase === g && this.getStatsEdge(a, b, c));
                }
            }, {
                key: "getStatsFirefox",
                value: function(a, b, c) {
                    var d = this;
                    if (d.isPromiseBased) try {
                        b.getStats().then(function(b) {
                            a(b, c);
                        }).catch(function(e) {
                            d.isPromiseBased = !1, b.getStats(null, function(b) {
                                a(b, c);
                            }, function() {});
                        });
                    } catch (e) {
                        d.isPromiseBased = !1, b.getStats(null, function(b) {
                            a(b, c);
                        }, function() {});
                    } else b.getStats(null, function(b) {
                        a(b, c);
                    }, function() {});
                }
            }, {
                key: "getStatsChrome",
                value: function(a, b, c) {
                    var d = this;
                    if (window && window.csioReactNative) b.getStats(null, function(b) {
                        a(b, c);
                    }, function(a) {}); else if (d.isPromiseBased) try {
                        b.getStats().then(function(b) {
                            a(b, c);
                        }).catch(function(e) {
                            d.isPromiseBased = !1, b.getStats(function(b) {
                                a(b, c);
                            });
                        });
                    } catch (d) {
                        isPromiseBased = !1, b.getStats(function(b) {
                            a(b, c);
                        });
                    } else b.getStats(function(b) {
                        a(b, c);
                    });
                }
            }, {
                key: "getStatsEdge",
                value: function(a, b, c) {
                    b.getStats().then(function(b) {
                        a(b, c);
                    }).catch(function(a) {});
                }
            }, {
                key: "getStatsSafari",
                value: function(a, b, c) {
                    b.getStats().then(function(b) {
                        a(b, c);
                    }).catch(function(a) {});
                }
            } ]), a;
        }();
        c.GetStatsHandler = i;
    }, {
        "./detectbrowser": 11,
        "./statsadapter": 13,
        bluebird: 1
    } ],
    13: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAdapter = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./detectbrowser"), g = function() {
            function a(b, c) {
                d(this, a), this.codeBase = b, this.browser = c;
            }
            return e(a, [ {
                key: "getIceCandidates",
                value: function(a) {
                    if (!a) return null;
                    var b = this.extractRawStats(a);
                    return this.processRawStatsForIceInfo(b);
                }
            }, {
                key: "extractRawStats",
                value: function(a) {
                    var b = [], c = void 0, d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.browserName.safari;
                    if (this.codeBase === d && this.browser !== g) a.forEach(function(a) {
                        b.push(a);
                    }); else if (this.codeBase === e && this.browser !== g) a && a.result ? b = a.result() : a && a.forEach && (b = [], 
                    a.forEach(function(a) {
                        b.push(a);
                    })); else for (c in a) a.hasOwnProperty(c) && b.push(a[c]);
                    return b;
                }
            }, {
                key: "processRawStatsForIceInfo",
                value: function(a) {
                    var b = [], c = [], d = [], e = void 0;
                    if (!a) return null;
                    for (var f = 0; f < a.length; ++f) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {
                            if ("transport" === h.transportStats.type) {
                                e = h.transportStats.selectedCandidatePairId;
                                continue;
                            }
                            d.push(h.transportStats);
                        } else if (h.localCandidate) {
                            var i = h.localCandidate;
                            if ("relay" == i.candidateType || "relayed" == i.candidateType) {
                                if (!i.mozLocalTransport) {
                                    var j = i.priority >> 24;
                                    i.mozLocalTransport = this.formatRelayType(j);
                                }
                                i.mozLocalTransport = i.mozLocalTransport.toLowerCase();
                            }
                            b.push(i);
                        } else h.remoteCandidate && c.push(h.remoteCandidate);
                    }
                    if (e) for (var k = 0; k < d.length; ++k) d[k].id === e && (d[k].googActiveConnection = "true");
                    return {
                        localCandidates: b,
                        remoteCandidates: c,
                        iceCandidatePairs: d
                    };
                }
            }, {
                key: "getParsedStats",
                value: function(a) {
                    var b = {};
                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), 
                    a.type && (b.type = a.type), a.names) for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]); else Object.assign(b, a);
                    if (b.values) {
                        for (var e = 0; e < b.values.length; e++) {
                            var f = b.values[e];
                            Object.assign(b, f);
                        }
                        delete b.values;
                    }
                    return b;
                }
            }, {
                key: "statsClassifier",
                value: function(a) {
                    var b = {}, c = function() {
                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];
                        for (var e = 0; e < c.length; e++) {
                            var f = c[e];
                            if (a.type === f) return !0;
                        }
                        return !1;
                    }, d = c("inbound-rtp", "inboundrtp"), e = "true" === a.isRemote || !0 === a.isRemote;
                    return d || c("outbound-rtp", "outboundrtp") ? (b.tracks = {}, b.tracks.data = a, 
                    b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", b.tracks.reportType = "local", 
                    void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, 
                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), 
                    b;
                }
            }, {
                key: "formatRelayType",
                value: function(a) {
                    var b = "none";
                    switch (a) {
                      case 0:
                        b = "tls";
                        break;

                      case 1:
                        b = "tcp";
                        break;

                      case 2:
                        b = "udp";
                    }
                    return b;
                }
            } ]), a;
        }();
        c.StatsAdapter = g;
    }, {
        "./detectbrowser": 11
    } ],
    14: [ function(a, b, c) {
        "use strict";
        function d() {
            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getCurrent = d;
    }, {} ],
    15: [ function(a, b, c) {
        function d() {
            throw new Error("setTimeout has not been defined");
        }
        function e() {
            throw new Error("clearTimeout has not been defined");
        }
        function f(a) {
            if (l === setTimeout) return setTimeout(a, 0);
            if ((l === d || !l) && setTimeout) return l = setTimeout, setTimeout(a, 0);
            try {
                return l(a, 0);
            } catch (b) {
                try {
                    return l.call(null, a, 0);
                } catch (b) {
                    return l.call(this, a, 0);
                }
            }
        }
        function g(a) {
            if (m === clearTimeout) return clearTimeout(a);
            if ((m === e || !m) && clearTimeout) return m = clearTimeout, clearTimeout(a);
            try {
                return m(a);
            } catch (b) {
                try {
                    return m.call(null, a);
                } catch (b) {
                    return m.call(this, a);
                }
            }
        }
        function h() {
            q && o && (q = !1, o.length ? p = o.concat(p) : r = -1, p.length && i());
        }
        function i() {
            if (!q) {
                var a = f(h);
                q = !0;
                for (var b = p.length; b; ) {
                    for (o = p, p = []; ++r < b; ) o && o[r].run();
                    r = -1, b = p.length;
                }
                o = null, q = !1, g(a);
            }
        }
        function j(a, b) {
            this.fun = a, this.array = b;
        }
        function k() {}
        var l, m, n = b.exports = {};
        !function() {
            try {
                l = "function" == typeof setTimeout ? setTimeout : d;
            } catch (a) {
                l = d;
            }
            try {
                m = "function" == typeof clearTimeout ? clearTimeout : e;
            } catch (a) {
                m = e;
            }
        }();
        var o, p = [], q = !1, r = -1;
        n.nextTick = function(a) {
            var b = new Array(arguments.length - 1);
            if (arguments.length > 1) for (var c = 1; c < arguments.length; c++) b[c - 1] = arguments[c];
            p.push(new j(a, b)), 1 !== p.length || q || f(i);
        }, j.prototype.run = function() {
            this.fun.apply(null, this.array);
        }, n.title = "browser", n.browser = !0, n.env = {}, n.argv = [], n.version = "", 
        n.versions = {}, n.on = k, n.addListener = k, n.once = k, n.off = k, n.removeListener = k, 
        n.removeAllListeners = k, n.emit = k, n.prependListener = k, n.prependOnceListener = k, 
        n.listeners = function(a) {
            return [];
        }, n.binding = function(a) {
            throw new Error("process.binding is not supported");
        }, n.cwd = function() {
            return "/";
        }, n.chdir = function(a) {
            throw new Error("process.chdir is not supported");
        }, n.umask = function() {
            return 0;
        };
    }, {} ],
    16: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                var b = this;
                d(this, a), this.batteryManager = null, "function" == typeof navigator.getBattery && navigator.getBattery().then(function(a) {
                    b.batteryManager = a;
                });
            }
            return e(a, [ {
                key: "getLevel",
                value: function() {
                    return this.batteryManager ? this.batteryManager.level : -1;
                }
            }, {
                key: "getCharging",
                value: function() {
                    return this.batteryManager ? this.batteryManager.charging : null;
                }
            } ]), a;
        }();
        c.Battery = f;
    }, {} ],
    17: [ function(a, b, c) {
        "use strict";
        function d() {
            var a = f.browserName.chrome, b = null, c = null, d = null, e = null, g = f.codeBaseType.chrome;
            if (!window.navigator.userAgent || window.csioReactNative) return window && window.csioGetOsName && (b = window.csioGetOsName()), 
            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), 
            {
                browserName: a,
                codeBase: g,
                os: b,
                osVersion: c,
                userAgent: d,
                browserVersion: null
            };
            d = navigator.userAgent;
            var h = d.toLowerCase();
            e = navigator.appVersion;
            var i = e.toLowerCase(), j = "" + parseFloat(i), k = void 0;
            -1 !== (k = h.indexOf("opera")) ? (a = f.browserName.opera, j = h.substring(k + 6), 
            -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("opr")) ? (a = f.browserName.opera, 
            j = h.substring(k + 4), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), 
            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("msie")) ? (a = f.browserName.msie, 
            j = h.substring(k + 5), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("edge")) ? (a = f.browserName.edge, 
            j = h.substring(k + 5), g = f.codeBaseType.edge) : -1 !== (k = h.indexOf("chrome")) ? (a = f.browserName.chrome, 
            j = h.substring(k + 7), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("safari")) ? (a = f.browserName.safari, 
            j = h.substring(k + 7), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), 
            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("firefox")) ? (a = f.browserName.firefox, 
            j = h.substring(k + 8), g = f.codeBaseType.firefox) : -1 !== (k = h.indexOf("trident")) && (a = f.browserName.msie, 
            k = h.indexOf("rv"), j = h.substring(k + 3, k + 7), g = f.codeBaseType.chrome);
            var l = [ {
                s: "Windows 3.11",
                r: /win16/
            }, {
                s: "Windows 95",
                r: /(windows 95|win95|windows_95)/
            }, {
                s: "Windows ME",
                r: /(win 9x 4.90|windows me)/
            }, {
                s: "Windows 98",
                r: /(windows 98|win98)/
            }, {
                s: "Windows CE",
                r: /windows ce/
            }, {
                s: "Windows 2000",
                r: /(windows nt 5.0|windows 2000)/
            }, {
                s: "Windows XP",
                r: /(windows nt 5.1|windows xp)/
            }, {
                s: "Windows Server 2003",
                r: /windows nt 5.2/
            }, {
                s: "Windows Vista",
                r: /windows nt 6.0/
            }, {
                s: "Windows 7",
                r: /(windows 7|windows nt 6.1)/
            }, {
                s: "Windows 8.1",
                r: /(windows 8.1|windows nt 6.3)/
            }, {
                s: "Windows 8",
                r: /(windows 8|windows nt 6.2)/
            }, {
                s: "Windows 10",
                r: /(windows 10|windows nt 10.0)/
            }, {
                s: "Windows NT 4.0",
                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/
            }, {
                s: "Windows ME",
                r: /windows me/
            }, {
                s: "Android",
                r: /android/
            }, {
                s: "Open BSD",
                r: /openbsd/
            }, {
                s: "Sun OS",
                r: /sunos/
            }, {
                s: "Linux",
                r: /(linux|x11)/
            }, {
                s: "iOS",
                r: /(iphone|ipad|ipod)/
            }, {
                s: "Mac OS X",
                r: /mac os x/
            }, {
                s: "Mac OS",
                r: /(macppc|macintel|mac_powerpc|macintosh)/
            }, {
                s: "QNX",
                r: /qnx/
            }, {
                s: "UNIX",
                r: /unix/
            }, {
                s: "BeOS",
                r: /beos/
            }, {
                s: "OS/2",
                r: /os\/2/
            }, {
                s: "Search Bot",
                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/
            } ], m = void 0, n = void 0;
            for (m in l) if (l.hasOwnProperty(m) && (n = l[m], n.r.test(h))) {
                b = n.s;
                break;
            }
            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = f.osName.windows), 
            b) {
              case f.osName.mac:
                c = /mac os x (10[\.\_\d]+)/.exec(h)[1];
                break;

              case f.osName.android:
                c = /android ([\.\_\d]+)/.exec(h)[1];
                break;

              case f.osName.ios:
                if (!(c = /os (\d+)_(\d+)_?(\d+)?/.exec(i))) break;
                c = c[1] + "." + c[2] + "." + (0 | c[3]);
            }
            return {
                browserName: a,
                browserVersion: j.toString(),
                os: b,
                osVersion: c,
                codeBase: g,
                userAgent: d
            };
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.detect = d;
        var e = a("../config/constants"), f = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(e);
    }, {
        "../config/constants": 32
    } ],
    18: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Devices = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/csiologger"), k = d(j), l = a("../utility/utils"), m = d(l), n = function() {
            function a(b, c) {
                e(this, a), this.conferenceId = b, this.pc = c, this.devices = null, this.emb = i.Registry.getEventMessageBuilder();
            }
            return f(a, [ {
                key: "collectConnected",
                value: function() {
                    var a = this;
                    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                        var b = this;
                        navigator.mediaDevices.enumerateDevices().then(function(c) {
                            var d = m.normalizeMediaDeviceList(c);
                            b.sendConnected(d), setTimeout(a.collectConnected.bind(b), 1e4);
                        }).catch(function(c) {
                            setTimeout(a.collectConnected.bind(b), 1e4);
                        });
                    }
                }
            }, {
                key: "sendConnected",
                value: function(a) {
                    this.devices ? this.compare(a) || (this.devices = a, this.send()) : (this.devices = a, 
                    this.send());
                }
            }, {
                key: "compare",
                value: function(a) {
                    return self.devices.sort().toString() === a.sort().toString();
                }
            }, {
                key: "send",
                value: function() {
                    var a = {
                        mediaDeviceList: this.devices
                    };
                    k.log("sending connectedDevice", h.internalFabricEvent.connectedDeviceList, a), 
                    this.emb.make(h.internalFabricEvent.connectedDeviceList, this.conferenceId, this.pc, a);
                }
            } ]), a;
        }();
        c.Devices = n;
    }, {
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/utils": 100
    } ],
    19: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (b) try {
                window && window.localStorage && window.localStorage.setItem(a, b);
            } catch (a) {
                return;
            }
        }
        function e(a) {
            try {
                if (window && window.localStorage) return window.localStorage.getItem(a);
            } catch (a) {
                return null;
            }
            return null;
        }
        function f(a) {
            try {
                window && window.localStorage && window.localStorage.removeItem(a);
            } catch (a) {
                return;
            }
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.store = d, c.get = e, c.remove = f;
    }, {} ],
    20: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (b) try {
                window && window.sessionStorage && window.sessionStorage.setItem(a, b);
            } catch (a) {
                return;
            }
        }
        function e(a) {
            try {
                if (window && window.sessionStorage) return window.sessionStorage.getItem(a);
            } catch (a) {
                return null;
            }
            return null;
        }
        function f(a) {
            try {
                window && window.sessionStorage && window.sessionStorage.removeItem(a);
            } catch (a) {
                return;
            }
        }
        function g(a, b) {
            if (a) {
                var c = JSON.parse(e("csio_ucid_data"));
                c || (c = {}), c[a] || (c[a] = {}), c[a].ucID = b, d("csio_ucid_data", JSON.stringify(c));
            }
        }
        function h(a) {
            if (!a) return null;
            var b = JSON.parse(e("csio_ucid_data"));
            return b && b[a] ? b[a].ucID : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.store = d, c.get = e, c.remove = f, c.storeUcId = g, c.getUcId = h;
    }, {} ],
    21: [ function(a, b, c) {
        (function(c) {
            "use strict";
            function d(a) {
                if (a && a.__esModule) return a;
                var b = {};
                if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
                return b.default = a, b;
            }
            function e(a, b) {
                if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
            }
            function f(a, b) {
                var c = {};
                return c.status = a, b && (c.message = b), c;
            }
            function g(a, b) {
                return a + ": " + b + " " + (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "");
            }
            function h() {
                var a = null, b = r.Registry.getEndpoint().getBrowserName();
                return "Firefox" === b ? a = mozRTCPeerConnection : "Chrome" === b || "Opera" === b ? a = webkitRTCPeerConnection : "Safari" === b ? t.log("Browser type Safari") : "Edge" === b && (a = window.RTCPeerConnection), 
                a;
            }
            function i(a) {
                if (null === a) return !1;
                var b = r.Registry.getEndpoint().getCodeBase();
                if (b === m.codeBaseType.firefox) return "undefined" != typeof mozRTCPeerConnection && a instanceof mozRTCPeerConnection || "undefined" != typeof RTCPeerConnection && a instanceof RTCPeerConnection;
                if (b === m.codeBaseType.edge || "function" == typeof a) return !0;
                var c = h();
                return null !== c && a instanceof c || void 0 !== a.createOffer;
            }
            var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
                return typeof a;
            } : function(a) {
                return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
            }, k = function() {
                function a(a, b) {
                    for (var c = 0; c < b.length; c++) {
                        var d = b[c];
                        d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                        Object.defineProperty(a, d.key, d);
                    }
                }
                return function(b, c, d) {
                    return c && a(b.prototype, c), d && a(b, d), b;
                };
            }(), l = a("./config/constants"), m = d(l), n = a("./config/settings"), o = d(n), p = a("./config/callstatserrors"), q = a("./fsm/mainfsm"), r = a("./utility/registry"), s = a("./utility/csiologger"), t = d(s), u = a("./utility/onerroreventlistner"), v = d(u), w = a("./utility/utils"), x = d(w);
            v.setErrorEventListener(), x.assignPollyfill(), x.isIntegerPollyfill();
            var y = null, z = function() {
                function a() {
                    e(this, a), y = new q.MainFSM();
                }
                return k(a, [ {
                    key: "initialize",
                    value: function(a, b, c, d, e, h) {
                        if (!a || !c || !b) {
                            var i = g("initialize", p.csErrorStrings.argumentError);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (d && "function" != typeof d) {
                            var j = g("initialize", p.csErrorStrings.argumentError);
                            t.warn(j), d = null;
                        }
                        if (e && "function" != typeof e) {
                            var k = g("initialize", p.csErrorStrings.argumentError);
                            t.warn(k), e = null;
                        }
                        if ("function" != typeof b && !(window.crypto && (window.crypto.subtle || window.crypto.webkitSubtle) || window.msCrypto && window.msCrypto.subtle || window.csioReactNative)) {
                            var l = g("initialize", p.csErrorStrings.cryptoError);
                            return t.error(l), d && d(p.csError.tokenGenerationError, p.csErrorStrings.cryptoError), 
                            f(m.callstatsAPIReturnStatus.failure, l);
                        }
                        try {
                            y.fire(q.MainEvents.onInitialize, a, c, b, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "initialize: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("initialize: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "addNewFabric",
                    value: function(a, b, c, d, e, h) {
                        var j = null, k = m.endpointType.peer, l = m.transmissionDirection.sendrecv;
                        if (d || (d = m.tmpConferenceId), !a || !c) {
                            var n = g("addNewFabric", p.csErrorStrings.argumentError);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        if (h && "function" == typeof h && (j = h), e && "function" == typeof e && (j = e), 
                        e && "function" != typeof e) {
                            if (e.remoteEndpointType) {
                                if (!m.endpointType.hasOwnProperty(e.remoteEndpointType)) {
                                    var o = g("addNewFabric", p.csErrorStrings.invalidEndPointType, e.remoteEndpointType);
                                    return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);
                                }
                                k = e.remoteEndpointType;
                            }
                            if (e.fabricTransmissionDirection) {
                                if (!m.transmissionDirection.hasOwnProperty(e.fabricTransmissionDirection)) {
                                    var s = g("addNewFabric", p.csErrorStrings.invalidTransmissionDirection, e.fabricTransmissionDirection);
                                    return t.error(s), f(m.callstatsAPIReturnStatus.failure, s);
                                }
                                l = e.fabricTransmissionDirection;
                            }
                        }
                        if (!m.fabricUsage.hasOwnProperty(c) || c instanceof Function) {
                            var u = g("addNewFabric", p.csErrorStrings.fabricUsageInvalid, c);
                            return t.error(u), f(m.callstatsAPIReturnStatus.failure, u);
                        }
                        if (!i(a)) {
                            var v = g("addNewFabric", p.csErrorStrings.pcInvalid);
                            return t.error(v), f(m.callstatsAPIReturnStatus.failure, v);
                        }
                        var w = r.Registry.getConferenceManager().get(d);
                        if (w) {
                            if (w.getPeerConnectionManager().getPcHandler(a)) return f(m.callstatsAPIReturnStatus.success);
                        }
                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {
                            var x = g("addNewFabric", p.csErrorStrings.notInitialized);
                            return t.error(x), f(m.callstatsAPIReturnStatus.failure, x);
                        }
                        try {
                            y.fire(q.MainEvents.onAddNewFabric, a, b, c, d, k, l, j), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "addNewFabric: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("addNewFabric: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "sendFabricEvent",
                    value: function(a, b, c, d) {
                        if (t.log("sendFabricEvent ", b), c || (c = m.tmpConferenceId), !a || !b) {
                            var e = g("sendFabricEvent", p.csErrorStrings.argumentError);
                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);
                        }
                        if (b === m.fabricEvent.fabricSetupFailed) {
                            var h = g("sendFabricEvent", p.csErrorStrings.fabricEventUnsupported, b);
                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);
                        }
                        if (!m.fabricEvent.hasOwnProperty(b) && !m.internalFabricEvent.hasOwnProperty(b)) {
                            var i = g("sendFabricEvent", p.csErrorStrings.fabricEventInvalid, b);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (!(b !== m.fabricEvent.activeDeviceList || d && d.deviceList)) {
                            var j = g("sendFabricEvent ", p.csErrorStrings.argumentError);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        var k = r.Registry.getConferenceManager().get(c);
                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId() || !k) {
                            var l = g("sendFabricEvent ", p.csErrorStrings.notInitialized);
                            return t.error(l), f(m.callstatsAPIReturnStatus.failure, l);
                        }
                        if (!k.getPeerConnectionManager().getPcHandler(a)) {
                            var n = g("sendFabricEvent ", p.csErrorStrings.pcInvalid);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        try {
                            y.fire(q.MainEvents.onSendFabricEvent, a, b, c, d), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "sendFabricEvent: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("sendFabricEvent: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "sendUserFeedback",
                    value: function(a, b, c) {
                        if (!b || !a) {
                            var d = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);
                        }
                        if ("object" !== (void 0 === b ? "undefined" : j(b))) {
                            var e = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);
                        }
                        if (0 === Object.keys(b).length) {
                            var h = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);
                        }
                        try {
                            y.fire(q.MainEvents.onSendUserFeedback, a, b, c), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "sendUserFeedback: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("sendUserFeedback: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "associateMstWithUserID",
                    value: function(a, b, c, d, e, h) {
                        if (c || (c = m.tmpConferenceId), !a || !d || !e) {
                            var j = g("associateMstWithUserID", p.csErrorStrings.argumentError);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        if (!i(a)) {
                            var k = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);
                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);
                        }
                        var l = r.Registry.getConferenceManager().get(c);
                        if (!l) {
                            var n = g("associateMstWithUserID", p.csErrorStrings.confereneDoesNotExist);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        if (!l.getPeerConnectionManager().getPcHandler(a)) {
                            var o = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);
                            return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);
                        }
                        h && "string" != typeof h && (t.error("associateMstWithUserID: Invalid videoTag"), 
                        h = null);
                        try {
                            y.fire(q.MainEvents.onAssociateMstWithUserID, a, b, c, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "associateMstWithUserID: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("associateMstWithUserID: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "reportError",
                    value: function(a, b, c, d, e, h) {
                        if (b || (b = m.tmpConferenceId), void 0 === a || !c) {
                            var i = g("reportError", p.csErrorStrings.argumentError);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (!m.webRTCFunctions.hasOwnProperty(c)) {
                            var j = g("reportError", p.csErrorStrings.webRTCFunctionsInvalid, c);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        if (void 0 === d && t.warn("reportError: Missing DOM error parameter"), !r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {
                            var k = g("reportError", p.csErrorStrings.notInitialized);
                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);
                        }
                        try {
                            y.fire(q.MainEvents.onReportError, a, b, c, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "reportError: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("reportError: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "setProxyConfig",
                    value: function(a) {
                        if (window && !window.csioproxy) {
                            var b = g("setProxyConfig", p.csErrorStrings.setProxyConfigInvokeError);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if (!a) {
                            var c = g("setProxyConfig", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onSetProxyConfig, a), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "setProxyConfig: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("setProxyConfig: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "attachWifiStatsHandler",
                    value: function(a) {
                        if (!a) {
                            var b = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if ("function" != typeof a) {
                            var c = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onAttachWifiStatsHandler, a), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "attachWifiStatsHandler: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("attachWifiStatsHandler: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "setIdentifiers",
                    value: function(a, b) {
                        if (!a) {
                            var c = g("setIdentifiers", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onSetIdentifiers, a, b), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "setIdentifiers: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("setIdentifiers: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "makePrecallTest",
                    value: function() {
                        if (!r.Registry.getAuthenticator().getToken() || !r.Registry.getCredentials().getAppId()) {
                            var a = g("makePrecallTest", p.csErrorStrings.notInitialized);
                            return t.error(a), f(m.callstatsAPIReturnStatus.failure, a);
                        }
                        if (!r.Registry.getAuthenticator().getIceServers()) {
                            var b = g("makePrecallTest", p.csErrorStrings.notInitialized);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if (!r.Registry.getCredentials().getCollectSDP()) {
                            var c = g("makePrecallTest", p.csErrorStrings.apiaccesserror);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onMakePrecallTest), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "on: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("makePrecallTest: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "on",
                    value: function(a, b) {
                        if (!b || "function" != typeof b) {
                            var c = g("on", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        if (!a || !m.callbackFunctions.hasOwnProperty(a)) {
                            var d = g("on", p.csErrorStrings.argumentError);
                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);
                        }
                        try {
                            y.fire(q.MainEvents.onOn, a, b), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "on: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("on: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "fabricUsage",
                    get: function() {
                        return this.constructor.fabricUsage;
                    }
                }, {
                    key: "fabricEvent",
                    get: function() {
                        return this.constructor.fabricEvent;
                    }
                }, {
                    key: "webRTCFunctions",
                    get: function() {
                        return this.constructor.webRTCFunctions;
                    }
                }, {
                    key: "csError",
                    get: function() {
                        return this.constructor.csError;
                    }
                }, {
                    key: "qualityRating",
                    get: function() {
                        return this.constructor.qualityRating;
                    }
                }, {
                    key: "callStatsAPIReturnStatus",
                    get: function() {
                        return this.constructor.callStatsAPIReturnStatus;
                    }
                }, {
                    key: "version",
                    get: function() {
                        return this.constructor.version;
                    }
                }, {
                    key: "userIDType",
                    get: function() {
                        return this.constructor.userIDType;
                    }
                }, {
                    key: "transmissionDirection",
                    get: function() {
                        return this.constructor.transmissionDirection;
                    }
                }, {
                    key: "endpointType",
                    get: function() {
                        return this.constructor.endpointType;
                    }
                } ]), a;
            }();
            z.fabricUsage = m.fabricUsage, z.fabricEvent = m.fabricEvent, z.webRTCFunctions = m.webRTCFunctions, 
            z.csError = p.csError, z.qualityRating = m.qualityRating, z.callStatsAPIReturnStatus = m.callstatsAPIReturnStatus, 
            z.version = o.version, z.userIDType = m.userIdType, z.endpointType = m.endpointType, 
            z.transmissionDirection = m.transmissionDirection, function() {
                function a() {
                    return new z();
                }
                "function" == typeof define && define.amd ? define("callstats", [], a) : c.callstats = a, 
                b.exports = a;
            }("undefined" != typeof window && window);
        }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {
        "./config/callstatserrors": 31,
        "./config/constants": 32,
        "./config/settings": 33,
        "./fsm/mainfsm": 34,
        "./utility/csiologger": 87,
        "./utility/onerroreventlistner": 93,
        "./utility/registry": 94,
        "./utility/utils": 100
    } ],
    22: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (Array.isArray(a)) {
                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];
                return c;
            }
            return Array.from(a);
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.BinaryTree = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./binarytreenode.js"), h = a("../utility/csiologger"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h), j = function() {
            function a(b) {
                e(this, a), this.root = null, this.top = null, this.bottom = null, this.comparator = b, 
                this.node_counter = 0, this.duplicate_counter = 0;
            }
            return f(a, [ {
                key: "getTopNode",
                value: function() {
                    return this.top;
                }
            }, {
                key: "getTopValue",
                value: function() {
                    return null === this.top ? null : this.top.peek();
                }
            }, {
                key: "getBottomValue",
                value: function() {
                    return null === this.bottom ? null : this.bottom.peek();
                }
            }, {
                key: "getBottomNode",
                value: function() {
                    return this.bottom;
                }
            }, {
                key: "getDuplicatedCounter",
                value: function() {
                    return this.duplicate_counter;
                }
            }, {
                key: "getNodeCounter",
                value: function() {
                    return this.node_counter;
                }
            }, {
                key: "getSize",
                value: function() {
                    return this.duplicate_counter + this.node_counter;
                }
            }, {
                key: "insertNodeAtTop",
                value: function(a) {
                    a && this.inserting(a.getValues(), this.top);
                }
            }, {
                key: "insertNodeAtBottom",
                value: function(a) {
                    a && this.inserting(a.getValues(), this.bottom);
                }
            }, {
                key: "insert",
                value: function(a) {
                    this.inserting([ a ], this.root);
                }
            }, {
                key: "createNode",
                value: function(a) {
                    var b = new (Function.prototype.bind.apply(g.BinaryTreeNode, [ null ].concat(d(a))))();
                    return null === this.top ? this.top = b : this.comparator(this.top.peek(), b.peek()) < 0 && (this.top = b), 
                    null === this.bottom ? this.bottom = b : this.comparator(b.peek(), this.bottom.peek()) < 0 && (this.bottom = b), 
                    b;
                }
            }, {
                key: "inserting",
                value: function(a, b) {
                    if (null === this.root) return this.root = this.createNode(a), this.node_counter = 1, 
                    void (this.duplicate_counter += a.length - 1);
                    for (var c = null, d = b, e = 0; null !== d; ) {
                        if (0 === (e = this.comparator(a[0], d.peek()))) return d.concat(a), this.duplicate_counter += a.length, 
                        void d.find(a[0]);
                        c = d, d = e < 0 ? d.getLeft() : d.getRight();
                    }
                    ++this.node_counter, this.duplicate_counter += a.length - 1, d = this.createNode(a), 
                    e < 0 ? c.setLeft(d) : c.setRight(d);
                }
            }, {
                key: "getRightist",
                value: function(a) {
                    for (var b = null; null !== a.right; ) b = a, a = a.right;
                    return [ a, b ];
                }
            }, {
                key: "getLeftist",
                value: function(a) {
                    for (var b = null; null !== a.getLeft(); ) b = a, a = a.getLeft();
                    return [ a, b ];
                }
            }, {
                key: "popBottomNode",
                value: function() {
                    if (null === this.bottom) return null;
                    var a = this.search(this.bottom.peek()), b = a[0], c = a[1];
                    return this.replaceNode(b, c, b.getRight()), this.disposeNode(b), --this.node_counter, 
                    this.duplicate_counter -= b.getLength() - 1, b.setRight(null), b;
                }
            }, {
                key: "popTopNode",
                value: function() {
                    if (null === this.top) return null;
                    var a = this.search(this.top.peek()), b = a[0], c = a[1];
                    return null === b ? null : (this.replaceNode(b, c, b.getLeft()), this.disposeNode(b), 
                    --this.node_counter, this.duplicate_counter -= b.getLength() - 1, b.setLeft(null), 
                    b);
                }
            }, {
                key: "search",
                value: function(a) {
                    for (var b = this.root, c = null, d = void 0; null !== b; ) {
                        if (0 === (d = this.comparator(a, b.peek()))) return b.find(a) ? [ b, c ] : [ null, null ];
                        c = b, b = d < 0 ? b.getLeft() : b.getRight();
                    }
                    return [ null, null ];
                }
            }, {
                key: "replaceNode",
                value: function(a, b, c) {
                    null !== b ? b.left === a ? b.left = c : b.right = c : this.root = c;
                }
            }, {
                key: "disposeNode",
                value: function(a) {
                    if (null === this.root) return void (this.bottom = this.top = null);
                    if (0 === this.comparator(this.top.peek(), a.peek())) {
                        var b = this.getRightist(this.root);
                        this.top = b[0];
                    }
                    if (0 === this.comparator(this.bottom.peek(), a.peek())) {
                        var c = this.getLeftist(this.root);
                        this.bottom = c[0];
                    }
                }
            }, {
                key: "delete",
                value: function(a) {
                    var b = this.search(a), c = b[0], d = b[1];
                    if (null === c) return !1;
                    if (1 < c.getLength()) return c.remove(a), --this.duplicate_counter, !0;
                    if (--this.node_counter, null === c.getLeft() && null === c.getRight()) this.replaceNode(c, d, null); else if (null === c.getLeft()) this.replaceNode(c, d, c.getRight()); else if (null === c.getRight()) this.replaceNode(c, d, c.getLeft()); else {
                        for (var e = c.getLeft(), f = c; null !== e.getRight(); f = e, e = e.getRight()) ;
                        var g = e.getLeft();
                        f === c ? f.setLeft(g) : f.setRight(g), c.setValues(e.getValues());
                    }
                    return this.disposeNode(c), !0;
                }
            }, {
                key: "logging",
                value: function() {
                    if (null === this.root) return void i.log("This tree is empty Duplicate Counter: " + this.duplicate_counter);
                    i.log("Size of the tree: " + this.getSize() + " Node: " + this.getNodeCounter() + " Duplicates: " + this.getDuplicatedCounter() + " Top: " + this.getTopNode().toString() + " Bottom: " + this.getBottomNode().toString()), 
                    function a(b, c, d) {
                        if (null !== b) {
                            for (var e = "-", f = 0; f < c; ++f) e += "--";
                            i.log(e + "> (" + d + ") [" + b.toString() + "]"), null !== b.getLeft() && a(b.getLeft(), c + 1, "Left"), 
                            null !== b.getRight() && a(b.getRight(), c + 1, "Right");
                        }
                    }(this.root, 0, "Root");
                }
            } ]), a;
        }();
        c.BinaryTree = j;
    }, {
        "../utility/csiologger": 87,
        "./binarytreenode.js": 23
    } ],
    23: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a);
                for (var b = arguments.length, c = Array(b), e = 0; e < b; e++) c[e] = arguments[e];
                this.values = c, this.left = null, this.right = null;
            }
            return e(a, [ {
                key: "getRight",
                value: function() {
                    return this.right;
                }
            }, {
                key: "setRight",
                value: function(a) {
                    this.right = a;
                }
            }, {
                key: "getLeft",
                value: function() {
                    return this.left;
                }
            }, {
                key: "setLeft",
                value: function(a) {
                    this.left = a;
                }
            }, {
                key: "push",
                value: function(a) {
                    this.values.push(a);
                }
            }, {
                key: "concat",
                value: function(a) {
                    this.values = this.values.concat(a);
                }
            }, {
                key: "pop",
                value: function() {
                    return this.values.length < 1 ? null : this.values.shift();
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.values.splice(this.values.indexOf(a), 1);
                }
            }, {
                key: "setValues",
                value: function(a) {
                    this.values = a;
                }
            }, {
                key: "getValues",
                value: function() {
                    return this.values;
                }
            }, {
                key: "hasValue",
                value: function() {
                    return 0 < this.values.length;
                }
            }, {
                key: "getLength",
                value: function() {
                    return this.values.length;
                }
            }, {
                key: "peek",
                value: function() {
                    return this.values.length < 1 ? null : this.values[0];
                }
            }, {
                key: "find",
                value: function(a) {
                    return this.values.find(function(b) {
                        return b === a;
                    });
                }
            }, {
                key: "toString",
                value: function() {
                    return this.values.toString();
                }
            } ]), a;
        }();
        c.BinaryTreeNode = f;
    }, {} ],
    24: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Cache = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a() {
                d(this, a), this.queue = [], this.priority = [];
            }
            return e(a, [ {
                key: "add",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                    if (this.length() > 1e6) return void g.error("Maximum cached items reached, dropping.");
                    b ? this.priority.push(a) : this.queue.push(a);
                }
            }, {
                key: "pop",
                value: function() {
                    return this.priority.length > 0 ? this.priority.shift() : this.queue.shift();
                }
            }, {
                key: "peak",
                value: function() {
                    return this.priority.length > 0 ? this.priority[0] : this.queue.length > 0 ? this.queue[0] : null;
                }
            }, {
                key: "length",
                value: function() {
                    return this.queue.length + this.priority.length;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    for (var b = 0; b < this.queue.length; ++b) {
                        this.queue[b].updateConferenceId(a);
                    }
                    for (var c = 0; c < this.priority.length; ++c) {
                        this.priority[c].updateConferenceId(a);
                    }
                }
            } ]), a;
        }();
        c.Cache = h;
    }, {
        "../utility/csiologger": 87
    } ],
    25: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Component = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./port"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "Unknown";
                d(this, a), this.name = b, this.ports = new Map();
            }
            return e(a, [ {
                key: "bindPort",
                value: function(a, b) {
                    var c = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : this;
                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");
                    this.ports.set(a, new f.Port(b, c));
                }
            }, {
                key: "declarePort",
                value: function(a) {
                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");
                    this.ports.set(a, null);
                }
            }, {
                key: "getPort",
                value: function(a) {
                    return this.ports.get(a);
                }
            }, {
                key: "isConnected",
                value: function(a) {
                    return !!this.ports.has(a) && null !== this.ports.get(a);
                }
            }, {
                key: "connect",
                value: function(a, b) {
                    if (!this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");
                    this.ports.set(a, b);
                }
            }, {
                key: "transmit",
                value: function(a) {
                    var b = this.ports.get(a);
                    if (void 0 === b) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");
                    if (null === b) return void h.warn("Port (" + a + ") for " + this.name + " is not connected.");
                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];
                    b.transmit(d);
                }
            }, {
                key: "request",
                value: function(a) {
                    var b = this.ports.get(a);
                    if (void 0 === b) return h.warn("Port (" + a + ") for " + this.name + " does not exists."), 
                    null;
                    if (null === b) return h.warn("Port (" + a + ") for " + this.name + " is not connected."), 
                    null;
                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];
                    return b.request(d);
                }
            } ]), a;
        }();
        c.Component = i;
    }, {
        "../utility/csiologger": 87,
        "./port": 26
    } ],
    26: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;
                d(this, a), this.target = b, this.object = c;
            }
            return e(a, [ {
                key: "transmit",
                value: function(a) {
                    this.target.apply(this.object, a);
                }
            }, {
                key: "request",
                value: function(a) {
                    return this.target.apply(this.object, a);
                }
            } ]), a;
        }();
        c.Port = f;
    }, {} ],
    27: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SlidingWindow = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./switem"), g = a("../utility/timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a(b, c) {
                d(this, a), this.items = [], this.plugins = [], this.postProcesses = [], this.preProcesses = [], 
                this.timeoutInMs = c, this.maxItemsNum = b, this.minItemsNum = 0;
            }
            return e(a, [ {
                key: "setMaxItemsNum",
                value: function(a) {
                    this.maxItemsNum = a;
                }
            }, {
                key: "setTimeoutInMs",
                value: function(a) {
                    this.timeoutInMs = a;
                }
            }, {
                key: "setMinItemsNum",
                value: function(a) {
                    this.minItemsNum = a;
                }
            }, {
                key: "refresh",
                value: function() {
                    var a = h.getCurrent();
                    if (!(this.items.length <= this.minItemsNum)) {
                        for (;0 < this.maxItemsNum && this.maxItemsNum <= this.items.length; ) this.remove();
                        this.timeoutInMs && this.timeoutInMs < a - this.items[0].getCreated() && (this.remove(), 
                        this.refresh());
                    }
                }
            }, {
                key: "getLength",
                value: function() {
                    return this.items.length;
                }
            }, {
                key: "add",
                value: function(a) {
                    this.refresh(), this.items.push(new f.SWItem(a));
                    for (var b = 0; b < this.preProcesses.length; b++) {
                        (0, this.preProcesses[b])(a);
                    }
                    for (var c = 0; c < this.plugins.length; c++) {
                        this.plugins[c].add(a);
                    }
                    for (var d = 0; d < this.postProcesses.length; d++) {
                        (0, this.postProcesses[d])(a);
                    }
                }
            }, {
                key: "remove",
                value: function() {
                    for (var a = this.items.shift(), b = 0; b < this.plugins.length; b++) {
                        this.plugins[b].remove(a.value);
                    }
                }
            }, {
                key: "peek",
                value: function() {
                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0;
                    return this.items.length <= a ? null : this.items[this.items.length - a - 1].getValue();
                }
            }, {
                key: "attach",
                value: function(a) {
                    this.plugins.push(a);
                }
            }, {
                key: "addPreProcess",
                value: function(a) {
                    this.preProcesses.push(a);
                }
            }, {
                key: "addPostProcess",
                value: function(a) {
                    this.postProcesses.push(a);
                }
            }, {
                key: "detach",
                value: function(a) {
                    this.plugins = this.plugins.filter(function(b) {
                        return b !== a;
                    });
                }
            } ]), a;
        }();
        c.SlidingWindow = i;
    }, {
        "../utility/timestamps": 98,
        "./switem": 28
    } ],
    28: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWItem = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/timestamps"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b) {
                d(this, a), this.value = b, this.created = g.getCurrent();
            }
            return e(a, [ {
                key: "getValue",
                value: function() {
                    return this.value;
                }
            }, {
                key: "getCreated",
                value: function() {
                    return this.created;
                }
            }, {
                key: "toString",
                value: function() {
                    return "";
                }
            } ]), a;
        }();
        c.SWItem = h;
    }, {
        "../utility/timestamps": 98
    } ],
    29: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Conference = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../peerconnection/peerconnectionmanager"), h = a("../config/settings"), i = d(h), j = a("../utility/registry"), k = a("../browserapi/sessionstorage"), l = d(k), m = function() {
            function a(b, c) {
                e(this, a), this.conferenceId = b, this.startTime, this.peerConnectionManager = new g.PeerConnectionManager(), 
                this.credentials = c, this.ucId = null, this.url = null, this.userJoinedSent = !1;
            }
            return f(a, [ {
                key: "getCredentials",
                value: function() {
                    return this.credentials;
                }
            }, {
                key: "getUcId",
                value: function() {
                    return this.ucId;
                }
            }, {
                key: "setUcId",
                value: function(a) {
                    this.ucId = a, this.url = i.conferenceBaseUrl + j.Registry.getCredentials().getAppId() + "/conferences/" + encodeURIComponent(this.conferenceId) + "/" + a + "/general", 
                    l.storeUcId(this.conferenceId, a);
                }
            }, {
                key: "getPeerConnectionManager",
                value: function() {
                    return this.peerConnectionManager;
                }
            }, {
                key: "getUrl",
                value: function() {
                    return this.url;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a, this.peerConnectionManager.updateConferenceId(a);
                }
            }, {
                key: "close",
                value: function(a) {}
            } ]), a;
        }();
        c.Conference = m;
    }, {
        "../browserapi/sessionstorage": 20,
        "../config/settings": 33,
        "../peerconnection/peerconnectionmanager": 41,
        "../utility/registry": 94
    } ],
    30: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConferenceManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./conference"), g = a("../config/constants"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.conferenceMap = new Map();
            }
            return e(a, [ {
                key: "add",
                value: function(a, b) {
                    if (!this.get(a)) {
                        var c = new f.Conference(a, b);
                        this.conferenceMap.set(a, c);
                    }
                }
            }, {
                key: "get",
                value: function(a) {
                    return this.conferenceMap.get(a);
                }
            }, {
                key: "getConferenceForPc",
                value: function(a) {
                    var b = null;
                    return a ? (this.conferenceMap.forEach(function(c, d) {
                        var e = c.getPeerConnectionManager().getPcHandler(a);
                        e && e.getConferenceId() === d && (b = c);
                    }), b) : b;
                }
            }, {
                key: "getConferenceForPcHash",
                value: function(a) {
                    var b = null;
                    return a ? (this.conferenceMap.forEach(function(c, d) {
                        var e = c.getPeerConnectionManager().getPcHandlerByHash(a);
                        e && e.getConferenceId() === d && (b = c);
                    }), b) : b;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    var b = h.tmpConferenceId, c = this.get(b);
                    c && (c.updateConferenceId(a), this.conferenceMap.set(a, c), this.conferenceMap.delete(b));
                }
            }, {
                key: "getConferenceIds",
                value: function() {
                    var a = [];
                    return this.conferenceMap.forEach(function(b, c) {
                        a.push(c);
                    }), a;
                }
            } ]), a;
        }();
        c.ConferenceManager = i;
    }, {
        "../config/constants": 32,
        "./conference": 29
    } ],
    31: [ function(a, b, c) {
        "use strict";
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        c.csError = {
            httpError: "httpError",
            authError: "authError",
            wsChannelFailure: "wsChannelFailure",
            success: "success",
            csProtoError: "csProtoError",
            appConnectivityError: "appConnectivityError",
            tokenGenerationError: "tokenGenerationError",
            ok: "OK",
            authOngoing: "authOngoing",
            invalidWebRTCFunctionName: "Invalid WebRTC function name",
            invalidEndPointType: "Invalid EndPoint Type",
            invalidTransmissionDirection: "Invalid fabric transmission direction"
        }, c.csErrorStrings = {
            argumentError: "Argument missing/invalid",
            cryptoError: "Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",
            fabricEventUnsupported: "Unsupported fabricEvent",
            fabricEventInvalid: "Invalid fabricEvents value",
            fabricUsageInvalid: "Invalid fabricUsage value",
            notInitialized: "SDK is not initialized or no Fabrics added",
            pcInvalid: "Invalid PeerConnection object passed",
            confereneDoesNotExist: "conferenceId does not exist",
            webRTCFunctionsInvalid: "Invalid webRTC functionName value",
            setProxyConfigInvokeError: "cannot be called if window.csioproxy is false",
            invalidWebRTCFunctionName: "Invalid WebRTC function name",
            invalidEndPointType: "Invalid EndPoint Type",
            invalidTransmissionDirection: "Invalid fabric transmission direction",
            apiaccesserror: "API access Error"
        }, c.csErrorReason = {
            csProtoError: "Protocol fields cannot be empty.",
            csNoAuthState: "Authentication state unavailable in server."
        }, c.internalErrors = {
            authOngoing: "authOngoing"
        }, c.authErrorActions = {
            RETRY: 0,
            GET_NEW_TOKEN: 1,
            REPORT_ERROR: 2
        };
    }, {} ],
    32: [ function(a, b, c) {
        "use strict";
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        c.logEvents = {
            stateMachine: "stateMachine",
            log: "log",
            timing: "timing",
            error: "error",
            getStatsError: "getStatsError",
            restResponseError: "restResponseError"
        }, c.fabricEvent = {
            fabricSetupFailed: "fabricSetupFailed",
            fabricHold: "fabricHold",
            fabricResume: "fabricResume",
            audioMute: "audioMute",
            audioUnmute: "audioUnmute",
            videoPause: "videoPause",
            videoResume: "videoResume",
            fabricUsageEvent: "fabricUsageEvent",
            fabricTerminated: "fabricTerminated",
            screenShareStart: "screenShareStart",
            screenShareStop: "screenShareStop",
            dominantSpeaker: "dominantSpeaker",
            activeDeviceList: "activeDeviceList",
            applicationErrorLog: "applicationErrorLog"
        }, c.internalFabricEvent = {
            fabricSetup: "fabricSetup",
            fabricSetupFailed: "fabricSetupFailed",
            userJoined: "userJoined",
            userLeft: "userLeft",
            userAlive: "userAlive",
            ssrcMap: "ssrcMap",
            mediaPlaybackStart: "mediaPlaybackStart",
            mediaPlaybackSuspended: "mediaPlaybackSuspended",
            mediaPlaybackStalled: "mediaPlaybackStalled",
            oneWayMedia: "oneWayMedia",
            fabricStateChange: "fabricStateChange",
            iceDisruptionStart: "iceDisruptionStart",
            iceDisruptionEnd: "iceDisruptionEnd",
            fabricTransportSwitch: "fabricTransportSwitch",
            iceConnectionDisruptionStart: "iceConnectionDisruptionStart",
            iceConnectionDisruptionEnd: "iceConnectionDisruptionEnd",
            iceAborted: "iceAborted",
            iceTerminated: "iceTerminated",
            iceFailed: "iceFailed",
            iceRestarted: "iceRestarted",
            fabricDropped: "fabricDropped",
            connectedDeviceList: "connectedDeviceList",
            sdpSubmission: "sdpSubmissionEvent",
            sendingThroughputObservations: "sendingThroughputObservations",
            limitationObservations: "limitationObservations",
            userDetails: "userDetails"
        }, c.callstatsChannels = {
            sdpSubmission: "sdpSubmissionEvent",
            processedStats: "processedStats",
            callstatsEvent: "callStatsEvent",
            userFeedback: "userFeedbackEvent",
            preCallTest: "preCallTest",
            senderConfiguration: "senderConfiguration"
        }, c.precalltestEvents = {
            results: "preCallTestResults",
            associate: "preCallTestAssociate"
        }, c.callstatsAPIReturnStatus = {
            success: "success",
            failure: "failure"
        }, c.fabricUsage = {
            audio: "audio",
            video: "video",
            data: "data",
            screen: "screen",
            multiplex: "multiplex",
            unbundled: "unbundled"
        }, c.userIdType = {
            local: "local",
            remote: "remote"
        }, c.qualityRating = {
            excellent: 5,
            good: 4,
            fair: 3,
            poor: 2,
            bad: 1
        }, c.reportType = {
            local: "local",
            remote: "remote",
            inbound: "inbound",
            outbound: "outbound"
        }, c.avQualityRatings = {
            excellent: "excellent",
            fair: "fair",
            bad: "bad",
            unknown: "unknown"
        }, c.fabricState = {
            established: "established",
            initializing: "initializing",
            failed: "failed",
            disrupted: "disrupted",
            hold: "hold",
            checkingDisrupted: "checkingDisrupted",
            terminated: "terminated"
        }, c.webRTCFunctions = {
            createOffer: "createOffer",
            createAnswer: "createAnswer",
            setLocalDescription: "setLocalDescription",
            setRemoteDescription: "setRemoteDescription",
            addIceCandidate: "addIceCandidate",
            getUserMedia: "getUserMedia",
            iceConnectionFailure: "iceConnectionFailure",
            signalingError: "signalingError",
            applicationError: "applicationError",
            applicationLog: "applicationLog"
        }, c.callFailureReasons = {
            mediaConfigError: "MediaConfigError",
            negotiationFailure: "NegotiationFailure",
            sdpError: "SDPGenerationError",
            iceFailure: "IceConnectionFailure",
            transportFailure: "TransportFailure",
            signalingError: "SignalingError",
            applicationError: "ApplicationError",
            applicationLog: "ApplicationLog",
            invalidWebRTCFunctionName: "Invalid WebRTC function name"
        }, c.throughputThreshold = {
            video: {
                green: 1024,
                red: 256
            },
            audio: {
                green: 30,
                red: 8
            }
        }, c.currOverPrevFrameRateThreshold = {
            video: {
                green: .8,
                red: .3
            }
        }, c.rttThreshold = {
            video: {
                green: 400,
                red: 1e3
            }
        }, c.fractionalLossThreshold = {
            video: {
                green: .1,
                red: .5
            },
            audio: {
                green: .15,
                red: .3
            }
        }, c.eModelThreshold = {
            audio: {
                green: 240,
                red: 400
            }
        }, c.codeBaseType = {
            chrome: "Chrome",
            firefox: "Firefox",
            edge: "Edge",
            plugin: "Plugin"
        }, c.browserName = {
            chrome: "Chrome",
            firefox: "Firefox",
            edge: "Edge",
            msie: "Microsoft Internet Explorer",
            safari: "Safari",
            opera: "Opera"
        }, c.osName = {
            windows: "Windows",
            mac: "Mac OS X",
            android: "Android",
            ios: "iOS"
        }, c.mediaType = {
            audio: "audio",
            video: "video"
        }, c.streamType = {
            inbound: "inbound",
            outbound: "outbound"
        }, c.fabricStateChangeType = {
            signalingState: "signalingState",
            iceConnectionState: "iceConnectionState",
            iceGatheringState: "iceGatheringState"
        }, c.transportType = {
            rest: "rest",
            ws: "ws"
        }, c.wsConnectionState = {
            initiated: "initiated",
            connected: "connected",
            closed: "closed"
        }, c.csCallBackMessages = {
            authSuccessful: "SDK authentication successful.",
            authFailed: "SDK authentication failed.",
            authProtocolInvalid: "Fatal authentication error. Invalid auth protocol message.",
            authOngoing: "Authentication on going.",
            wsConnected: "WebSocket establishment successful.",
            wsClosed: "WebSocket server closed.",
            wsFailed: "WebSocket establishment failed."
        }, c.oneWayMediaTypes = {
            audio: "audio",
            video: "video",
            screen: "screen"
        }, c.limitationType = {
            cpu: "cpu",
            network: "network"
        }, c.qualityDisruptionTypes = {
            qpchange: "qpchange"
        }, c.callbackFunctions = {
            stats: "stats",
            defaultConfig: "defaultConfig",
            recommendedConfig: "recommendedConfig",
            preCallTestResults: "preCallTestResults"
        }, c.endpointType = {
            peer: "peer",
            server: "server"
        }, c.transmissionDirection = {
            sendonly: "sendonly",
            receiveonly: "receiveonly",
            sendrecv: "sendrecv",
            inactive: "inactive"
        }, c.tmpConferenceId = "csio-conf-id-tmp";
    }, {} ],
    33: [ function(a, b, c) {
        "use strict";
        function d(a) {
            c.configServiceUrl = m = a;
        }
        function e(a) {
            c.authServiceUrl = n = a;
        }
        function f(a) {
            c.conferenceBaseUrl = o = a;
        }
        function g(a) {
            c.wsUrl = p = a;
        }
        function h(a) {
            c.restEventUrl = q = a;
        }
        function i(a) {
            c.restStatsUrl = r = a;
        }
        function j(a) {
            c.baseUrl = s = a;
        }
        function k(a) {
            c.qmodelThresholdsAPIUrl = t = a;
        }
        function l(a) {
            c.transportType = u = a;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.setConfigServiceUrl = d, c.setAuthServiceUrl = e, c.setConferenceBaseUrl = f, 
        c.setWsUrl = g, c.setRestEventUrl = h, c.setRestStatsUrl = i, c.setBaseUrl = j, 
        c.setQmodelThresholdsAPIUrl = k, c.setTransportType = l;
        var m = (c.version = "3.50.3", c.configServiceUrl = "https://appsettings.callstats.io/v1/apps/"), n = c.authServiceUrl = "https://auth.callstats.io/", o = (c.authRetryTimeout = 5e3, 
        c.conferenceBaseUrl = "https://dashboard.callstats.io/apps/"), p = c.wsUrl = "wss://collector.callstats.io:443/csiows/collectCallStats", q = c.restEventUrl = "https://events.callstats.io/v1/apps/", r = c.restStatsUrl = "https://stats.callstats.io/v1/apps/", s = c.baseUrl = "https://collector.callstats.io:443/", t = c.qmodelThresholdsAPIUrl = "https://dashboard.callstats.io/api-internal/v1/qmodelthresholds", u = (c.csioDebug = "false", 
        c.transportType = "@@transportType");
    }, {} ],
    34: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a) {
            if (Array.isArray(a)) {
                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];
                return c;
            }
            return Array.from(a);
        }
        function f(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function g(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function h(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        function i() {
            Array.prototype.find || Object.defineProperty(Array.prototype, "find", {
                value: function(a) {
                    if (null === this) throw new TypeError("Array.prototype.find called on null or undefined");
                    if ("function" != typeof a) throw new TypeError("predicate must be a function");
                    for (var b = Object(this), c = b.length >>> 0, d = arguments[1], e = void 0, f = 0; f < c; f++) if (e = b[f], 
                    a.call(d, e, f, b)) return e;
                }
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.MainFSM = c.MainEvents = void 0;
        var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, k = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), l = a("./statemachine"), m = a("../utility/registry"), n = a("../utility/csiologger"), o = d(n), p = a("../utility/utils"), q = d(p), r = a("../utility/timestamps"), s = d(r), t = a("../config/constants"), u = d(t), v = a("../config/settings"), w = d(v), x = a("./utility"), y = d(x), z = a("../statspipeline/statsadapter"), A = a("../statspipeline/statsparser"), B = a("../statspipeline/statsmonitor"), C = a("../statspipeline/statstransmitter"), D = a("../statspipeline/statsassembler"), E = {
            Created: "Created",
            Initializing: "Initializing",
            Idle: "Idle",
            Run: "Run"
        }, F = c.MainEvents = {
            onStart: "onStart",
            onInitialize: "onInitialize",
            onAddNewFabric: "onAddNewFabric",
            onSendFabricEvent: "onSendFabricEvent",
            onReportError: "onReportError",
            onAssociateMstWithUserID: "onAssociateMstWithUserID",
            onSetProxyConfig: "onSetProxyConfig",
            onAttachWifiStatsHandler: "onAttachWifiStatsHandler",
            onSendUserFeedback: "onSendUserFeedback",
            onOn: "onOn",
            onSetIdentifiers: "onSetIdentifiers",
            onMakePrecallTest: "onMakePrecallTest"
        }, G = {
            onServicesFinished: "onServicesFinished"
        }, H = function(a) {
            function b() {
                f(this, b);
                var a = g(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, E.Created));
                return o.log("FSM:", a.getState()), a.fire(F.onStart), a.run(), i(), a;
            }
            return h(b, a), k(b, [ {
                key: "proceed",
                value: function(a, b) {
                    switch (this.getState()) {
                      case E.Created:
                        switch (a) {
                          case F.onStart:
                            this.onStart.apply(this, e(b));
                            break;

                          case F.onInitialize:
                            this.setState(E.Initializing), o.log("FSM:", this.getState()), this.onInitialize.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                        }
                        break;

                      case E.Initializing:
                        switch (a) {
                          case G.onServicesFinished:
                            this.onServicesFinished() && (this.setState(E.Idle), o.log("FSM:", this.getState()));
                            break;

                          case F.onAddNewFabric:
                            this.onAddNewFabric.apply(this, e(b));
                            break;

                          case F.onSendFabricEvent:
                            this.onSendFabricEvent.apply(this, e(b));
                            break;

                          case F.onReportError:
                            this.onReportError.apply(this, e(b));
                            break;

                          case F.onAssociateMstWithUserID:
                            this.onAssociateMstWithUserID.apply(this, e(b));
                            break;

                          case F.onSendUserFeedback:
                            this.onSendUserFeedback.apply(this, e(b));
                            break;

                          case F.onAttachWifiStatsHandler:
                            this.onAttachWifiStatsHandler.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                            break;

                          case F.onMakePrecallTest:
                            this.onMakePrecallTest();
                            break;

                          case F.onSetIdentifiers:
                            this.onSetIdentifiers.apply(this, e(b));
                        }
                        break;

                      case E.Idle:
                      case E.Run:
                        switch (a) {
                          case F.onAddNewFabric:
                            this.onAddNewFabric.apply(this, e(b));
                            break;

                          case F.onSendFabricEvent:
                            this.onSendFabricEvent.apply(this, e(b));
                            break;

                          case F.onReportError:
                            this.onReportError.apply(this, e(b));
                            break;

                          case F.onAssociateMstWithUserID:
                            this.onAssociateMstWithUserID.apply(this, e(b));
                            break;

                          case F.onSendUserFeedback:
                            this.onSendUserFeedback.apply(this, e(b));
                            break;

                          case F.onAttachWifiStatsHandler:
                            this.onAttachWifiStatsHandler.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                            break;

                          case F.onMakePrecallTest:
                            this.onMakePrecallTest();
                            break;

                          case F.onSetIdentifiers:
                            this.onSetIdentifiers.apply(this, e(b));
                        }
                    }
                }
            }, {
                key: "onStart",
                value: function() {
                    m.Registry.getEndpoint().setup(), this.authenticator = m.Registry.getAuthenticator(), 
                    this.configservicewrapper = m.Registry.getConfigServiceWrapper(), this.precalltest = m.Registry.getPreCallTest(), 
                    this.precalltestIds = [];
                    var a = m.Registry.getStatsAdapter(), b = m.Registry.getStatsParser(), c = m.Registry.getStatsMonitor(), d = m.Registry.getStatsTransmitter(), e = m.Registry.getStatsAssembler();
                    a.connect(z.StatsAdapterIO.RawStatsOut, b.getPort(A.StatsParserIO.RawStatsIn)), 
                    b.connect(A.StatsParserIO.PcStatsTupleOut, c.getPort(B.StatsMonitorIO.PcStatsTupleIn)), 
                    c.connect(B.StatsMonitorIO.StatsTupleOut, e.getPort(D.StatsAssemblerIO.StatsTupleIn)), 
                    e.connect(D.StatsAssemblerIO.CallstatsOut, d.getPort(C.StatsTransmitterIO.CallstatsIn)), 
                    a.connect(z.StatsAdapterIO.UnprocessedOut, d.getPort(C.StatsTransmitterIO.UnprocessedIn));
                }
            }, {
                key: "setupConnection",
                value: function() {
                    var a = this;
                    this.connectionManager = m.Registry.getConnectionManager(), this.connectionManager.setupCollectorConnection(m.Registry.getCredentials().getTransportType()), 
                    this.connectionManager.setup().then(function() {
                        o.log("Connected to connectionManager"), a.fire(G.onServicesFinished), a.run();
                    }).catch(function(a) {
                        return o.log("Could not connect to connectionManager", a);
                    });
                }
            }, {
                key: "setup",
                value: function() {
                    var a = this;
                    this.clocksync = m.Registry.getClockSync(), this.clocksync.initiate().then(function() {
                        o.log("Clocksync completed"), a.fire(G.onServicesFinished), a.run();
                    }).catch(function(a) {
                        return o.log("Could not finish ClockSync", a);
                    });
                }
            }, {
                key: "onInitialize",
                value: function(a, b, c, d, e, f) {
                    var g = this, h = m.Registry.getCredentials();
                    if (h.setAppId(a), h.setUserId(b), m.Registry.getCallbacks().set(u.callbackFunctions.stats, e), 
                    this.doPrecalltest = !0, m.Registry.getGenericEventHandler().sendEvent(u.logEvents.log, {
                        msg: "callstats initialize in progress"
                    }), f) {
                        if (!0 === f.disableBeforeUnloadHandler && this.setBeforeUnloadHandler(), f.applicationVersion) {
                            m.Registry.getEndpoint().setAppVersion(f.applicationVersion);
                        }
                        f.transportType && w.setTransportType(f.transportType), f.disablePrecalltest && (this.doPrecalltest = !1);
                    }
                    this.setup(), this.authenticator.initiate(c, d).then(function(a) {
                        o.log("Authentication complete"), g.setupConnection();
                        var b = m.Registry.getCredentials().getStatsSubmissionInterval();
                        m.Registry.getStatsMonitor().setIntervals(b, b), g.fire(G.onServicesFinished), g.run();
                        var c = g.authenticator.getIceServers();
                        c && g.doPrecalltest && g.precalltest.start(c, g.precalltestCallback.bind(g)), g.configservicewrapper.initiateInternalConfig().then(function() {
                            o.log("ConfigService internal config:", g.configservicewrapper.getInternalConfig()), 
                            g.fire(G.onServicesFinished), g.run();
                        }, function(a) {
                            return o.log(a);
                        }), g.configservicewrapper.initiateAppConfig().then(function() {
                            var a = m.Registry.getCallbacks().get(u.callbackFunctions.defaultConfig), b = g.configservicewrapper.getAppDefaultConfig();
                            a && b && a(b);
                            var c = m.Registry.getCallbacks().get(u.callbackFunctions.recommendedConfig), d = g.configservicewrapper.getAppRecommendedConfig();
                            c && d && c(d), g.fire(G.onServicesFinished), g.run();
                        }, function(a) {
                            return o.log(a);
                        });
                    }, function(a) {
                        o.log(a);
                    }), this.genericevent = m.Registry.getGenericEventHandler(), this.genericevent.sendEvent(u.logEvents.log, {
                        msg: "callstats initialize in progress"
                    });
                }
            }, {
                key: "precalltestCallback",
                value: function(a, b) {
                    var c = m.Registry.getCallbacks().get(u.callbackFunctions.preCallTestResults);
                    if (c) {
                        if (b) {
                            var d = {
                                msg: "precalltest error: " + b
                            };
                            return o.warn("backendlog", d), this.genericevent.sendEvent(u.logEvents.log, d), 
                            void c(u.callstatsAPIReturnStatus.failure, null);
                        }
                        var e = y.getPublicPrecalltestResults(a);
                        c(u.callstatsAPIReturnStatus.success, e);
                    }
                    a && (this.precalltestIds.push(a.id), a.tests && a.tests.ice && ("" === a.tests.ice.turnIpAddress && delete a.tests.ice.turnIpAddress, 
                    "" === a.tests.ice.turnIpVersion && delete a.tests.ice.turnIpVersion, "" === a.tests.ice.turnTransport && delete a.tests.ice.turnTransport), 
                    o.log("sending preCallTest results", a), m.Registry.getEventMessageBuilder().make(u.precalltestEvents.results, null, null, {
                        results: a
                    }));
                }
            }, {
                key: "setBeforeUnloadHandler",
                value: function() {
                    window && window.addEventListener && (o.log("setBeforeUnloadHandler"), window.addEventListener("beforeunload", function(a) {
                        return m.Registry.getConferenceManager().conferenceMap.forEach(function(a, b) {
                            a && a.getPeerConnectionManager().pcHandlers.forEach(function(a, b) {
                                m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userLeft, a.getConferenceId(), a.getPeerConnection());
                            });
                        }), "Are you sure you want to close the call?";
                    }));
                }
            }, {
                key: "onServicesFinished",
                value: function() {
                    return !!(this.connectionManager && this.connectionManager.isReady() && this.clocksync.isCompleted() && this.authenticator.isCompleted()) && (m.Registry.getTransmissionManager().trySend(), 
                    !0);
                }
            }, {
                key: "onAddNewFabric",
                value: function(a, b, c, d, e, f, g) {
                    o.warn("FSM onAddNewFabric"), m.Registry.getConferenceManager().add(d, m.Registry.getCredentials());
                    var h = m.Registry.getConferenceManager().get(d);
                    h.getPeerConnectionManager().addPcHandler(a, b, c, d, e, f, g);
                    var i = {
                        endpointInfo: m.Registry.getEndpoint().serialize()
                    };
                    m.Registry.getCredentials().getUserIdObject() && (i.localUserIDObject = m.Registry.getCredentials().getUserIdObject()), 
                    h.userJoinedSent || (m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userJoined, d, a, i), 
                    h.userJoinedSent = !0, m.Registry.getCredentials().getTransportType() === u.transportType.rest && i.localUserIDObject && i.localUserIDObject.userName && m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userDetails, d, a, {
                        userName: String(i.localUserIDObject.userName)
                    }));
                    var j = this.precalltestIds;
                    this.precalltestIds = [];
                    var k = this.precalltest.getId();
                    k && j.push(k), j.length > 0 && m.Registry.getEventMessageBuilder().make(u.precalltestEvents.associate, d, a, {
                        ids: j
                    });
                }
            }, {
                key: "onSendFabricEvent",
                value: function(a, b, c, d) {
                    o.warn("FSM onSendFabricEvent");
                    var e = {};
                    if (d && (e = d), b === u.fabricEvent.activeDeviceList) {
                        e = {
                            mediaDeviceList: q.normalizeMediaDeviceList(d.deviceList)
                        };
                    }
                    m.Registry.getEventMessageBuilder().make(b, c, a, e);
                    var f = m.Registry.getConferenceManager().get(c);
                    if (f) {
                        var g = f.getPeerConnectionManager().getPcHandler(a);
                        b !== u.fabricEvent.fabricTerminated && b !== u.internalFabricEvent.fabricSetupFailed || (g.stopUserAliveHandler(), 
                        g.setPcState(u.fabricState.terminated), g.stopStatsPolling()), b === u.fabricEvent.fabricHold && (g.setPcState(u.fabricState.hold), 
                        g.stopStatsPolling()), b === u.fabricEvent.fabricResume && (g.setPcState(u.fabricState.established), 
                        g.startStatsPolling());
                    }
                }
            }, {
                key: "onReportError",
                value: function(a, b, c, d, e, f) {
                    o.warn("FSM onReportError");
                    var g = {
                        failureDelay: 0,
                        reason: this.callFailureClassifier(c),
                        function: c,
                        magicKey: m.Registry.getEndpoint().getMagicKey(),
                        endpoint: m.Registry.getEndpoint().serialize(),
                        level: "debug"
                    };
                    if (d) {
                        var h = this.formatDomError(d);
                        g.message = h.message, g.messageType = h.messageType, g.name = d.name, g.stack = d.stack;
                    }
                    if (a) {
                        var i = m.Registry.getConferenceManager().get(b), j = void 0;
                        if (i && (j = i.getPeerConnectionManager().getPcHandler(a)), !j) return void o.error("onReportError: No handler found for given PeerConnection!");
                        if (g.failureDelay = s.getCurrent() - j.getStartTime(), g.fabricState = j.getPcState(), 
                        g.iceConnectionState = j.getIceConnectionState(), (e || f || a && "closed" !== a.signalingState) && m.Registry.getCredentials().getCollectSDP() && c === u.fabricEvent.fabricSetupFailed) {
                            var k = {};
                            k.localSDP = this.pickSDP(a, e, "localDescription"), k.remoteSDP = this.pickSDP(a, f, "remoteDescription"), 
                            m.Registry.getEventMessageBuilder().make(u.callstatsChannels.sdpSubmission, b, a, k);
                        }
                    }
                    c === u.webRTCFunctions.applicationLog || c === u.webRTCFunctions.applicationError ? m.Registry.getEventMessageBuilder().make(u.fabricEvent.applicationErrorLog, b, a, g) : m.Registry.getEventMessageBuilder().make(u.fabricEvent.fabricSetupFailed, b, a, g);
                }
            }, {
                key: "onAssociateMstWithUserID",
                value: function(a, b, c, d, e, f) {
                    var g = m.Registry.getConferenceManager().get(c);
                    if (g) {
                        var h = g.getPeerConnectionManager().getPcHandler(a);
                        "string" != typeof d && (d += ""), h.updateSSRCInfo(d, b, e, f);
                    }
                }
            }, {
                key: "onAttachWifiStatsHandler",
                value: function(a) {
                    m.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(a);
                }
            }, {
                key: "onSetProxyConfig",
                value: function(a) {
                    a.collectorURL && w.setBaseUrl(a.collectorURL), a.authServiceURL && w.setAuthServiceUrl(a.authServiceURL), 
                    a.csioInternalAPIURL && w.setQmodelThresholdsAPIUrl(a.csioInternalAPIURL), a.wsURL && w.setWsUrl(a.wsURL), 
                    a.restEventUrl && w.setRestEventUrl(a.restEventURL), a.restStatsUrl && w.setRestStatsUrl(a.restStatsURL), 
                    this.setup();
                }
            }, {
                key: "onSendUserFeedback",
                value: function(a, b, c) {
                    var d = {
                        feedback: {
                            overallRating: b.overall
                        }
                    };
                    b.video && (d.feedback.videoQualityRating = b.video), b.audio && (d.feedback.audioQualityRating = b.audio), 
                    b.comment && (d.feedback.comments = b.comment), m.Registry.getEventMessageBuilder().make(u.callstatsChannels.userFeedback, a, null, d);
                }
            }, {
                key: "onOn",
                value: function(a, b) {
                    m.Registry.getCallbacks().set(a, b);
                }
            }, {
                key: "onSetIdentifiers",
                value: function(a, b) {
                    if (a.conferenceID && (m.Registry.getConferenceManager().updateConferenceId(a.conferenceID), 
                    m.Registry.getTransmissionManager().updateConferenceId(a.conferenceID), m.Registry.getTransmissionManager().trySend()), 
                    a.remoteUserID && b) {
                        var c = m.Registry.getConferenceManager().getConferenceForPc(b);
                        if (!c) return void o.log("onSetIdentifiers conference not found");
                        var d = c.getPeerConnectionManager().getPcHandler(b);
                        if (!d) return void o.log("pcHandler not found");
                        d.updateRemoteId(a.remoteUserID), m.Registry.getTransmissionManager().trySend();
                    }
                }
            }, {
                key: "onMakePrecallTest",
                value: function() {
                    var a = this, b = this.authenticator.getIceServers();
                    a.precalltest.start(b, a.precalltestCallback.bind(a));
                }
            }, {
                key: "callFailureClassifier",
                value: function(a) {
                    var b = void 0;
                    return u.webRTCFunctions.hasOwnProperty(a) ? a === u.webRTCFunctions.createOffer || a === u.webRTCFunctions.createAnswer || a === u.webRTCFunctions.setRemoteDescription ? b = u.callFailureReasons.negotiationFailure : a === u.webRTCFunctions.setLocalDescription ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.addIceCandidate ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.getUserMedia ? b = u.callFailureReasons.mediaConfigError : a === u.webRTCFunctions.iceConnectionFailure ? b = u.callFailureReasons.iceFailure : a === u.webRTCFunctions.signalingError ? b = u.callFailureReasons.signalingError : (a === u.webRTCFunctions.applicationLog || u.webRTCFunctions.applicationError) && (b = u.callFailureReasons.applicationLog) : b = u.callFailureReasons.invalidWebRTCFunctionName, 
                    b;
                }
            }, {
                key: "formatDomError",
                value: function(a) {
                    var b = {}, c = {};
                    a && (window.DOMException && a instanceof window.DOMException ? (c.message = a.message, 
                    c.name = a.name, b.messageType = "domError") : "object" === (void 0 === a ? "undefined" : j(a)) ? (a.message && (c.message = a.message), 
                    a.name && (c.name = a.name), a.constraintName && (c.name = a.constraintName), a.stack && (c.stack = a.stack), 
                    b.messageType = "json") : (c = a, b.messageType = "text"));
                    var d = this.truncateLog(c);
                    return "object" === (void 0 === d ? "undefined" : j(d)) ? b.message = JSON.stringify(d) : b.message = d, 
                    b;
                }
            }, {
                key: "pickSDP",
                value: function(a, b, c) {
                    return b || (a && a[c] ? a[c].sdp : "");
                }
            }, {
                key: "truncateString",
                value: function(a) {
                    return a.length > 2e4 && (o.log("Log exceeds 20kb, It will be truncated"), a = a.substring(0, 2e4)), 
                    a;
                }
            }, {
                key: "truncateLog",
                value: function(a) {
                    return a ? ("string" == typeof a ? a = this.truncateString(a) : "object" === (void 0 === a ? "undefined" : j(a)) && a.message && (a.message = this.truncateString(a.message)), 
                    a) : a;
                }
            } ]), b;
        }(l.StateMachine);
        c.MainFSM = H;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../statspipeline/statsadapter": 68,
        "../statspipeline/statsassembler": 69,
        "../statspipeline/statsmonitor": 71,
        "../statspipeline/statsparser": 72,
        "../statspipeline/statstransmitter": 73,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "../utility/utils": 100,
        "./statemachine": 36,
        "./utility": 37
    } ],
    35: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c) {
                d(this, a), this.type = b, this.args = void 0 !== c ? c : null;
            }
            return e(a, [ {
                key: "getType",
                value: function() {
                    return this.type;
                }
            }, {
                key: "getArgs",
                value: function() {
                    return this.args;
                }
            } ]), a;
        }();
        c.ProgramEvent = f;
    }, {} ],
    36: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StateMachine = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./programevent"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a(b) {
                d(this, a), this.events = [], this.state = b;
            }
            return e(a, [ {
                key: "fire",
                value: function(a) {
                    for (var b = arguments.length, c = Array(b > 1 ? b - 1 : 0), d = 1; d < b; d++) c[d - 1] = arguments[d];
                    var e = new f.ProgramEvent(a, c);
                    this.events.push(e);
                }
            }, {
                key: "proceed",
                value: function(a, b) {
                    h.warn("You need to overwrite the proceed function inan extended StateMachine");
                }
            }, {
                key: "setState",
                value: function(a) {
                    this.state = a;
                }
            }, {
                key: "getState",
                value: function() {
                    return this.state;
                }
            }, {
                key: "run",
                value: function() {
                    if (!(this.events.length < 1)) {
                        var a = this.events.shift();
                        this.proceed(a.getType(), a.getArgs());
                    }
                }
            } ]), a;
        }();
        c.StateMachine = i;
    }, {
        "../utility/csiologger": 87,
        "./programevent": 35
    } ],
    37: [ function(a, b, c) {
        "use strict";
        function d(a) {
            var b = {
                mediaConnectivity: !1,
                throughput: null,
                fractionalLoss: null,
                rtt: null
            };
            return a && a.tests ? (a.tests.rtt && (b.rtt = a.tests.rtt.median, b.mediaConnectivity = !0), 
            a.tests.throughput && (b.throughput = a.tests.throughput.average, b.fractionalLoss = Math.max(a.tests.throughput.fractionLostBytes, 0), 
            b.mediaConnectivity = !0), a.tests.ice && (a.tests.ice.relayTcpSuccess || a.tests.ice.relayTlsSuccess || a.tests.ice.relayUdpSuccess) && (b.mediaConnectivity = !0), 
            b) : b;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getPublicPrecalltestResults = d;
    }, {} ],
    38: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GetStatsHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../statspipeline/statsadapter"), j = a("../utility/registry"), k = a("../utility/rttregistry"), l = a("../utility/csiologger"), m = d(l), n = function() {
            function a(b, c, d, f, g) {
                e(this, a), this.pc = b, this.interval = d, this.codeBase = f, this.browserName = g, 
                this.getStatsTimer = null, this.isPromiseBased = !0, this.pcHash = c, this.genericevent = j.Registry.getGenericEventHandler();
            }
            return f(a, [ {
                key: "startStatsPolling",
                value: function() {
                    var a = this;
                    a.getStatsTimer || (m.log("startStatsPolling for ", a.pcHash), this.getStatsTimer = setInterval(function() {
                        a.csioGetStats(a.statsHandler, a.pcHash);
                    }, a.interval));
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsTimer && (clearInterval(this.getStatsTimer), this.getStatsTimer = null);
                }
            }, {
                key: "csioGetStats",
                value: function(a, b) {
                    var c = h.codeBaseType.firefox, d = h.codeBaseType.chrome, e = h.codeBaseType.edge, f = h.browserName.safari;
                    if (this.pc) try {
                        this.isTemaSys() ? this.getStatsTemasys(a, b) : this.codeBase === c ? this.getStatsFirefox(a, b) : this.browserName === f ? this.getStatsSafari(a, b) : this.codeBase === d ? this.getStatsChrome(a, b) : this.codeBase === e && this.getStatsEdge(a, b);
                    } catch (a) {
                        m.log("csioGetStats: Error ", a);
                    }
                }
            }, {
                key: "getStatsTemasys",
                value: function(a, b) {
                    this.pc.getStats(null, function(c) {
                        a(c, b);
                    }, function(a) {
                        m("getStatsTemasys error", a);
                    });
                }
            }, {
                key: "getStatsFirefox",
                value: function(a, b) {
                    var c = this, d = this.pc;
                    if (!c.isPromiseBased) return void d.getStats(null, function(c) {
                        a(c, b);
                    });
                    try {
                        d.getStats().then(function(c) {
                            a(c, b);
                        }).catch(function(e) {
                            c.isPromiseBased = !1, d.getStats(null, function(c) {
                                a(c, b);
                            });
                        });
                    } catch (e) {
                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Firefox getStats reports error ",
                            error: e.message + ":" + e.stack
                        }), d.getStats(null, function(c) {
                            a(c, b);
                        });
                    }
                }
            }, {
                key: "getStatsChrome",
                value: function(a, b) {
                    var c = this, d = c.pc;
                    if (window && window.csioReactNative) return void d.getStats(null, function(c) {
                        a(c, b);
                    }, function(a) {
                        c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "react-native getStats reports error",
                            error: a.message + ":" + a.stack
                        });
                    });
                    if (!c.isPromiseBased) return void d.getStats(function(c) {
                        a(c, b);
                    });
                    try {
                        d.getStats().then(function(c) {
                            (0, k.getRTTRegistry)().update(d), a(c, b);
                        }).catch(function(e) {
                            m.log("Chrome getStats Error ", e), c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                                msg: "Chrome getStats reports error",
                                error: e.message + ":" + e.stack
                            }), d.getStats(function(c) {
                                a(c, b);
                            });
                        });
                    } catch (e) {
                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Chrome getStats reports error",
                            error: e.message + ":" + e.stack
                        }), d.getStats(function(c) {
                            a(c, b);
                        });
                    }
                }
            }, {
                key: "getStatsEdge",
                value: function(a, b) {
                    var c = this;
                    c.pc.getStats().then(function(c) {
                        a(c, b);
                    }).catch(function(d) {
                        a({}, b), d ? c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Edge getStats reports error",
                            error: d.message + ":" + d.stack
                        }) : c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Edge getStats reports error"
                        });
                    });
                }
            }, {
                key: "getStatsSafari",
                value: function(a, b) {
                    var c = this;
                    c.pc.getStats().then(function(c) {
                        a(c, b);
                    }).catch(function(a) {
                        c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Safari getStats reports error",
                            error: a.message + ":" + a.stack
                        });
                    });
                }
            }, {
                key: "statsHandler",
                value: function(a, b) {
                    var c = j.Registry.getStatsAdapter();
                    if (a && c) try {
                        c.transmit(i.StatsAdapterIO.RawStatsIn, a, b);
                    } catch (a) {
                        m.log("statsHandler 123: Error ", a), j.Registry.getGenericEventHandler().sendEvent(h.logEvents.error, {
                            msg: "statsHandler: Error",
                            error: a.message + ":" + a.stack
                        });
                    }
                }
            }, {
                key: "iceCandidatesHandler",
                value: function(a, b) {
                    var c = j.Registry.getStatsAdapter(), d = void 0;
                    d = c.getIceCandidates(a), b(d);
                }
            }, {
                key: "getIceCandidates",
                value: function() {
                    var a = this;
                    return new Promise(function(b, c) {
                        a.csioGetStats(a.iceCandidatesHandler, function(a) {
                            b(a);
                        });
                    });
                }
            }, {
                key: "isTemaSys",
                value: function() {
                    return !!(window && window.AdapterJS && window.AdapterJS.WebRTCPlugin && window.AdapterJS.WebRTCPlugin.plugin);
                }
            } ]), a;
        }();
        c.GetStatsHandler = n;
    }, {
        "../config/constants": 32,
        "../statspipeline/statsadapter": 68,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/rttregistry": 95
    } ],
    39: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PcCallbackHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/timestamps"), k = d(j), l = a("../config/callstatserrors"), m = d(l), n = a("../utility/csiologger"), o = d(n), p = function() {
            function a(b, c, d, f, g, j) {
                var l = this;
                e(this, a), c && (this.conferenceId = b, this.pc = c, this.getStatsHandler = d, 
                this.userAlive = f, this.callback = j, this.remoteId = g, this.clocksync = i.Registry.getClockSync(), 
                this.emb = i.Registry.getEventMessageBuilder(), this.precalltest = i.Registry.getPreCallTest(), 
                this.genericevent = i.Registry.getGenericEventHandler(), this.iceCandidates = [], 
                this.iceConnectionState = c.iceConnectionState, this.iceGatheringState = c.iceGatheringState, 
                this.signalingState = c.signalingState, this.oldIceConnectionState = "", this.oldIceGatheringState = "", 
                this.iceConnectionStateTS = "", this.negotiationNeeded = 0, this.pcState = h.fabricState.initializing, 
                this.disruptedTS = 0, this.startTime = k.getCurrent(), this.established = !1, this.activeIceCandidatePair = null, 
                this.prevActiveIceCandidatePair = null, this.localIceCandidates = [], this.remoteIceCandidates = [], 
                this.iceCandidatePairs = [], this.iceConnectivityDelay = 0, this.iceGatheringDelay = 0, 
                this.fabricSetupSent = !1, this.pc && this.pc.addEventListener ? (this.pc.addEventListener("icecandidate", this.iceCandidateCallback.bind(this), !1), 
                this.pc.addEventListener("iceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this), !1), 
                this.pc.addEventListener("signalingstatechange", this.pcSignalingStateChangeCallback.bind(this), !1), 
                this.pc.addEventListener("negotiationneeded", this.pcNegotiationNeededCallback.bind(this), !1)) : this.pc && this.pc.attachEvent ? (o.info("attachEvent"), 
                this.pc.attachEvent("onicecandidate", this.iceCandidateCallback.bind(this)), this.pc.attachEvent("oniceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this)), 
                this.pc.attachEvent("onsignalingstatechange", this.pcSignalingStateChangeCallback.bind(this)), 
                this.pc.attachEvent("onnegotiationneeded", this.pcNegotiationNeededCallback.bind(this))) : o.error("callstats cannot monitor or collect stats"), 
                !c || "connected" !== c.iceConnectionState && "completed" !== c.iceConnectionState || (this.pcState = h.fabricState.established, 
                this.getStatsHandler.getIceCandidates().then(function(a) {
                    l.localIceCandidates = a.localIceCandidates, l.remoteIceCandidates = a.remoteIceCandidates, 
                    l.iceCandidatePairs = a.iceCandidatePairs, l.prevActiveIceCandidatePair = l.activeIceCandidatePair, 
                    l.activeIceCandidatePair = l.getActiveIceCandidatePair(), l.sendfabricSetup(), l.startStatsPolling();
                })));
            }
            return f(a, [ {
                key: "iceCandidateCallback",
                value: function(a) {
                    if (a && a.candidate) {
                        var b = a.candidate.candidate.split(" ");
                        if ("0" !== b[4] && "0" !== b[5]) {
                            var c = -1 !== b[4].indexOf(":"), d = "1" === b[1] ? "rtp" : "rtcp", e = {
                                transport: b[2],
                                protocol: d,
                                typePreference: b[3],
                                address: c ? "[" + b[4] + "]:" + b[5] : b[4] + ":" + b[5],
                                type: b[7],
                                media: a.candidate.sdpMid
                            };
                            -1 === this.iceCandidates.indexOf(e) && (this.iceCandidates.push(e), o.warn("CALLBACK: ICE candidate", e));
                        }
                    }
                }
            }, {
                key: "iceConnectionStateChangeCallback",
                value: function(a) {
                    var b = this;
                    if (a) {
                        o.log("pc states ", this.pc.iceGatheringState, this.pc.iceConnectionState), this.iceConnectionStateTS = this.clocksync.getSynchronizedTimestamp(), 
                        this.handleIceGatheringState(), this.handleIceConnectionState(), o.log("states ", this.iceGatheringState, this.iceConnectionState), 
                        "complete" === this.iceGatheringState && "checking" === this.iceConnectionState && this.handleIceChecking();
                        var c = {
                            prevIceConnectionState: this.oldIceConnectionState,
                            currIceConnectionState: this.iceConnectionState
                        }, d = this.iceConnectionState;
                        this.getStatsHandler.getIceCandidates().then(function(a) {
                            b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, 
                            b.iceCandidatePairs = a.iceCandidatePairs, b.prevActiveIceCandidatePair = b.activeIceCandidatePair, 
                            b.activeIceCandidatePair = b.getActiveIceCandidatePair(), "connected" === d || "completed" === d ? b.handleIceConnectedOrCompleted(c) : "failed" === d ? b.handleIceFailed(c) : "disconnected" === d ? b.handleIceDisconnected(c) : "closed" === d ? b.handleIceClosed(c) : "new" === d && b.handleIceRestart(c);
                        });
                    }
                }
            }, {
                key: "sendFabricStateChange",
                value: function(a) {
                    this.emb.make(h.internalFabricEvent.fabricStateChange, this.conferenceId, this.pc, a);
                }
            }, {
                key: "handleIceConnectionState",
                value: function() {
                    this.oldIceConnectionState = this.iceConnectionState, this.iceConnectionState = this.pc.iceConnectionState, 
                    o.warn("CALLBACK: ICE connection state change", this.oldIceConnectionState, "->", this.iceConnectionState);
                    var a = {
                        changedState: h.fabricStateChangeType.iceConnectionState,
                        prevState: this.oldIceConnectionState,
                        newState: this.iceConnectionState
                    };
                    this.sendFabricStateChange(a);
                }
            }, {
                key: "handleIceGatheringState",
                value: function() {
                    if (this.iceGatheringState !== this.pc.iceGatheringState) {
                        "complete" === this.pc.iceGatheringState && (this.iceGatheringDelay = k.getCurrent() - this.startTime), 
                        this.oldIceGatheringState = this.iceGatheringState, this.iceGatheringState = this.pc.iceGatheringState, 
                        o.warn("CALLBACK: ICE gathering state change", this.oldIceGatheringState, "->", this.iceGatheringState);
                        var a = {
                            changedState: h.fabricStateChangeType.iceGatheringState,
                            prevState: this.oldIceGatheringState,
                            newState: this.iceGatheringState
                        };
                        this.sendFabricStateChange(a);
                    }
                }
            }, {
                key: "handleIceChecking",
                value: function() {
                    if ("disconnected" === this.oldIceConnectionState && this.pcState === h.fabricState.checkingDisrupted) {
                        var a = {
                            prevIceConnectionState: this.oldIceConnectionState,
                            currIceConnectionState: this.iceConnectionState,
                            disruptionDelay: k.getCurrent() - this.disruptedTS
                        };
                        this.emb.make(h.internalFabricEvent.iceConnectionDisruptionEnd, this.conferenceId, this.pc, a);
                    }
                }
            }, {
                key: "handleIceConnectedOrCompleted",
                value: function(a) {
                    var b = k.getCurrent();
                    this.pcState === h.fabricState.disrupted && (a.prevIceCandidatePair = this.prevActiveIceCandidatePair, 
                    a.currIceCandidatePair = this.activeIceCandidatePair, a.disruptionDelay = b - this.disruptedTS, 
                    this.emb.make(h.internalFabricEvent.iceDisruptionEnd, this.conferenceId, this.pc, a)), 
                    this.iceConnectivityDelay = b - this.startTime, this.established = !0, this.pcState = h.fabricState.established, 
                    this.sendfabricSetup(), this.startStatsPolling();
                }
            }, {
                key: "sendfabricSetup",
                value: function() {
                    if (this.fabricSetupSent) return void o.log("fabricSetup has been sent already");
                    var a = {
                        delay: k.getCurrent() - this.startTime,
                        iceGatheringDelay: this.iceGatheringDelay,
                        iceConnectivityDelay: this.iceConnectivityDelay,
                        localIceCandidates: this.localIceCandidates,
                        remoteIceCandidates: this.remoteIceCandidates,
                        iceCandidatePairs: this.iceCandidatePairs
                    };
                    this.fabricSetupSent = !0;
                    var b = void 0;
                    if (this.conferenceId) {
                        b = i.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc), 
                        a.remoteEndpointType = b.getRemoteEndpointType(), a.fabricTransmissionDirection = b.getFabricTransmissionDirection();
                    }
                    this.pcState = h.fabricState.established, this.emb.make(h.internalFabricEvent.fabricSetup, this.conferenceId, this.pc, a);
                }
            }, {
                key: "isFabricSetupSent",
                value: function() {
                    return this.fabricSetupSent;
                }
            }, {
                key: "startStatsPolling",
                value: function() {
                    this.getStatsHandler.startStatsPolling();
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsHandler.stopStatsPolling();
                }
            }, {
                key: "handleIceFailed",
                value: function(a) {
                    a.currIceCandidatePair = this.activeIceCandidatePair, a.failureDelay = k.getCurrent() - this.startTime, 
                    a.delay = k.getCurrent() - this.startTime, this.pcState = h.fabricState.failed, 
                    "checking" === this.oldIceConnectionState ? this.sendIceFailed(a) : "completed" === this.oldIceConnectionState || "connected" === this.oldIceConnectionState ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === this.oldIceConnectionState && this.established ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === this.oldIceConnectionState && this.sendIceFailed(a);
                }
            }, {
                key: "getActiveIceCandidatePair",
                value: function() {
                    var a = null, b = this.iceCandidatePairs;
                    if (b && b.length > 0) {
                        var c = b.filter(function(a) {
                            return "true" === a.selected || "true" === a.googActiveConnection || !0 === a.selected || !0 === a.googActiveConnection;
                        });
                        c.length > 0 && (a = c[0]);
                    }
                    return a;
                }
            }, {
                key: "sendIceFailed",
                value: function(a) {
                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, 
                    a.iceCandidatePairs = this.iceCandidatePairs, o.log("sending icefailed ", a), this.emb.make(h.internalFabricEvent.iceFailed, this.conferenceId, this.pc, a);
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a) {
                    var b = this, c = {};
                    c.prevIceCandidatePair = b.activeIceCandidatePair, c.relayType = a, c.currIceConnectionState = b.iceConnectionState, 
                    c.prevIceConnectionState = b.oldIceConnectionState, c.switchDelay = null, b.getStatsHandler.getIceCandidates().then(function(a) {
                        b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, 
                        b.iceCandidatePairs = a.iceCandidatePairs, b.activeIceCandidatePair = b.getActiveIceCandidatePair(), 
                        c.currIceCandidatePair = b.activeIceCandidatePair, c.localIceCandidates = b.localIceCandidates, 
                        c.remoteIceCandidates = b.remoteIceCandidates, o.log("sending fabric transport switch ", c), 
                        "completed" !== c.currIceConnectionState && "connected" !== c.currIceConnectionState || "completed" !== c.prevIceConnectionState && "connected" !== c.prevIceConnectionState || b.emb.make(h.internalFabricEvent.fabricTransportSwitch, b.conferenceId, b.pc, c);
                    });
                }
            }, {
                key: "handleIceDisconnected",
                value: function(a) {
                    var b = k.getCurrent();
                    this.startTime = b, a.prevIceConnectionStateTs = this.iceConnectionStateTS, a.currIceCandidatePair = this.activeIceCandidatePair, 
                    "connected" === this.oldIceConnectionState || "completed" === this.oldIceConnectionState ? (this.pcState = h.fabricState.disrupted, 
                    this.disruptedTS = b, this.emb.make(h.internalFabricEvent.iceDisruptionStart, this.conferenceId, this.pc, a), 
                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed.")) : "checking" === this.oldIceConnectionState && (this.pcState = h.fabricState.checkingDisrupted, 
                    this.disruptedTS = b, this.emb.make(h.internalFabricEvent.iceConnectionDisruptionStart, this.conferenceId, this.pc, a), 
                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed."));
                }
            }, {
                key: "handleIceClosed",
                value: function(a) {
                    "new" === this.oldIceConnectionState || "checking" === this.oldIceConnectionState ? (a.failureDelay = k.getCurrent() - this.startTime, 
                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, 
                    a.iceCandidatePairs = this.iceCandidatePairs, this.emb.make(h.internalFabricEvent.iceAborted, this.conferenceId, this.pc, a)) : (a.currIceCandidatePair = this.activeIceCandidatePair, 
                    this.emb.make(h.internalFabricEvent.iceTerminated, this.conferenceId, this.pc, a), 
                    this.stopStatsPolling());
                }
            }, {
                key: "handleIceRestart",
                value: function(a) {
                    a.prevIceCandidatePair = this.prevActiveIceCandidatePair, "new" !== this.oldIceConnectionState && (o.log("iceRestarted sending"), 
                    this.established = !1, this.emb.make(h.internalFabricEvent.iceRestarted, this.conferenceId, this.pc, a));
                }
            }, {
                key: "pcSignalingStateChangeCallback",
                value: function(a) {
                    var b = this;
                    if (a) {
                        var c = this.signalingState;
                        this.signalingState = this.pc.signalingState, o.warn("CALLBACK: signaling state change", c, "->", this.signalingState);
                        var d = {
                            changedState: h.fabricStateChangeType.signalingState,
                            prevState: c,
                            newState: this.signalingState
                        };
                        this.sendFabricStateChange(d), "have-remote-offer" !== this.signalingState && "stable" !== this.signalingState || (this.precalltest.callStarts(), 
                        this.genericevent.sendEvent(h.logEvents.log, {
                            msg: "precalltest told to stop "
                        })), "closed" === this.signalingState && (this.emb.make(h.fabricEvent.fabricTerminated, this.conferenceId, this.pc), 
                        this.userAlive.stop(), this.precalltest.callFinished(), this.stopStatsPolling(), 
                        this.genericevent.sendEvent(h.logEvents.log, {
                            msg: "precalltest finished "
                        })), "have-local-offer" !== this.signalingState && "have-local-pranswer" !== this.signalingState && "stable" !== this.signalingState || (o.log(this.signalingState, ".. requesting sender config."), 
                        i.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function() {
                            var a = i.Registry.getConfigServiceWrapper().getSenderConfig();
                            o.log("Sender config:", a);
                            var c = h.callstatsChannels.senderConfiguration;
                            i.Registry.getEventMessageBuilder().make(c, b.conferenceId, b.pc, a);
                        }).catch(function(a) {
                            o.warn(a);
                        }));
                    }
                }
            }, {
                key: "pcNegotiationNeededCallback",
                value: function(a) {
                    a && (this.negotiationNeeded++, this.startTime = k.getCurrent(), o.warn("CALLBACK: negotiation needed", this.negotiationNeeded));
                }
            } ]), a;
        }();
        c.PcCallbackHandler = p;
    }, {
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    40: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PeerConnectionHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/registry"), h = a("../peerconnection/pccallbackhandler"), i = a("../browserapi/devices"), j = a("./useralivehandler"), k = a("./getstatshandler"), l = a("../config/constants"), m = d(l), n = a("../utility/timestamps"), o = d(n), p = a("../utility/csiologger"), q = d(p), r = function() {
            function a(b) {
                e(this, a), this.pc = b.pc, this.remoteId = b.remoteId, this.fabricUsage = b.fabricUsage, 
                this.callback = b.callback, this.conferenceId = b.conferenceId, this.remoteEndpointType = b.remoteEndpointType, 
                this.fabricTransmissionDirection = b.fabricTransmissionDirection, this.clocksync = g.Registry.getClockSync(), 
                this.startTime = this.clocksync.getSynchronizedTimestamp(), this.credentials = g.Registry.getCredentials(), 
                this.pcHash = this.generatePcHash(), this.ssrcMap = new Map(), this.localSdp = null, 
                this.remoteSdp = null, this.transportInfo = null, this.userAliveHandler = new j.UserAliveHandler(this.conferenceId, this.pc), 
                this.userAliveHandler.start(), this.emb = g.Registry.getEventMessageBuilder(), this.devices = new i.Devices(this.conferenceId, this.pc);
                var c = g.Registry.getEndpoint();
                this.getStatsHandler = new k.GetStatsHandler(this.pc, this.pcHash, 5e3, c.getCodeBase(), c.getBrowserName()), 
                this.pcCallbackHandler = new h.PcCallbackHandler(this.conferenceId, this.pc, this.getStatsHandler, this.userAliveHandler, this.remoteId, this.callback), 
                this.devices.collectConnected(), this.fabricTransmissionDirection || (this.fabricTransmissionDirection = "sendrecv"), 
                this.remoteEndpointType || (this.remoteEndpointType = "peer");
            }
            return f(a, [ {
                key: "getFabricTransmissionDirection",
                value: function() {
                    return this.fabricTransmissionDirection;
                }
            }, {
                key: "getRemoteEndpointType",
                value: function() {
                    return this.remoteEndpointType;
                }
            }, {
                key: "stopUserAliveHandler",
                value: function() {
                    this.userAliveHandler.stop();
                }
            }, {
                key: "getPcState",
                value: function() {
                    return this.pcCallbackHandler.pcState;
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsHandler.stopStatsPolling();
                }
            }, {
                key: "startStatsPolling",
                value: function() {
                    this.getStatsHandler.startStatsPolling();
                }
            }, {
                key: "setPcState",
                value: function(a) {
                    a in m.fabricState ? this.pcCallbackHandler.pcState = a : q.error("setPcState: Invalid state");
                }
            }, {
                key: "getAppId",
                value: function() {
                    return this.credentials.getAppId();
                }
            }, {
                key: "getLocalId",
                value: function() {
                    return this.credentials.getUserId();
                }
            }, {
                key: "getConferenceId",
                value: function() {
                    return this.conferenceId;
                }
            }, {
                key: "getPeerConnection",
                value: function() {
                    return this.pc;
                }
            }, {
                key: "getRemoteId",
                value: function() {
                    return this.remoteId;
                }
            }, {
                key: "isFabricSetupSent",
                value: function() {
                    return this.pcCallbackHandler.isFabricSetupSent();
                }
            }, {
                key: "getStartTime",
                value: function() {
                    return this.startTime;
                }
            }, {
                key: "getCallback",
                value: function() {
                    return this.callback;
                }
            }, {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getIceCandidates",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceCandidates : null;
                }
            }, {
                key: "getIceConnectionState",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceConnectionState : null;
                }
            }, {
                key: "getNegotiationsNumber",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.negotiationNeeded : 0;
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a) {
                    this.pcCallbackHandler && this.pcCallbackHandler.sendFabricTransportSwitch(a);
                }
            }, {
                key: "getSdp",
                value: function() {
                    return {
                        localSdp: this.localSdp,
                        remoteSdp: this.remoteSdp
                    };
                }
            }, {
                key: "setSdp",
                value: function(a, b) {
                    this.localSdp = a, this.remoteSdp = b;
                }
            }, {
                key: "generatePcHash",
                value: function() {
                    var a = (Math.random() + 1).toString(36);
                    return a.substring(2, a.length);
                }
            }, {
                key: "getTransportInfo",
                value: function() {
                    return this.transportInfo;
                }
            }, {
                key: "setTransportInfo",
                value: function(a) {
                    this.transportInfo = a;
                }
            }, {
                key: "updateSDP",
                value: function(a) {
                    var b = this, c = this.pc.localDescription.sdp, d = this.pc.remoteDescription.sdp;
                    if (c && d && (c !== this.localSdp || d !== this.remoteSdp)) {
                        this.parseSDP(c, m.streamType.outbound), this.parseSDP(d, m.streamType.inbound);
                        var e = {
                            localSDP: c !== this.localSdp ? c : "",
                            remoteSDP: d !== this.remoteSdp ? d : ""
                        };
                        "" === c && "" === remoteSDP || !g.Registry.getCredentials().getCollectSDP() || this.emb.make(m.internalFabricEvent.sdpSubmission, this.conferenceId, this.pc, e), 
                        a && a.forEach(function(a) {
                            var c = String(a.data.ssrc), d = b.ssrcMap.get(c);
                            d || (d = {}), d.mediaType = a.data.mediaType, d.reportType = a.data.isRemote ? "remote" : "local", 
                            d.ssrc = c, b.ssrcMap.set(c, d);
                        });
                        var f = [];
                        this.ssrcMap.forEach(function(a, b) {
                            f.push(a);
                        });
                        for (var h = {
                            ssrcData: f
                        }, i = 0; i < h.ssrcData.length; i += 1) {
                            h.ssrcData[i].userID = g.Registry.getCredentials().getUserId();
                        }
                        this.emb.make(m.internalFabricEvent.ssrcMap, this.conferenceId, this.pc, h), this.setSdp(c, d);
                    }
                }
            }, {
                key: "parseSDP",
                value: function(a, b) {
                    var c = this, d = RegExp.prototype.test.bind(/^([a-z])=(.*)/), e = /^ssrc:(\d*) ([\w_]*):(.*)/, f = /^ssrc-group:SIM (\d*)/;
                    a.split(/(\r\n|\r|\n)/).filter(d).forEach(function(a) {
                        var d = a[0], g = a.slice(2);
                        if ("a" === d && e.test(g)) {
                            var h = g.match(e), i = h[1], j = h[2], k = h[3], l = c.ssrcMap.get(i);
                            if (l || (l = {}), l.ssrc = i, l[j] = k, l.localStartTime = o.getCurrent(), l.syncedStartTime = c.clocksync.getSynchronizedTimestamp(), 
                            l.streamType = b, !f.test(g)) return void c.ssrcMap.set(i, l);
                            l.ssrcGroup = {}, l.ssrcGroup[b] = {}, l.ssrcGroup[b].simulcastGroup = g.match(/\d+/g), 
                            c.ssrcMap.set(i, l);
                        }
                    });
                }
            }, {
                key: "getSSRCInfo",
                value: function(a) {
                    return this.ssrcMap.get(a);
                }
            }, {
                key: "setupVideoTagMethods",
                value: function(a, b) {
                    var c = this, d = document.getElementById(a);
                    d && (d.oncanplay = function() {
                        var a = {
                            ssrc: String(b),
                            highResTs: o.getCurrent()
                        };
                        c.emb.make(m.internalFabricEvent.mediaPlaybackStart, c.conferenceId, c.pc, a);
                    }, d.onsuspend = function() {
                        var a = {
                            ssrc: String(b),
                            highResTs: o.getCurrent()
                        };
                        c.emb.make(m.internalFabricEvent.mediaPlaybackSuspended, c.conferenceId, c.pc, a);
                    });
                }
            }, {
                key: "updateSSRCInfo",
                value: function(a, b, c, d) {
                    var e = this.ssrcMap.get(a);
                    e || (e = {}), e.ssrc = a, e.remoteUserID = b, e.usageLabel = c, e.associatedVideoTag = d, 
                    this.ssrcMap.set(a, e), d && b !== this.credentials.getUserId() && this.setupVideoTagMethods(d, a);
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a, this.userAliveHandler.updateConferenceId(a);
                }
            }, {
                key: "updateRemoteId",
                value: function(a) {
                    this.remoteId = a;
                }
            } ], [ {
                key: "Builder",
                get: function() {
                    return function() {
                        function b() {
                            e(this, b);
                        }
                        return f(b, [ {
                            key: "withPc",
                            value: function(a) {
                                return this.pc = a, this;
                            }
                        }, {
                            key: "withRemoteId",
                            value: function(a) {
                                return this.remoteId = a, this;
                            }
                        }, {
                            key: "withFabricUsage",
                            value: function(a) {
                                return this.fabricUsage = a, this;
                            }
                        }, {
                            key: "withConferenceId",
                            value: function(a) {
                                return this.conferenceId = a, this;
                            }
                        }, {
                            key: "withRemoteEndpointType",
                            value: function(a) {
                                return this.remoteEndpointType = a, this;
                            }
                        }, {
                            key: "withFabricTransmissionDirection",
                            value: function(a) {
                                return this.fabricTransmissionDirection = a, this;
                            }
                        }, {
                            key: "withCallback",
                            value: function(a) {
                                return this.callback = a, this;
                            }
                        }, {
                            key: "make",
                            value: function() {
                                return new a(this);
                            }
                        } ]), b;
                    }();
                }
            } ]), a;
        }();
        c.PeerConnectionHandler = r;
    }, {
        "../browserapi/devices": 18,
        "../config/constants": 32,
        "../peerconnection/pccallbackhandler": 39,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "./getstatshandler": 38,
        "./useralivehandler": 42
    } ],
    41: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PeerConnectionManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./peerconnectionhandler"), g = function() {
            function a() {
                d(this, a), this.pcHandlers = new Map();
            }
            return e(a, [ {
                key: "addPcHandler",
                value: function(a, b, c, d, e, g, h) {
                    if (!this.getPcHandler(a)) {
                        var i = new f.PeerConnectionHandler.Builder().withPc(a).withRemoteId(b).withFabricUsage(c).withConferenceId(d).withRemoteEndpointType(e).withFabricTransmissionDirection(g).withCallback(h).make();
                        this.pcHandlers.set(i.getPcHash(), i);
                    }
                }
            }, {
                key: "getPcHandler",
                value: function(a) {
                    var b = null;
                    return a ? (this.pcHandlers.forEach(function(c, d) {
                        c && c.getPeerConnection() === a && (b = c);
                    }), b) : b;
                }
            }, {
                key: "getPcHandlerByHash",
                value: function(a) {
                    return a && this.pcHandlers.has(a) ? this.pcHandlers.get(a) : null;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.pcHandlers.forEach(function(b, c) {
                        b.updateConferenceId(a);
                    });
                }
            } ]), a;
        }();
        c.PeerConnectionManager = g;
    }, {
        "./peerconnectionhandler": 40
    } ],
    42: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.UserAliveHandler = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h), j = a("../utility/timeoutprocess"), k = a("../utility/registry"), l = 1e4, m = function(a) {
            function b(a, c) {
                d(this, b);
                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, l));
                return f.emb = k.Registry.getEventMessageBuilder(), f.pc = c, f.conferenceId = a, 
                f.setCallback(f.send), f;
            }
            return f(b, a), g(b, [ {
                key: "send",
                value: function() {
                    this.conferenceId !== i.tmpConferenceId && this.pc && this.emb.make(i.internalFabricEvent.userAlive, this.conferenceId, this.pc);
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a;
                }
            } ]), b;
        }(j.TimeoutProcess);
        c.UserAliveHandler = m;
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "../utility/timeoutprocess": 97
    } ],
    43: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Authenticator = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, j = a("./jwt/jwt"), k = a("./jwt/jwttoken"), l = a("../config/settings"), m = d(l), n = a("../utility/base64"), o = d(n), p = a("../config/callstatserrors"), q = d(p), r = a("../config/constants"), s = d(r), t = a("../browserapi/localstorage"), u = d(t), v = a("../utility/json"), w = d(v), x = a("./xmlhttp"), y = a("./xmlhttpservice"), z = a("../utility/registry"), A = a("../utility/csiologger"), B = d(A), C = m.authRetryTimeout, D = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "Authenticator"));
                return a.clockSync = z.Registry.getClockSync(), a.credentials = z.Registry.getCredentials(), 
                a.url = m.authServiceUrl, a;
            }
            return g(b, a), h(b, [ {
                key: "initiate",
                value: function(a, c) {
                    var d = this;
                    return this.inProgress ? (c && c(q.csError.authOngoing, null), new Promise(function(a, b) {
                        b(new Error(d.name + ": in progress"));
                    })) : this.credentials.getAppId() && this.credentials.getUserId() ? (this.initCallback = c, 
                    "function" == typeof a ? (this.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this)) : new Promise(function(c, e) {
                        d.createTokenGenerator(a).then(function(a) {
                            d.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", d).call(d).then(function() {
                                c();
                            }, function(a) {
                                e(a);
                            });
                        }, function(a) {
                            e(new Error(d.name + ": tokenGenerator creation problem (" + a + ")"));
                        });
                    })) : new Promise(function(a, b) {
                        b(new Error(d.name + ": credentials not set"));
                    });
                }
            }, {
                key: "getToken",
                value: function() {
                    var a = null;
                    return this.token && (a = this.token.getToken()), a;
                }
            }, {
                key: "isTokenValid",
                value: function() {
                    return !!this.token && this.token.isValid(this.credentials);
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.elapsed : null;
                }
            }, {
                key: "getIceServers",
                value: function() {
                    return this.iceServers;
                }
            }, {
                key: "reset",
                value: function() {
                    this.token = null, this.reauthTimer = null, this.renew = !1, this.credentials = null, 
                    this.jwt = new j.Jwt(), this.tokenGenerator = function(a, b) {
                        b("Token generator is not set");
                    }, this.elapsed = 0, this.iceServers = null, i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "setupToken",
                value: function(a) {
                    u.store("csio_auth_data", JSON.stringify(a)), this.token = new k.JwtToken(a, this.clockSync);
                }
            }, {
                key: "clearReauthTimer",
                value: function() {
                    null !== this.reauthTimer && (clearTimeout(this.reauthTimer), this.reauthTimer = null);
                }
            }, {
                key: "setupReauthTimer",
                value: function(a) {
                    var b = this;
                    b.clearReauthTimer(), b.reauthTimer = setTimeout(function() {
                        b.reAuthenticate();
                    }, a);
                }
            }, {
                key: "reAuthenticate",
                value: function() {
                    this.inProgress || (this.inProgress = !0, this.token = null, this.sendRequest());
                }
            }, {
                key: "handleErrorActions",
                value: function(a) {
                    if (0 !== a.length) {
                        var b = a.shift();
                        if (b.action === q.authErrorActions.RETRY) {
                            var c = b.params.timeout ? b.params.timeout : m.authRetryTimeout;
                            this.setupReauthTimer(c), this.handleErrorActions(a);
                        }
                        b.action === q.authErrorActions.GET_NEW_TOKEN && (this.renew = !0, this.handleErrorActions(a)), 
                        b.action === q.authErrorActions.REPORT_ERROR && (B.error(this.name + ": " + b.params.errorReason), 
                        this.handleErrorActions(a));
                    }
                }
            }, {
                key: "setTokenGenerator",
                value: function(a) {
                    this.tokenGenerator = a;
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed(), d = w.parse(b.response);
                    if (!d) return B.error(this.name + ": invalid authentication response"), void this.sendNextRequest();
                    if (d["urn:x-callstats:auth:errorActions"] && d["urn:x-callstats:auth:errorActions"].length > 0) return void this.handleErrorActions(d["urn:x-callstats:auth:errorActions"]);
                    if (200 === b.status) {
                        if ("bearer" !== d.token_type) return B.error(this.name + ": successful, but token type was not bearer. Scheduling retry."), 
                        void this.sendNextRequest();
                        this.setupToken(d.access_token), d.iceServers && (this.iceServers = d.iceServers);
                        var e = parseInt(1e3 * parseInt(d.expires_in) * .9);
                        return this.setupReauthTimer(e), this.renew = !1, this.initCallback && this.initCallback(q.csError.success, s.csCallBackMessages.authSuccessful), 
                        this.elapsed = c, void this.completeProcess();
                    }
                    B.error("Authentication failed, but no error actions were defined in response."), 
                    this.sendNextRequest();
                }
            }, {
                key: "request",
                value: function() {
                    var a = this;
                    this.clearReauthTimer();
                    var b = new Promise(function(b, c) {
                        a.tempResolve = b, a.tempReject = c;
                    });
                    return this.tokenGenerator(this.renew, function(b, c) {
                        if (null !== b) return a.initCallback && a.initCallback(q.csError.tokenGenerationError, b.toString()), 
                        a.rejectCb(new Error(a.name + ": tokenGenerationError")), B.error("tokenGenerationError ", b), 
                        null;
                        var d = a.url + "authenticate", e = {
                            client_id: a.credentials.userId + "@" + a.credentials.getAppId(),
                            code: c,
                            grant_type: "authorization_code"
                        }, f = {
                            "Content-Type": "application/x-www-form-urlencoded"
                        };
                        (0, x.sendPostRequest)(d, f, C, e).then(function(b) {
                            a.tempResolve(b);
                        }, function(b) {
                            a.tempReject(b);
                        });
                    }), b;
                }
            }, {
                key: "tokenGeneratorCreator",
                value: function(a, b) {
                    var c = this;
                    return function(d, e) {
                        var f = null, g = {
                            alg: "HS256"
                        };
                        if (!d && null !== f) return e(null, f);
                        var h = c.credentials, i = {
                            userID: h.getUserId(),
                            appID: h.getAppId()
                        };
                        b && (i.keyId = b), c.jwt.sign(g, i, a).then(function(a) {
                            f = a, e(null, a);
                        }).catch(function(a) {
                            e(a);
                        });
                    };
                }
            }, {
                key: "createTokenGenerator",
                value: function(a) {
                    var b = this;
                    return new Promise(function(c, d) {
                        var e = null;
                        a.indexOf(":") > -1 && (e = o.strtohex(a.split(":")[0]), a = a.split(":")[1]), b.jwt.importKey(a).then(function(d) {
                            a = null;
                            var f = b.tokenGeneratorCreator(d, e);
                            c(f);
                        }).catch(function(a) {
                            B.error(b.name + ": could not import key (" + a + ")"), d(a);
                        });
                    });
                }
            } ]), b;
        }(y.XMLHttpService);
        c.Authenticator = D;
    }, {
        "../browserapi/localstorage": 19,
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/base64": 84,
        "../utility/csiologger": 87,
        "../utility/json": 92,
        "../utility/registry": 94,
        "./jwt/jwt": 51,
        "./jwt/jwttoken": 52,
        "./xmlhttp": 57,
        "./xmlhttpservice": 58
    } ],
    44: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GenericEventHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/settings"), h = d(g), i = a("./xmlhttp"), j = a("../utility/registry"), k = a("../utility/csiologger"), l = d(k), m = h.baseUrl + "generics", n = function() {
            function a() {
                e(this, a), this.credentials = j.Registry.getCredentials(), this.enabled = !1;
            }
            return f(a, [ {
                key: "enable",
                value: function() {
                    this.enabled = !0;
                }
            }, {
                key: "disable",
                value: function() {
                    this.enabled = !1;
                }
            }, {
                key: "sendEvent",
                value: function(a, b) {
                    this.send(a, b).then(function(a) {
                        l.log("Got generic response: %o", a);
                    }).catch(function(a) {
                        l.log("Got error for generic request", a);
                    });
                }
            }, {
                key: "send",
                value: function(a, b) {
                    if (!this.enabled) return new Promise(function(a, b) {
                        b(new Error("GenericEvent Error: not enabled"));
                    });
                    var c = this;
                    return new Promise(function(d, e) {
                        var f = {
                            "Content-Type": "application/json"
                        }, g = {
                            appID: c.credentials.appId,
                            userID: encodeURIComponent(c.credentials.userId),
                            version: h.version,
                            eventType: a,
                            data: b
                        };
                        (0, i.sendPostRequest)(m, f, 5e3, g).then(function(a) {
                            d(a.getXhr().response);
                        }, function(a) {
                            e(a);
                        });
                    });
                }
            } ]), a;
        }();
        c.GenericEventHandler = n;
    }, {
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./xmlhttp": 57
    } ],
    45: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ClockSync = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, j = a("../config/settings"), k = d(j), l = a("./xmlhttp"), m = a("../utility/timestamps"), n = d(m), o = a("./xmlhttpservice"), p = a("../utility/registry"), q = a("../config/constants"), r = d(q), s = k.baseUrl + "clockSync", t = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ClockSync"));
                return a.currentOffset = 0, a.completed = !1, a;
            }
            return g(b, a), h(b, [ {
                key: "initiate",
                value: function() {
                    return this.startTime = n.getCurrent(), p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "Starting clocksync"
                    }), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this);
                }
            }, {
                key: "getSynchronizedTimestamp",
                value: function() {
                    return n.getCurrent() + this.currentOffset;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.endTime - this.startTime : null;
                }
            }, {
                key: "getOffset",
                value: function() {
                    return this.currentOffset;
                }
            }, {
                key: "reset",
                value: function() {
                    this.currentOffset = 0, this.offsetResults = [], this.startTime = 0, this.endTime = 0, 
                    i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "request",
                value: function() {
                    return (0, l.sendGetRequest)(s, null, 5e3);
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed(), d = JSON.parse(b.response), e = n.getCurrent();
                    this.handleMessage(d, c, e);
                }
            }, {
                key: "handleMessage",
                value: function(a, b, c) {
                    var d = b / 2;
                    d > 6e4 ? (this.offsetResults = [], p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync restarting"
                    })) : this.addOffset(a, d, c), this.offsetResults.length >= 5 ? (this.calculateOffset(), 
                    this.endTime = n.getCurrent(), this.completeProcess()) : this.sendRequest();
                }
            }, {
                key: "isCompleted",
                value: function() {
                    return this.completed;
                }
            }, {
                key: "addOffset",
                value: function(a, b, c) {
                    var d = a.now + b, e = d - c;
                    this.offsetResults.push(e), p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync Info: serverTime " + d + " responseRecvTs: " + c
                    });
                }
            }, {
                key: "calculateOffset",
                value: function() {
                    var a = this.offsetResults.reduce(function(a, b) {
                        return a + b;
                    });
                    this.currentOffset = a / this.offsetResults.length, this.currentOffset = isNaN(this.currentOffset) ? 0 : this.currentOffset, 
                    p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync Done, offset is: " + this.currentOffset + "results length" + this.offsetResults.length
                    }), this.offsetResults = [], this.completed = !0;
                }
            } ]), b;
        }(o.XMLHttpService);
        c.ClockSync = t;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "./xmlhttp": 57,
        "./xmlhttpservice": 58
    } ],
    46: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a), this.connected = !1, this.reconnected = !1, this.conferenceUrl = {};
            }
            return e(a, [ {
                key: "setup",
                value: function() {
                    return new Promise(function(a, b) {
                        a();
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    return this.connected;
                }
            }, {
                key: "send",
                value: function(a) {}
            } ]), a;
        }();
        c.CollectorConnection = f;
    }, {} ],
    47: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServiceGet = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, i = a("../xmlhttp"), j = a("../xmlhttpservice"), k = a("../../utility/registry"), l = function(a) {
            function b() {
                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ConfigService"));
            }
            return f(b, a), g(b, [ {
                key: "initiate",
                value: function(a) {
                    var c = this;
                    return this.url = a, this.authToken = k.Registry.getAuthenticator().getToken(), 
                    this.authToken ? h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this) : new Promise(function(a, b) {
                        b(new Error(c.name + ": authToken has to be string"));
                    });
                }
            }, {
                key: "getConfig",
                value: function() {
                    return this.config;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.elapsed : null;
                }
            }, {
                key: "reset",
                value: function() {
                    this.authToken = null, this.url = null, this.config = null, this.elapsed = 0, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "request",
                value: function() {
                    var a = {
                        Authorization: "Bearer " + this.authToken
                    };
                    return (0, i.sendGetRequest)(this.url, a, 2e3);
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed();
                    this.config = JSON.parse(b.response), this.elapsed = c, this.completeProcess();
                }
            } ]), b;
        }(j.XMLHttpService);
        c.ConfigServiceGet = l;
    }, {
        "../../utility/registry": 94,
        "../xmlhttp": 57,
        "../xmlhttpservice": 58
    } ],
    48: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServicePost = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, i = a("../xmlhttp"), j = a("./configserviceget"), k = function(a) {
            function b() {
                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
            }
            return f(b, a), g(b, [ {
                key: "initiate",
                value: function(a, c) {
                    return this.body = c, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this, a);
                }
            }, {
                key: "request",
                value: function() {
                    var a = {
                        Authorization: "Bearer " + this.authToken
                    };
                    return a["Content-Type"] = "application/json", (0, i.sendPostRequest)(this.url, a, 2e3, this.body);
                }
            } ]), b;
        }(j.ConfigServiceGet);
        c.ConfigServicePost = k;
    }, {
        "../xmlhttp": 57,
        "./configserviceget": 47
    } ],
    49: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServiceWrapper = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./configserviceget"), i = a("./configservicepost"), j = a("../../config/settings"), k = d(j), l = a("../../utility/registry"), m = a("../../utility/csiologger"), n = d(m), o = k.configServiceUrl, p = function() {
            function a() {
                e(this, a), this.internalConfigService = new h.ConfigServiceGet(), this.appConfigService = new h.ConfigServiceGet(), 
                this.senderConfigService = new i.ConfigServicePost(), this.defaultSenderConfig = null;
            }
            return g(a, [ {
                key: "initiateInternalConfig",
                value: function() {
                    var a = this, b = l.Registry.getCredentials().getAppId();
                    if (!b) return new Promise(function(b, c) {
                        n.log("appId has to be string"), c(new Error(a.internalConfigService.name + ": appId has to be string"));
                    });
                    var c = o + b;
                    return this.internalConfigService.initiate(c + "/configurations/internal");
                }
            }, {
                key: "initiateAppConfig",
                value: function() {
                    var a = this, b = l.Registry.getCredentials().getAppId();
                    if (!b) return new Promise(function(b, c) {
                        n.log("appId has to be string"), c(new Error(a.appConfigService.name + ": appId has to be string"));
                    });
                    var c = o + b;
                    return this.appConfigService.initiate(c + "/configurations");
                }
            }, {
                key: "initiateSenderConfig",
                value: function(a) {
                    var b = this;
                    if (this.senderConfigService.getConfig()) return new Promise(function(a, c) {
                        n.log("sender config already present"), c(new Error(b.senderConfigService.name + ": sender config already present"));
                    });
                    var c = l.Registry.getCredentials().getAppId(), d = l.Registry.getCredentials().getUserId();
                    if (!c || !d) return new Promise(function(a, c) {
                        n.log("appId and userId have to be string"), c(new Error(b.senderConfigService.name + ": appId and userId have to be string"));
                    });
                    if (this.defaultSenderConfig = this.getCurrentVideoSenderConfig(a), !this.defaultSenderConfig) return new Promise(function(a, c) {
                        n.log("Could not obtain a sender config"), c(new Error(b.senderConfigService.name + ": Could not obtain a sender config"));
                    });
                    var e = o + c, f = {
                        app_id: c,
                        local_id: d,
                        rtc_rtp_parameters: this.defaultSenderConfig
                    };
                    return this.senderConfigService.initiate(e + "/configurations", f);
                }
            }, {
                key: "getInternalConfig",
                value: function() {
                    return this.internalConfigService.getConfig();
                }
            }, {
                key: "getAppDefaultConfig",
                value: function() {
                    var a = this.appConfigService.getConfig(), b = {
                        peerConnection: null,
                        media: null
                    };
                    return a.default ? (a.default.peerConnection && (b.peerConnection = a.default.peerConnection), 
                    a.default.media && (b.media = a.default.media), b) : b;
                }
            }, {
                key: "getAppRecommendedConfig",
                value: function() {
                    var a = this.appConfigService.getConfig(), b = {};
                    return a.recommended ? (a.recommended.peerConnection && (b.peerConnection = a.recommended.peerConnection), 
                    a.recommended.media && (b.media = a.recommended.media), b) : b;
                }
            }, {
                key: "getSenderConfig",
                value: function() {
                    var a = this.senderConfigService.getConfig();
                    return a && a.recommended && a.recommended.sender ? a.recommended.sender : null;
                }
            }, {
                key: "getDefaultSenderConfig",
                value: function() {
                    return this.defaultSenderConfig ? this.defaultSenderConfig : null;
                }
            }, {
                key: "getInternalElapsed",
                value: function() {
                    return this.internalConfigService.getElapsed();
                }
            }, {
                key: "getAppElapsed",
                value: function() {
                    return this.appConfigService.getElapsed();
                }
            }, {
                key: "getSenderElapsed",
                value: function() {
                    return this.senderConfigService.getElapsed();
                }
            }, {
                key: "getCurrentVideoSenderConfig",
                value: function(a) {
                    var b = {
                        encodings: [ {
                            maxBitrate: 0
                        } ]
                    }, c = l.Registry.getConferenceManager().getConferenceForPc(a);
                    if (!c) return n.warn("No conference found for PC, skipping"), null;
                    if (c.getPeerConnectionManager().pcHandlers.size > 1) return n.warn("Multiple PCs found, skipping"), 
                    null;
                    if (!a.getSenders || "function" != typeof a.getSenders) return n.warn("Get senders error"), 
                    b;
                    for (var d = a.getSenders(), e = void 0, g = 0; g < d.length; g += 1) {
                        var h = d[g];
                        if ("object" !== (void 0 === h ? "undefined" : f(h)) || !h.track || "object" !== f(h.track) || !h.track.kind) return n.warn("Access senders error"), 
                        null;
                        if ("video" === h.track.kind) {
                            if (e) return n.warn("Multiple video sender, skipping"), null;
                            e = h;
                        }
                    }
                    if (!e) return n.warn("No video sender found"), null;
                    if (!e.getParameters || "function" != typeof e.getParameters) return n.warn("Sender getParameters error"), 
                    b;
                    var i = e.getParameters();
                    return "object" !== (void 0 === i ? "undefined" : f(i)) ? null : ("encodings" in i || (i.encodings = []), 
                    0 === i.encodings.length && i.encodings.push({
                        maxBitrate: 0
                    }), i);
                }
            } ]), a;
        }();
        c.ConfigServiceWrapper = p;
    }, {
        "../../config/settings": 33,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94,
        "./configserviceget": 47,
        "./configservicepost": 48
    } ],
    50: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConnectionManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../config/constants"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = a("./wscollectorconnection"), i = a("./restcollectorconnection"), j = a("../utility/registry"), k = function() {
            function a() {
                d(this, a), this.connection = null;
            }
            return e(a, [ {
                key: "setupCollectorConnection",
                value: function(a) {
                    a === g.transportType.rest ? this.connection = new i.RestCollectorConnection() : this.connection = new h.WsCollectorConnection();
                }
            }, {
                key: "setup",
                value: function() {
                    return this.connection ? this.connection.setup() : new Promise(function(a, b) {
                        b();
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    return !!this.connection && this.connection.isReady();
                }
            }, {
                key: "send",
                value: function(a) {
                    if (!this.connection) return void j.Registry.getGenericEventHandler().sendEvent(g.logEvents.error, {
                        msg: "Connection not available to the collector"
                    });
                    this.connection.send(a);
                }
            } ]), a;
        }();
        c.ConnectionManager = k;
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "./restcollectorconnection": 53,
        "./wscollectorconnection": 56
    } ],
    51: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Jwt = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../utility/base64"), h = d(g), i = a("../../utility/csiologger"), j = d(i), k = a("../../utility/registry"), l = a("../../config/constants"), m = d(l), n = function() {
            function a() {
                e(this, a), this.cryptotype = null, window.crypto && window.crypto.subtle ? (this.cryptotype = "standard", 
                this.subtlecrypto = window.crypto.subtle) : window.crypto && !window.crypto.subtle && window.crypto.webkitSubtle ? (this.cryptotype = "webkit", 
                this.subtlecrypto = window.crypto.webkitSubtle) : window.msCrypto && window.msCrypto.subtle ? (this.cryptotype = "ie", 
                this.subtlecrypto = window.msCrypto.subtle) : (this.subtlecrypto = null, j.info("WebCryptography API not supported in this browser.")), 
                this.browserName = k.Registry.getEndpoint().getBrowserName();
            }
            return f(a, [ {
                key: "sign",
                value: function(a, b, c) {
                    var d = this;
                    return new Promise(function(e, f) {
                        "HS256" !== a.alg && f("Use header.alg=HS256"), a = JSON.stringify(a), "string" != typeof b && (b = JSON.stringify(b));
                        var g = h.urlencodeUnicode(a) + "." + h.urlencodeUnicode(b);
                        window.csioReactNative && window.csiosign(g, c, function(a, b) {
                            if (a) return j.log("Token sign error", a), void f(error);
                            e(b);
                        });
                        var i = new ArrayBuffer(g.length), k = new Uint8Array(i), l = {
                            name: "HMAC"
                        };
                        "ie" !== d.cryptotype && "webkit" !== d.cryptotype && d.browserName !== m.browserName.edge || (l.hash = {
                            name: "sha-256"
                        });
                        for (var n = g.length - 1; n >= 0; n--) k[n] = g.charCodeAt(n);
                        var o = d.subtlecrypto.sign(l, c, k);
                        "ie" === d.cryptotype ? (o.onerror = f, o.oncomplete = function(a) {
                            g = d.buildToken(a.target.result, g), e(g);
                        }) : o.then(function(a) {
                            g = d.buildToken(a, g), e(g);
                        }).catch(function(a) {
                            f(a);
                        });
                    });
                }
            }, {
                key: "buildToken",
                value: function(a, b) {
                    for (var c = "", d = new Uint8Array(a), e = d.byteLength, f = 0; f < e; f++) c += String.fromCharCode(d[f]);
                    return b += "." + h.urlencode(c);
                }
            }, {
                key: "decode",
                value: function(a) {
                    try {
                        var b = a.split(".")[1], c = h.decode(b);
                        return JSON.parse(c);
                    } catch (a) {
                        return j.error("Could not decode token. "), null;
                    }
                }
            }, {
                key: "importKey",
                value: function(a) {
                    var b = this;
                    return new Promise(function(c, d) {
                        if (window.csioReactNative) return void c(a);
                        if ("webkit" === b.cryptotype) for (;a.length < 32; ) a += "\0";
                        var e = {
                            kty: "oct",
                            k: h.urlencode(a),
                            alg: "HS256"
                        }, f = {
                            name: "HMAC",
                            hash: {
                                name: "SHA-256"
                            }
                        };
                        if ("ie" === b.cryptotype ? e.extractable = !1 : e.ext = !1, "webkit" === b.cryptotype && (f = null, 
                        e.use = "sig"), "ie" === b.cryptotype || "webkit" === b.cryptotype) {
                            var g = JSON.stringify(e);
                            e = new Uint8Array(g.length);
                            for (var i = 0; i < g.length; i++) e[i] = g.charCodeAt(i);
                        }
                        var j = b.subtlecrypto.importKey("jwk", e, f, !1, [ "sign" ]);
                        "ie" === b.cryptotype ? (j.onerror = d, j.oncomplete = function(a) {
                            c(a.target.result);
                        }) : j.then(c).catch(d);
                    });
                }
            } ]), a;
        }();
        c.Jwt = n;
    }, {
        "../../config/constants": 32,
        "../../utility/base64": 84,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94
    } ],
    52: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.JwtToken = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./jwt"), h = a("../../utility/registry"), i = a("../../config/constants"), j = d(i), k = a("../../utility/csiologger"), l = d(k), m = function() {
            function a(b) {
                e(this, a), this.token = b, this.statsSubmissionInterval = 15e3, this.collectSDP = !1, 
                this.appId = null, this.userId = null, this.tokenPayload = null, this.jwt = new g.Jwt(), 
                this.expires = null, this.clockSync = h.Registry.getClockSync(), this.adaptiveInterval = !1, 
                this.transportType = j.transportType.rest, this.setupTokenPayload(), this.restApiTransport = !1;
            }
            return f(a, [ {
                key: "getToken",
                value: function() {
                    return this.token;
                }
            }, {
                key: "setupTokenPayload",
                value: function() {
                    var a = this.jwt.decode(this.token);
                    if (this.statsSubmissionInterval = parseInt(a.submissionInterval, 10), this.collectSDP = a.collectSDP, 
                    this.adaptiveInterval = a.adaptiveInterval, this.appId = a.appID, this.userId = a.userID, 
                    this.restApiTransport = a.restApiTransport, navigator.mozGetUserMedia) {
                        var b = a.expiry.split(" ").join("T");
                        this.expires = Date.parse(b);
                    } else this.expires = new Date(a.expiry);
                    this.restApiTransport ? this.transportType = j.transportType.rest : this.transportType = j.transportType.ws, 
                    l.info("transportType is ", this.transportType, this.restApiTransport), h.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval), 
                    h.Registry.getCredentials().setCollectSDP(this.collectSDP), h.Registry.getCredentials().setTransportType(this.transportType), 
                    h.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval);
                }
            }, {
                key: "isValid",
                value: function(a) {
                    var b = this, c = !1;
                    if (null !== b.token && b.appId === a.appId && b.userId === encodeURIComponent(a.userId)) {
                        new Date(this.clockSync.getSynchronizedTimestamp()) < b.expires && (c = !0);
                    }
                    return c;
                }
            } ]), a;
        }();
        c.JwtToken = m;
    }, {
        "../../config/constants": 32,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94,
        "./jwt": 51
    } ],
    53: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RestCollectorConnection = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../utility/registry"), j = a("./xmlhttp"), k = a("./collectorconnection"), l = a("./restrelays"), m = a("../config/constants"), n = d(m), o = a("../utility/csiologger"), p = d(o), q = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
                return a.relays = new l.RestRelays(), a;
            }
            return g(b, a), h(b, [ {
                key: "isReady",
                value: function() {
                    return !0;
                }
            }, {
                key: "send",
                value: function(a) {
                    var b = {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + i.Registry.getAuthenticator().getToken()
                    }, c = a.eventType, d = a.confID, e = a.ucID, f = this.relays, g = f.getRequestUrl(c, d, e);
                    if (!g) return void p.warn("No action for message type: " + c);
                    var h = this.getMessage(c, a);
                    p.log("sending ", g, a), (0, j.sendPostRequest)(g, b, 5e3, h).then(function(a) {
                        f.handleResponse(c, a, d);
                    }, function(a) {
                        p.error(a);
                    });
                }
            }, {
                key: "getMessage",
                value: function(a, b) {
                    delete b.confID, delete b.channel, delete b.token, delete b.appID, delete b.action, 
                    delete b.ucID, delete b.version;
                    var c = decodeURIComponent(b.localID);
                    b.localID = c;
                    var d = decodeURIComponent(b.remoteID);
                    return b.remoteID = d, a === n.callstatsChannels.processedStats && (b.eventType = "stats"), 
                    b;
                }
            } ]), b;
        }(k.CollectorConnection);
        c.RestCollectorConnection = q;
    }, {
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./collectorconnection": 46,
        "./restrelays": 54,
        "./xmlhttp": 57
    } ],
    54: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f() {
            var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null, b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;
            return function(c, d) {
                if (!c || !c.xhr) return void p.log("Response for request is null");
                var e = c.xhr.response, f = JSON.parse(e);
                f.conferenceId = d, "success" === f.status ? a && a(f) : b ? b(f) : (m.Registry.getGenericEventHandler().sendEvent(j.logEvents.restResponseError, {
                    msg: "response failure " + f.msg + ":" + f.status
                }), p.error("Response error:", f.msg, e));
            };
        }
        function g(a) {
            var b = f();
            return new Map([ [ j.fabricEvent.fabricTerminated, new r(l.restEventUrl, "/events/fabric/terminated", b) ], [ j.fabricEvent.audioMute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.audioUnmute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoPause, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoResume, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStart, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStop, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.activeDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.fabricEvent.applicationErrorLog, new r(l.restEventUrl, "/events/app/logs", b) ], [ j.fabricEvent.dominantSpeaker, new r(l.restEventUrl, "/events/dominantspeaker", b) ], [ j.fabricEvent.fabricHold, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.fabricEvent.fabricResume, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.internalFabricEvent.fabricSetup, new r(l.restEventUrl, "/events/fabric/setup", b) ], [ j.fabricEvent.fabricSetupFailed, new r(l.restEventUrl, "/events/fabric/setupfailed", b) ], [ j.internalFabricEvent.userJoined, new r(l.restEventUrl, "", f(function(a) {
                if ("success" !== a.status) return void m.Registry.getGenericEventHandler().sendEvent(j.logEvents.restResponseError, {
                    msg: "userJoined response failure" + a.msg + ":" + a.status
                });
                var b = decodeURIComponent(a.conferenceId), c = m.Registry.getConferenceManager().get(b);
                c && (p.log("UcId =", a.ucID, b), c.setUcId(a.ucID), m.Registry.getTransmissionManager().trySend());
            })) ], [ j.internalFabricEvent.userLeft, new r(l.restEventUrl, "/events/user/left", b) ], [ j.internalFabricEvent.userAlive, new r(l.restEventUrl, "/events/user/alive", b) ], [ j.internalFabricEvent.fabricTransportSwitch, new r(l.restEventUrl, "/events/fabric/transportchange", b) ], [ j.internalFabricEvent.mediaPlaybackStart, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackSuspended, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackStalled, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.ssrcMap, new r(l.restEventUrl, "/events/ssrcmap", b) ], [ j.internalFabricEvent.connectedDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.internalFabricEvent.sdpSubmission, new r(l.restEventUrl, "/events/sdp", b) ], [ j.internalFabricEvent.iceDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceAborted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceTerminated, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceFailed, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceRestarted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.fabricDropped, new r(l.restEventUrl, "/events/fabric/status", b) ], [ j.callstatsChannels.processedStats, new r(l.restStatsUrl, "/stats", b) ], [ j.internalFabricEvent.fabricStateChange, new r(l.restEventUrl, "/events/fabric/statechange", b) ], [ j.callstatsChannels.userFeedback, new r(l.restEventUrl, "/events/feedback", b) ], [ j.precalltestEvents.results, new r(l.restEventUrl, "/events/precall", b) ], [ j.precalltestEvents.associate, new r(l.restEventUrl, "/events/precall", b) ], [ j.internalFabricEvent.userDetails, new r(l.restEventUrl, "/events/userdetails", b) ] ]);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RestRelays = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/constants"), j = d(i), k = a("../config/settings"), l = d(k), m = a("../utility/registry"), n = a("../utility/url"), o = a("../utility/csiologger"), p = d(o), q = function() {
            function a() {
                e(this, a), this.items = g();
            }
            return h(a, [ {
                key: "getRequestUrl",
                value: function(a, b, c) {
                    return this.items.has(a) ? this.items.get(a).getRequestUrl(a, b, c) : (p.warn("EventType Unsupported ", a), 
                    null);
                }
            }, {
                key: "handleResponse",
                value: function(a, b, c) {
                    if (!this.items.has(a)) return void p.warn("No response handler for event type " + a);
                    this.items.get(a).handleResponse(b, c);
                }
            } ]), a;
        }(), r = function() {
            function a(b, c) {
                var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                e(this, a), this.baseUrl = b, this.urlAppendix = c, this.responseHandler = d;
            }
            return h(a, [ {
                key: "getRequestUrl",
                value: function(a, b, c) {
                    return this.makeRequestUrl(a, b, c), this.requestUrl.toString();
                }
            }, {
                key: "makeRequestUrl",
                value: function(a, b, c) {
                    a === j.precalltestEvents.results ? this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId(), this.urlAppendix) : (a === j.internalFabricEvent.userJoined && c && (c = ""), 
                    this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId() + "/conferences/" + b, c, this.urlAppendix));
                }
            }, {
                key: "handleResponse",
                value: function(a, b) {
                    this.responseHandler(a, b);
                }
            } ]), a;
        }();
        c.RestRelays = q;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/url": 99
    } ],
    55: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TransmissionManager = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/timestamps"), h = d(g), i = a("../collections/cache"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = function() {
            function a() {
                e(this, a), this.cache = [], this.connectionManager = j.Registry.getConnectionManager(), 
                this.lastTS = 0, this.timerStarted = !1;
            }
            return f(a, [ {
                key: "send",
                value: function(a) {
                    (a.isCachable() || a.canBeSent()) && (this.cache[a.getConferenceId()] || (this.cache[a.getConferenceId()] = new i.Cache()), 
                    this.cache[a.getConferenceId()].add(a, a.isPriority()), this.trySend());
                }
            }, {
                key: "trySend",
                value: function() {
                    if (!this.connectionManager.isReady()) return void this.setupConnection();
                    if (!this.timerStarted) return this.timeToSend() ? void (this.sendMessage() && this.startTimer()) : void (this.getCacheLength() > 0 && this.startTimer());
                }
            }, {
                key: "setupConnection",
                value: function() {
                    this.connectionManager.setup().then(function() {
                        n.log("Connected to connectionManager");
                    }).catch(function(a) {
                        return n.log("Could not connect to connectionManager", a);
                    });
                }
            }, {
                key: "sendMessage",
                value: function() {
                    var a = void 0, b = void 0;
                    if (0 === this.getCacheLength()) return !1;
                    for (var c in this.cache) if (this.cache.hasOwnProperty(c) && (b = c, (a = this.cache[b].peak()) && a.canBeSent())) break;
                    return !(!a || !a.canBeSent()) && (n.log("sending message type :", a.toJson().action, a.toJson()), 
                    a = this.cache[b].pop(), this.lastTS = h.getCurrent(), this.connectionManager.send(a.toJson()), 
                    !0);
                }
            }, {
                key: "startTimer",
                value: function() {
                    var a = this;
                    this.timerStarted || 0 != this.getCacheLength() && (this.timerStarted = !0, setTimeout(function() {
                        a.timerStarted = !1, a.trySend();
                    }, 200));
                }
            }, {
                key: "timeToSend",
                value: function() {
                    return h.getCurrent() >= this.lastTS + 200;
                }
            }, {
                key: "getCacheLength",
                value: function() {
                    var a = 0;
                    for (var b in this.cache) this.cache.hasOwnProperty(b) && (a += this.cache[b].length());
                    return a;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    var b = l.tmpConferenceId;
                    this.cache[b] && this.cache[b].updateConferenceId(a);
                }
            } ]), a;
        }();
        c.TransmissionManager = o;
    }, {
        "../collections/cache": 24,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    56: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.WsCollectorConnection = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/callstatserrors"), j = d(i), k = a("../config/constants"), l = d(k), m = a("../config/settings"), n = d(m), o = a("../utility/registry"), p = a("../utility/csiologger"), q = d(p), r = a("./collectorconnection"), s = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
                return a.wsConnection = null, a.wsUrl = n.wsUrl, a.wsConnectionState = l.wsConnectionState.closed, 
                a.connected = !1, a.reconnected = !1, a;
            }
            return g(b, a), h(b, [ {
                key: "onOpenHandler",
                value: function() {
                    var a = this;
                    a.wsConnectionState = l.wsConnectionState.connected, a.connected ? a.reconnected = !0 : a.connected = !0, 
                    a.reconnected = !1;
                }
            }, {
                key: "onCloseHandler",
                value: function() {
                    var a = this;
                    a.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection to the backend closed."), 
                    a.wsConnection && (a.wsConnection = null);
                }
            }, {
                key: "onErrorHandler",
                value: function(a) {
                    var b = this;
                    b.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection establishment to the backend failed."), 
                    b.callback && b.callback(j.csError.wsChannelFailure, "WebSocket establishment failed.", a);
                }
            }, {
                key: "onMessageHandler",
                value: function(a) {
                    var b = a.data, c = JSON.parse(b);
                    if ("200 OK" === c.status) {
                        if ("feedback" === c.event) window.localStorage.removeItem("feedback"); else if (c.event === l.internalFabricEvent.userJoined) {
                            var d = o.Registry.getConferenceManager().get(decodeURIComponent(c.conferenceID));
                            d && d.setUcId(c.ucID), q.log("UcId =", c.ucID), o.Registry.getTransmissionManager().trySend();
                        }
                    } else q.error("Collector error:", c.reason);
                }
            }, {
                key: "setup",
                value: function() {
                    var a = this;
                    return new Promise(function(b, c) {
                        if (a.wsConnectionState === l.wsConnectionState.initiated || a.wsConnectionState === l.wsConnectionState.connected) return q.log("setupWebSocketConnection is called when already connected!"), 
                        a.callback && a.callback(j.csError.success, l.csCallBackMessages.wsConnected), void b();
                        a.wsConnectionState = l.wsConnectionState.initiated, q.log("creating new WebSocket", a.wsUrl), 
                        a.wsConnection = new WebSocket(a.wsUrl, "echo-protocol"), a.wsConnection.onopen = function() {
                            b(), a.onOpenHandler();
                        }, a.wsConnection.onclose = function() {
                            a.onCloseHandler();
                        }, a.wsConnection.onerror = function(b) {
                            c(b), a.onErrorHandler(b);
                        }, a.wsConnection.onmessage = function(b) {
                            a.onMessageHandler(b);
                        };
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    var a = this;
                    return !(!a.wsConnection || 1 !== a.wsConnection.readyState);
                }
            }, {
                key: "getState",
                value: function() {
                    var a = this;
                    return a.wsConnection ? a.wsConnection.readyState : -1;
                }
            }, {
                key: "send",
                value: function(a) {
                    this.wsConnection.send(JSON.stringify(a));
                }
            } ]), b;
        }(r.CollectorConnection);
        c.WsCollectorConnection = s;
    }, {
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./collectorconnection": 46
    } ],
    57: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b, c, d, e) {
            return new Promise(function(f, g) {
                var h = null, i = null, j = null, l = new XMLHttpRequest(), p = n.Registry.getEndpoint().getBrowserName();
                if (!l) return void g(new Error("creating instance failed"));
                h = k.getCurrent(), l.open(a, b), p !== m.browserName.msie && (l.timeout = d);
                for (var q in c) c.hasOwnProperty(q) && l.setRequestHeader(q, c[q]);
                var r = null;
                if ("POST" === a) {
                    if ("application/x-www-form-urlencoded" === c["Content-Type"]) {
                        var s = [];
                        for (var t in e) e.hasOwnProperty(t) && s.push(encodeURIComponent(t) + "=" + encodeURIComponent(e[t]));
                        r = s.join("&");
                    }
                    "application/json" === c["Content-Type"] && (r = JSON.stringify(e));
                }
                l.onload = function() {
                    i = k.getCurrent(), j = i - h;
                    var a = new o(l, j);
                    f(a);
                }, l.ontimeout = function() {
                    g(new Error("connection timeout"));
                }, l.onreadystatechange = function() {
                    4 === l.readyState && 0 === l.status && g(new Error("no server response received"));
                }, l.send(r);
            });
        }
        function g(a, b, c) {
            return f("GET", a, b, c, null);
        }
        function h(a, b, c, d) {
            return f("POST", a, b, c, d);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var i = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }();
        c.sendGetRequest = g, c.sendPostRequest = h;
        var j = a("../utility/timestamps"), k = d(j), l = a("../config/constants"), m = d(l), n = a("../utility/registry"), o = function() {
            function a(b, c) {
                e(this, a), this.xhr = b, this.elapsed = c;
            }
            return i(a, [ {
                key: "getXhr",
                value: function() {
                    return this.xhr;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.elapsed;
                }
            } ]), a;
        }();
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    58: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.XMLHttpService = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/sigmoid"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = 100, j = 1e4, k = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "XMLHttpService", c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : i, e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : j;
                d(this, a), this.name = b, this.minRetryTimeout = c, this.sigmoid = new f.Sigmoid(e - c, 15, .5), 
                this.reset();
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.inProgress = !1, this.completed = !1, this.resolveCb && this.rejectCb(new Error(this.name + ": resetting")), 
                    this.resolveCb = null, this.rejectCb = null;
                }
            }, {
                key: "initiate",
                value: function() {
                    var a = this;
                    if (this.inProgress) return new Promise(function(b, c) {
                        c(new Error(a.name + ": in progress"));
                    });
                    var b = new Promise(function(b, c) {
                        a.resolveCb = b, a.rejectCb = c;
                    });
                    return this.inProgress = !0, this.sendRequest(), b;
                }
            }, {
                key: "isCompleted",
                value: function() {
                    return this.completed;
                }
            }, {
                key: "handleSendError",
                value: function(a) {
                    h.log(this.name + ": send next request (" + a + ")"), this.sendNextRequest();
                }
            }, {
                key: "handleResponseProxy",
                value: function(a) {
                    this.handleResponse(a), this.resetTimeout();
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    h.error(this.name + ": handleResponse() not implemented"), this.completeProcess();
                }
            }, {
                key: "completeProcess",
                value: function() {
                    this.inProgress = !1, this.completed = !0, this.resolveCb.apply(this, arguments);
                }
            }, {
                key: "request",
                value: function() {
                    return h.error(this.name + ": request() not implemented!"), new Promise(function(a, b) {
                        a();
                    });
                }
            }, {
                key: "sendRequest",
                value: function() {
                    if (this.inProgress) {
                        var a = this.request();
                        a && a.then(this.handleResponseProxy.bind(this), this.handleSendError.bind(this));
                    }
                }
            }, {
                key: "sendNextRequest",
                value: function() {
                    setTimeout(this.sendRequest.bind(this), this.getTimeout());
                }
            }, {
                key: "resetTimeout",
                value: function() {
                    this.sigmoid.reset();
                }
            }, {
                key: "getTimeout",
                value: function() {
                    return this.minRetryTimeout + this.sigmoid.getActual();
                }
            } ]), a;
        }();
        c.XMLHttpService = k;
    }, {
        "../utility/csiologger": 87,
        "../utility/sigmoid": 96
    } ],
    59: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Measurement = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./resolution"), g = a("./validator"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.pcHash = null, this.ssrc = null, this.streamType = null, this.mediaType = null, 
                this.resolution = null, this.frameRateReceived = null, this.frameHeight = null, 
                this.frameWidth = null, this.droppedFramesNum = null, this.rtt = null, this.jitter = null, 
                this.lostPackets = -1, this.receivedPackets = -1, this.sentPackets = -1, this.discardedPackets = -1, 
                this.sentBytes = -1, this.receivedBytes = -1, this.track = null, this.fractionLost = 0;
            }
            return e(a, null, [ {
                key: "make",
                value: function(b, c, d, e, g, i, j, k, l, m, n, o, p, q, r, s, t) {
                    var u = new a(), v = function(a, b) {
                        -1 === [ void 0, null ].indexOf(b) && (u[a] = b);
                    };
                    return v("pcHash", b), v("ssrc", c), v("streamType", d), v("mediaType", e), v("frameRateReceived", g), 
                    v("frameHeight", h.checkForNan(parseInt(i, 10))), v("frameWidth", h.checkForNan(parseInt(j, 10))), 
                    v("droppedFramesNum", k), v("rtt", l), v("jitter", m), v("lostPackets", n), v("receivedPackets", o), 
                    v("sentPackets", p), v("discardedPackets", q), v("sentBytes", r), v("receivedBytes", s), 
                    v("track", t), u.resolution = void 0 !== g && void 0 !== j && void 0 !== i && j > 0 && i > 0 ? new f.Resolution(j, i, g) : null, 
                    u;
                }
            } ]), e(a, [ {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getSSRC",
                value: function() {
                    return this.ssrc;
                }
            }, {
                key: "getStreamType",
                value: function() {
                    return this.streamType;
                }
            }, {
                key: "getMediaType",
                value: function() {
                    return this.mediaType;
                }
            }, {
                key: "getResolution",
                value: function() {
                    return this.resolution ? this.resolution.toString() : null;
                }
            }, {
                key: "getFrameRateReceived",
                value: function() {
                    return this.frameRateReceived;
                }
            }, {
                key: "getFrameHeight",
                value: function() {
                    return this.frameHeight;
                }
            }, {
                key: "getFrameWidth",
                value: function() {
                    return this.frameWidth;
                }
            }, {
                key: "getDroppedFramesNum",
                value: function() {
                    return this.droppedFramesNum;
                }
            }, {
                key: "getJitter",
                value: function() {
                    return this.jitter;
                }
            }, {
                key: "getRTT",
                value: function() {
                    return this.rtt;
                }
            }, {
                key: "getLostPackets",
                value: function() {
                    return this.lostPackets;
                }
            }, {
                key: "getDiscardedPackets",
                value: function() {
                    return this.discardedPackets;
                }
            }, {
                key: "getReceivedPackets",
                value: function() {
                    return this.receivedPackets;
                }
            }, {
                key: "getSentPackets",
                value: function() {
                    return this.sentPackets;
                }
            }, {
                key: "getSentBytes",
                value: function() {
                    return this.sentBytes;
                }
            }, {
                key: "getReceivedBytes",
                value: function() {
                    return this.receivedBytes;
                }
            }, {
                key: "setFractionLost",
                value: function(a) {
                    this.fractionLost = void 0 === a ? null : a;
                }
            }, {
                key: "getFractionLost",
                value: function() {
                    return this.fractionLost;
                }
            }, {
                key: "extractTrack",
                value: function() {
                    var a = this.track;
                    return this.track = null, a;
                }
            }, {
                key: "toString",
                value: function() {
                    return "pcHash: " + this.pcHash + ", ssrc: " + this.ssrc + ", streamType: " + this.streamType + ", mediaType: " + this.mediaType + ", frameRateReceived: " + this.frameRateReceived + ", frameHeight: " + this.frameHeight + ", frameWidth: " + this.frameWidth + ", droppedFramesNum: " + this.droppedFramesNum + ", rtt: " + this.rtt + ", jitter: " + this.jitter + ", lostPackets: " + this.lostPackets + ", receivedPackets: " + this.receivedPackets + ", sentPackets: " + this.sentPackets + ", discardedPackets: " + this.discardedPackets + ", sentBytes: " + this.sentBytes + ", receivedBytes: " + this.receivedBytes;
                }
            } ]), a;
        }();
        c.Measurement = i;
    }, {
        "./resolution": 67,
        "./validator": 82
    } ],
    60: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.CPULimitationObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a() {
                e(this, a), this.ewmaDiscardedPackets = 0, this.ewmaLostPackets = 0, this.ewmaDroppedFrames = 0, 
                this.last = 0, this.noticed = 0;
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.discardedPackets, c = a.lostPackets;
                    if (!c || c < 1 || !b || b < 1) return !1;
                    if (0 === this.last) return this.last = j.getCurrent(), this.ewmaLostPackets = c, 
                    this.ewmaDiscardedPackets = b, !1;
                    var d = j.getCurrent(), e = Math.max(d - this.last, 1), f = Math.min((5e3 - e) / 5e3, .9), g = a.droppedFrames;
                    return this.ewmaLostPackets = this.ewmaLostPackets * f + c, this.ewmaDroppedFrames = this.ewmaDroppedFrames * f + g, 
                    this.ewmaDiscardedPackets = this.ewmaDiscardedPackets * f + b, !(!g || g < 1) && (!(1 < this.ewmaLostPackets || 1 < this.ewmaDiscardedPackets) && (!(d - this.noticed < 1e4) && (!(this.ewmaDroppedFrames < 1) && (this.noticed = d, 
                    !0))));
                }
            } ]), a;
        }(), l = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.inbVideoTesters = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    for (var b = a.filter(function(a) {
                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.inbound;
                    }), c = 0; c < b.length; ++c) {
                        var d = b[c];
                        this.checkInboundVideo(d);
                    }
                }
            }, {
                key: "checkInboundVideo",
                value: function(a) {
                    var b = a.peek(), c = a.getSSRC();
                    if (this.inbVideoTesters.has(c) || this.inbVideoTesters.set(c, new k()), this.inbVideoTesters.get(c).test(b)) {
                        var d = {
                            reason: h.limitationType.cpu,
                            ssrc: c
                        };
                        this.notifyCallback(d);
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "CPULimitationObserver";
                }
            } ]), a;
        }();
        c.CPULimitationObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    61: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.OneWayMediaObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../onewaymediadisruption"), j = a("../../utility/timestamps"), k = d(j), l = function() {
            function a(b) {
                e(this, a), this.notifierCallback = b, this.inbOneWayAudioDisruption = {
                    sent: !1,
                    started: 0,
                    hasTrafficTs: 0
                }, this.outbOneWayAudioDisruption = {
                    sent: !1,
                    started: 0,
                    hasTrafficTs: 0
                };
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    var b = a.filter(function(a) {
                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.inbound;
                    }), c = a.filter(function(a) {
                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.outbound;
                    }), d = [ this.getInbOneWayAudioDisruption(b, c), this.getOutbOneWayAudioDisruption(b, c) ], e = d.filter(function(a) {
                        return null !== a;
                    });
                    0 < e.length && this.notifierCallback(e);
                }
            }, {
                key: "toString",
                value: function() {
                    return "DisruptionObserver";
                }
            }, {
                key: "getInbOneWayAudioDisruption",
                value: function(a, b) {
                    var c = this.inbOneWayAudioDisruption;
                    if (c.sent) return null;
                    var d = b.filter(function(a) {
                        return 0 === a.getStartTime();
                    }).length < 1, e = b.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    if (!d || e) return null;
                    var f = a.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    return 0 < a.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), 
                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));
                }
            }, {
                key: "getOutbOneWayAudioDisruption",
                value: function(a, b) {
                    var c = this.outbOneWayAudioDisruption;
                    if (c.sent) return null;
                    var d = a.filter(function(a) {
                        return 0 === a.getStartTime();
                    }).length < 1, e = a.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    if (!d || !e) return null;
                    var f = b.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    return 0 < b.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), 
                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));
                }
            } ]), a;
        }();
        c.OneWayMediaObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98,
        "../onewaymediadisruption": 65
    } ],
    62: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.QPSumObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a(b) {
                e(this, a), this.lastQpSum = null, this.qpAvg = null, this.noticed = 0;
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.getTrack();
                    if (!b || !b.data || !b.data.qpSum) return !1;
                    if (!this.lastQpSum) return this.lastQpSum = b.data.qpSum, !1;
                    var c = b.data.qpSum - this.lastQpSum;
                    if (this.lastQpSum = b.data.qpSum, null === this.qpAvg) this.qpAvg = c; else {
                        this.qpAvg = .2 * c + .8 * this.qpAvg;
                    }
                    var d = Math.max(2 * this.qpAvg, 1);
                    if (c < this.qpAvg + d) return !1;
                    var e = j.getCurrent();
                    return this.noticed < e - 1e4;
                }
            } ]), a;
        }(), l = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.testers = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b];
                        if (c.getMediaType() === h.mediaType.video) {
                            var d = c.getSSRC();
                            this.testers.has(d) || this.testers.set(d, new k(c));
                            if (this.testers.get(d).test(c)) {
                                var e = {
                                    reason: h.qualityDisruptionTypes.qpchange
                                };
                                this.notifyCallback(e);
                            }
                        }
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "QPSumObserver";
                }
            } ]), a;
        }();
        c.QPSumObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    63: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SendingTrigger = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../utility/timestamps"), h = d(g), i = a("../validator"), j = d(i), k = 1e3, l = 3e4, m = function() {
            function a(b, c, d) {
                e(this, a), this.last = null, this.actual = 0, this.name = b, this.alpha = c, this.supplier = d;
            }
            return f(a, [ {
                key: "update",
                value: function(a) {
                    if (null === this.last) return void (this.last = a);
                    var b = Math.abs(a - this.last);
                    this.actual = b * this.alpha + this.actual * (1 - this.alpha), this.last = a;
                }
            }, {
                key: "doTest",
                value: function(a) {
                    var b = this.last;
                    return this.update(a), null !== b && b + this.supplier(this.actual) < a;
                }
            } ]), a;
        }(), n = function() {
            function a() {
                e(this, a);
                var b = this;
                this.marginFactor = 1, this.rttTester = new m("RTT Tester", .2, function(a) {
                    return Math.max(50, a) * b.marginFactor;
                }), this.throughputTester = new m("Throughput Tester", .1, function(a) {
                    return Math.max(100, a) * b.marginFactor;
                }), this.FLTester = new m("FL Tester", .1, function(a) {
                    return Math.max(.2, a) * b.marginFactor;
                }), this.lastDecreased = h.getCurrent();
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.peek();
                    if (!b) return !1;
                    var c = a.getTrack(), d = c.data, e = b.getRTT(), f = j.checkForNan(parseInt(d.csioIntBRKbps, 10)), g = b.getFractionLost();
                    if (this.rttTester.doTest(e) || this.throughputTester.doTest(f) || this.FLTester.doTest(g)) return this.marginFactor = Math.min(2 * this.marginFactor, 15), 
                    !0;
                    var i = h.getCurrent();
                    return 3e3 < i - this.lastChanged && (this.marginFactor = Math.max(this.marginFactor - .5, 1), 
                    this.lastDecreased = i), !1;
                }
            } ]), a;
        }(), o = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.minInterval = k, this.maxInterval = l, 
                this.notified = 0, this.testers = new Map();
            }
            return f(a, [ {
                key: "setup",
                value: function(a, b) {
                    this.minInterval = a, this.maxInterval = b;
                }
            }, {
                key: "accept",
                value: function(a) {
                    var b = h.getCurrent(), c = b - this.notified;
                    if (this.minInterval === this.maxInterval) return void (this.minInterval <= c && (this.notifyCallback(), 
                    this.notified = b));
                    if (!(c < this.minInterval)) {
                        if (c < this.maxInterval) {
                            if (!1 === this.doSend(a)) return;
                        }
                        this.notifyCallback(), this.notified = b;
                    }
                }
            }, {
                key: "setIntervals",
                value: function(a, b) {
                    this.minInterval = a, this.maxInterval = b;
                }
            }, {
                key: "toString",
                value: function() {
                    return "SendingTrigger";
                }
            }, {
                key: "doSend",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b], d = c.getSSRC();
                        this.testers.has(d) || this.testers.set(d, new n());
                        if (this.testers.get(d).test(c)) return !0;
                    }
                    return !1;
                }
            } ]), a;
        }();
        c.SendingTrigger = o;
    }, {
        "../../utility/timestamps": 98,
        "../validator": 82
    } ],
    64: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ThroughputObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a(b) {
                e(this, a), this.notifierCallback = b, this.observations = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    var b = a.filter(function(a) {
                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.outbound;
                    });
                    if (!(b.length < 1)) {
                        var c = this;
                        b.forEach(function(a) {
                            c.observe(a);
                        });
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "ThroughputObserver";
                }
            }, {
                key: "getObservations",
                value: function(a) {
                    if (this.observations.has(a)) return this.observations.get(a);
                    var b = {
                        ssrc: 0,
                        started: 0,
                        max: 0,
                        maxTs: 0,
                        stable: 0,
                        stableTs: 0,
                        ready: !1,
                        maxVerified: !1,
                        stableVerified: !1
                    };
                    return this.observations.set(a, b), this.observations.get(a);
                }
            }, {
                key: "observe",
                value: function(a) {
                    var b = a.getSSRC(), c = this.getObservations(b), d = j.getCurrent();
                    if (!0 !== c.ready) {
                        if (0 === c.started) return c.ssrc = b, void (c.started = d);
                        var e = a.getTrack(), f = e.data, g = f.csioIntBRKbps, h = Math.min(50, .05 * g);
                        if (c.max < g ? (c.max = g, c.maxTs = d) : 1e4 < d - c.maxTs && (c.maxVerified = !0), 
                        !(d - c.started < 15e3) && (g - h < f.csioAvgBRKbps && f.csioAvgBRKbps < g + h && (c.stableTs = d, 
                        c.stable = g, c.stableVerified = !0), c.stableVerified && c.maxVerified)) {
                            var i = {
                                ssrc: String(c.ssrc),
                                maxsendingKBitrate: c.max,
                                timeToMaxSendingKBitrate: c.maxTs - c.started,
                                stablesendingKBitrate: c.stable,
                                timeToStableSendingKBitrate: c.stableTs - c.started
                            };
                            this.notifierCallback(i), c.ready = !0;
                        }
                    }
                }
            } ]), a;
        }();
        c.ThroughputObserver = k;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    65: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "0";
                d(this, a), this.mediaType = b, this.ssrc = c;
            }
            return e(a, [ {
                key: "getContent",
                value: function() {
                    var a = this;
                    return {
                        mediaType: a.mediaType,
                        ssrc: a.ssrc
                    };
                }
            } ]), a;
        }();
        c.OneWayMediaDisruption = f;
    }, {} ],
    66: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e, f, g, h) {
                d(this, a), this.candidatePair = b, this.codec = c, this.pcHash = e, this.trackStats = f, 
                this.transportStats = g, this.measurements = h;
            }
            return e(a, [ {
                key: "getCandidatePair",
                value: function() {
                    return this.candidatePair;
                }
            }, {
                key: "getCodec",
                value: function() {
                    return this.codec;
                }
            }, {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getTrackStats",
                value: function() {
                    return this.trackStats;
                }
            }, {
                key: "getTransportStats",
                value: function() {
                    return this.transportStats;
                }
            }, {
                key: "getMeasurements",
                value: function() {
                    return this.measurements;
                }
            } ]), a;
        }();
        c.PcStats = f;
    }, {} ],
    67: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e) {
                d(this, a), this.width = b, this.height = c, this.frameRate = e;
            }
            return e(a, [ {
                key: "getWidth",
                value: function() {
                    return this.width;
                }
            }, {
                key: "getHeight",
                value: function() {
                    return this.height;
                }
            }, {
                key: "getFrameRate",
                value: function() {
                    return this.frameRate;
                }
            }, {
                key: "toString",
                value: function() {
                    return this.width && this.height && this.frameRate ? this.width.toString() + "X" + this.height.toString() + "X" + this.frameRate.toString() : null;
                }
            } ]), a;
        }();
        c.Resolution = f;
    }, {} ],
    68: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAdapter = c.StatsAdapterIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/constants"), j = d(i), k = a("../collections/component"), l = a("../utility/registry"), m = a("../utility/hash"), n = d(m), o = c.StatsAdapterIO = {
            RawStatsIn: "RawStatsIn",
            RawStatsOut: "RawStatsOut",
            UnprocessedOut: "UnprocessedOut"
        }, p = function(a) {
            function b(a, c) {
                e(this, b);
                var d = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAdapter"));
                return d.bindPort(o.RawStatsIn, d.receiveRawData, d), d.declarePort(o.RawStatsOut), 
                d.declarePort(o.UnprocessedOut), d.codeBase = a, d.browser = c, d;
            }
            return g(b, a), h(b, [ {
                key: "receiveRawData",
                value: function(a, b) {
                    if (a) {
                        var c = this.extractRawStats(a);
                        if (c) {
                            window && window.csioReactNative && (c = this.removeValues(c)), this.isConnected(o.UnprocessedOut) && this.transmit(o.UnprocessedOut, c);
                            var d = this.processRawStats(c, b);
                            if (d && d.transportStats) for (var e = 0; e < d.transportStats.length; e++) d.transportStats[e].hash = this.getTransportHash(d.transportStats[e]);
                            d && d.transportStats && this.checkTransportStatsUpdates(d.transportStats, b), d && d.trackStats && (d = this.backFillTrackStats(d)), 
                            d && d.transportStats && d.candidatePair && (d = this.backFillCandidatePairStats(d)), 
                            d.pcHash = b, this.transmit(o.RawStatsOut, d);
                        }
                    }
                }
            }, {
                key: "removeValues",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b];
                        if (c && c.values) {
                            for (var d = 0; d < c.values.length; ++d) Object.assign(c, c.values[d]);
                            delete c.values;
                        }
                    }
                    return a;
                }
            }, {
                key: "getIceCandidates",
                value: function(a) {
                    if (!a) return null;
                    var b = this.extractRawStats(a);
                    return this.processRawStatsForIceInfo(b);
                }
            }, {
                key: "extractRawStats",
                value: function(a) {
                    var b = [];
                    if (a && a.result) b = a.result(); else if (a && a.forEach) a.forEach(function(a) {
                        b.push(a);
                    }); else for (var c in a) a.hasOwnProperty(c) && b.push(a[c]);
                    return b;
                }
            }, {
                key: "normalizeIceCandidates",
                value: function(a) {
                    for (var b = 0; b < a.length; b += 1) {
                        var c = a[b];
                        c.transport = c.protocol ? c.protocol : "udp", c.ip = c.ip ? c.ip : c.ipAddress, 
                        c.port = c.portNumber ? Number(c.portNumber) : c.port, "ssltcp" === c.transport && (c.transport = "tcp");
                    }
                    return a;
                }
            }, {
                key: "normalizeCanidatePairs",
                value: function(a) {
                    for (var b = 0; b < a.length; b += 1) {
                        var c = a[b];
                        "in-progress" === c.state && (c.state = "inprogress"), c.state || (c.state = "succeeded"), 
                        c.nominated || (c.nominated = "true" === c.googActiveConnection), c.priority || (c.priority = 123);
                    }
                    return a;
                }
            }, {
                key: "processRawStatsForIceInfo",
                value: function(a) {
                    var b = [], c = [], d = [], e = void 0;
                    if (!a) return null;
                    for (var f = 0; f < a.length; ++f) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {
                            if ("transport" === h.transportStats.type) {
                                e = h.transportStats.selectedCandidatePairId;
                                continue;
                            }
                            d.push(h.transportStats);
                        } else h.localCandidate ? b.push(h.localCandidate) : h.remoteCandidate && c.push(h.remoteCandidate);
                    }
                    if (e) for (var i = 0; i < d.length; ++i) d[i].id === e && (d[i].googActiveConnection = "true");
                    return {
                        localIceCandidates: this.normalizeIceCandidates(b),
                        remoteIceCandidates: this.normalizeIceCandidates(c),
                        iceCandidatePairs: this.normalizeCanidatePairs(d)
                    };
                }
            }, {
                key: "processRawStats",
                value: function(a, b) {
                    var c = {}, d = {}, e = {};
                    c.tracks = [], c.candidatePair = [], c.transportStats = [], c.trackStats = [], c.codec = [];
                    for (var f = 0; f < a.length; f++) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        h.tracks ? c.tracks.push(h.tracks) : h.candidatePair ? c.candidatePair.push(h.candidatePair) : h.transportStats ? this.codeBase !== j.codeBaseType.firefox ? (parseInt(h.transportStats.bytesReceived, 10) > 0 || parseInt(h.transportStats.bytesSent, 10) > 0) && (c.transportStats.push(h.transportStats), 
                        "true" !== h.transportStats.googActiveConnection && !0 !== h.transportStats.googActiveConnection || (c.activeConnectionIndex = h.transportStats.length)) : "true" !== h.transportStats.selected && !0 !== h.transportStats.selected || (c.transportStats.push(h.transportStats), 
                        c.activeConnectionIndex = h.transportStats.length) : h.bwe ? c.bwe = h.bwe : h.trackStats ? c.trackStats.push(h.trackStats) : h.codec ? c.codec.push(h.codec) : h.localCandidate ? d[h.localCandidate.id] = h.localCandidate : h.remoteCandidate && (e[h.remoteCandidate.id] = h.remoteCandidate);
                    }
                    if (c.tracks) {
                        var i = l.Registry.getConferenceManager().getConferenceForPcHash(b), k = void 0;
                        i && (k = i.getPeerConnectionManager().getPcHandlerByHash(b)), c.tracks.forEach(function(a) {
                            var b = k.getSSRCInfo(a.data.ssrc);
                            void 0 !== b && b.localStartTime || k && (k.updateSDP(c.tracks), b = k.getSSRCInfo(a.data.ssrc)), 
                            b && (a.cname = b.cname, a.msid = b.msid, a.associatedVideoTag = b.associatedVideoTag, 
                            a.usageLabel = b.usageLabel);
                        });
                    }
                    return c.transportStats && this.codeBase === j.codeBaseType.firefox && (c.transportStats = this.getAddressInfoFromCandidates(c.transportStats, d, e)), 
                    c;
                }
            }, {
                key: "getParsedStats",
                value: function(a) {
                    var b = {};
                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), 
                    a.type && (b.type = a.type), a.names) {
                        for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]);
                        a.id && (b.id = a.id);
                    } else Object.assign(b, a);
                    if (b.values) {
                        for (var e = 0; e < b.values.length; ++e) Object.assign(b, b.values[e]);
                        delete b.values;
                    }
                    return b;
                }
            }, {
                key: "statsClassifier",
                value: function(a) {
                    var b = {}, c = function() {
                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];
                        return -1 !== c.indexOf(a.type);
                    }, d = c("inbound-rtp", "inboundrtp"), e = "true" === a.isRemote || !0 === a.isRemote;
                    return d || c("outbound-rtp", "outboundrtp") ? (b.tracks = {}, b.tracks.data = a, 
                    b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", b.tracks.reportType = "local", 
                    void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, 
                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), 
                    b;
                }
            }, {
                key: "getAddressInfoFromCandidates",
                value: function(a, b, c) {
                    for (var d = void 0, e = void 0, f = 0; f < a.length; f++) d = b[a[f].localCandidateId], 
                    e = c[a[f].remoteCandidateId], d && e && (a[f].localAddr = d.ipAddress + ":" + d.portNumber, 
                    a[f].remoteAddr = e.ipAddress + ":" + e.portNumber, a[f].localAddrType = d.candidateType, 
                    a[f].remoteAddrType = e.candidateType, a[f].transportType = d.transport);
                    return a;
                }
            }, {
                key: "getTransportHash",
                value: function(a) {
                    var b = void 0;
                    return a && (this.codeBase === j.codeBaseType.chrome ? a.googLocalAddress ? (b = a.googLocalAddress, 
                    b.concat(":", a.googRemoteAddress)) : a.selectedCandidatePairId && (b = a.selectedCandidatePairId) : this.codeBase === j.codeBaseType.firefox && (b = a.localAddr, 
                    b.concat(":", a.remoteAddr))), n.generateHash(b);
                }
            }, {
                key: "backFillTrackStats",
                value: function(a) {
                    for (var b = a.tracks.length, c = void 0, d = void 0, e = void 0, f = 0; f < b; f++) c = a.tracks[f], 
                    c.data.trackId && (d = this.getStatsForId(a.trackStats, c.data.trackId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, d)), 
                    c.data.codecId && (e = this.getStatsForId(a.codec, c.data.codecId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, e));
                    return a;
                }
            }, {
                key: "backFillCandidatePairStats",
                value: function(a) {
                    for (var b = a.transportStats.length, c = void 0, d = void 0, e = 0; e < b; e++) d = a.transportStats[e], 
                    d.selectedCandidatePairId && (c = this.getStatsForId(a.candidatePair, d.selectedCandidatePairId)) && (a.transportStats[e] = this.mergeObjects(a.transportStats[e], c));
                    return a;
                }
            }, {
                key: "mergeObjects",
                value: function(a, b) {
                    for (var c in b) b.hasOwnProperty(c) && "id" !== c && "type" !== c && (a[c] = b[c]);
                    return a;
                }
            }, {
                key: "getStatsForId",
                value: function(a, b) {
                    if (a) {
                        var c = a.filter(function(a) {
                            return a.id === b;
                        });
                        if (c.length > 0) return c[0];
                    }
                }
            }, {
                key: "formatRelayType",
                value: function(a) {
                    var b = "None";
                    switch (a) {
                      case 0:
                        b = "TURN/TLS";
                        break;

                      case 1:
                        b = "TURN/TCP";
                        break;

                      case 2:
                        b = "TURN/UDP";
                    }
                    return b;
                }
            }, {
                key: "getRelayType",
                value: function(a, b) {
                    var c = this, d = void 0, e = function(b) {
                        if (b.typePreference) {
                            var e = b.typePreference >> 24;
                            return "rtp" === b.protocol && b.address === a && (e >= 0 && e <= 2 && (d = c.formatTypePreference(e)), 
                            !0);
                        }
                        return !1;
                    };
                    return b.getIceCandidates().some(e), d;
                }
            }, {
                key: "getTransportInfo",
                value: function(a, b) {
                    for (var c = {}, d = !1, e = 0; e < a.length; e++) {
                        var f = a[e];
                        if (navigator.mozGetUserMedia && "candidatepair" === f.type && ("true" === f.selected || !0 === f.selected)) {
                            c.foundActive = !0, c.localAddr = f.localAddr, c.remoteAddr = f.remoteAddr, c.localAddrType = f.localAddrType, 
                            c.remoteAddrType = f.remoteAddrType, c.transportType = f.transportType, c.localCandidateId = f.localCandidateId, 
                            c.remoteCandidateId = f.remoteCandidateId;
                            break;
                        }
                        if ("googCandidatePair" === f.type && ("true" === f.googActiveConnection || !0 === f.googActiveConnection)) {
                            c.foundActive = !0, c.localAddr = f.googLocalAddress, c.remoteAddr = f.googRemoteAddress, 
                            c.localAddrType = f.googLocalCandidateType, c.remoteAddrType = f.googRemoteCandidateType, 
                            c.transportType = f.googTransportType;
                            break;
                        }
                        if ("transport" === f.type) {
                            d = !0, f.selectedCandidatePairId && (c.selectedCandidatePairId = f.selectedCandidatePairId);
                            break;
                        }
                    }
                    return d && c.localAddr && (c.ipv6 = 0 === c.localAddr.indexOf("["), c.relayType = getRelayType(c.localAddr, b)), 
                    c;
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a, b) {
                    a.sendFabricTransportSwitch(b);
                }
            }, {
                key: "checkTransportStatsUpdates",
                value: function(a, b) {
                    var c = l.Registry.getConferenceManager().getConferenceForPcHash(b);
                    if (c) {
                        var d = c.getPeerConnectionManager().getPcHandlerByHash(b);
                        if (d) {
                            var e = this.getTransportInfo(a, d), f = d.getTransportInfo();
                            f && (f.localAddr === e.localAddr && f.remoteAddr === e.remoteAddr && f.transportType === e.transportType && f.selectedCandidatePairId === e.selectedCandidatePairId && f.localCandidateId === e.localCandidateId && f.remoteCandidateId === e.remoteCandidateId || (d.setTransportInfo(e), 
                            this.sendFabricTransportSwitch(d, e.relayType)));
                        }
                    }
                }
            } ]), b;
        }(k.Component);
        c.StatsAdapter = p;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/hash": 91,
        "../utility/registry": 94
    } ],
    69: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAssembler = c.StatsAssemblerIO = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../collections/component"), i = c.StatsAssemblerIO = {
            StatsTupleIn: "StatsTupleIn",
            CallstatsOut: "CallstatsOut"
        }, j = function(a) {
            function b() {
                d(this, b);
                var a = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAssembler"));
                return a.pcHashes = [], a.bindPort(i.StatsTupleIn, a.receiveStats, a), a.declarePort(i.CallstatsOut), 
                a;
            }
            return f(b, a), g(b, [ {
                key: "receiveStats",
                value: function(a) {
                    for (var b = this, c = 0; c < a.tracks.length; c++) {
                        (function(c) {
                            var d = a.tracks[c];
                            if (b.pcHashes.find(function(a) {
                                return a === d.pcHash;
                            })) return "continue";
                            b.pcHashes.push(d.pcHash);
                        })(c);
                    }
                    for (var d = a.getTransportStats(), c = 0; c < this.pcHashes.length; c++) {
                        var e = this.pcHashes[c], f = {};
                        f.codec = a.getCodec(), f.trackStats = a.getTrackStats(), f.tracks = [];
                        for (var g = 0; g < a.tracks.length; g++) {
                            var h = a.tracks[g];
                            h.pcHash === e && f.tracks.push(h);
                        }
                        var j = d.get(e);
                        1 == j.length ? f.Transport = j[0] : f.Transport = j, this.transmit(i.CallstatsOut, e, f);
                    }
                }
            } ]), b;
        }(h.Component);
        c.StatsAssembler = j;
    }, {
        "../collections/component": 25
    } ],
    70: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsCallbackBuilder = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/registry"), g = function() {
            function a() {
                d(this, a), this.callback = null;
            }
            return e(a, [ {
                key: "setCallback",
                value: function(a) {
                    this.callback = a;
                }
            }, {
                key: "buildStats",
                value: function(a, b) {
                    this.callback && this.buildFromUnifiedFormat(a, b);
                }
            }, {
                key: "getConnectionState",
                value: function() {
                    return !0 === navigator.onLine ? "online" : "offline";
                }
            }, {
                key: "buildConferenceUrl",
                value: function(a) {
                    var b = a.getConferenceId(), c = f.Registry.getConferenceManager().get(b);
                    return c ? c.getUrl() : null;
                }
            }, {
                key: "buildFromUnifiedFormat",
                value: function(a, b) {
                    var c = {};
                    c.connectionState = this.getConnectionState(), c.conferenceURL = this.buildConferenceUrl(b), 
                    c.fabricState = b.getPcState(), c.streams = {};
                    for (var d = 0; d < a.length; d++) {
                        var e = a[d];
                        if ("inbound-rtp" === e.type || "outbound-rtp" === e.type) {
                            var f = {
                                ssrc: e.ssrc,
                                statsType: e.type,
                                fractionLoss: e.csioIntFL,
                                bitrate: e.csioIntBRKbps,
                                quality: e.csioMark,
                                mediaType: e.csioMediaType,
                                jitter: e.jitter,
                                audioOutputLevel: e.audioOutputLevel,
                                audioIntputLevel: e.audioIntputLevel,
                                audioLevel: e.audioLevel,
                                averageRTT: e.csioAvgRtt,
                                averageJitter: e.csioAvgJitter,
                                packetLossPercentage: e.csioPktLossPercentage,
                                rtt: e.roundTripTime,
                                remoteUserID: b.getRemoteId()
                            }, g = b.getSSRCInfo(e.ssrc + "");
                            g && (f.cname = g.cname, f.msid = g.msid, f.usageLabel = g.usageLabel, f.associatedVideoTag = g.associatedVideoTag), 
                            e.hasOwnProperty("googRtt") && (f.rtt = e.googRtt), e.hasOwnProperty("mozRtt") && (f.rtt = e.mozRtt), 
                            e.hasOwnProperty("googJitterReceived") && (f.jitter = e.googJitterReceived), c.streams[e.ssrc] = f;
                        }
                    }
                    this.callback(c);
                }
            } ]), a;
        }();
        c.StatsCallbackBuilder = g;
    }, {
        "../utility/registry": 94
    } ],
    71: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsMonitor = c.StatsMonitorIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("./tracksmonitor"), k = a("./transportsmonitor"), l = a("./statstuple"), m = a("../utility/registry"), n = a("./monitorhooks/sendingtrigger"), o = a("./monitorhooks/onewaymediaobserver"), p = a("./monitorhooks/throughputobserver"), q = a("./monitorhooks/cpulimitationobserver"), r = a("./monitorhooks/qpsumobserver"), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = c.StatsMonitorIO = {
            PcStatsTupleIn: "PcStatsTupleIn",
            StatsTupleOut: "StatsTupleOut"
        }, x = function(a) {
            function b(a) {
                e(this, b);
                var c = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsMonitor"));
                return c.bindPort(w.PcStatsTupleIn, c.receive, c), c.declarePort(w.StatsTupleOut), 
                c.lastPcStats = null, c.lastPcHash = null, c.tracksmonitor = new j.TracksMonitor(), 
                c.transportsmonitor = new k.TransportsMonitor(a), c.candidatepairs = new Map(), 
                c.monitorhooks = [], c.sendingTrigger = new n.SendingTrigger(c.sendStatsTuple.bind(c)), 
                c.oneWayMediaObserver = new o.OneWayMediaObserver(c.sendDisruptions.bind(c)), c.throughputObserver = new p.ThroughputObserver(c.sendThroughputObservations.bind(c)), 
                c.cpuLimitationObserver = new q.CPULimitationObserver(c.sendCPULimitationObservations.bind(c)), 
                c.qpSumObserver = new r.QPSumObserver(c.sendQPSumDistortions.bind(c)), c.setupHooks(), 
                c;
            }
            return g(b, a), h(b, [ {
                key: "setupHooks",
                value: function() {
                    this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)), this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)), 
                    this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)), 
                    this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)), 
                    this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver));
                }
            }, {
                key: "setIntervals",
                value: function(a, b) {
                    this.sendingTrigger.setup(a, b);
                }
            }, {
                key: "receive",
                value: function(a) {
                    var b = a.getPcHash(), c = a.getMeasurements();
                    this.candidatepairs.set(b, a.getCandidatePair()), this.transportsmonitor.set(b, a.getTransportStats());
                    for (var d = 0; d < c.length; d++) {
                        var e = c[d], f = this.tracksmonitor.getMonitor(e);
                        f ? f.add(e) : v.warn("No monitor for ssrc " + e.getSSRC());
                    }
                    this.lastPcStats = a, this.lastPcHash = b;
                    for (var g = this.tracksmonitor.getMonitors(), h = this.monitorhooks, i = 0; i < h.length; i++) {
                        (0, h[i])(g);
                    }
                }
            }, {
                key: "getCandidatePairs",
                value: function() {
                    var a = [];
                    return this.candidatepairs.forEach(function(b, c) {
                        var d = [ c, b ];
                        a.push(d);
                    }), a;
                }
            }, {
                key: "sendStatsTuple",
                value: function() {
                    var a = new l.StatsTuple(this.getCandidatePairs(), this.lastPcStats.getCodec(), this.lastPcStats.getTrackStats(), this.transportsmonitor.getIntervalStats(), this.tracksmonitor.extractTracks());
                    this.transmit(w.StatsTupleOut, a);
                }
            }, {
                key: "sendDisruptions",
                value: function(a) {
                    var b = this;
                    a.forEach(function(a) {
                        b.sendEventMsg(t.internalFabricEvent.oneWayMedia, a.getContent());
                    });
                }
            }, {
                key: "sendCPULimitationObservations",
                value: function(a) {}
            }, {
                key: "sendQPSumDistortions",
                value: function(a) {}
            }, {
                key: "sendThroughputObservations",
                value: function(a) {
                    this.sendEventMsg(t.internalFabricEvent.sendingThroughputObservations, a);
                }
            }, {
                key: "sendEventMsg",
                value: function(a, b) {
                    if (this.lastPcHash) {
                        var c = m.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);
                        if (c) {
                            var d = c.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash), e = d.getPeerConnection(), f = d.getConferenceId();
                            m.Registry.getEventMessageBuilder().make(a, f, e, b);
                        }
                    }
                }
            } ]), b;
        }(i.Component);
        c.StatsMonitor = x;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./monitorhooks/cpulimitationobserver": 60,
        "./monitorhooks/onewaymediaobserver": 61,
        "./monitorhooks/qpsumobserver": 62,
        "./monitorhooks/sendingtrigger": 63,
        "./monitorhooks/throughputobserver": 64,
        "./statstuple": 74,
        "./tracksmonitor": 80,
        "./transportsmonitor": 81
    } ],
    72: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsParser = c.StatsParserIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("./measurement"), k = a("./pcstats"), l = a("../utility/rttregistry"), m = a("./validator"), n = d(m), o = a("../config/constants"), p = d(o), q = a("../utility/csiologger"), r = d(q), s = c.StatsParserIO = {
            RawStatsIn: "RawStatsIn",
            PcStatsTupleOut: "PcStatsTupleOut"
        }, t = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsParser"));
                return a.bindPort(s.RawStatsIn, a.receive, a), a.declarePort(s.PcStatsTupleOut), 
                a;
            }
            return g(b, a), h(b, [ {
                key: "receive",
                value: function(a) {
                    if (null === a) return void r.warn("Stats object can not be null");
                    for (var b = a.tracks, c = [], d = 0; d < b.length; ++d) {
                        var e = b[d];
                        if (e && e.data) {
                            var f = j.Measurement.make(a.pcHash, this.getSSRC(e), this.getStreamType(e), this.getMediaType(e), this.getFrameRateReceived(e), this.getFrameHeight(e), this.getFrameWidth(e), this.getDroppedFramesNum(e), this.getRTT(e), this.getJitter(e), this.getLostPackets(e), this.getReceivedPackets(e), this.getSentPackets(e), this.getDiscardedPackets(e), this.getSentBytes(e), this.getReceivedBytes(e), e);
                            c.push(f);
                        } else r.log("No track or track.data.");
                    }
                    var g = new k.PcStats(a.candidatePair, a.codec, a.pcHash, a.trackStats, a.transportStats, c);
                    this.transmit(s.PcStatsTupleOut, g);
                }
            }, {
                key: "getSSRC",
                value: function(a) {
                    return a.ssrc;
                }
            }, {
                key: "getStreamType",
                value: function(a) {
                    return a.streamType === p.streamType.inbound ? p.streamType.inbound : a.streamType === p.streamType.outbound ? p.streamType.outbound : void 0;
                }
            }, {
                key: "getSentBytes",
                value: function(a) {
                    if (void 0 === a.data.bytesSent) return -1;
                    var b = n.checkForNan(parseInt(a.data.bytesSent, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getReceivedBytes",
                value: function(a) {
                    if (void 0 === a.data.bytesReceived) return -1;
                    var b = n.checkForNan(parseInt(a.data.bytesReceived, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getReceivedPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsReceived) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsReceived, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getSentPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsSent) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsSent, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getDiscardedPackets",
                value: function(a) {
                    if (void 0 === a.data.discardedPackets) return -1;
                    var b = n.checkForNan(parseInt(a.data.discardedPackets, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getLostPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsLost) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsLost, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getDroppedFramesNum",
                value: function(a) {
                    if (void 0 === a.data.droppedFrames) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.droppedFrames, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getFrameRateReceived",
                value: function(a) {
                    var b = null;
                    return void 0 !== a.data.googFrameRateOutput ? b = parseInt(a.data.googFrameRateOutput, 10) : void 0 !== a.data.googFrameRateDecoded ? b = parseInt(a.data.googFrameRateDecoded, 10) : void 0 !== a.data.googFrameRateReceived ? b = parseInt(a.data.googFrameRateReceived, 10) : void 0 !== a.data.googFrameRateSent ? b = parseInt(a.data.googFrameRateSent, 10) : void 0 !== a.data.framerateMean && (b = parseInt(a.data.framerateMean, 10)), 
                    void 0 !== b && (b = n.checkForNegativeValue(b)), b;
                }
            }, {
                key: "getFrameHeight",
                value: function(a) {
                    var b = void 0;
                    return void 0 !== a.data.googFrameHeightReceived ? b = a.data.googFrameHeightReceived : void 0 !== a.data.googFrameHeightSent ? b = a.data.googFrameHeightSent : void 0 !== a.data.frameHeight && (b = a.data.frameHeight), 
                    b;
                }
            }, {
                key: "getJitter",
                value: function(a) {
                    return void 0 !== a.data.googJitterReceived ? n.checkForNan(parseInt(a.data.googJitterReceived, 10)) : void 0 !== a.data.jitter ? n.checkForNan(parseInt(a.data.jitter, 10)) : void 0;
                }
            }, {
                key: "getFrameWidth",
                value: function(a) {
                    return void 0 !== a.data.googFrameWidthReceived ? a.data.googFrameWidthReceived : void 0 !== a.data.googFrameWidthSent ? a.data.googFrameWidthSent : void 0 !== a.data.frameWidth ? a.data.frameWidth : void 0;
                }
            }, {
                key: "getRTT",
                value: function(a) {
                    var b = function(a) {
                        return isNaN(a) || a < 0 ? null : a;
                    };
                    if (void 0 !== a.data.googRtt) return b(parseInt(a.data.googRtt, 10));
                    if (void 0 !== a.data.mozRtt) return b(parseInt(a.data.mozRtt, 10));
                    if (a.data.roundTripTime) return b(parseInt(a.data.roundTripTime, 10));
                    var c = this.getSSRC(a), d = (0, l.getRTTRegistry)().getRTT(c);
                    return d && (a.data.roundTripTime = d), d;
                }
            }, {
                key: "getMediaType",
                value: function(a) {
                    var b = p.mediaType.unknown;
                    return a.data && void 0 !== a.data.mediaType ? a.data.mediaType : (void 0 !== a.data.googFrameRateReceived || void 0 !== a.data.googFrameRateSent ? b = p.mediaType.video : void 0 !== a.data.audioInputLevel || void 0 !== a.data.audioOutputLevel ? b = p.mediaType.audio : a.data.mediaType ? b = a.data.mediaType : void 0 !== a.data.framerateMean && (b = p.mediaType.video), 
                    b);
                }
            } ]), b;
        }(i.Component);
        c.StatsParser = t;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/rttregistry": 95,
        "./measurement": 59,
        "./pcstats": 66,
        "./validator": 82
    } ],
    73: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsTransmitter = c.StatsTransmitterIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = c.StatsTransmitterIO = {
            CallstatsIn: "CallstatsIn",
            UnprocessedIn: "UnprocessedIn"
        }, p = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsTransmitter"));
                return a.pcHashes = [], a.battery = j.Registry.getBattery(), a.lastUnprocessed = null, 
                a.bindPort(o.CallstatsIn, a.receiveCallstats, a), a.bindPort(o.UnprocessedIn, a.receiveUnprocessed, a), 
                a;
            }
            return g(b, a), h(b, [ {
                key: "receiveUnprocessed",
                value: function(a) {
                    this.lastUnprocessed = a;
                }
            }, {
                key: "receiveCallstats",
                value: function(a, b) {
                    var c = null;
                    if (!(c = this.getUnifiedFormat(b))) return void n.warn("Content can not be sent");
                    this.send(a, c);
                }
            }, {
                key: "send",
                value: function(a, b) {
                    var c = j.Registry.getConferenceManager().getConferenceForPcHash(a);
                    if (c) {
                        var d = c.getPeerConnectionManager().getPcHandlerByHash(a);
                        if (d) {
                            j.Registry.getEventMessageBuilder().make(l.callstatsChannels.processedStats, d.getConferenceId(), d.getPeerConnection(), b), 
                            this.sendToStatsCallback(b.stats, d);
                        }
                    }
                }
            }, {
                key: "sendToStatsCallback",
                value: function(a, b) {
                    var c = j.Registry.getStatsCallbackBuilder();
                    c && c.buildStats(a, b);
                }
            }, {
                key: "getUnifiedFormat",
                value: function(a) {
                    for (var b = this.lastUnprocessed, c = [], d = 0; d < b.length; d++) {
                        var e = b[d], f = {};
                        e.id && (f.id = e.id), e.timestamp && (f.timestamp = e.timestamp), e.type && (f.type = e.type), 
                        Object.assign(f, e);
                        var g = function(b) {
                            for (var c = 0; c < a.tracks.length; c++) {
                                var d = a.tracks[c];
                                if (d.data.id === b.id && d.data.type === b.type) return d.data;
                            }
                            return b.id === a.Transport.id && b.type === a.Transport.type ? a.Transport : null;
                        }(e);
                        if (g) {
                            for (var h in g) if (g.hasOwnProperty(h)) {
                                if ("id" === h || "type" === h || "timestamp" === h) continue;
                                f[h] = g[h];
                            }
                            c.push(f);
                        } else c.push(f);
                    }
                    var i = {
                        stats: c
                    };
                    return i.wifiStats = j.Registry.getWifiStatsExecutor().getWifiStats(), i.batteryStatus = {}, 
                    i.batteryStatus.batteryLevel = this.battery.getLevel(), i.batteryStatus.isBatteryCharging = this.battery.getCharging(), 
                    i;
                }
            } ]), b;
        }(i.Component);
        c.StatsTransmitter = p;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94
    } ],
    74: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e, f, g) {
                d(this, a), this.candidatePairs = b, this.codec = c, this.trackStats = e, this.transportStats = f, 
                this.tracks = g;
            }
            return e(a, [ {
                key: "getCandidatePairs",
                value: function() {
                    return this.candidatePairs;
                }
            }, {
                key: "getCodec",
                value: function() {
                    return this.codec;
                }
            }, {
                key: "getTrackStats",
                value: function() {
                    return this.trackStats;
                }
            }, {
                key: "getTransportStats",
                value: function() {
                    return this.transportStats;
                }
            }, {
                key: "getTracks",
                value: function() {
                    return this.tracks;
                }
            } ]), a;
        }();
        c.StatsTuple = f;
    }, {} ],
    75: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWAvg = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./swplugin"), i = function(a) {
            function b(a, c) {
                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, b);
                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c, f));
                return g.sum = 0, g.counter = 0, g;
            }
            return f(b, a), g(b, [ {
                key: "add",
                value: function(a) {
                    this.filter(a) && (this.sum += this.extract(a), ++this.counter, this.calculate());
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.filter(a) && (this.sum -= this.extract(a), --this.counter, this.calculate());
                }
            }, {
                key: "calculate",
                value: function() {
                    var a = 0;
                    if (this.counter < 1) return void this.notify(a);
                    a = this.sum / this.counter, this.notify(a);
                }
            } ]), b;
        }(h.SWPlugin);
        c.SWAvg = i;
    }, {
        "./swplugin": 78
    } ],
    76: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWBTreePercentile = void 0;
        var g = function() {
            function a(a, b) {
                var c = [], d = !0, e = !1, f = void 0;
                try {
                    for (var g, h = a[Symbol.iterator](); !(d = (g = h.next()).done) && (c.push(g.value), 
                    !b || c.length !== b); d = !0) ;
                } catch (a) {
                    e = !0, f = a;
                } finally {
                    try {
                        !d && h.return && h.return();
                    } finally {
                        if (e) throw f;
                    }
                }
                return c;
            }
            return function(b, c) {
                if (Array.isArray(b)) return b;
                if (Symbol.iterator in Object(b)) return a(b, c);
                throw new TypeError("Invalid attempt to destructure non-iterable instance");
            };
        }(), h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("./swplugin"), j = a("../../collections/binarytree"), k = function(a) {
            function b(a, c, f, g) {
                var h = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : null, i = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : null, k = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : null;
                d(this, b);
                var l = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, f, g, i));
                if (99 < a || a < 1) throw new RangeError("Percentile parameter must be between 1 and 99");
                return l.comparator = c, l.percentile = a, l.meanCalcer = k, l.estimator = h, l.ratio = a / (100 - a), 
                l.maxtree = new j.BinaryTree(c), l.mintree = new j.BinaryTree(c), l.ratio < 1 ? l.required = 1 / l.ratio + 1 : 1 < l.ratio ? l.required = l.ratio + 1 : l.required = 2, 
                l.result = null, l;
            }
            return f(b, a), h(b, [ {
                key: "add",
                value: function(a) {
                    if (this.filter(a)) {
                        if (this.maxtree.getNodeCounter() < 1) return this.maxtree.insert(a), void this.calculate();
                        this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.insert(a) : this.mintree.insert(a), 
                        this.balancing(), this.calculate();
                    }
                }
            }, {
                key: "remove",
                value: function(a) {
                    if (this.filter(a)) {
                        var b = this.mintree.getNodeCounter();
                        this.maxtree.getNodeCounter() < 1 ? this.mintree.delete(a) : b < 1 ? this.maxtree.delete(a) : this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.delete(a) : this.mintree.delete(a), 
                        this.calculate();
                    }
                }
            }, {
                key: "getThresholds",
                value: function() {
                    var a = this.mintree.getSize(), b = this.maxtree.getSize(), c = a + 1, d = b + 1;
                    return 1 < this.ratio ? (c = Math.ceil(a * this.ratio), d = Math.floor(b / this.ratio) + 1) : this.ratio < 1 && (c = Math.floor(a * this.ratio) + 1, 
                    d = Math.ceil(b / this.ratio)), [ c, d ];
                }
            }, {
                key: "balancing",
                value: function() {
                    var a = this.mintree, b = this.maxtree, c = a.getSize(), d = b.getSize();
                    if (!(d + c < this.required)) {
                        if (c < 1) return void a.insertNodeAtBottom(b.popTopNode());
                        for (d < 1 && b.insertNodeAtTop(a.popBottomNode()); ;) {
                            var e = 1 < a.getNodeCounter(), f = 1 < b.getNodeCounter(), h = a.getBottomNode().getLength(), i = b.getTopNode().getLength();
                            if (a.getNodeCounter() < 1 || b.getNodeCounter() < 1) break;
                            var j = this.getThresholds(), k = g(j, 2), l = k[0], m = k[1];
                            if (f &= c + i <= m, e &= d + h <= l, c = a.getSize(), d = b.getSize(), l < d && f) a.insertNodeAtBottom(b.popTopNode()); else {
                                if (!(m < c && e)) break;
                                b.insertNodeAtTop(a.popBottomNode());
                            }
                        }
                    }
                }
            }, {
                key: "getMean",
                value: function(a, b) {
                    return this.meanCalcer ? this.meanCalcer(a, b) : a;
                }
            }, {
                key: "estimate",
                value: function(a, b) {
                    return this.estimator ? this.estimator(a, b) : null;
                }
            }, {
                key: "calculate",
                value: function() {
                    var a = null, b = this.mintree, c = this.maxtree, d = b.getSize(), e = c.getSize(), f = e + d;
                    if (!(f < 1)) {
                        if (f < this.required || d < 1 || e < 1) {
                            if (0 == f) return;
                            var g = void 0, h = void 0;
                            d < 1 ? (g = this.maxtree.getBottomValue(), h = this.maxtree.getTopValue()) : e < 1 ? (g = this.mintree.getBottomValue(), 
                            h = this.mintree.getTopValue()) : (h = this.mintree.getTopValue(), g = this.maxtree.getBottomValue());
                            var i = this.estimate(g, h);
                            return void this.notify(i);
                        }
                        var j = c.getTopNode(), k = b.getBottomNode();
                        if (j || k) {
                            if (!j) {
                                var l = this.extract(k);
                                return void this.notify(l);
                            }
                            if (!k) {
                                var m = this.extract(j);
                                return void this.notify(m);
                            }
                            var n = f * (this.percentile / 100);
                            if (!Number.isInteger(n)) {
                                var o = e / d;
                                a = this.ratio < o ? j.peek() : o < this.ratio ? k.peek() : this.ratio < 1 ? k.peek() : j.peek();
                            } else {
                                var p = Math.floor(n);
                                a = Math.ceil(n + 1) <= e ? j.peek() : p <= e ? this.getMean(j.peek(), k.peek()) : k.peek();
                            }
                            var q = this.extract(a);
                            this.notify(q);
                        }
                    }
                }
            } ]), b;
        }(i.SWPlugin);
        c.SWBTreePercentile = k;
    }, {
        "../../collections/binarytree": 22,
        "./swplugin": 78
    } ],
    77: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWFunctor = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./swplugin"), i = function(a) {
            function b(a, c) {
                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, b);
                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, null, null, f));
                return g.addFunc = a, g.remFunc = c, g;
            }
            return f(b, a), g(b, [ {
                key: "add",
                value: function(a) {
                    this.filter(a) && this.addFunc && this.addFunc(a);
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.filter(a) && this.remFunc && this.remFunc(a);
                }
            }, {
                key: "toString",
                value: function() {
                    return "SWFuncPlugin";
                }
            } ]), b;
        }(h.SWPlugin);
        c.SWFunctor = i;
    }, {
        "./swplugin": 78
    } ],
    78: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWPlugin = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../../utility/csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b, c) {
                var e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, a), this.extractorFnc = b, this.notifierFnc = c, this.filterFunc = e;
            }
            return e(a, [ {
                key: "notify",
                value: function(a) {
                    if (!this.notifierFnc) return void g.warn("Failed notification for " + this.toString());
                    this.notifierFnc(a);
                }
            }, {
                key: "extract",
                value: function(a) {
                    return this.extractorFnc ? this.extractorFnc(a) : (g.warn(this.toString() + " tried to extract without extractorFnc"), 
                    null);
                }
            }, {
                key: "filter",
                value: function(a) {
                    return !this.filterFunc || this.filterFunc(a);
                }
            }, {
                key: "add",
                value: function(a) {
                    g.log("Abstract method is called width value: " + a);
                }
            }, {
                key: "remove",
                value: function(a) {
                    g.log("Abstract method is called with value: " + a);
                }
            }, {
                key: "toString",
                value: function() {
                    return "SWPlugin";
                }
            } ]), a;
        }();
        c.SWPlugin = h;
    }, {
        "../../utility/csiologger": 87
    } ],
    79: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        function g(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function h(a, b) {
            return b.green <= a ? t.avQualityRatings.excellent : b.red < a ? t.avQualityRatings.fair : t.avQualityRatings.bad;
        }
        function i(a, b) {
            return b.red < a ? t.avQualityRatings.bad : b.green <= a ? t.avQualityRatings.fair : t.avQualityRatings.excellent;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TrackMonitor = void 0;
        var j = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, k = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), l = a("../utility/registry"), m = a("../collections/slidingwindow"), n = a("../statspipeline/swplugins/swavg"), o = a("../statspipeline/swplugins/swbtreepercentile"), p = a("../statspipeline/swplugins/swfunctor"), q = a("../utility/timestamps"), r = d(q), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = function() {
            function a() {
                g(this, a), this.evaluators = [];
            }
            return k(a, [ {
                key: "addEvaluator",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, c = {
                        processFnc: a,
                        weight: b
                    };
                    this.evaluators.push(c);
                }
            }, {
                key: "getQuality",
                value: function(a) {
                    for (var b = 0, c = [], d = 0, e = 0; e < this.evaluators.length; e++) {
                        var f = this.evaluators[e], g = 0, h = f.processFnc ? f.processFnc(a) : 0;
                        if (h) {
                            if (h === t.avQualityRatings.bad) g = t.qualityRating.bad; else if (h === t.avQualityRatings.fair) g = t.qualityRating.fair; else if (h === t.avQualityRatings.excellent) g = t.qualityRating.excellent; else if (h === t.avQualityRatings.unknown) continue;
                            b += f.weight, c.push({
                                result: g,
                                weight: f.weight
                            });
                        }
                    }
                    for (var i = 0; i < c.length; i++) {
                        var j = c[i];
                        d += j.result * (j.weight / b);
                    }
                    return d = Math.floor(d), d === t.qualityRating.excellent ? t.avQualityRatings.excellent : d === t.qualityRating.good ? t.avQualityRatings.fair : d === t.qualityRating.fair ? t.avQualityRatings.fair : d === t.qualityRating.poor ? t.avQualityRatings.fair : d === t.qualityRating.bad ? t.avQualityRatings.bad : void 0;
                }
            } ]), a;
        }(), x = function(a) {
            function b(a, c, d, f) {
                g(this, b);
                var h = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c));
                return h.thresholds = [], h.enableThresholds = !1, h.requestTime = 0, h.started = 0, 
                h.created = r.getCurrent(), h.mediaType = f, h.streamType = d, h.qualityHelper = new w(), 
                h.metrics = h.makeTrack(), h.lastTrack = {}, h.prevFrameRateMean = null, h.ssrc = null, 
                h.scsHelper = {
                    total: 0,
                    above: 0,
                    ccDriven: 0,
                    sumMaxBitrateDiff: 0,
                    sumThroughputDiff: 0,
                    prevCsioAvgBRKbps: 0
                }, h;
            }
            return f(b, a), k(b, null, [ {
                key: "make",
                value: function(a, c, d, e) {
                    var f = new b(a, c, d, e), g = f.metrics;
                    return f.attach(new n.SWAvg(function(a) {
                        return a.getJitter();
                    }, function(a) {
                        g.csioAvgJitter = a;
                    }, function(a) {
                        var b = a.getJitter();
                        return null !== b && void 0 !== b;
                    })), f.attach(new n.SWAvg(function(a) {
                        return a.getRTT();
                    }, function(a) {
                        g.csioAvgRtt = a;
                    }, function(a) {
                        var b = a.getRTT();
                        return null !== b && void 0 !== b;
                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getJitter(), d = b.getJitter();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getJitter();
                    }, function(a) {
                        g.csioPercentileJitter = a;
                    }, function(a, b) {
                        return b ? b.getJitter() : a ? a.getJitter() : void 0;
                    }, function(a) {
                        var b = a.getJitter();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getRTT(), d = b.getRTT();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getRTT();
                    }, function(a) {
                        g.csioSig2Latency = a, g.csioeM = a + 40;
                    }, function(a, b) {
                        return b ? b.getRTT() : a ? a.getRTT() : void 0;
                    }, function(a) {
                        var b = a.getRTT();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), d === t.streamType.inbound ? b.setupInboundMonitor(f) : d === t.streamType.outbound ? b.setupOutboundMonitor(f) : v.warn("Unrecognized streamType (" + d + ") at TrackMonitor"), 
                    e === t.mediaType.audio ? b.setupAudioMonitor(f) : e === t.mediaType.video ? b.setupVideoMonitor(f) : v.warn("Unrecognized mediaType (" + e + ") at TrackMonitor"), 
                    d === t.streamType.inbound && e === t.mediaType.audio ? b.setupInbAudioQualityEvaluator(f) : d === t.streamType.inbound && e === t.mediaType.video ? b.setupInbVideoQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.audio ? b.setupOutbAudioQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.video && (b.setupOutbVideoQualityEvaluator(f), 
                    b.setupSCSValidator(f)), f.addPostProcess(function(a) {
                        g.csioMark = f.getQuality(a);
                    }), f;
                }
            }, {
                key: "setupInbAudioQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntFL || null === b.csioIntFL || b.csioIntFL < 0 ? t.avQualityRatings.unknown : i(b.csioIntFL, t.fractionalLossThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);
                    });
                }
            }, {
                key: "setupOutbAudioQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);
                    });
                }
            }, {
                key: "setupInbVideoQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);
                    }), a.addQualityEvaluator(function(c) {
                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);
                    });
                }
            }, {
                key: "setupOutbVideoQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 == b.csioIntBRKbps || null == b.csioIntBRKbps ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);
                    }), a.addQualityEvaluator(function(c) {
                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);
                    });
                }
            }, {
                key: "setupInboundMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.addPreProcess(function(c) {
                        var d = c.getLostPackets(), e = c.getReceivedPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;
                        f ? (g = d - f.getLostPackets(), h = e - f.getReceivedPackets()) : (g = d, h = e);
                        var i = 0;
                        (0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, c.setFractionLost(i);
                    }), a.attach(new p.SWFunctor(function(c) {
                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getReceivedBytes(), j = c.getReceivedPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);
                        f ? (p = j - f.getReceivedPackets(), m = i - 8 * f.getReceivedBytes(), n = h - f.getLostPackets(), 
                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), 
                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), 
                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioIntPR = p / (o / 1e3), 
                        b.csioAvgBRKbps = i / s, b.csioIntBRKbps = m / o, b.csioAvgPacketSize = c.getReceivedBytes() / j, 
                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;
                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFractionLost(), d = b.getFractionLost();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFractionLost();
                    }, function(a) {
                        b.csioPercentileFl = a;
                    }, function(a, b) {
                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;
                    }, function(a) {
                        var b = a.getFractionLost();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    }));
                }
            }, {
                key: "setupOutboundMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.addPreProcess(function(c) {
                        var d = c.getLostPackets(), e = c.getSentPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;
                        f ? (g = d - f.getLostPackets(), h = e - f.getSentPackets()) : (g = d, h = e);
                        var i = 0;
                        (0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, c.setFractionLost(i);
                    }), a.attach(new p.SWFunctor(function(c) {
                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getSentBytes(), j = c.getSentPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);
                        f ? (p = j - f.getSentPackets(), m = i - 8 * f.getSentBytes(), n = h - f.getLostPackets(), 
                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), 
                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), 
                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioAvgBRKbps = i / s, 
                        b.csioIntBRKbps = m / o, b.csioIntPR = p / (o / 1e3), b.csioAvgPacketSize = c.getSentBytes() / j, 
                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;
                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFractionLost(), d = b.getFractionLost();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFractionLost();
                    }, function(a) {
                        b.csioPercentileFl = a;
                    }, function(a, b) {
                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;
                    }, function(a) {
                        var b = a.getFractionLost();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    }));
                }
            }, {
                key: "setupAudioMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new p.SWFunctor(function(a) {
                        b.csioMediaType = t.mediaType.audio;
                    }, null, null));
                }
            }, {
                key: "setupVideoMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new n.SWAvg(function(a) {
                        return a.getFrameRateReceived();
                    }, function(c) {
                        a.prevFrameRateMean = b.csioFrameRateMean, b.csioFrameRateMean = c;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    })), a.attach(new n.SWAvg(function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeightMean = a;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    })), a.attach(new n.SWAvg(function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidthMean = a;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameRateReceived();
                    }, function(a) {
                        b.csioFrameRate95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameRateReceived();
                    }, function(a) {
                        b.csioFrameRate50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameHeight(), d = b.getFrameHeight();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeight95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameHeight(), d = b.getFrameHeight();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeight50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameWidth(), d = b.getFrameWidth();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidth95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameWidth(), d = b.getFrameWidth();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidth50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new p.SWFunctor(function(a) {
                        b.csioMediaType = t.mediaType.video;
                    }, null, null));
                }
            }, {
                key: "setupSCSValidator",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new p.SWFunctor(function(c) {
                        var d = l.Registry.getConfigServiceWrapper().getSenderConfig();
                        if (!d || !d.rtc_rtp_parameters || !d.rtc_rtp_parameters.encodings) return b.csioSCSValidationSampleCount = null, 
                        b.csioAvgMaxBitrateDiff = null, b.csioAvgDeltaThroughput = null, b.csioMaxBitrateAboveRatio = null, 
                        void (b.csioCCDrivenRatio = null);
                        var e = 0;
                        d.rtc_rtp_parameters.encodings.forEach(function(a) {
                            a && (e = Math.max(e, a.maxBitrate));
                        });
                        var f = 0, g = l.Registry.getConfigServiceWrapper().getDefaultSenderConfig();
                        if (g && g.encodings) {
                            g.encodings.forEach(function(a) {
                                f = Math.max(f, a.maxBitrate);
                            });
                            var h = 0, i = 0, j = null, k = null, m = a.getSCSHelper();
                            0 < f && .9 * f < 1e3 * b.csioAvgBRKbps ? (h = e - f, k = !1) : (h = e - 1e3 * b.csioAvgBRKbps, 
                            k = !0), j = 0 < h, i = b.csioAvgBRKbps - b.prevCsioAvgBRKbps, m.prevCsioAvgBRKbps = b.csioAvgBRKbps, 
                            b.csioSCSValidationSampleCount = ++m.total, m.sumMaxBitrateDiff += h, b.csioAvgMaxBitrateDiff = m.sumMaxBitrateDiff / m.total, 
                            m.sumThroughputDiff += i, b.csioAvgDeltaThroughput = m.sumThroughputDiff / m.total, 
                            j && (m.above += 1), b.csioMaxBitrateAboveRatio = m.above / m.total, k && (m.ccDriven += 1), 
                            b.csioCCDrivenRatio = m.ccDriven / m.total;
                        }
                    }, null, null));
                }
            } ]), k(b, [ {
                key: "makeTrack",
                value: function() {
                    var a = {};
                    return a.csioMediaType = void 0, a.csioMark = void 0, a.csioIntBRKbps = void 0, 
                    a.csioAvgBRKbps = void 0, a.csioIntFL = void 0, a.csioIntMs = void 0, a.csioIntPR = void 0, 
                    a.csioPercentileFl = void 0, a.csioAvgJitter = void 0, a.csioAvgRtt = void 0, a.csioPercentileJitter = void 0, 
                    a.csioSig2Latency = void 0, a.csioTimeElapseMs = void 0, a.csioeM = void 0, a.csiores = void 0, 
                    a.csioFrameWidth95Percentile = void 0, a.csioFrameWidth50Percentile = void 0, a.csioFrameHeight95Percentile = void 0, 
                    a.csioFrameHeight50Percentile = void 0, a.csioFrameRate95Percentile = void 0, a.csioFrameRate50Percentile = void 0, 
                    a.csioFrameWidthMean = void 0, a.csioFrameHeightMean = void 0, a.csioFrameRateMean = void 0, 
                    a.csioIntPktRcv = void 0, a.csioSCSValidationSampleCount = null, a.csioAvgMaxBitrateDiff = null, 
                    a.csioAvgDeltaThroughput = null, a.csioMaxBitrateAboveRatio = null, a.csioCCDrivenRatio = null, 
                    a;
                }
            }, {
                key: "getSSRC",
                value: function() {
                    return this.ssrc;
                }
            }, {
                key: "add",
                value: function(a) {
                    this.ssrc = a.getSSRC(), this.lastTrack = a.extractTrack(), this.lastTrack.pcHash = a.getPcHash(), 
                    0 === this.started && (this.started = r.getCurrent()), j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "add", this).call(this, a);
                }
            }, {
                key: "hasTraffic",
                value: function() {
                    return 0 < this.metrics.csioIntBRKbps;
                }
            }, {
                key: "getTrack",
                value: function() {
                    var a = this.lastTrack;
                    return Object.assign(a.data, this.metrics), a;
                }
            }, {
                key: "extractTrack",
                value: function() {
                    var a = this.lastTrack;
                    return Object.assign(a.data, this.metrics), this.requestTime = r.getCurrent(), this.requestedMeasurement = this.peek(), 
                    a;
                }
            }, {
                key: "getMediaType",
                value: function() {
                    return this.mediaType;
                }
            }, {
                key: "getStreamType",
                value: function() {
                    return this.streamType;
                }
            }, {
                key: "getStartTime",
                value: function() {
                    return this.started;
                }
            }, {
                key: "getCreationTime",
                value: function() {
                    return this.created;
                }
            }, {
                key: "getRequestTime",
                value: function() {
                    return Math.max(this.started, this.requestTime);
                }
            }, {
                key: "getRequestedMeasurement",
                value: function() {
                    return this.requestedMeasurement;
                }
            }, {
                key: "getSCSHelper",
                value: function() {
                    return this.scsHelper;
                }
            }, {
                key: "addQualityEvaluator",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
                    this.qualityHelper.addEvaluator(a, b);
                }
            }, {
                key: "getQuality",
                value: function(a) {
                    return this.qualityHelper.getQuality(a);
                }
            }, {
                key: "addPreProcess",
                value: function(a) {
                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPreProcess", this).call(this, a);
                }
            }, {
                key: "addPostProcess",
                value: function(a) {
                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPostProcess", this).call(this, a);
                }
            } ]), b;
        }(m.SlidingWindow);
        c.TrackMonitor = x;
    }, {
        "../collections/slidingwindow": 27,
        "../config/constants": 32,
        "../statspipeline/swplugins/swavg": 75,
        "../statspipeline/swplugins/swbtreepercentile": 76,
        "../statspipeline/swplugins/swfunctor": 77,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    80: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TracksMonitor = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./trackmonitor"), g = a("../config/constants"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.inbMonitors = new Map(), this.outbMonitors = new Map();
            }
            return e(a, [ {
                key: "getMonitor",
                value: function(a) {
                    var b = a.getStreamType(), c = a.getMediaType(), d = a.getSSRC(), e = null;
                    return b === h.streamType.inbound ? c === h.mediaType.audio ? e = this.getInbAudioMonitor(d) : c === h.mediaType.video && (e = this.getInbVideoMonitor(d)) : b === h.streamType.outbound && (c === h.mediaType.audio ? e = this.getOutbAudioMonitor(d) : c === h.mediaType.video && (e = this.getOutbVideoMonitor(d))), 
                    e;
                }
            }, {
                key: "extractTracks",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b.extractTrack());
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b.extractTrack());
                    }), a;
                }
            }, {
                key: "getTracks",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b.getTrack());
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b.getTrack());
                    }), a;
                }
            }, {
                key: "getMonitors",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b);
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b);
                    }), a;
                }
            }, {
                key: "getInbAudioMonitor",
                value: function(a) {
                    var b = this.inbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.audio), 
                    this.inbMonitors.set(a, b)), b;
                }
            }, {
                key: "getInbVideoMonitor",
                value: function(a) {
                    var b = this.inbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.video), 
                    this.inbMonitors.set(a, b)), b;
                }
            }, {
                key: "getOutbAudioMonitor",
                value: function(a) {
                    var b = this.outbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.audio), 
                    this.outbMonitors.set(a, b)), b;
                }
            }, {
                key: "getOutbVideoMonitor",
                value: function(a) {
                    var b = this.outbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.video), 
                    this.outbMonitors.set(a, b)), b;
                }
            } ]), a;
        }();
        c.TracksMonitor = i;
    }, {
        "../config/constants": 32,
        "./trackmonitor": 79
    } ],
    81: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TransportsMonitor = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/timestamps"), j = d(i), k = a("../utility/rttregistry"), l = function() {
            function a(b) {
                e(this, a), this.previous = b, this.actual = b, this.outdated = j.getCurrent();
            }
            return f(a, [ {
                key: "setActual",
                value: function(a) {
                    this.actual = a;
                }
            }, {
                key: "outdate",
                value: function() {
                    this.previous = this.actual, this.outdated = j.getCurrent();
                }
            }, {
                key: "getActual",
                value: function() {
                    return this.actual;
                }
            }, {
                key: "getPrevious",
                value: function() {
                    return this.previous;
                }
            }, {
                key: "getElapsedTime",
                value: function() {
                    return j.getCurrent() - this.outdated;
                }
            } ]), a;
        }(), m = function() {
            function a(b) {
                e(this, a), this.stats = new Map(), this.codeBase = b;
            }
            return f(a, [ {
                key: "set",
                value: function(a, b) {
                    var c = this.stats.get(a);
                    if (!c) return void this.stats.set(a, new l(b));
                    c.setActual(b);
                }
            }, {
                key: "getIntervalStats",
                value: function() {
                    var a = this, b = new Map();
                    return this.stats.forEach(function(c, d) {
                        b.set(d, a.getIntervalStat(c)), c.outdate();
                    }), b;
                }
            }, {
                key: "getIntervalStat",
                value: function(a) {
                    var b = null;
                    switch (this.codeBase) {
                      case h.codeBaseType.chrome:
                        b = this.getIntervalStatForChrome(a);
                        break;

                      default:
                        b = a.getActual();
                    }
                    return b;
                }
            }, {
                key: "getIntervalStatForChrome",
                value: function(a) {
                    var b = a.getActual(), c = a.getPrevious(), d = a.getElapsedTime();
                    if (!c) return actual;
                    for (var e = 0; e < b.length; ++e) {
                        var f = b[e], g = c[e];
                        if (!g || !f) return b;
                        var i = parseInt(g.bytesReceived, 10), j = parseInt(g.bytesSent, 10);
                        f.csioReceivedBwKbps = 8 * (parseInt(f.bytesReceived, 10) - i) / d, f.csioSentBwKbps = 8 * (parseInt(f.bytesSent, 10) - j) / d, 
                        f.csioIntBytesReceived = parseInt(f.bytesReceived, 10) - i, f.csioIntBytesSent = parseInt(f.bytesSent, 10) - j, 
                        void 0 !== g.packetsSent && void 0 !== f.packetsSent && (f.csioSentPacketRate = (parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)) / (d / 1e3), 
                        f.csioIntPacketsSent = parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)), 
                        void 0 !== g.packetsReceived && void 0 !== f.packetsReceived && (f.csioReceivedPacketRate = (parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)) / (d / 1e3), 
                        f.csioIntPacketsReceived = parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)), 
                        this.codeBase == h.codeBaseType.chrome && (f.currentRoundTripTime = (0, k.getRTTRegistry)().getTransportRTT());
                    }
                    return b;
                }
            } ]), a;
        }();
        c.TransportsMonitor = m;
    }, {
        "../config/constants": 32,
        "../utility/rttregistry": 95,
        "../utility/timestamps": 98
    } ],
    82: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return isNaN(a) ? null : a;
        }
        function e(a) {
            return null !== d(a) && 0 < a ? a : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.checkForNan = d, c.checkForNegativeValue = e;
    }, {} ],
    83: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a), this.getWifiStatsMethod = null, this.wifiStats = null, this.interval = 1e4;
            }
            return e(a, [ {
                key: "setGetWifiStatsMethod",
                value: function(a) {
                    this.getWifiStatsMethod = a, this.wifiStatsHandler();
                }
            }, {
                key: "getWifiStats",
                value: function() {
                    return this.wifiStats;
                }
            }, {
                key: "wifiStatsHandler",
                value: function() {
                    var a = this;
                    a.getWifiStatsMethod && a.getWifiStatsMethod().then(function(b) {
                        a.wifiStats = JSON.parse(b), setTimeout(function() {
                            a.wifiStatsHandler();
                        }, a.interval);
                    }).catch(function() {
                        setTimeout(function() {
                            a.wifiStatsHandler();
                        }, a.interval);
                    });
                }
            } ]), a;
        }();
        c.WifiStatsExecutor = f;
    }, {} ],
    84: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return window.btoa(a);
        }
        function e(a) {
            return window.atob(a);
        }
        function f(a) {
            return d(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g, function(a, b) {
                return String.fromCharCode("0x" + b);
            }));
        }
        function g(a) {
            return d(a).replace(/\+/g, "-").replace(/\//g, "_").replace(/\=+$/, "");
        }
        function h(a) {
            return f(a).replace(/\+/g, "-").replace(/\//g, "_").replace(/\=+$/, "");
        }
        function i(a) {
            for (var b = e(a.replace(/[ \r\n]+$/, "")), c = [], d = 0; d < b.length; ++d) {
                var f = b.charCodeAt(d).toString(16);
                1 === f.length && (f = "0" + f), c.push(f);
            }
            return c.join("");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.encode = d, c.decode = e, c.urlencode = g, c.urlencodeUnicode = h, c.strtohex = i;
    }, {} ],
    85: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Callbacks = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("./registry"), j = a("./csiologger"), k = d(j), l = function() {
            function a() {
                e(this, a), this.callbacks = {};
            }
            return f(a, [ {
                key: "set",
                value: function(a, b) {
                    if ("function" == typeof b) return h.callbackFunctions.hasOwnProperty(a) ? (this.callbacks[a] = b, 
                    void (a === h.callbackFunctions.stats && i.Registry.getStatsCallbackBuilder().setCallback(b))) : void k.error("Couldn't set callback: " + a);
                }
            }, {
                key: "get",
                value: function(a) {
                    return this.callbacks.hasOwnProperty(a) ? this.callbacks[a] : null;
                }
            } ]), a;
        }();
        c.Callbacks = l;
    }, {
        "../config/constants": 32,
        "./csiologger": 87,
        "./registry": 94
    } ],
    86: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Credentials = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = d(h), j = a("./csiologger"), k = d(j), l = function() {
            function a() {
                e(this, a), this.appId = null, this.userId = null, this.userIdObject = null, this.deviceId = null, 
                this.statsSubmissionInterval = 15e3, this.collectSDP = !1, this.transportType = i.transportType.rest, 
                this.adaptiveInterval = !1;
            }
            return g(a, [ {
                key: "getAppId",
                value: function() {
                    return this.appId;
                }
            }, {
                key: "setAppId",
                value: function(a) {
                    this.appId = "string" == typeof a ? parseInt(a, 10) : a;
                }
            }, {
                key: "getUserId",
                value: function() {
                    return this.userId;
                }
            }, {
                key: "setUserId",
                value: function(a) {
                    "object" === (void 0 === a ? "undefined" : f(a)) ? (this.userId = a.aliasName, this.setUserIdObject(a)) : this.userId = a;
                }
            }, {
                key: "getUserIdObject",
                value: function() {
                    return this.userIdObject;
                }
            }, {
                key: "setUserIdObject",
                value: function(a) {
                    this.userIdObject = a;
                }
            }, {
                key: "getStatsSubmissionInterval",
                value: function() {
                    return this.statsSubmissionInterval;
                }
            }, {
                key: "setStatsSubmissionInterval",
                value: function(a) {
                    k.log("setStatsSubmissionInterval is ", a), this.statsSubmissionInterval = a;
                }
            }, {
                key: "getCollectSDP",
                value: function() {
                    return this.collectSDP;
                }
            }, {
                key: "setCollectSDP",
                value: function(a) {
                    this.collectSDP = a;
                }
            }, {
                key: "getTransportType",
                value: function() {
                    return this.transportType;
                }
            }, {
                key: "setTransportType",
                value: function(a) {
                    this.transportType = a;
                }
            }, {
                key: "getAdaptiveInterval",
                value: function() {
                    return this.adaptiveInterval;
                }
            }, {
                key: "setAdaptiveInterval",
                value: function(a) {
                    this.adaptiveInterval = a;
                }
            } ]), a;
        }();
        c.Credentials = l;
    }, {
        "../config/constants": 32,
        "./csiologger": 87
    } ],
    87: [ function(a, b, c) {
        "use strict";
        function d() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).info.apply(a, arguments);
            }
        }
        function e() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).log.apply(a, arguments);
            }
        }
        function f() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).warn.apply(a, arguments);
            }
        }
        function g() {
            var a;
            (a = console).warn.apply(a, arguments);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.info = d, c.log = e, c.warn = f, c.error = g;
        var h = a("../config/settings"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h);
    }, {
        "../config/settings": 33
    } ],
    88: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Endpoint = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../browserapi/localstorage"), h = d(g), i = a("../browserapi/detectbrowser"), j = d(i), k = a("../utility/timestamps"), l = d(k), m = a("../utility/hash"), n = d(m), o = function() {
            function a() {
                e(this, a), this.id = null, this.appversion = null, this.magicKey = Math.floor(4294967296 * Math.random()), 
                this.browserName = null, this.browserVersion = null, this.osName = null, this.osVersion = null, 
                this.codeBase = null, this.userAgent = null, this.retrieveId();
            }
            return f(a, [ {
                key: "setup",
                value: function() {
                    var a = j.detect();
                    this.browserName = a.browserName, this.browserVersion = a.browserVersion, this.osName = a.os, 
                    this.osVersion = a.osVersion, this.codeBase = a.codeBase, this.userAgent = a.userAgent;
                }
            }, {
                key: "retrieveId",
                value: function() {
                    var a = this, b = h.get("endpointID");
                    if (null === b) {
                        var c = l.getCurrent(), d = Math.random() * c;
                        n.generateSHA256(d.toString(), function(b) {
                            a.id = b, h.store("endpointID", b);
                        });
                    } else this.id = b;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.id;
                }
            }, {
                key: "getAppVersion",
                value: function() {
                    return this.appversion;
                }
            }, {
                key: "setAppVersion",
                value: function(a) {
                    this.appversion = a;
                }
            }, {
                key: "getMagicKey",
                value: function() {
                    return this.magicKey;
                }
            }, {
                key: "getBrowserName",
                value: function() {
                    return this.browserName;
                }
            }, {
                key: "getBrowserVersion",
                value: function() {
                    return this.browserVersion;
                }
            }, {
                key: "getOsName",
                value: function() {
                    return this.osName;
                }
            }, {
                key: "getOsVersion",
                value: function() {
                    return this.osVersion;
                }
            }, {
                key: "getCodeBase",
                value: function() {
                    return this.codeBase;
                }
            }, {
                key: "getUserAgent",
                value: function() {
                    return this.userAgent;
                }
            }, {
                key: "serialize",
                value: function() {
                    return {
                        type: "browser",
                        buildName: this.browserName,
                        buildVersion: this.browserVersion,
                        appVersion: this.appversion,
                        os: this.osName,
                        osVersion: this.osVersion,
                        userAgent: this.userAgent
                    };
                }
            } ]), a;
        }();
        c.Endpoint = o;
    }, {
        "../browserapi/detectbrowser": 17,
        "../browserapi/localstorage": 19,
        "../utility/hash": 91,
        "../utility/timestamps": 98
    } ],
    89: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.EventMessage = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = d(h), j = a("../config/settings"), k = d(j), l = a("./registry"), m = a("./csiologger"), n = d(m), o = function() {
            function a(b, c, d, f) {
                e(this, a), this.eventType = b, this.customEntries = d, this.pcHandler = f, this.auth = l.Registry.getAuthenticator(), 
                this.clocksync = l.Registry.getClockSync(), this.timestamp = this.clocksync.getSynchronizedTimestamp(), 
                this.conferenceId = c, this.clockUnSynced = !this.clocksync.isCompleted();
            }
            return g(a, [ {
                key: "updateConferenceId",
                value: function(a) {
                    n.log("updating conferenceId to ", this.eventType, this.conferenceId, a), this.conferenceId = a;
                }
            }, {
                key: "toJson",
                value: function() {
                    if (!this.canBeSent()) return null;
                    var a = this.getCommonHeader();
                    return Object.assign(a, this.customEntries), this.eventType === i.internalFabricEvent.userJoined && delete a.connectionID, 
                    a;
                }
            }, {
                key: "getCallback",
                value: function() {
                    return this.pcHandler ? this.pcHandler.getCallback() : null;
                }
            }, {
                key: "canBeSent",
                value: function() {
                    var a = void 0, b = i.tmpConferenceId;
                    if (this.conferenceId === b) return !1;
                    if (this.pcHandler && !this.pcHandler.getRemoteId()) return !1;
                    if (this.eventType !== i.precalltestEvents.results) {
                        var c = l.Registry.getConferenceManager().get(this.conferenceId);
                        if (!c) return !1;
                        a = c.getUcId();
                    }
                    return !!this.auth.getToken() && (this.auth.isTokenValid() ? !!(this.isPriority() || this.clocksync.isCompleted() && a) && !(this.eventType === i.internalFabricEvent.userAlive && !a) : (this.auth.reAuthenticate(), 
                    !1));
                }
            }, {
                key: "isCachable",
                value: function() {
                    return -1 === [ i.internalFabricEvent.userAlive ].indexOf(this.eventType);
                }
            }, {
                key: "isPriority",
                value: function() {
                    var a = !1;
                    return this.eventType !== i.internalFabricEvent.userJoined && this.eventType !== i.precalltestEvents.results && this.eventType !== i.internalFabricEvent.userAlive || (a = !0), 
                    a;
                }
            }, {
                key: "getConferenceId",
                value: function() {
                    return this.conferenceId;
                }
            }, {
                key: "getCommonHeader",
                value: function() {
                    var a = {
                        version: k.version,
                        callstatsVersion: k.version,
                        channel: this.decideChannel(),
                        timestamp: this.timestamp,
                        action: this.eventType,
                        eventType: this.eventType,
                        localID: encodeURIComponent(l.Registry.getCredentials().getUserId()),
                        timeShift: 0,
                        appID: l.Registry.getCredentials().getAppId(),
                        deviceID: l.Registry.getEndpoint().getId(),
                        token: this.auth.getToken(),
                        confID: encodeURIComponent(this.conferenceId)
                    };
                    this.clockUnSynced && (a.timestamp += this.clocksync.getOffset());
                    var b = l.Registry.getConferenceManager().get(this.conferenceId);
                    return a.ucID = b ? b.getUcId() : null, this.eventType !== i.callstatsChannels.userFeedback && this.eventType !== i.precalltestEvents.results && (this.pcHandler ? (a.remoteID = encodeURIComponent(this.pcHandler.getRemoteId()), 
                    a.connectionID = this.pcHandler.getPcHash()) : (a.remoteID = encodeURIComponent(l.Registry.getCredentials().getUserId()), 
                    a.connectionID = encodeURIComponent(l.Registry.getCredentials().getUserId()))), 
                    a;
                }
            }, {
                key: "decideChannel",
                value: function() {
                    if (this.eventType == i.callstatsChannels.sdpSubmission) return i.callstatsChannels.sdpSubmission;
                    if (this.eventType == i.callstatsChannels.userFeedback) return i.callstatsChannels.userFeedback;
                    if (this.eventType == i.callstatsChannels.processedStats) return i.callstatsChannels.processedStats;
                    for (var a in i.precalltestEvents) if (this.eventType == i.precalltestEvents[a]) return i.callstatsChannels.preCallTest;
                    return i.callstatsChannels.callstatsEvent;
                }
            } ], [ {
                key: "checkCustomEntries",
                value: function(a, b) {
                    if (!p[a]) return n.error("eventType not recognized:", a), !1;
                    var c = p[a];
                    for (var d in c) if (!b.hasOwnProperty(d) || f(b[d]) !== c[d]) return n.error("customEntries for", a, "should have", d, "of type", c[d]), 
                    !1;
                    return !0;
                }
            } ]), a;
        }(), p = {};
        p[i.internalFabricEvent.userJoined] = {
            endpointInfo: "object"
        }, p[i.internalFabricEvent.userLeft] = {}, p[i.internalFabricEvent.userAlive] = {}, 
        p[i.internalFabricEvent.userDetails] = {
            userName: "string"
        }, p[i.internalFabricEvent.connectedDeviceList] = {
            mediaDeviceList: "object"
        }, p[i.fabricEvent.activeDeviceList] = {
            mediaDeviceList: "object"
        }, p[i.fabricEvent.audioMute] = {}, p[i.fabricEvent.audioUnmute] = {}, p[i.fabricEvent.videoPause] = {}, 
        p[i.fabricEvent.videoResume] = {}, p[i.fabricEvent.screenShareStart] = {}, p[i.fabricEvent.screenShareStop] = {}, 
        p[i.internalFabricEvent.mediaPlaybackStart] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.mediaPlaybackSuspended] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.mediaPlaybackStalled] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.oneWayMedia] = {
            mediaType: "string",
            ssrc: "string"
        }, p[i.internalFabricEvent.fabricSetup] = {
            localIceCandidates: "object",
            remoteIceCandidates: "object",
            iceCandidatePairs: "object"
        }, p[i.fabricEvent.fabricSetupFailed] = {
            failureDelay: "number",
            reason: "string",
            function: "string",
            endpoint: "object"
        }, p[i.internalFabricEvent.fabricStateChange] = {
            changedState: "string",
            prevState: "string",
            newState: "string"
        }, p[i.internalFabricEvent.fabricDropped] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            currIceCandidatePair: "object",
            failureDelay: "number"
        }, p[i.internalFabricEvent.iceConnectionDisruptionStart] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceConnectionStateTs: "number",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceConnectionDisruptionEnd] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            disruptionDelay: "number"
        }, p[i.internalFabricEvent.iceDisruptionStart] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceConnectionStateTs: "number",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceDisruptionEnd] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceFailed] = {
            localIceCandidates: "object",
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            currIceCandidatePair: "object",
            failureDelay: "number"
        }, p[i.internalFabricEvent.iceAborted] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string"
        }, p[i.internalFabricEvent.iceRestarted] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceCandidatePair: "object"
        }, p[i.internalFabricEvent.fabricTransportSwitch] = {
            prevIceCandidatePair: "object",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceTerminated] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string"
        }, p[i.fabricEvent.fabricTerminated] = {}, p[i.fabricEvent.fabricHold] = {}, p[i.fabricEvent.fabricResume] = {}, 
        p[i.callstatsChannels.sdpSubmission] = {
            localSDP: "string",
            remoteSDP: "string"
        }, p[i.internalFabricEvent.ssrcMap] = {
            ssrcData: "object"
        }, p[i.callstatsChannels.userFeedback] = {
            feedback: "object"
        }, p[i.internalFabricEvent.sendingThroughputObservations] = {
            ssrc: "string",
            maxsendingKBitrate: "number",
            timeToMaxSendingKBitrate: "number",
            stablesendingKBitrate: "number",
            timeToStableSendingKBitrate: "number"
        }, p[i.fabricEvent.dominantSpeaker] = {}, p[i.fabricEvent.applicationErrorLog] = {
            message: "string",
            messageType: "string"
        }, p[i.callstatsChannels.processedStats] = {
            stats: "object"
        }, p[i.callstatsChannels.senderConfiguration] = {
            rtc_rtp_parameters: "object"
        }, p[i.internalFabricEvent.limitationObservations] = {
            reason: "string"
        }, p[i.qualityDisruptionTypes.qpchange] = {
            reason: "string"
        }, p[i.precalltestEvents.results] = {
            results: "object"
        }, p[i.precalltestEvents.associate] = {
            ids: "object"
        }, c.EventMessage = o;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "./csiologger": 87,
        "./registry": 94
    } ],
    90: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.EventMessageBuilder = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./eventmessage"), i = a("../config/constants"), j = d(i), k = a("./registry"), l = a("./csiologger"), m = d(l), n = function() {
            function a() {
                e(this, a), this.transmissionmanager = k.Registry.getTransmissionManager();
            }
            return g(a, [ {
                key: "make",
                value: function(a, b, c) {
                    var d = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {};
                    if ("string" != typeof a || null === d || "object" !== (void 0 === d ? "undefined" : f(d))) return m.error("failed typeof checks:", a, void 0 === a ? "undefined" : f(a), void 0 === d ? "undefined" : f(d), d), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed typeof checks:" + a + ":" + (void 0 === d ? "undefined" : f(d))
                    }), !1;
                    if (null === b && a !== j.precalltestEvents.results) return m.error("failed conferenceId checks:", a, b), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed conferenceId checks:" + a
                    }), !1;
                    if (!c && a !== j.callstatsChannels.userFeedback && a !== j.fabricEvent.applicationErrorLog && a !== j.fabricEvent.fabricSetupFailed && a !== j.precalltestEvents.results) return m.error("peerconnection cannot be null", a), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "peerconnection cannot be null" + a
                    }), !1;
                    if (!h.EventMessage.checkCustomEntries(a, d)) return m.error("failed checks:", a, d), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed customEntries checks:" + a
                    }), !1;
                    var e = void 0;
                    if (b) {
                        var g = k.Registry.getConferenceManager().get(b);
                        g && c && (e = g.getPeerConnectionManager().getPcHandler(c));
                    }
                    var i = new h.EventMessage(a, b, d, e);
                    return this.transmissionmanager.send(i), !0;
                }
            } ]), a;
        }();
        c.EventMessageBuilder = n;
    }, {
        "../config/constants": 32,
        "./csiologger": 87,
        "./eventmessage": 89,
        "./registry": 94
    } ],
    91: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            var c = {
                name: "SHA-256"
            };
            if (window.crypto) {
                var d = window.crypto.subtle || window.crypto.webkitSubtle;
                if (!d) return void e(a, b);
                d.digest(c, f(a)).then(function(a) {
                    b(g(a));
                }).catch(function() {
                    e(a, b);
                });
            } else if (window.msCrypto) {
                if (!window.msCrypto.subtle) return void e(a, b);
                var h = window.msCrypto.subtle.digest(c, f(a));
                h.oncomplete = function(a) {
                    a.target && b(g(a.target.result));
                }, h.onerror = function() {
                    e(a, b);
                };
            } else e(a, b);
        }
        function e(a) {
            var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, c = 0;
            if (!a) return c;
            for (var d = 0, e = a.length; d < e; d++) {
                c = (c << 5) - c + a.charCodeAt(d), c |= 0;
            }
            return b && b(c + ""), c + "";
        }
        function f(a) {
            for (var b = [], c = 0; c < a.length; ++c) {
                var d = a.charCodeAt(c);
                d < 128 ? b[b.length] = d : d > 127 && d < 2048 ? (b[b.length] = d >> 6 | 192, b[b.length] = 63 & d | 128) : (b[b.length] = d >> 12 | 224, 
                b[b.length] = d >> 6 & 63 | 128, b[b.length] = 63 & d | 128);
            }
            return new Uint8Array(b).buffer;
        }
        function g(a) {
            for (var b = new DataView(a), c = "", d = void 0, e = 0; e < b.byteLength; e++) d = b.getUint8(e).toString(16), 
            d.length < 2 && (d = "0" + d), c += d;
            return c;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.generateSHA256 = d, c.generateHash = e;
    }, {} ],
    92: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return !!/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""));
        }
        function e(a) {
            var b = null;
            return null === a ? b : (d(a) && (b = JSON.parse(a)), b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.isValid = d, c.parse = e;
    }, {} ],
    93: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e() {
            window && window.addEventListener && window.addEventListener("error", function(a) {
                var b = f.Registry.getGenericEventHandler();
                if (a && a.filename && a.filename.indexOf("callstats") > -1) {
                    for (var c = !1, d = {
                        fileName: a.filename,
                        line: a.lineno,
                        col: a.colno,
                        jsVersion: h.version,
                        eventType: "error",
                        message: a.message,
                        pageURL: window.location.href
                    }, e = f.Registry.getConferenceManager().getConferenceIds(), g = 0; g < e.length; g++) d.conferenceID = e[g], 
                    b.sendEvent(j.logEvents.error, d), c = !0;
                    c || b.sendEvent(j.logEvents.error, d);
                }
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.setErrorEventListener = e;
        var f = a("./registry"), g = a("../config/settings"), h = d(g), i = a("../config/constants"), j = d(i);
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "./registry": 94
    } ],
    94: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Registry = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../services/clocksync"), g = a("../services/configservice/configservicewrapper"), h = a("../services/authenticator"), i = a("../services/backendlog"), j = a("../services/transmissionmanager"), k = a("./eventmessagebuilder"), l = a("../conference/conferencemanager"), m = a("../utility/credentials"), n = a("../statspipeline/statsadapter"), o = a("../statspipeline/statsparser"), p = a("../statspipeline/statsmonitor"), q = a("../statspipeline/statstransmitter"), r = a("../statspipeline/statsassembler"), s = a("../utility/endpoint"), t = a("../browserapi/battery"), u = a("precalltest"), v = a("../statspipeline/wifistatsexecutor"), w = a("./callbacks"), x = a("../statspipeline/statscallbackbuilder"), y = a("../services/connectionmanager"), z = null, A = null, B = null, C = null, D = null, E = null, F = null, G = null, H = null, I = null, J = null, K = null, L = null, M = null, N = null, O = null, P = null, Q = null, R = null, S = null, T = function() {
            function a() {
                d(this, a);
            }
            return e(a, null, [ {
                key: "getConferenceManager",
                value: function() {
                    return O || (O = new l.ConferenceManager()), O;
                }
            }, {
                key: "getStatsCallbackBuilder",
                value: function() {
                    return R || (R = new x.StatsCallbackBuilder()), R;
                }
            }, {
                key: "getClockSync",
                value: function() {
                    return A || (A = new f.ClockSync()), A;
                }
            }, {
                key: "getWifiStatsExecutor",
                value: function() {
                    return P || (P = new v.WifiStatsExecutor()), P;
                }
            }, {
                key: "getAuthenticator",
                value: function() {
                    return B || (B = new h.Authenticator()), B;
                }
            }, {
                key: "getConfigServiceWrapper",
                value: function() {
                    return C || (C = new g.ConfigServiceWrapper()), C;
                }
            }, {
                key: "getGenericEventHandler",
                value: function() {
                    return D || (D = new i.GenericEventHandler(), D.enable()), D;
                }
            }, {
                key: "getConnectionManager",
                value: function() {
                    return S || (S = new y.ConnectionManager()), S;
                }
            }, {
                key: "getTransmissionManager",
                value: function() {
                    return E || (E = new j.TransmissionManager()), E;
                }
            }, {
                key: "getEventMessageBuilder",
                value: function() {
                    return F || (F = new k.EventMessageBuilder()), F;
                }
            }, {
                key: "getCredentials",
                value: function() {
                    return G || (G = new m.Credentials()), G;
                }
            }, {
                key: "getEndpoint",
                value: function() {
                    return H || (H = new s.Endpoint()), H;
                }
            }, {
                key: "getStatsAdapter",
                value: function() {
                    if (!I) {
                        var b = a.getEndpoint().getCodeBase(), c = a.getEndpoint().getBrowserName();
                        I = new n.StatsAdapter(b, c);
                    }
                    return I;
                }
            }, {
                key: "getPreCallTest",
                value: function() {
                    return z || (z = new u.PreCallTest()), z;
                }
            }, {
                key: "getStatsParser",
                value: function() {
                    return J || (J = new o.StatsParser()), J;
                }
            }, {
                key: "getStatsMonitor",
                value: function() {
                    if (!K) {
                        var b = a.getEndpoint().getCodeBase();
                        K = new p.StatsMonitor(b);
                    }
                    return K;
                }
            }, {
                key: "getStatsTransmitter",
                value: function() {
                    return L || (L = new q.StatsTransmitter()), L;
                }
            }, {
                key: "getStatsAssembler",
                value: function() {
                    return M || (M = new r.StatsAssembler()), M;
                }
            }, {
                key: "getBattery",
                value: function() {
                    return N || (N = new t.Battery()), N;
                }
            }, {
                key: "getCallbacks",
                value: function() {
                    return Q || (Q = new w.Callbacks()), Q;
                }
            } ]), a;
        }();
        c.Registry = T;
    }, {
        "../browserapi/battery": 16,
        "../conference/conferencemanager": 30,
        "../services/authenticator": 43,
        "../services/backendlog": 44,
        "../services/clocksync": 45,
        "../services/configservice/configservicewrapper": 49,
        "../services/connectionmanager": 50,
        "../services/transmissionmanager": 55,
        "../statspipeline/statsadapter": 68,
        "../statspipeline/statsassembler": 69,
        "../statspipeline/statscallbackbuilder": 70,
        "../statspipeline/statsmonitor": 71,
        "../statspipeline/statsparser": 72,
        "../statspipeline/statstransmitter": 73,
        "../statspipeline/wifistatsexecutor": 83,
        "../utility/credentials": 86,
        "../utility/endpoint": 88,
        "./callbacks": 85,
        "./eventmessagebuilder": 90,
        precalltest: 2
    } ],
    95: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e() {
            return null === i && (i = new j()), i;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }();
        c.getRTTRegistry = e;
        var g = a("../statspipeline/validator"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = null, j = function() {
            function a() {
                d(this, a), this.rtts = new Map(), this.transportRTT = null;
            }
            return f(a, [ {
                key: "update",
                value: function(a) {
                    var b = this;
                    a.getStats(function(a) {
                        for (var c = [], d = a.result(), e = 0; e < d.length; ++e) {
                            var f = d[e];
                            if ("googCandidatePair" !== f.type) {
                                if ("ssrc" === f.type) {
                                    var g = f.stat("googRtt"), i = f.stat("ssrc");
                                    g && b.rtts.set(h.checkForNan(parseInt(i, 10)), h.checkForNan(parseInt(g, 10)));
                                }
                            } else {
                                var j = f.stat("googRtt");
                                c.push(j);
                            }
                        }
                        b.transportRTT = Math.max.apply(Math, c);
                    });
                }
            }, {
                key: "getTransportRTT",
                value: function() {
                    return this.transportRTT;
                }
            }, {
                key: "getRTT",
                value: function(a) {
                    var b = h.checkForNan(parseInt(a, 10));
                    return this.rtts.has(b) ? this.rtts.get(b) : null;
                }
            } ]), a;
        }();
    }, {
        "../statspipeline/validator": 82
    } ],
    96: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e) {
                d(this, a), this.max = b, this.midpoint = c, this.stepness = e, this.actualStep = 0, 
                this.reset();
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.actualStep = 0;
                }
            }, {
                key: "setMidpoint",
                value: function(a) {
                    this.midpoint = a;
                }
            }, {
                key: "setMax",
                value: function(a) {
                    this.max = a;
                }
            }, {
                key: "setStepness",
                value: function(a) {
                    this.stepness = a;
                }
            }, {
                key: "increaseActualStep",
                value: function(a) {
                    this.actualStep += a;
                }
            }, {
                key: "getActual",
                value: function() {
                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;
                    return this.actualStep += a, this.max / (1 + Math.exp(-1 * this.stepness * (this.actualStep - this.midpoint)));
                }
            } ]), a;
        }();
        c.Sigmoid = f;
    }, {} ],
    97: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TimeoutProcess = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b) {
                d(this, a), this.interval = b, this.timerId = null, this.callback = function() {
                    g.warn("no callback function set", this);
                };
            }
            return e(a, [ {
                key: "setCallback",
                value: function(a) {
                    this.callback = a;
                }
            }, {
                key: "start",
                value: function() {
                    var a = this;
                    this.timerId = setInterval(function() {
                        a.callback();
                    }, this.interval);
                }
            }, {
                key: "stop",
                value: function() {
                    clearInterval(this.timerId), this.timerId = null;
                }
            }, {
                key: "isStarted",
                value: function() {
                    return null !== this.timerId;
                }
            } ]), a;
        }();
        c.TimeoutProcess = h;
    }, {
        "./csiologger": 87
    } ],
    98: [ function(a, b, c) {
        "use strict";
        function d() {
            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
        }
        function e() {
            return window && window.performance && window.performance.now ? window.performance.now() : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getCurrent = d, c.getSinceOrigin = e;
    }, {} ],
    99: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = function() {
            function a(b) {
                d(this, a), this.base = b;
                for (var c = arguments.length, e = Array(c > 1 ? c - 1 : 0), f = 1; f < c; f++) e[f - 1] = arguments[f];
                this.appendixes = e;
            }
            return f(a, null, [ {
                key: "concat",
                value: function(a, b) {
                    if (!b) return a;
                    if (!a) return b;
                    var c = "/" === a.substr(a.length - 1), d = "/" === b.substring(0, 1);
                    return c || d ? c && d ? a + b.substring(1) : a + b : a + "/" + b;
                }
            } ]), f(a, [ {
                key: "append",
                value: function(a) {
                    this.appendixes.push(a);
                }
            }, {
                key: "toString",
                value: function() {
                    var b = this.getString(this.base), c = this;
                    return this.appendixes.forEach(function(d) {
                        if (null !== d && void 0 !== d) {
                            var e = c.getString(d);
                            b = a.concat(b, e);
                        }
                    }), b;
                }
            }, {
                key: "getString",
                value: function(a) {
                    switch (void 0 === a ? "undefined" : e(a)) {
                      case "function":
                        return this.getString(a());

                      case "number":
                        return a + "";

                      case "string":
                      default:
                        return a;
                    }
                }
            } ]), a;
        }();
        c.Url = g;
    }, {} ],
    100: [ function(a, b, c) {
        "use strict";
        function d(a) {
            var b = [];
            if (!a) return b;
            for (var c = 0; c < a.length; c++) {
                var d = {};
                d.mediaDeviceID = a[c].deviceId, d.groupID = a[c].groupId, d.kind = a[c].kind, d.label = a[c].label, 
                b.push(d);
            }
            return b;
        }
        function e() {
            Number.isInteger || (Number.isInteger = Number.isInteger || function(a) {
                return "number" == typeof a && isFinite(a) && Math.floor(a) === a;
            });
        }
        function f() {
            "function" != typeof Object.assign && Object.defineProperty(Object, "assign", {
                value: function(a, b) {
                    if (null == a) throw new TypeError("Cannot convert undefined or null to object");
                    for (var c = Object(a), d = 1; d < arguments.length; d++) {
                        var e = arguments[d];
                        if (null != e) for (var f in e) Object.prototype.hasOwnProperty.call(e, f) && (c[f] = e[f]);
                    }
                    return c;
                },
                writable: !0,
                configurable: !0
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.normalizeMediaDeviceList = d, c.isIntegerPollyfill = e, c.assignPollyfill = f;
    }, {} ]
}, {}, [ 21 ]);